var En=te=>{throw TypeError(te)};var wn=(te,de,K)=>de.has(te)||En("Cannot "+K);var k=(te,de,K)=>(wn(te,de,"read from private field"),K?K.call(te):de.get(te)),Z=(te,de,K)=>de.has(te)?En("Cannot add the same private member more than once"):de instanceof WeakSet?de.add(te):de.set(te,K),U=(te,de,K,Oe)=>(wn(te,de,"write to private field"),Oe?Oe.call(te,K):de.set(te,K),K);var Nr=(te,de,K,Oe)=>({set _(Ue){U(te,de,Ue,K)},get _(){return k(te,de,Oe)}});(function(){"use strict";var Ue,Ae,Tt,ut,Se,_t,He,Ct,Re,Ge,Me,At,ct,ze,ht,ft,We,$e,kt,Ot,pt,Ye,dt,Ne,Ft,It,mt,vt,gt,Dt,Lt,yt,rt,Rt,nt,Le,Et,qe;var Module=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(t){t=t||{};var t=typeof t<"u"?t:{},n,s;t.ready=new Promise(function(l,c){n=l,s=c});var i=Object.assign({},t),o="./this.program",a=(l,c)=>{throw c},u=typeof window=="object",h=typeof importScripts=="function",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",m="";function v(l){return t.locateFile?t.locateFile(l,m):m+l}var E,x,P;function T(l){if(l instanceof Rr)return;F("exiting due to exception: "+l)}var C,I,O;p?(h?m=require("path").dirname(m)+"/":m=__dirname+"/",O=()=>{I||(C=require("fs"),I=require("path"))},E=function(c,f){return O(),c=I.normalize(c),C.readFileSync(c,f?void 0:"utf8")},P=l=>{var c=E(l,!0);return c.buffer||(c=new Uint8Array(c)),c},x=(l,c,f)=>{O(),l=I.normalize(l),C.readFile(l,function(d,g){d?f(d):c(g.buffer)})},process.argv.length>1&&(o=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(l){if(!(l instanceof Rr))throw l}),process.on("unhandledRejection",function(l){throw l}),a=(l,c)=>{if(Hr())throw process.exitCode=l,c;T(c),process.exit(l)},t.inspect=function(){return"[Emscripten Module object]"}):(u||h)&&(h?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),r&&(m=r),m.indexOf("blob:")!==0?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="",E=l=>{var c=new XMLHttpRequest;return c.open("GET",l,!1),c.send(null),c.responseText},h&&(P=l=>{var c=new XMLHttpRequest;return c.open("GET",l,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),x=(l,c,f)=>{var d=new XMLHttpRequest;d.open("GET",l,!0),d.responseType="arraybuffer",d.onload=()=>{if(d.status==200||d.status==0&&d.response){c(d.response);return}f()},d.onerror=f,d.send(null)});var G=t.print||console.log.bind(console),F=t.printErr||console.warn.bind(console);Object.assign(t,i),i=null,t.arguments&&t.arguments,t.thisProgram&&(o=t.thisProgram),t.quit&&(a=t.quit);var Y=4,V;t.wasmBinary&&(V=t.wasmBinary);var W=t.noExitRuntime||!0;typeof WebAssembly!="object"&&it("no native wasm support detected");var q,ce=!1;function J(l,c){l||it(c)}var ge=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function fe(l,c,f){for(var d=c+f,g=c;l[g]&&!(g>=d);)++g;if(g-c>16&&l.buffer&&ge)return ge.decode(l.subarray(c,g));for(var w="";c<g;){var b=l[c++];if(!(b&128)){w+=String.fromCharCode(b);continue}var S=l[c++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|S);continue}var _=l[c++]&63;if((b&240)==224?b=(b&15)<<12|S<<6|_:b=(b&7)<<18|S<<12|_<<6|l[c++]&63,b<65536)w+=String.fromCharCode(b);else{var A=b-65536;w+=String.fromCharCode(55296|A>>10,56320|A&1023)}}return w}function Q(l,c){return l?fe(_e,l,c):""}function oe(l,c,f,d){if(!(d>0))return 0;for(var g=f,w=f+d-1,b=0;b<l.length;++b){var S=l.charCodeAt(b);if(S>=55296&&S<=57343){var _=l.charCodeAt(++b);S=65536+((S&1023)<<10)|_&1023}if(S<=127){if(f>=w)break;c[f++]=S}else if(S<=2047){if(f+1>=w)break;c[f++]=192|S>>6,c[f++]=128|S&63}else if(S<=65535){if(f+2>=w)break;c[f++]=224|S>>12,c[f++]=128|S>>6&63,c[f++]=128|S&63}else{if(f+3>=w)break;c[f++]=240|S>>18,c[f++]=128|S>>12&63,c[f++]=128|S>>6&63,c[f++]=128|S&63}}return c[f]=0,f-g}function $(l,c,f){return oe(l,_e,c,f)}function X(l){for(var c=0,f=0;f<l.length;++f){var d=l.charCodeAt(f);d>=55296&&d<=57343&&(d=65536+((d&1023)<<10)|l.charCodeAt(++f)&1023),d<=127?++c:d<=2047?c+=2:d<=65535?c+=3:c+=4}return c}var ae=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ye(l,c){for(var f=l,d=f>>1,g=d+c/2;!(d>=g)&&Gt[d];)++d;if(f=d<<1,f-l>32&&ae)return ae.decode(_e.subarray(l,f));for(var w="",b=0;!(b>=c/2);++b){var S=st[l+b*2>>1];if(S==0)break;w+=String.fromCharCode(S)}return w}function xe(l,c,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var d=c,g=f<l.length*2?f/2:l.length,w=0;w<g;++w){var b=l.charCodeAt(w);st[c>>1]=b,c+=2}return st[c>>1]=0,c-d}function ue(l){return l.length*2}function be(l,c){for(var f=0,d="";!(f>=c/4);){var g=N[l+f*4>>2];if(g==0)break;if(++f,g>=65536){var w=g-65536;d+=String.fromCharCode(55296|w>>10,56320|w&1023)}else d+=String.fromCharCode(g)}return d}function Bt(l,c,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var d=c,g=d+f-4,w=0;w<l.length;++w){var b=l.charCodeAt(w);if(b>=55296&&b<=57343){var S=l.charCodeAt(++w);b=65536+((b&1023)<<10)|S&1023}if(N[c>>2]=b,c+=4,c+4>g)break}return N[c>>2]=0,c-d}function vr(l){for(var c=0,f=0;f<l.length;++f){var d=l.charCodeAt(f);d>=55296&&d<=57343&&++f,c+=4}return c}function jt(l){var c=X(l)+1,f=Je(c);return f&&oe(l,Te,f,c),f}function Ut(l,c){Te.set(l,c)}function Zt(l,c,f){for(var d=0;d<l.length;++d)Te[c++>>0]=l.charCodeAt(d);Te[c>>0]=0}var Xe,Te,_e,st,Gt,N,ee,Fe,Fr;function Br(l){Xe=l,t.HEAP8=Te=new Int8Array(l),t.HEAP16=st=new Int16Array(l),t.HEAP32=N=new Int32Array(l),t.HEAPU8=_e=new Uint8Array(l),t.HEAPU16=Gt=new Uint16Array(l),t.HEAPU32=ee=new Uint32Array(l),t.HEAPF32=Fe=new Float32Array(l),t.HEAPF64=Fr=new Float64Array(l)}t.INITIAL_MEMORY;var Ur,Gr=[],Wr=[],Vr=[];function Hr(){return W}function bn(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Pn(t.preRun.shift());yr(Gr)}function Sn(){!t.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,yr(Wr)}function xn(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)_n(t.postRun.shift());yr(Vr)}function Pn(l){Gr.unshift(l)}function Tn(l){Wr.unshift(l)}function _n(l){Vr.unshift(l)}var wt=0,Wt=null;function ro(l){return l}function gr(l){wt++,t.monitorRunDependencies&&t.monitorRunDependencies(wt)}function Kt(l){if(wt--,t.monitorRunDependencies&&t.monitorRunDependencies(wt),wt==0&&Wt){var c=Wt;Wt=null,c()}}function it(l){t.onAbort&&t.onAbort(l),l="Aborted("+l+")",F(l),ce=!0,l+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(l);throw s(c),c}var Cn="data:application/octet-stream;base64,";function zr(l){return l.startsWith(Cn)}function $r(l){return l.startsWith("file://")}var Ie;Ie="replicad_single.wasm",zr(Ie)||(Ie=v(Ie));function Yr(l){try{if(l==Ie&&V)return new Uint8Array(V);if(P)return P(l);throw"both async and sync fetching of the wasm failed"}catch(c){it(c)}}function An(){if(!V&&(u||h)){if(typeof fetch=="function"&&!$r(Ie))return fetch(Ie,{credentials:"same-origin"}).then(function(l){if(!l.ok)throw"failed to load wasm binary file at '"+Ie+"'";return l.arrayBuffer()}).catch(function(){return Yr(Ie)});if(x)return new Promise(function(l,c){x(Ie,function(f){l(new Uint8Array(f))},c)})}return Promise.resolve().then(function(){return Yr(Ie)})}function kn(){var l={a:Ji};function c(b,S){var _=b.exports;t.asm=_,q=t.asm.oa,Br(q.buffer),Ur=t.asm.va,Tn(t.asm.pa),Kt()}gr();function f(b){c(b.instance)}function d(b){return An().then(function(S){return WebAssembly.instantiate(S,l)}).then(function(S){return S}).then(b,function(S){F("failed to asynchronously prepare wasm: "+S),it(S)})}function g(){return!V&&typeof WebAssembly.instantiateStreaming=="function"&&!zr(Ie)&&!$r(Ie)&&!p&&typeof fetch=="function"?fetch(Ie,{credentials:"same-origin"}).then(function(b){var S=WebAssembly.instantiateStreaming(b,l);return S.then(f,function(_){return F("wasm streaming compile failed: "+_),F("falling back to ArrayBuffer instantiation"),d(f)})}):d(f)}if(t.instantiateWasm)try{var w=t.instantiateWasm(l,c);return w}catch(b){return F("Module.instantiateWasm callback failed with error: "+b),!1}return g().catch(s),{}}var Pe,je;function On(){return t.HEAP8.length}function yr(l){for(;l.length>0;){var c=l.shift();if(typeof c=="function"){c(t);continue}var f=c.func;typeof f=="number"?c.arg===void 0?Jt(f)():Jt(f)(c.arg):f(c.arg===void 0?null:c.arg)}}var Qt=[];function Jt(l){var c=Qt[l];return c||(l>=Qt.length&&(Qt.length=l+1),Qt[l]=c=Ur.get(l)),c}function In(l,c,f,d){it("Assertion failed: "+Q(l)+", at: "+[c?Q(c):"unknown filename",f,d?Q(d):"unknown function"])}function Dn(l){return Je(l+24)+24}function Ln(l){this.excPtr=l,this.ptr=l-24,this.set_type=function(c){ee[this.ptr+4>>2]=c},this.get_type=function(){return ee[this.ptr+4>>2]},this.set_destructor=function(c){ee[this.ptr+8>>2]=c},this.get_destructor=function(){return ee[this.ptr+8>>2]},this.set_refcount=function(c){N[this.ptr>>2]=c},this.set_caught=function(c){c=c?1:0,Te[this.ptr+12>>0]=c},this.get_caught=function(){return Te[this.ptr+12>>0]!=0},this.set_rethrown=function(c){c=c?1:0,Te[this.ptr+13>>0]=c},this.get_rethrown=function(){return Te[this.ptr+13>>0]!=0},this.init=function(c,f){this.set_adjusted_ptr(0),this.set_type(c),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var c=N[this.ptr>>2];N[this.ptr>>2]=c+1},this.release_ref=function(){var c=N[this.ptr>>2];return N[this.ptr>>2]=c-1,c===1},this.set_adjusted_ptr=function(c){ee[this.ptr+16>>2]=c},this.get_adjusted_ptr=function(){return ee[this.ptr+16>>2]},this.get_exception_ptr=function(){var c=yn(this.get_type());if(c)return ee[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function Rn(l,c,f){var d=new Ln(l);throw d.init(c,f),l}var re={isAbs:l=>l.charAt(0)==="/",splitPath:l=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(l).slice(1)},normalizeArray:(l,c)=>{for(var f=0,d=l.length-1;d>=0;d--){var g=l[d];g==="."?l.splice(d,1):g===".."?(l.splice(d,1),f++):f&&(l.splice(d,1),f--)}if(c)for(;f;f--)l.unshift("..");return l},normalize:l=>{var c=re.isAbs(l),f=l.substr(-1)==="/";return l=re.normalizeArray(l.split("/").filter(d=>!!d),!c).join("/"),!l&&!c&&(l="."),l&&f&&(l+="/"),(c?"/":"")+l},dirname:l=>{var c=re.splitPath(l),f=c[0],d=c[1];return!f&&!d?".":(d&&(d=d.substr(0,d.length-1)),f+d)},basename:l=>{if(l==="/")return"/";l=re.normalize(l),l=l.replace(/\/$/,"");var c=l.lastIndexOf("/");return c===-1?l:l.substr(c+1)},join:function(){var l=Array.prototype.slice.call(arguments,0);return re.normalize(l.join("/"))},join2:(l,c)=>re.normalize(l+"/"+c)};function Mn(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var l=new Uint8Array(1);return function(){return crypto.getRandomValues(l),l[0]}}else if(p)try{var c=require("crypto");return function(){return c.randomBytes(1)[0]}}catch{}return function(){it("randomDevice")}}var Ze={resolve:function(){for(var l="",c=!1,f=arguments.length-1;f>=-1&&!c;f--){var d=f>=0?arguments[f]:y.cwd();if(typeof d!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!d)return"";l=d+"/"+l,c=re.isAbs(d)}return l=re.normalizeArray(l.split("/").filter(g=>!!g),!c).join("/"),(c?"/":"")+l||"."},relative:(l,c)=>{l=Ze.resolve(l).substr(1),c=Ze.resolve(c).substr(1);function f(A){for(var R=0;R<A.length&&A[R]==="";R++);for(var M=A.length-1;M>=0&&A[M]==="";M--);return R>M?[]:A.slice(R,M-R+1)}for(var d=f(l.split("/")),g=f(c.split("/")),w=Math.min(d.length,g.length),b=w,S=0;S<w;S++)if(d[S]!==g[S]){b=S;break}for(var _=[],S=b;S<d.length;S++)_.push("..");return _=_.concat(g.slice(b)),_.join("/")}},bt={ttys:[],init:function(){},shutdown:function(){},register:function(l,c){bt.ttys[l]={input:[],output:[],ops:c},y.registerDevice(l,bt.stream_ops)},stream_ops:{open:function(l){var c=bt.ttys[l.node.rdev];if(!c)throw new y.ErrnoError(43);l.tty=c,l.seekable=!1},close:function(l){l.tty.ops.flush(l.tty)},flush:function(l){l.tty.ops.flush(l.tty)},read:function(l,c,f,d,g){if(!l.tty||!l.tty.ops.get_char)throw new y.ErrnoError(60);for(var w=0,b=0;b<d;b++){var S;try{S=l.tty.ops.get_char(l.tty)}catch{throw new y.ErrnoError(29)}if(S===void 0&&w===0)throw new y.ErrnoError(6);if(S==null)break;w++,c[f+b]=S}return w&&(l.node.timestamp=Date.now()),w},write:function(l,c,f,d,g){if(!l.tty||!l.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var w=0;w<d;w++)l.tty.ops.put_char(l.tty,c[f+w])}catch{throw new y.ErrnoError(29)}return d&&(l.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(l){if(!l.input.length){var c=null;if(p){var f=256,d=Buffer.alloc(f),g=0;try{g=C.readSync(process.stdin.fd,d,0,f,-1)}catch(w){if(w.toString().includes("EOF"))g=0;else throw w}g>0?c=d.slice(0,g).toString("utf-8"):c=null}else typeof window<"u"&&typeof window.prompt=="function"?(c=window.prompt("Input: "),c!==null&&(c+=`
`)):typeof readline=="function"&&(c=readline(),c!==null&&(c+=`
`));if(!c)return null;l.input=dr(c,!0)}return l.input.shift()},put_char:function(l,c){c===null||c===10?(G(fe(l.output,0)),l.output=[]):c!=0&&l.output.push(c)},flush:function(l){l.output&&l.output.length>0&&(G(fe(l.output,0)),l.output=[])}},default_tty1_ops:{put_char:function(l,c){c===null||c===10?(F(fe(l.output,0)),l.output=[]):c!=0&&l.output.push(c)},flush:function(l){l.output&&l.output.length>0&&(F(fe(l.output,0)),l.output=[])}}};function Nn(l,c){_e.fill(0,l,l+c)}function Fn(l,c){return Math.ceil(l/c)*c}function qr(l){l=Fn(l,65536);var c=gn(65536,l);return c?(Nn(c,l),c):0}var j={ops_table:null,mount:function(l){return j.createNode(null,"/",16895,0)},createNode:function(l,c,f,d){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);j.ops_table||(j.ops_table={dir:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr,lookup:j.node_ops.lookup,mknod:j.node_ops.mknod,rename:j.node_ops.rename,unlink:j.node_ops.unlink,rmdir:j.node_ops.rmdir,readdir:j.node_ops.readdir,symlink:j.node_ops.symlink},stream:{llseek:j.stream_ops.llseek}},file:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr},stream:{llseek:j.stream_ops.llseek,read:j.stream_ops.read,write:j.stream_ops.write,allocate:j.stream_ops.allocate,mmap:j.stream_ops.mmap,msync:j.stream_ops.msync}},link:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr,readlink:j.node_ops.readlink},stream:{}},chrdev:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr},stream:y.chrdev_stream_ops}});var g=y.createNode(l,c,f,d);return y.isDir(g.mode)?(g.node_ops=j.ops_table.dir.node,g.stream_ops=j.ops_table.dir.stream,g.contents={}):y.isFile(g.mode)?(g.node_ops=j.ops_table.file.node,g.stream_ops=j.ops_table.file.stream,g.usedBytes=0,g.contents=null):y.isLink(g.mode)?(g.node_ops=j.ops_table.link.node,g.stream_ops=j.ops_table.link.stream):y.isChrdev(g.mode)&&(g.node_ops=j.ops_table.chrdev.node,g.stream_ops=j.ops_table.chrdev.stream),g.timestamp=Date.now(),l&&(l.contents[c]=g,l.timestamp=g.timestamp),g},getFileDataAsTypedArray:function(l){return l.contents?l.contents.subarray?l.contents.subarray(0,l.usedBytes):new Uint8Array(l.contents):new Uint8Array(0)},expandFileStorage:function(l,c){var f=l.contents?l.contents.length:0;if(!(f>=c)){var d=1024*1024;c=Math.max(c,f*(f<d?2:1.125)>>>0),f!=0&&(c=Math.max(c,256));var g=l.contents;l.contents=new Uint8Array(c),l.usedBytes>0&&l.contents.set(g.subarray(0,l.usedBytes),0)}},resizeFileStorage:function(l,c){if(l.usedBytes!=c)if(c==0)l.contents=null,l.usedBytes=0;else{var f=l.contents;l.contents=new Uint8Array(c),f&&l.contents.set(f.subarray(0,Math.min(c,l.usedBytes))),l.usedBytes=c}},node_ops:{getattr:function(l){var c={};return c.dev=y.isChrdev(l.mode)?l.id:1,c.ino=l.id,c.mode=l.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=l.rdev,y.isDir(l.mode)?c.size=4096:y.isFile(l.mode)?c.size=l.usedBytes:y.isLink(l.mode)?c.size=l.link.length:c.size=0,c.atime=new Date(l.timestamp),c.mtime=new Date(l.timestamp),c.ctime=new Date(l.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr:function(l,c){c.mode!==void 0&&(l.mode=c.mode),c.timestamp!==void 0&&(l.timestamp=c.timestamp),c.size!==void 0&&j.resizeFileStorage(l,c.size)},lookup:function(l,c){throw y.genericErrors[44]},mknod:function(l,c,f,d){return j.createNode(l,c,f,d)},rename:function(l,c,f){if(y.isDir(l.mode)){var d;try{d=y.lookupNode(c,f)}catch{}if(d)for(var g in d.contents)throw new y.ErrnoError(55)}delete l.parent.contents[l.name],l.parent.timestamp=Date.now(),l.name=f,c.contents[f]=l,c.timestamp=l.parent.timestamp,l.parent=c},unlink:function(l,c){delete l.contents[c],l.timestamp=Date.now()},rmdir:function(l,c){var f=y.lookupNode(l,c);for(var d in f.contents)throw new y.ErrnoError(55);delete l.contents[c],l.timestamp=Date.now()},readdir:function(l){var c=[".",".."];for(var f in l.contents)l.contents.hasOwnProperty(f)&&c.push(f);return c},symlink:function(l,c,f){var d=j.createNode(l,c,41471,0);return d.link=f,d},readlink:function(l){if(!y.isLink(l.mode))throw new y.ErrnoError(28);return l.link}},stream_ops:{read:function(l,c,f,d,g){var w=l.node.contents;if(g>=l.node.usedBytes)return 0;var b=Math.min(l.node.usedBytes-g,d);if(b>8&&w.subarray)c.set(w.subarray(g,g+b),f);else for(var S=0;S<b;S++)c[f+S]=w[g+S];return b},write:function(l,c,f,d,g,w){if(c.buffer===Te.buffer&&(w=!1),!d)return 0;var b=l.node;if(b.timestamp=Date.now(),c.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=c.subarray(f,f+d),b.usedBytes=d,d;if(b.usedBytes===0&&g===0)return b.contents=c.slice(f,f+d),b.usedBytes=d,d;if(g+d<=b.usedBytes)return b.contents.set(c.subarray(f,f+d),g),d}if(j.expandFileStorage(b,g+d),b.contents.subarray&&c.subarray)b.contents.set(c.subarray(f,f+d),g);else for(var S=0;S<d;S++)b.contents[g+S]=c[f+S];return b.usedBytes=Math.max(b.usedBytes,g+d),d},llseek:function(l,c,f){var d=c;if(f===1?d+=l.position:f===2&&y.isFile(l.node.mode)&&(d+=l.node.usedBytes),d<0)throw new y.ErrnoError(28);return d},allocate:function(l,c,f){j.expandFileStorage(l.node,c+f),l.node.usedBytes=Math.max(l.node.usedBytes,c+f)},mmap:function(l,c,f,d,g){if(!y.isFile(l.node.mode))throw new y.ErrnoError(43);var w,b,S=l.node.contents;if(!(g&2)&&S.buffer===Xe)b=!1,w=S.byteOffset;else{if((f>0||f+c<S.length)&&(S.subarray?S=S.subarray(f,f+c):S=Array.prototype.slice.call(S,f,f+c)),b=!0,w=qr(c),!w)throw new y.ErrnoError(48);Te.set(S,w)}return{ptr:w,allocated:b}},msync:function(l,c,f,d,g){if(!y.isFile(l.node.mode))throw new y.ErrnoError(43);return g&2||j.stream_ops.write(l,c,0,d,f,!1),0}}};function Bn(l,c,f,d){var g="al "+l;x(l,function(w){J(w,'Loading data file "'+l+'" failed (no arrayBuffer).'),c(new Uint8Array(w)),g&&Kt()},function(w){if(f)f();else throw'Loading data file "'+l+'" failed.'}),g&&gr()}var y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(l,c={})=>{if(l=Ze.resolve(y.cwd(),l),!l)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(c=Object.assign(f,c),c.recurse_count>8)throw new y.ErrnoError(32);for(var d=re.normalizeArray(l.split("/").filter(M=>!!M),!1),g=y.root,w="/",b=0;b<d.length;b++){var S=b===d.length-1;if(S&&c.parent)break;if(g=y.lookupNode(g,d[b]),w=re.join2(w,d[b]),y.isMountpoint(g)&&(!S||S&&c.follow_mount)&&(g=g.mounted.root),!S||c.follow)for(var _=0;y.isLink(g.mode);){var A=y.readlink(w);w=Ze.resolve(re.dirname(w),A);var R=y.lookupPath(w,{recurse_count:c.recurse_count+1});if(g=R.node,_++>40)throw new y.ErrnoError(32)}}return{path:w,node:g}},getPath:l=>{for(var c;;){if(y.isRoot(l)){var f=l.mount.mountpoint;return c?f[f.length-1]!=="/"?f+"/"+c:f+c:f}c=c?l.name+"/"+c:l.name,l=l.parent}},hashName:(l,c)=>{for(var f=0,d=0;d<c.length;d++)f=(f<<5)-f+c.charCodeAt(d)|0;return(l+f>>>0)%y.nameTable.length},hashAddNode:l=>{var c=y.hashName(l.parent.id,l.name);l.name_next=y.nameTable[c],y.nameTable[c]=l},hashRemoveNode:l=>{var c=y.hashName(l.parent.id,l.name);if(y.nameTable[c]===l)y.nameTable[c]=l.name_next;else for(var f=y.nameTable[c];f;){if(f.name_next===l){f.name_next=l.name_next;break}f=f.name_next}},lookupNode:(l,c)=>{var f=y.mayLookup(l);if(f)throw new y.ErrnoError(f,l);for(var d=y.hashName(l.id,c),g=y.nameTable[d];g;g=g.name_next){var w=g.name;if(g.parent.id===l.id&&w===c)return g}return y.lookup(l,c)},createNode:(l,c,f,d)=>{var g=new y.FSNode(l,c,f,d);return y.hashAddNode(g),g},destroyNode:l=>{y.hashRemoveNode(l)},isRoot:l=>l===l.parent,isMountpoint:l=>!!l.mounted,isFile:l=>(l&61440)===32768,isDir:l=>(l&61440)===16384,isLink:l=>(l&61440)===40960,isChrdev:l=>(l&61440)===8192,isBlkdev:l=>(l&61440)===24576,isFIFO:l=>(l&61440)===4096,isSocket:l=>(l&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:l=>{var c=y.flagModes[l];if(typeof c>"u")throw new Error("Unknown file open mode: "+l);return c},flagsToPermissionString:l=>{var c=["r","w","rw"][l&3];return l&512&&(c+="w"),c},nodePermissions:(l,c)=>y.ignorePermissions?0:c.includes("r")&&!(l.mode&292)||c.includes("w")&&!(l.mode&146)||c.includes("x")&&!(l.mode&73)?2:0,mayLookup:l=>{var c=y.nodePermissions(l,"x");return c||(l.node_ops.lookup?0:2)},mayCreate:(l,c)=>{try{var f=y.lookupNode(l,c);return 20}catch{}return y.nodePermissions(l,"wx")},mayDelete:(l,c,f)=>{var d;try{d=y.lookupNode(l,c)}catch(w){return w.errno}var g=y.nodePermissions(l,"wx");if(g)return g;if(f){if(!y.isDir(d.mode))return 54;if(y.isRoot(d)||y.getPath(d)===y.cwd())return 10}else if(y.isDir(d.mode))return 31;return 0},mayOpen:(l,c)=>l?y.isLink(l.mode)?32:y.isDir(l.mode)&&(y.flagsToPermissionString(c)!=="r"||c&512)?31:y.nodePermissions(l,y.flagsToPermissionString(c)):44,MAX_OPEN_FDS:4096,nextfd:(l=0,c=y.MAX_OPEN_FDS)=>{for(var f=l;f<=c;f++)if(!y.streams[f])return f;throw new y.ErrnoError(33)},getStream:l=>y.streams[l],createStream:(l,c,f)=>{y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get:function(){return this.node},set:function(g){this.node=g}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(g){this.shared.flags=g}},position:{get:function(){return this.shared.position},set:function(g){this.shared.position=g}}})),l=Object.assign(new y.FSStream,l);var d=y.nextfd(c,f);return l.fd=d,y.streams[d]=l,l},closeStream:l=>{y.streams[l]=null},chrdev_stream_ops:{open:l=>{var c=y.getDevice(l.node.rdev);l.stream_ops=c.stream_ops,l.stream_ops.open&&l.stream_ops.open(l)},llseek:()=>{throw new y.ErrnoError(70)}},major:l=>l>>8,minor:l=>l&255,makedev:(l,c)=>l<<8|c,registerDevice:(l,c)=>{y.devices[l]={stream_ops:c}},getDevice:l=>y.devices[l],getMounts:l=>{for(var c=[],f=[l];f.length;){var d=f.pop();c.push(d),f.push.apply(f,d.mounts)}return c},syncfs:(l,c)=>{typeof l=="function"&&(c=l,l=!1),y.syncFSRequests++,y.syncFSRequests>1&&F("warning: "+y.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=y.getMounts(y.root.mount),d=0;function g(b){return y.syncFSRequests--,c(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,g(b));++d>=f.length&&g(null)}f.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,l,w)})},mount:(l,c,f)=>{var d=f==="/",g=!f,w;if(d&&y.root)throw new y.ErrnoError(10);if(!d&&!g){var b=y.lookupPath(f,{follow_mount:!1});if(f=b.path,w=b.node,y.isMountpoint(w))throw new y.ErrnoError(10);if(!y.isDir(w.mode))throw new y.ErrnoError(54)}var S={type:l,opts:c,mountpoint:f,mounts:[]},_=l.mount(S);return _.mount=S,S.root=_,d?y.root=_:w&&(w.mounted=S,w.mount&&w.mount.mounts.push(S)),_},unmount:l=>{var c=y.lookupPath(l,{follow_mount:!1});if(!y.isMountpoint(c.node))throw new y.ErrnoError(28);var f=c.node,d=f.mounted,g=y.getMounts(d);Object.keys(y.nameTable).forEach(b=>{for(var S=y.nameTable[b];S;){var _=S.name_next;g.includes(S.mount)&&y.destroyNode(S),S=_}}),f.mounted=null;var w=f.mount.mounts.indexOf(d);f.mount.mounts.splice(w,1)},lookup:(l,c)=>l.node_ops.lookup(l,c),mknod:(l,c,f)=>{var d=y.lookupPath(l,{parent:!0}),g=d.node,w=re.basename(l);if(!w||w==="."||w==="..")throw new y.ErrnoError(28);var b=y.mayCreate(g,w);if(b)throw new y.ErrnoError(b);if(!g.node_ops.mknod)throw new y.ErrnoError(63);return g.node_ops.mknod(g,w,c,f)},create:(l,c)=>(c=c!==void 0?c:438,c&=4095,c|=32768,y.mknod(l,c,0)),mkdir:(l,c)=>(c=c!==void 0?c:511,c&=1023,c|=16384,y.mknod(l,c,0)),mkdirTree:(l,c)=>{for(var f=l.split("/"),d="",g=0;g<f.length;++g)if(f[g]){d+="/"+f[g];try{y.mkdir(d,c)}catch(w){if(w.errno!=20)throw w}}},mkdev:(l,c,f)=>(typeof f>"u"&&(f=c,c=438),c|=8192,y.mknod(l,c,f)),symlink:(l,c)=>{if(!Ze.resolve(l))throw new y.ErrnoError(44);var f=y.lookupPath(c,{parent:!0}),d=f.node;if(!d)throw new y.ErrnoError(44);var g=re.basename(c),w=y.mayCreate(d,g);if(w)throw new y.ErrnoError(w);if(!d.node_ops.symlink)throw new y.ErrnoError(63);return d.node_ops.symlink(d,g,l)},rename:(l,c)=>{var f=re.dirname(l),d=re.dirname(c),g=re.basename(l),w=re.basename(c),b,S,_;if(b=y.lookupPath(l,{parent:!0}),S=b.node,b=y.lookupPath(c,{parent:!0}),_=b.node,!S||!_)throw new y.ErrnoError(44);if(S.mount!==_.mount)throw new y.ErrnoError(75);var A=y.lookupNode(S,g),R=Ze.relative(l,d);if(R.charAt(0)!==".")throw new y.ErrnoError(28);if(R=Ze.relative(c,f),R.charAt(0)!==".")throw new y.ErrnoError(55);var M;try{M=y.lookupNode(_,w)}catch{}if(A!==M){var L=y.isDir(A.mode),B=y.mayDelete(S,g,L);if(B)throw new y.ErrnoError(B);if(B=M?y.mayDelete(_,w,L):y.mayCreate(_,w),B)throw new y.ErrnoError(B);if(!S.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(A)||M&&y.isMountpoint(M))throw new y.ErrnoError(10);if(_!==S&&(B=y.nodePermissions(S,"w"),B))throw new y.ErrnoError(B);y.hashRemoveNode(A);try{S.node_ops.rename(A,_,w)}catch(z){throw z}finally{y.hashAddNode(A)}}},rmdir:l=>{var c=y.lookupPath(l,{parent:!0}),f=c.node,d=re.basename(l),g=y.lookupNode(f,d),w=y.mayDelete(f,d,!0);if(w)throw new y.ErrnoError(w);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(g))throw new y.ErrnoError(10);f.node_ops.rmdir(f,d),y.destroyNode(g)},readdir:l=>{var c=y.lookupPath(l,{follow:!0}),f=c.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink:l=>{var c=y.lookupPath(l,{parent:!0}),f=c.node;if(!f)throw new y.ErrnoError(44);var d=re.basename(l),g=y.lookupNode(f,d),w=y.mayDelete(f,d,!1);if(w)throw new y.ErrnoError(w);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(g))throw new y.ErrnoError(10);f.node_ops.unlink(f,d),y.destroyNode(g)},readlink:l=>{var c=y.lookupPath(l),f=c.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return Ze.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat:(l,c)=>{var f=y.lookupPath(l,{follow:!c}),d=f.node;if(!d)throw new y.ErrnoError(44);if(!d.node_ops.getattr)throw new y.ErrnoError(63);return d.node_ops.getattr(d)},lstat:l=>y.stat(l,!0),chmod:(l,c,f)=>{var d;if(typeof l=="string"){var g=y.lookupPath(l,{follow:!f});d=g.node}else d=l;if(!d.node_ops.setattr)throw new y.ErrnoError(63);d.node_ops.setattr(d,{mode:c&4095|d.mode&-4096,timestamp:Date.now()})},lchmod:(l,c)=>{y.chmod(l,c,!0)},fchmod:(l,c)=>{var f=y.getStream(l);if(!f)throw new y.ErrnoError(8);y.chmod(f.node,c)},chown:(l,c,f,d)=>{var g;if(typeof l=="string"){var w=y.lookupPath(l,{follow:!d});g=w.node}else g=l;if(!g.node_ops.setattr)throw new y.ErrnoError(63);g.node_ops.setattr(g,{timestamp:Date.now()})},lchown:(l,c,f)=>{y.chown(l,c,f,!0)},fchown:(l,c,f)=>{var d=y.getStream(l);if(!d)throw new y.ErrnoError(8);y.chown(d.node,c,f)},truncate:(l,c)=>{if(c<0)throw new y.ErrnoError(28);var f;if(typeof l=="string"){var d=y.lookupPath(l,{follow:!0});f=d.node}else f=l;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var g=y.nodePermissions(f,"w");if(g)throw new y.ErrnoError(g);f.node_ops.setattr(f,{size:c,timestamp:Date.now()})},ftruncate:(l,c)=>{var f=y.getStream(l);if(!f)throw new y.ErrnoError(8);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,c)},utime:(l,c,f)=>{var d=y.lookupPath(l,{follow:!0}),g=d.node;g.node_ops.setattr(g,{timestamp:Math.max(c,f)})},open:(l,c,f)=>{if(l==="")throw new y.ErrnoError(44);c=typeof c=="string"?y.modeStringToFlags(c):c,f=typeof f>"u"?438:f,c&64?f=f&4095|32768:f=0;var d;if(typeof l=="object")d=l;else{l=re.normalize(l);try{var g=y.lookupPath(l,{follow:!(c&131072)});d=g.node}catch{}}var w=!1;if(c&64)if(d){if(c&128)throw new y.ErrnoError(20)}else d=y.mknod(l,f,0),w=!0;if(!d)throw new y.ErrnoError(44);if(y.isChrdev(d.mode)&&(c&=-513),c&65536&&!y.isDir(d.mode))throw new y.ErrnoError(54);if(!w){var b=y.mayOpen(d,c);if(b)throw new y.ErrnoError(b)}c&512&&!w&&y.truncate(d,0),c&=-131713;var S=y.createStream({node:d,path:y.getPath(d),flags:c,seekable:!0,position:0,stream_ops:d.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),t.logReadFiles&&!(c&1)&&(y.readFiles||(y.readFiles={}),l in y.readFiles||(y.readFiles[l]=1)),S},close:l=>{if(y.isClosed(l))throw new y.ErrnoError(8);l.getdents&&(l.getdents=null);try{l.stream_ops.close&&l.stream_ops.close(l)}catch(c){throw c}finally{y.closeStream(l.fd)}l.fd=null},isClosed:l=>l.fd===null,llseek:(l,c,f)=>{if(y.isClosed(l))throw new y.ErrnoError(8);if(!l.seekable||!l.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return l.position=l.stream_ops.llseek(l,c,f),l.ungotten=[],l.position},read:(l,c,f,d,g)=>{if(d<0||g<0)throw new y.ErrnoError(28);if(y.isClosed(l))throw new y.ErrnoError(8);if((l.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(l.node.mode))throw new y.ErrnoError(31);if(!l.stream_ops.read)throw new y.ErrnoError(28);var w=typeof g<"u";if(!w)g=l.position;else if(!l.seekable)throw new y.ErrnoError(70);var b=l.stream_ops.read(l,c,f,d,g);return w||(l.position+=b),b},write:(l,c,f,d,g,w)=>{if(d<0||g<0)throw new y.ErrnoError(28);if(y.isClosed(l))throw new y.ErrnoError(8);if(!(l.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(l.node.mode))throw new y.ErrnoError(31);if(!l.stream_ops.write)throw new y.ErrnoError(28);l.seekable&&l.flags&1024&&y.llseek(l,0,2);var b=typeof g<"u";if(!b)g=l.position;else if(!l.seekable)throw new y.ErrnoError(70);var S=l.stream_ops.write(l,c,f,d,g,w);return b||(l.position+=S),S},allocate:(l,c,f)=>{if(y.isClosed(l))throw new y.ErrnoError(8);if(c<0||f<=0)throw new y.ErrnoError(28);if(!(l.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(l.node.mode)&&!y.isDir(l.node.mode))throw new y.ErrnoError(43);if(!l.stream_ops.allocate)throw new y.ErrnoError(138);l.stream_ops.allocate(l,c,f)},mmap:(l,c,f,d,g)=>{if(d&2&&!(g&2)&&(l.flags&2097155)!==2)throw new y.ErrnoError(2);if((l.flags&2097155)===1)throw new y.ErrnoError(2);if(!l.stream_ops.mmap)throw new y.ErrnoError(43);return l.stream_ops.mmap(l,c,f,d,g)},msync:(l,c,f,d,g)=>!l||!l.stream_ops.msync?0:l.stream_ops.msync(l,c,f,d,g),munmap:l=>0,ioctl:(l,c,f)=>{if(!l.stream_ops.ioctl)throw new y.ErrnoError(59);return l.stream_ops.ioctl(l,c,f)},readFile:(l,c={})=>{if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error('Invalid encoding type "'+c.encoding+'"');var f,d=y.open(l,c.flags),g=y.stat(l),w=g.size,b=new Uint8Array(w);return y.read(d,b,0,w,0),c.encoding==="utf8"?f=fe(b,0):c.encoding==="binary"&&(f=b),y.close(d),f},writeFile:(l,c,f={})=>{f.flags=f.flags||577;var d=y.open(l,f.flags,f.mode);if(typeof c=="string"){var g=new Uint8Array(X(c)+1),w=oe(c,g,0,g.length);y.write(d,g,0,w,void 0,f.canOwn)}else if(ArrayBuffer.isView(c))y.write(d,c,0,c.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(d)},cwd:()=>y.currentPath,chdir:l=>{var c=y.lookupPath(l,{follow:!0});if(c.node===null)throw new y.ErrnoError(44);if(!y.isDir(c.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(c.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=c.path},createDefaultDirectories:()=>{y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices:()=>{y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(c,f,d,g,w)=>g}),y.mkdev("/dev/null",y.makedev(1,3)),bt.register(y.makedev(5,0),bt.default_tty_ops),bt.register(y.makedev(6,0),bt.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var l=Mn();y.createDevice("/dev","random",l),y.createDevice("/dev","urandom",l),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{y.mkdir("/proc");var l=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount:()=>{var c=y.createNode(l,"fd",16895,73);return c.node_ops={lookup:(f,d)=>{var g=+d,w=y.getStream(g);if(!w)throw new y.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},c}},{},"/proc/self/fd")},createStandardStreams:()=>{t.stdin?y.createDevice("/dev","stdin",t.stdin):y.symlink("/dev/tty","/dev/stdin"),t.stdout?y.createDevice("/dev","stdout",null,t.stdout):y.symlink("/dev/tty","/dev/stdout"),t.stderr?y.createDevice("/dev","stderr",null,t.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError:()=>{y.ErrnoError||(y.ErrnoError=function(c,f){this.node=f,this.setErrno=function(d){this.errno=d},this.setErrno(c),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(l=>{y.genericErrors[l]=new y.ErrnoError(l),y.genericErrors[l].stack="<generic error, no stack>"}))},staticInit:()=>{y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(j,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:j}},init:(l,c,f)=>{y.init.initialized=!0,y.ensureErrnoError(),t.stdin=l||t.stdin,t.stdout=c||t.stdout,t.stderr=f||t.stderr,y.createStandardStreams()},quit:()=>{y.init.initialized=!1;for(var l=0;l<y.streams.length;l++){var c=y.streams[l];c&&y.close(c)}},getMode:(l,c)=>{var f=0;return l&&(f|=365),c&&(f|=146),f},findObject:(l,c)=>{var f=y.analyzePath(l,c);return f.exists?f.object:null},analyzePath:(l,c)=>{try{var f=y.lookupPath(l,{follow:!c});l=f.path}catch{}var d={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(l,{parent:!0});d.parentExists=!0,d.parentPath=f.path,d.parentObject=f.node,d.name=re.basename(l),f=y.lookupPath(l,{follow:!c}),d.exists=!0,d.path=f.path,d.object=f.node,d.name=f.node.name,d.isRoot=f.path==="/"}catch(g){d.error=g.errno}return d},createPath:(l,c,f,d)=>{l=typeof l=="string"?l:y.getPath(l);for(var g=c.split("/").reverse();g.length;){var w=g.pop();if(w){var b=re.join2(l,w);try{y.mkdir(b)}catch{}l=b}}return b},createFile:(l,c,f,d,g)=>{var w=re.join2(typeof l=="string"?l:y.getPath(l),c),b=y.getMode(d,g);return y.create(w,b)},createDataFile:(l,c,f,d,g,w)=>{var b=c;l&&(l=typeof l=="string"?l:y.getPath(l),b=c?re.join2(l,c):l);var S=y.getMode(d,g),_=y.create(b,S);if(f){if(typeof f=="string"){for(var A=new Array(f.length),R=0,M=f.length;R<M;++R)A[R]=f.charCodeAt(R);f=A}y.chmod(_,S|146);var L=y.open(_,577);y.write(L,f,0,f.length,0,w),y.close(L),y.chmod(_,S)}return _},createDevice:(l,c,f,d)=>{var g=re.join2(typeof l=="string"?l:y.getPath(l),c),w=y.getMode(!!f,!!d);y.createDevice.major||(y.createDevice.major=64);var b=y.makedev(y.createDevice.major++,0);return y.registerDevice(b,{open:S=>{S.seekable=!1},close:S=>{d&&d.buffer&&d.buffer.length&&d(10)},read:(S,_,A,R,M)=>{for(var L=0,B=0;B<R;B++){var z;try{z=f()}catch{throw new y.ErrnoError(29)}if(z===void 0&&L===0)throw new y.ErrnoError(6);if(z==null)break;L++,_[A+B]=z}return L&&(S.node.timestamp=Date.now()),L},write:(S,_,A,R,M)=>{for(var L=0;L<R;L++)try{d(_[A+L])}catch{throw new y.ErrnoError(29)}return R&&(S.node.timestamp=Date.now()),L}}),y.mkdev(g,w,b)},forceLoadFile:l=>{if(l.isDevice||l.isFolder||l.link||l.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(E)try{l.contents=dr(E(l.url),!0),l.usedBytes=l.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(l,c,f,d,g)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(B){if(!(B>this.length-1||B<0)){var z=B%this.chunkSize,ie=B/this.chunkSize|0;return this.getter(ie)[z]}},w.prototype.setDataGetter=function(B){this.getter=B},w.prototype.cacheLength=function(){var B=new XMLHttpRequest;if(B.open("HEAD",f,!1),B.send(null),!(B.status>=200&&B.status<300||B.status===304))throw new Error("Couldn't load "+f+". Status: "+B.status);var z=Number(B.getResponseHeader("Content-length")),ie,pe=(ie=B.getResponseHeader("Accept-Ranges"))&&ie==="bytes",me=(ie=B.getResponseHeader("Content-Encoding"))&&ie==="gzip",D=1024*1024;pe||(D=z);var H=(le,De)=>{if(le>De)throw new Error("invalid range ("+le+", "+De+") or no bytes requested!");if(De>z-1)throw new Error("only "+z+" bytes available! programmer error!");var ve=new XMLHttpRequest;if(ve.open("GET",f,!1),z!==D&&ve.setRequestHeader("Range","bytes="+le+"-"+De),ve.responseType="arraybuffer",ve.overrideMimeType&&ve.overrideMimeType("text/plain; charset=x-user-defined"),ve.send(null),!(ve.status>=200&&ve.status<300||ve.status===304))throw new Error("Couldn't load "+f+". Status: "+ve.status);return ve.response!==void 0?new Uint8Array(ve.response||[]):dr(ve.responseText||"",!0)},we=this;we.setDataGetter(le=>{var De=le*D,ve=(le+1)*D-1;if(ve=Math.min(ve,z-1),typeof we.chunks[le]>"u"&&(we.chunks[le]=H(De,ve)),typeof we.chunks[le]>"u")throw new Error("doXHR failed!");return we.chunks[le]}),(me||!z)&&(D=z=1,z=this.getter(0).length,D=z,G("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=z,this._chunkSize=D,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:b}}else var S={isDevice:!1,url:f};var _=y.createFile(l,c,S,d,g);S.contents?_.contents=S.contents:S.url&&(_.contents=null,_.url=S.url),Object.defineProperties(_,{usedBytes:{get:function(){return this.contents.length}}});var A={},R=Object.keys(_.stream_ops);R.forEach(L=>{var B=_.stream_ops[L];A[L]=function(){return y.forceLoadFile(_),B.apply(null,arguments)}});function M(L,B,z,ie,pe){var me=L.node.contents;if(pe>=me.length)return 0;var D=Math.min(me.length-pe,ie);if(me.slice)for(var H=0;H<D;H++)B[z+H]=me[pe+H];else for(var H=0;H<D;H++)B[z+H]=me.get(pe+H);return D}return A.read=(L,B,z,ie,pe)=>(y.forceLoadFile(_),M(L,B,z,ie,pe)),A.mmap=(L,B,z,ie,pe)=>{y.forceLoadFile(_);var me=qr(B);if(!me)throw new y.ErrnoError(48);return M(L,Te,me,B,z),{ptr:me,allocated:!0}},_.stream_ops=A,_},createPreloadedFile:(l,c,f,d,g,w,b,S,_,A)=>{var R=c?Ze.resolve(re.join2(l,c)):l;function M(L){function B(z){A&&A(),S||y.createDataFile(l,c,z,d,g,_),w&&w(),Kt()}Browser.handledByPreloadPlugin(L,R,B,()=>{b&&b(),Kt()})||B(L)}gr(),typeof f=="string"?Bn(f,L=>M(L),b):M(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(l,c,f)=>{c=c||(()=>{}),f=f||(()=>{});var d=y.indexedDB();try{var g=d.open(y.DB_NAME(),y.DB_VERSION)}catch(w){return f(w)}g.onupgradeneeded=()=>{G("creating db");var w=g.result;w.createObjectStore(y.DB_STORE_NAME)},g.onsuccess=()=>{var w=g.result,b=w.transaction([y.DB_STORE_NAME],"readwrite"),S=b.objectStore(y.DB_STORE_NAME),_=0,A=0,R=l.length;function M(){A==0?c():f()}l.forEach(L=>{var B=S.put(y.analyzePath(L).object.contents,L);B.onsuccess=()=>{_++,_+A==R&&M()},B.onerror=()=>{A++,_+A==R&&M()}}),b.onerror=f},g.onerror=f},loadFilesFromDB:(l,c,f)=>{c=c||(()=>{}),f=f||(()=>{});var d=y.indexedDB();try{var g=d.open(y.DB_NAME(),y.DB_VERSION)}catch(w){return f(w)}g.onupgradeneeded=f,g.onsuccess=()=>{var w=g.result;try{var b=w.transaction([y.DB_STORE_NAME],"readonly")}catch(L){f(L);return}var S=b.objectStore(y.DB_STORE_NAME),_=0,A=0,R=l.length;function M(){A==0?c():f()}l.forEach(L=>{var B=S.get(L);B.onsuccess=()=>{y.analyzePath(L).exists&&y.unlink(L),y.createDataFile(re.dirname(L),re.basename(L),B.result,!0,!0,!0),_++,_+A==R&&M()},B.onerror=()=>{A++,_+A==R&&M()}}),b.onerror=f},g.onerror=f}},ne={DEFAULT_POLLMASK:5,calculateAt:function(l,c,f){if(re.isAbs(c))return c;var d;if(l===-100)d=y.cwd();else{var g=y.getStream(l);if(!g)throw new y.ErrnoError(8);d=g.path}if(c.length==0){if(!f)throw new y.ErrnoError(44);return d}return re.join2(d,c)},doStat:function(l,c,f){try{var d=l(c)}catch(g){if(g&&g.node&&re.normalize(c)!==re.normalize(y.getPath(g.node)))return-54;throw g}return N[f>>2]=d.dev,N[f+4>>2]=0,N[f+8>>2]=d.ino,N[f+12>>2]=d.mode,N[f+16>>2]=d.nlink,N[f+20>>2]=d.uid,N[f+24>>2]=d.gid,N[f+28>>2]=d.rdev,N[f+32>>2]=0,je=[d.size>>>0,(Pe=d.size,+Math.abs(Pe)>=1?Pe>0?(Math.min(+Math.floor(Pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Pe-+(~~Pe>>>0))/4294967296)>>>0:0)],N[f+40>>2]=je[0],N[f+44>>2]=je[1],N[f+48>>2]=4096,N[f+52>>2]=d.blocks,N[f+56>>2]=d.atime.getTime()/1e3|0,N[f+60>>2]=0,N[f+64>>2]=d.mtime.getTime()/1e3|0,N[f+68>>2]=0,N[f+72>>2]=d.ctime.getTime()/1e3|0,N[f+76>>2]=0,je=[d.ino>>>0,(Pe=d.ino,+Math.abs(Pe)>=1?Pe>0?(Math.min(+Math.floor(Pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Pe-+(~~Pe>>>0))/4294967296)>>>0:0)],N[f+80>>2]=je[0],N[f+84>>2]=je[1],0},doMsync:function(l,c,f,d,g){var w=_e.slice(l,l+f);y.msync(c,w,g,f,d)},varargs:void 0,get:function(){ne.varargs+=4;var l=N[ne.varargs-4>>2];return l},getStr:function(l){var c=Q(l);return c},getStreamFromFD:function(l){var c=y.getStream(l);if(!c)throw new y.ErrnoError(8);return c}};function Un(l,c){try{return l=ne.getStr(l),y.chmod(l,c),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Gn(l,c,f,d){try{if(c=ne.getStr(c),c=ne.calculateAt(l,c),f&-8)return-28;var g=y.lookupPath(c,{follow:!0}),w=g.node;if(!w)return-44;var b="";return f&4&&(b+="r"),f&2&&(b+="w"),f&1&&(b+="x"),b&&y.nodePermissions(w,b)?-2:0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Wn(l){return N[dn()>>2]=l,l}function Vn(l,c,f){ne.varargs=f;try{var d=ne.getStreamFromFD(l);switch(c){case 0:{var g=ne.get();if(g<0)return-28;var w;return w=y.createStream(d,g),w.fd}case 1:case 2:return 0;case 3:return d.flags;case 4:{var g=ne.get();return d.flags|=g,0}case 5:{var g=ne.get(),b=0;return st[g+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Wn(28),-1;default:return-28}}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Hn(l,c){try{var f=ne.getStreamFromFD(l);return ne.doStat(y.stat,f.path,c)}catch(d){if(typeof y>"u"||!(d instanceof y.ErrnoError))throw d;return-d.errno}}function zn(l,c,f){ne.varargs=f;try{var d=ne.getStreamFromFD(l);switch(c){case 21509:case 21505:return d.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return d.tty?0:-59;case 21519:{if(!d.tty)return-59;var g=ne.get();return N[g>>2]=0,0}case 21520:return d.tty?-28:-59;case 21531:{var g=ne.get();return y.ioctl(d,c,g)}case 21523:return d.tty?0:-59;case 21524:return d.tty?0:-59;default:it("bad ioctl syscall "+c)}}catch(w){if(typeof y>"u"||!(w instanceof y.ErrnoError))throw w;return-w.errno}}function $n(l,c){try{return l=ne.getStr(l),ne.doStat(y.lstat,l,c)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Yn(l,c,f,d){try{c=ne.getStr(c);var g=d&256,w=d&4096;return d=d&-4353,c=ne.calculateAt(l,c,w),ne.doStat(g?y.lstat:y.stat,c,f)}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return-b.errno}}function qn(l,c,f,d){ne.varargs=d;try{c=ne.getStr(c),c=ne.calculateAt(l,c);var g=d?ne.get():0;return y.open(c,f,g).fd}catch(w){if(typeof y>"u"||!(w instanceof y.ErrnoError))throw w;return-w.errno}}function Xn(l,c){try{return l=ne.getStr(l),ne.doStat(y.stat,l,c)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function jn(l,c,f,d,g){}function er(l){switch(l){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+l)}}function Zn(){for(var l=new Array(256),c=0;c<256;++c)l[c]=String.fromCharCode(c);Xr=l}var Xr=void 0;function Ce(l){for(var c="",f=l;_e[f];)c+=Xr[_e[f++]];return c}var Mt={},St={},tr={},Kn=48,Qn=57;function rr(l){if(l===void 0)return"_unknown";l=l.replace(/[^a-zA-Z0-9_]/g,"$");var c=l.charCodeAt(0);return c>=Kn&&c<=Qn?"_"+l:l}function nr(l,c){return l=rr(l),new Function("body","return function "+l+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(c)}function Er(l,c){var f=nr(c,function(d){this.name=c,this.message=d;var g=new Error(d).stack;g!==void 0&&(this.stack=this.toString()+`
`+g.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(l.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var Nt=void 0;function se(l){throw new Nt(l)}var jr=void 0;function sr(l){throw new jr(l)}function xt(l,c,f){l.forEach(function(S){tr[S]=c});function d(S){var _=f(S);_.length!==l.length&&sr("Mismatched type converter count");for(var A=0;A<l.length;++A)Ve(l[A],_[A])}var g=new Array(c.length),w=[],b=0;c.forEach((S,_)=>{St.hasOwnProperty(S)?g[_]=St[S]:(w.push(S),Mt.hasOwnProperty(S)||(Mt[S]=[]),Mt[S].push(()=>{g[_]=St[S],++b,b===w.length&&d(g)}))}),w.length===0&&d(g)}function Ve(l,c,f={}){if(!("argPackAdvance"in c))throw new TypeError("registerType registeredInstance requires argPackAdvance");var d=c.name;if(l||se('type "'+d+'" must have a positive integer typeid pointer'),St.hasOwnProperty(l)){if(f.ignoreDuplicateRegistrations)return;se("Cannot register type '"+d+"' twice")}if(St[l]=c,delete tr[l],Mt.hasOwnProperty(l)){var g=Mt[l];delete Mt[l],g.forEach(w=>w())}}function Jn(l,c,f,d,g){var w=er(f);c=Ce(c),Ve(l,{name:c,fromWireType:function(b){return!!b},toWireType:function(b,S){return S?d:g},argPackAdvance:8,readValueFromPointer:function(b){var S;if(f===1)S=Te;else if(f===2)S=st;else if(f===4)S=N;else throw new TypeError("Unknown boolean type size: "+c);return this.fromWireType(S[b>>w])},destructorFunction:null})}function es(l){if(!(this instanceof ot)||!(l instanceof ot))return!1;for(var c=this.$$.ptrType.registeredClass,f=this.$$.ptr,d=l.$$.ptrType.registeredClass,g=l.$$.ptr;c.baseClass;)f=c.upcast(f),c=c.baseClass;for(;d.baseClass;)g=d.upcast(g),d=d.baseClass;return c===d&&f===g}function ts(l){return{count:l.count,deleteScheduled:l.deleteScheduled,preservePointerOnDelete:l.preservePointerOnDelete,ptr:l.ptr,ptrType:l.ptrType,smartPtr:l.smartPtr,smartPtrType:l.smartPtrType}}function wr(l){function c(f){return f.$$.ptrType.registeredClass.name}se(c(l)+" instance already deleted")}var br=!1;function Zr(l){}function rs(l){l.smartPtr?l.smartPtrType.rawDestructor(l.smartPtr):l.ptrType.registeredClass.rawDestructor(l.ptr)}function Kr(l){l.count.value-=1;var c=l.count.value===0;c&&rs(l)}function Qr(l,c,f){if(c===f)return l;if(f.baseClass===void 0)return null;var d=Qr(l,c,f.baseClass);return d===null?null:f.downcast(d)}var Jr={};function ns(){return Object.keys(zt).length}function ss(){var l=[];for(var c in zt)zt.hasOwnProperty(c)&&l.push(zt[c]);return l}var Vt=[];function Sr(){for(;Vt.length;){var l=Vt.pop();l.$$.deleteScheduled=!1,l.delete()}}var Ht=void 0;function is(l){Ht=l,Vt.length&&Ht&&Ht(Sr)}function os(){t.getInheritedInstanceCount=ns,t.getLiveInheritedInstances=ss,t.flushPendingDeletes=Sr,t.setDelayFunction=is}var zt={};function as(l,c){for(c===void 0&&se("ptr should not be undefined");l.baseClass;)c=l.upcast(c),l=l.baseClass;return c}function ls(l,c){return c=as(l,c),zt[c]}function ir(l,c){(!c.ptrType||!c.ptr)&&sr("makeClassHandle requires ptr and ptrType");var f=!!c.smartPtrType,d=!!c.smartPtr;return f!==d&&sr("Both smartPtrType and smartPtr must be specified"),c.count={value:1},$t(Object.create(l,{$$:{value:c}}))}function us(l){var c=this.getPointee(l);if(!c)return this.destructor(l),null;var f=ls(this.registeredClass,c);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=c,f.$$.smartPtr=l,f.clone();var d=f.clone();return this.destructor(l),d}function g(){return this.isSmartPointer?ir(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:c,smartPtrType:this,smartPtr:l}):ir(this.registeredClass.instancePrototype,{ptrType:this,ptr:l})}var w=this.registeredClass.getActualType(c),b=Jr[w];if(!b)return g.call(this);var S;this.isConst?S=b.constPointerType:S=b.pointerType;var _=Qr(c,this.registeredClass,S.registeredClass);return _===null?g.call(this):this.isSmartPointer?ir(S.registeredClass.instancePrototype,{ptrType:S,ptr:_,smartPtrType:this,smartPtr:l}):ir(S.registeredClass.instancePrototype,{ptrType:S,ptr:_})}function $t(l){return typeof FinalizationRegistry>"u"?($t=c=>c,l):(br=new FinalizationRegistry(c=>{Kr(c.$$)}),$t=c=>{var f=c.$$,d=!!f.smartPtr;if(d){var g={$$:f};br.register(c,g,c)}return c},Zr=c=>br.unregister(c),$t(l))}function cs(){if(this.$$.ptr||wr(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var l=$t(Object.create(Object.getPrototypeOf(this),{$$:{value:ts(this.$$)}}));return l.$$.count.value+=1,l.$$.deleteScheduled=!1,l}function hs(){this.$$.ptr||wr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&se("Object already scheduled for deletion"),Zr(this),Kr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function fs(){return!this.$$.ptr}function ps(){return this.$$.ptr||wr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&se("Object already scheduled for deletion"),Vt.push(this),Vt.length===1&&Ht&&Ht(Sr),this.$$.deleteScheduled=!0,this}function ds(){ot.prototype.isAliasOf=es,ot.prototype.clone=cs,ot.prototype.delete=hs,ot.prototype.isDeleted=fs,ot.prototype.deleteLater=ps}function ot(){}function xr(l,c,f){if(l[c].overloadTable===void 0){var d=l[c];l[c]=function(){return l[c].overloadTable.hasOwnProperty(arguments.length)||se("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+l[c].overloadTable+")!"),l[c].overloadTable[arguments.length].apply(this,arguments)},l[c].overloadTable=[],l[c].overloadTable[d.argCount]=d}}function en(l,c,f){t.hasOwnProperty(l)?(se("Cannot register public name '"+l+"' twice"),xr(t,l,l),t.hasOwnProperty(f)&&se("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),t[l].overloadTable[f]=c):t[l]=c}function ms(l,c,f,d,g,w,b,S){this.name=l,this.constructor=c,this.instancePrototype=f,this.rawDestructor=d,this.baseClass=g,this.getActualType=w,this.upcast=b,this.downcast=S,this.pureVirtualFunctions=[]}function Pr(l,c,f){for(;c!==f;)c.upcast||se("Expected null or instance of "+f.name+", got an instance of "+c.name),l=c.upcast(l),c=c.baseClass;return l}function vs(l,c){if(c===null)return this.isReference&&se("null is not a valid "+this.name),0;c.$$||se('Cannot pass "'+kr(c)+'" as a '+this.name),c.$$.ptr||se("Cannot pass deleted object as a pointer of type "+this.name);var f=c.$$.ptrType.registeredClass,d=Pr(c.$$.ptr,f,this.registeredClass);return d}function gs(l,c){var f;if(c===null)return this.isReference&&se("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),l!==null&&l.push(this.rawDestructor,f),f):0;c.$$||se('Cannot pass "'+kr(c)+'" as a '+this.name),c.$$.ptr||se("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&c.$$.ptrType.isConst&&se("Cannot convert argument of type "+(c.$$.smartPtrType?c.$$.smartPtrType.name:c.$$.ptrType.name)+" to parameter type "+this.name);var d=c.$$.ptrType.registeredClass;if(f=Pr(c.$$.ptr,d,this.registeredClass),this.isSmartPointer)switch(c.$$.smartPtr===void 0&&se("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:c.$$.smartPtrType===this?f=c.$$.smartPtr:se("Cannot convert argument of type "+(c.$$.smartPtrType?c.$$.smartPtrType.name:c.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=c.$$.smartPtr;break;case 2:if(c.$$.smartPtrType===this)f=c.$$.smartPtr;else{var g=c.clone();f=this.rawShare(f,Ee.toHandle(function(){g.delete()})),l!==null&&l.push(this.rawDestructor,f)}break;default:se("Unsupporting sharing policy")}return f}function ys(l,c){if(c===null)return this.isReference&&se("null is not a valid "+this.name),0;c.$$||se('Cannot pass "'+kr(c)+'" as a '+this.name),c.$$.ptr||se("Cannot pass deleted object as a pointer of type "+this.name),c.$$.ptrType.isConst&&se("Cannot convert argument of type "+c.$$.ptrType.name+" to parameter type "+this.name);var f=c.$$.ptrType.registeredClass,d=Pr(c.$$.ptr,f,this.registeredClass);return d}function or(l){return this.fromWireType(ee[l>>2])}function Es(l){return this.rawGetPointee&&(l=this.rawGetPointee(l)),l}function ws(l){this.rawDestructor&&this.rawDestructor(l)}function bs(l){l!==null&&l.delete()}function Ss(){Ke.prototype.getPointee=Es,Ke.prototype.destructor=ws,Ke.prototype.argPackAdvance=8,Ke.prototype.readValueFromPointer=or,Ke.prototype.deleteObject=bs,Ke.prototype.fromWireType=us}function Ke(l,c,f,d,g,w,b,S,_,A,R){this.name=l,this.registeredClass=c,this.isReference=f,this.isConst=d,this.isSmartPointer=g,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=S,this.rawConstructor=_,this.rawShare=A,this.rawDestructor=R,!g&&c.baseClass===void 0?d?(this.toWireType=vs,this.destructorFunction=null):(this.toWireType=ys,this.destructorFunction=null):this.toWireType=gs}function xs(l,c,f){t.hasOwnProperty(l)||sr("Replacing nonexistant public symbol"),t[l].overloadTable!==void 0&&f!==void 0?t[l].overloadTable[f]=c:(t[l]=c,t[l].argCount=f)}function Ps(l,c,f){var d=t["dynCall_"+l];return f&&f.length?d.apply(null,[c].concat(f)):d.call(null,c)}function Ts(l,c,f){return l.includes("j")?Ps(l,c,f):Jt(c).apply(null,f)}function _s(l,c){var f=[];return function(){return f.length=0,Object.assign(f,arguments),Ts(l,c,f)}}function Pt(l,c){l=Ce(l);function f(){return l.includes("j")?_s(l,c):Jt(c)}var d=f();return typeof d!="function"&&se("unknown function pointer with signature "+l+": "+c),d}var tn=void 0;function rn(l){var c=mn(l),f=Ce(c);return et(c),f}function ar(l,c){var f=[],d={};function g(w){if(!d[w]&&!St[w]){if(tr[w]){tr[w].forEach(g);return}f.push(w),d[w]=!0}}throw c.forEach(g),new tn(l+": "+f.map(rn).join([", "]))}function Cs(l,c,f,d,g,w,b,S,_,A,R,M,L){R=Ce(R),w=Pt(g,w),S&&(S=Pt(b,S)),A&&(A=Pt(_,A)),L=Pt(M,L);var B=rr(R);en(B,function(){ar("Cannot construct "+R+" due to unbound types",[d])}),xt([l,c,f],d?[d]:[],function(z){z=z[0];var ie,pe;d?(ie=z.registeredClass,pe=ie.instancePrototype):pe=ot.prototype;var me=nr(B,function(){if(Object.getPrototypeOf(this)!==D)throw new Nt("Use 'new' to construct "+R);if(H.constructor_body===void 0)throw new Nt(R+" has no accessible constructor");var ve=H.constructor_body[arguments.length];if(ve===void 0)throw new Nt("Tried to invoke ctor of "+R+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(H.constructor_body).toString()+") parameters instead!");return ve.apply(this,arguments)}),D=Object.create(pe,{constructor:{value:me}});me.prototype=D;var H=new ms(R,me,D,L,ie,w,S,A),we=new Ke(R,H,!0,!1,!1),le=new Ke(R+"*",H,!1,!1,!1),De=new Ke(R+" const*",H,!1,!0,!1);return Jr[l]={pointerType:le,constPointerType:De},xs(B,me),[we,le,De]})}function nn(l,c){if(!(l instanceof Function))throw new TypeError("new_ called with constructor type "+typeof l+" which is not a function");var f=nr(l.name||"unknownFunctionName",function(){});f.prototype=l.prototype;var d=new f,g=l.apply(d,c);return g instanceof Object?g:d}function sn(l){for(;l.length;){var c=l.pop(),f=l.pop();f(c)}}function Tr(l,c,f,d,g){var w=c.length;w<2&&se("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=c[1]!==null&&f!==null,S=!1,_=1;_<c.length;++_)if(c[_]!==null&&c[_].destructorFunction===void 0){S=!0;break}for(var A=c[0].name!=="void",R="",M="",_=0;_<w-2;++_)R+=(_!==0?", ":"")+"arg"+_,M+=(_!==0?", ":"")+"arg"+_+"Wired";var L="return function "+rr(l)+"("+R+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+l+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;S&&(L+=`var destructors = [];
`);var B=S?"destructors":"null",z=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ie=[se,d,g,sn,c[0],c[1]];b&&(L+="var thisWired = classParam.toWireType("+B+`, this);
`);for(var _=0;_<w-2;++_)L+="var arg"+_+"Wired = argType"+_+".toWireType("+B+", arg"+_+"); // "+c[_+2].name+`
`,z.push("argType"+_),ie.push(c[_+2]);if(b&&(M="thisWired"+(M.length>0?", ":"")+M),L+=(A?"var rv = ":"")+"invoker(fn"+(M.length>0?", ":"")+M+`);
`,S)L+=`runDestructors(destructors);
`;else for(var _=b?1:2;_<c.length;++_){var pe=_===1?"thisWired":"arg"+(_-2)+"Wired";c[_].destructorFunction!==null&&(L+=pe+"_dtor("+pe+"); // "+c[_].name+`
`,z.push(pe+"_dtor"),ie.push(c[_].destructorFunction))}A&&(L+=`var ret = retType.fromWireType(rv);
return ret;
`),L+=`}
`,z.push(L);var me=nn(Function,z).apply(null,ie);return me}function _r(l,c){for(var f=[],d=0;d<l;d++)f.push(N[(c>>2)+d]);return f}function As(l,c,f,d,g,w,b){var S=_r(f,d);c=Ce(c),w=Pt(g,w),xt([],[l],function(_){_=_[0];var A=_.name+"."+c;function R(){ar("Cannot call "+A+" due to unbound types",S)}c.startsWith("@@")&&(c=Symbol[c.substring(2)]);var M=_.registeredClass.constructor;return M[c]===void 0?(R.argCount=f-1,M[c]=R):(xr(M,c,A),M[c].overloadTable[f-1]=R),xt([],S,function(L){var B=[L[0],null].concat(L.slice(1)),z=Tr(A,B,null,w,b);return M[c].overloadTable===void 0?(z.argCount=f-1,M[c]=z):M[c].overloadTable[f-1]=z,[]}),[]})}function ks(l,c,f,d,g,w){J(c>0);var b=_r(c,f);g=Pt(d,g),xt([],[l],function(S){S=S[0];var _="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[c-1]!==void 0)throw new Nt("Cannot register multiple constructors with identical number of parameters ("+(c-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[c-1]=()=>{ar("Cannot construct "+S.name+" due to unbound types",b)},xt([],b,function(A){return A.splice(1,0,null),S.registeredClass.constructor_body[c-1]=Tr(_,A,null,g,w),[]}),[]})}function Os(l,c,f,d,g,w,b,S){var _=_r(f,d);c=Ce(c),w=Pt(g,w),xt([],[l],function(A){A=A[0];var R=A.name+"."+c;c.startsWith("@@")&&(c=Symbol[c.substring(2)]),S&&A.registeredClass.pureVirtualFunctions.push(c);function M(){ar("Cannot call "+R+" due to unbound types",_)}var L=A.registeredClass.instancePrototype,B=L[c];return B===void 0||B.overloadTable===void 0&&B.className!==A.name&&B.argCount===f-2?(M.argCount=f-2,M.className=A.name,L[c]=M):(xr(L,c,R),L[c].overloadTable[f-2]=M),xt([],_,function(z){var ie=Tr(R,z,A,w,b);return L[c].overloadTable===void 0?(ie.argCount=f-2,L[c]=ie):L[c].overloadTable[f-2]=ie,[]}),[]})}var Cr=[],Be=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ar(l){l>4&&--Be[l].refcount===0&&(Be[l]=void 0,Cr.push(l))}function Is(){for(var l=0,c=5;c<Be.length;++c)Be[c]!==void 0&&++l;return l}function Ds(){for(var l=5;l<Be.length;++l)if(Be[l]!==void 0)return Be[l];return null}function Ls(){t.count_emval_handles=Is,t.get_first_emval=Ds}var Ee={toValue:l=>(l||se("Cannot use deleted val. handle = "+l),Be[l].value),toHandle:l=>{switch(l){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var c=Cr.length?Cr.pop():Be.length;return Be[c]={refcount:1,value:l},c}}}};function Rs(l,c){c=Ce(c),Ve(l,{name:c,fromWireType:function(f){var d=Ee.toValue(f);return Ar(f),d},toWireType:function(f,d){return Ee.toHandle(d)},argPackAdvance:8,readValueFromPointer:or,destructorFunction:null})}function Ms(l,c,f){switch(c){case 0:return function(d){var g=f?Te:_e;return this.fromWireType(g[d])};case 1:return function(d){var g=f?st:Gt;return this.fromWireType(g[d>>1])};case 2:return function(d){var g=f?N:ee;return this.fromWireType(g[d>>2])};default:throw new TypeError("Unknown integer type: "+l)}}function Ns(l,c,f,d){var g=er(f);c=Ce(c);function w(){}w.values={},Ve(l,{name:c,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,S){return S.value},argPackAdvance:8,readValueFromPointer:Ms(c,g,d),destructorFunction:null}),en(c,w)}function lr(l,c){var f=St[l];return f===void 0&&se(c+" has unknown type "+rn(l)),f}function Fs(l,c,f){var d=lr(l,"enum");c=Ce(c);var g=d.constructor,w=Object.create(d.constructor.prototype,{value:{value:f},constructor:{value:nr(d.name+"_"+c,function(){})}});g.values[f]=w,g[c]=w}function kr(l){if(l===null)return"null";var c=typeof l;return c==="object"||c==="array"||c==="function"?l.toString():""+l}function Bs(l,c){switch(c){case 2:return function(f){return this.fromWireType(Fe[f>>2])};case 3:return function(f){return this.fromWireType(Fr[f>>3])};default:throw new TypeError("Unknown float type: "+l)}}function Us(l,c,f){var d=er(f);c=Ce(c),Ve(l,{name:c,fromWireType:function(g){return g},toWireType:function(g,w){return w},argPackAdvance:8,readValueFromPointer:Bs(c,d),destructorFunction:null})}function Gs(l,c,f){switch(c){case 0:return f?function(g){return Te[g]}:function(g){return _e[g]};case 1:return f?function(g){return st[g>>1]}:function(g){return Gt[g>>1]};case 2:return f?function(g){return N[g>>2]}:function(g){return ee[g>>2]};default:throw new TypeError("Unknown integer type: "+l)}}function Ws(l,c,f,d,g){c=Ce(c);var w=er(f),b=M=>M;if(d===0){var S=32-8*f;b=M=>M<<S>>>S}var _=c.includes("unsigned"),A=(M,L)=>{},R;_?R=function(M,L){return A(L,this.name),L>>>0}:R=function(M,L){return A(L,this.name),L},Ve(l,{name:c,fromWireType:b,toWireType:R,argPackAdvance:8,readValueFromPointer:Gs(c,w,d!==0),destructorFunction:null})}function Vs(l,c,f){var d=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],g=d[c];function w(b){b=b>>2;var S=ee,_=S[b],A=S[b+1];return new g(Xe,A,_)}f=Ce(f),Ve(l,{name:f,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function Hs(l,c){c=Ce(c);var f=c==="std::string";Ve(l,{name:c,fromWireType:function(d){var g=ee[d>>2],w;if(f)for(var b=d+4,S=0;S<=g;++S){var _=d+4+S;if(S==g||_e[_]==0){var A=_-b,R=Q(b,A);w===void 0?w=R:(w+="\0",w+=R),b=_+1}}else{for(var M=new Array(g),S=0;S<g;++S)M[S]=String.fromCharCode(_e[d+4+S]);w=M.join("")}return et(d),w},toWireType:function(d,g){g instanceof ArrayBuffer&&(g=new Uint8Array(g));var w,b=typeof g=="string";b||g instanceof Uint8Array||g instanceof Uint8ClampedArray||g instanceof Int8Array||se("Cannot pass non-string to std::string"),f&&b?w=()=>X(g):w=()=>g.length;var S=w(),_=Je(4+S+1);if(ee[_>>2]=S,f&&b)$(g,_+4,S+1);else if(b)for(var A=0;A<S;++A){var R=g.charCodeAt(A);R>255&&(et(_),se("String has UTF-16 code units that do not fit in 8 bits")),_e[_+4+A]=R}else for(var A=0;A<S;++A)_e[_+4+A]=g[A];return d!==null&&d.push(et,_),_},argPackAdvance:8,readValueFromPointer:or,destructorFunction:function(d){et(d)}})}function zs(l,c,f){f=Ce(f);var d,g,w,b,S;c===2?(d=ye,g=xe,b=ue,w=()=>Gt,S=1):c===4&&(d=be,g=Bt,b=vr,w=()=>ee,S=2),Ve(l,{name:f,fromWireType:function(_){for(var A=ee[_>>2],R=w(),M,L=_+4,B=0;B<=A;++B){var z=_+4+B*c;if(B==A||R[z>>S]==0){var ie=z-L,pe=d(L,ie);M===void 0?M=pe:(M+="\0",M+=pe),L=z+c}}return et(_),M},toWireType:function(_,A){typeof A!="string"&&se("Cannot pass non-string to C++ string type "+f);var R=b(A),M=Je(4+R+c);return ee[M>>2]=R>>S,g(A,M+4,R+c),_!==null&&_.push(et,M),M},argPackAdvance:8,readValueFromPointer:or,destructorFunction:function(_){et(_)}})}function $s(l,c){c=Ce(c),Ve(l,{isVoid:!0,name:c,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,d){}})}function Ys(){return Date.now()}var qs=!0;function Xs(){return qs}function js(l,c,f){l=Ee.toValue(l),c=lr(c,"emval::as");var d=[],g=Ee.toHandle(d);return N[f>>2]=g,c.toWireType(d,l)}function Zs(l){var c=[];return N[l>>2]=Ee.toHandle(c),c}var Ks={};function Or(l){var c=Ks[l];return c===void 0?Ce(l):c}var Ir=[];function Qs(l,c,f,d,g){return l=Ir[l],c=Ee.toValue(c),f=Or(f),l(c,f,Zs(d),g)}function on(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Js(l){return l===0?Ee.toHandle(on()):(l=Or(l),Ee.toHandle(on()[l]))}function ei(l){var c=Ir.length;return Ir.push(l),c}function ti(l,c){for(var f=new Array(l),d=0;d<l;++d)f[d]=lr(ee[c+d*Y>>2],"parameter "+d);return f}var an=[];function ri(l,c){var f=ti(l,c),d=f[0],g=d.name+"_$"+f.slice(1).map(function(z){return z.name}).join("_")+"$",w=an[g];if(w!==void 0)return w;for(var b=["retType"],S=[d],_="",A=0;A<l-1;++A)_+=(A!==0?", ":"")+"arg"+A,b.push("argType"+A),S.push(f[1+A]);for(var R=rr("methodCaller_"+g),M="return function "+R+`(handle, name, destructors, args) {
`,L=0,A=0;A<l-1;++A)M+="    var arg"+A+" = argType"+A+".readValueFromPointer(args"+(L?"+"+L:"")+`);
`,L+=f[A+1].argPackAdvance;M+="    var rv = handle[name]("+_+`);
`;for(var A=0;A<l-1;++A)f[A+1].deleteObject&&(M+="    argType"+A+".deleteObject(arg"+A+`);
`);d.isVoid||(M+=`    return retType.toWireType(destructors, rv);
`),M+=`};
`,b.push(M);var B=nn(Function,b).apply(null,S);return w=ei(B),an[g]=w,w}function ni(l,c){return l=Ee.toValue(l),c=Ee.toValue(c),Ee.toHandle(l[c])}function si(l){l>4&&(Be[l].refcount+=1)}function ii(l){return Ee.toHandle(Or(l))}function oi(l){var c=Ee.toValue(l);sn(c),Ar(l)}function ai(l,c,f){l=Ee.toValue(l),c=Ee.toValue(c),f=Ee.toValue(f),l[c]=f}function li(l,c){l=lr(l,"_emval_take_value");var f=l.readValueFromPointer(c);return Ee.toHandle(f)}function ui(l){return l=Ee.toValue(l),Ee.toHandle(typeof l)}function ci(l,c){var f=new Date(N[l>>2]*1e3);N[c>>2]=f.getSeconds(),N[c+4>>2]=f.getMinutes(),N[c+8>>2]=f.getHours(),N[c+12>>2]=f.getDate(),N[c+16>>2]=f.getMonth(),N[c+20>>2]=f.getFullYear()-1900,N[c+24>>2]=f.getDay();var d=new Date(f.getFullYear(),0,1),g=(f.getTime()-d.getTime())/(1e3*60*60*24)|0;N[c+28>>2]=g,N[c+36>>2]=-(f.getTimezoneOffset()*60);var w=new Date(f.getFullYear(),6,1).getTimezoneOffset(),b=d.getTimezoneOffset(),S=(w!=b&&f.getTimezoneOffset()==Math.min(b,w))|0;N[c+32>>2]=S}function hi(l,c,f,d,g,w){try{var b=y.getStream(g);b&&(f&2&&ne.doMsync(l,b,c,d,w),y.munmap(b))}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function fi(l,c,f){var d=new Date().getFullYear(),g=new Date(d,0,1),w=new Date(d,6,1),b=g.getTimezoneOffset(),S=w.getTimezoneOffset(),_=Math.max(b,S);N[l>>2]=_*60,N[c>>2]=+(b!=S);function A(z){var ie=z.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ie?ie[1]:"GMT"}var R=A(g),M=A(w),L=jt(R),B=jt(M);S<b?(ee[f>>2]=L,ee[f+4>>2]=B):(ee[f>>2]=B,ee[f+4>>2]=L)}function Dr(l,c,f){Dr.called||(Dr.called=!0,fi(l,c,f))}function pi(){it("")}function ln(){return 2147483648}function di(){return ln()}function mi(l,c,f){_e.copyWithin(l,c,c+f)}function vi(l){try{return q.grow(l-Xe.byteLength+65535>>>16),Br(q.buffer),1}catch{}}function gi(l){var c=_e.length;l=l>>>0;var f=ln();if(l>f)return!1;let d=(_,A)=>_+(A-_%A)%A;for(var g=1;g<=4;g*=2){var w=c*(1+.2/g);w=Math.min(w,l+100663296);var b=Math.min(f,d(Math.max(l,w),65536)),S=vi(b);if(S)return!0}return!1}var Lr={};function yi(){return o||"./this.program"}function Yt(){if(!Yt.strings){var l=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:l,_:yi()};for(var f in Lr)Lr[f]===void 0?delete c[f]:c[f]=Lr[f];var d=[];for(var f in c)d.push(f+"="+c[f]);Yt.strings=d}return Yt.strings}function Ei(l,c){var f=0;return Yt().forEach(function(d,g){var w=c+f;ee[l+g*4>>2]=w,Zt(d,w),f+=d.length+1}),0}function wi(l,c){var f=Yt();ee[l>>2]=f.length;var d=0;return f.forEach(function(g){d+=g.length+1}),ee[c>>2]=d,0}function bi(l){eo(l)}function Si(l){try{var c=ne.getStreamFromFD(l);return y.close(c),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return f.errno}}function xi(l,c,f,d){for(var g=0,w=0;w<f;w++){var b=ee[c>>2],S=ee[c+4>>2];c+=8;var _=y.read(l,Te,b,S,d);if(_<0)return-1;if(g+=_,_<S)break}return g}function Pi(l,c,f,d){try{var g=ne.getStreamFromFD(l),w=xi(g,c,f);return N[d>>2]=w,0}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return b.errno}}function Ti(l,c){return c+2097152>>>0<4194305-!!l?(l>>>0)+c*4294967296:NaN}function _i(l,c,f,d,g){try{var w=Ti(c,f);if(isNaN(w))return 61;var b=ne.getStreamFromFD(l);return y.llseek(b,w,d),je=[b.position>>>0,(Pe=b.position,+Math.abs(Pe)>=1?Pe>0?(Math.min(+Math.floor(Pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Pe-+(~~Pe>>>0))/4294967296)>>>0:0)],N[g>>2]=je[0],N[g+4>>2]=je[1],b.getdents&&w===0&&d===0&&(b.getdents=null),0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function Ci(l,c,f,d){for(var g=0,w=0;w<f;w++){var b=ee[c>>2],S=ee[c+4>>2];c+=8;var _=y.write(l,Te,b,S,d);if(_<0)return-1;g+=_}return g}function Ai(l,c,f,d){try{var g=ne.getStreamFromFD(l),w=Ci(g,c,f);return ee[d>>2]=w,0}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return b.errno}}function un(l){for(var c=l.split("."),f=0;f<4;f++){var d=Number(c[f]);if(isNaN(d))return null;c[f]=d}return(c[0]|c[1]<<8|c[2]<<16|c[3]<<24)>>>0}function qt(l){return parseInt(l)}function ki(l){var c,f,d,g,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(l))return null;if(l==="::")return[0,0,0,0,0,0,0,0];for(l.startsWith("::")?l=l.replace("::","Z:"):l=l.replace("::",":Z:"),l.indexOf(".")>0?(l=l.replace(new RegExp("[.]","g"),":"),c=l.split(":"),c[c.length-4]=qt(c[c.length-4])+qt(c[c.length-3])*256,c[c.length-3]=qt(c[c.length-2])+qt(c[c.length-1])*256,c=c.slice(0,c.length-2)):c=l.split(":"),d=0,g=0,f=0;f<c.length;f++)if(typeof c[f]=="string")if(c[f]==="Z"){for(g=0;g<8-c.length+1;g++)b[f+g]=0;d=g-1}else b[f+d]=vn(parseInt(c[f],16));else b[f+d]=c[f];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var at={address_map:{id:1,addrs:{},names:{}},lookup_name:function(l){var c=un(l);if(c!==null||(c=ki(l),c!==null))return l;var f;if(at.address_map.addrs[l])f=at.address_map.addrs[l];else{var d=at.address_map.id++;J(d<65535,"exceeded max address mappings of 65535"),f="172.29."+(d&255)+"."+(d&65280),at.address_map.names[f]=l,at.address_map.addrs[l]=f}return f},lookup_addr:function(l){return at.address_map.names[l]?at.address_map.names[l]:null}};function Oi(l){var c=Je(20),f=Je(l.length+1);$(l,f,l.length+1),ee[c>>2]=f;var d=Je(4);ee[d>>2]=0,ee[c+4>>2]=d;var g=2;N[c+8>>2]=g,N[c+12>>2]=4;var w=Je(12);return ee[w>>2]=w+8,ee[w+4>>2]=0,N[w+8>>2]=un(at.lookup_name(l)),ee[c+16>>2]=w,c}function Ii(l){return Oi(Q(l))}function Di(l){var c=l.getExtension("ANGLE_instanced_arrays");if(c)return l.vertexAttribDivisor=function(f,d){c.vertexAttribDivisorANGLE(f,d)},l.drawArraysInstanced=function(f,d,g,w){c.drawArraysInstancedANGLE(f,d,g,w)},l.drawElementsInstanced=function(f,d,g,w,b){c.drawElementsInstancedANGLE(f,d,g,w,b)},1}function Li(l){var c=l.getExtension("OES_vertex_array_object");if(c)return l.createVertexArray=function(){return c.createVertexArrayOES()},l.deleteVertexArray=function(f){c.deleteVertexArrayOES(f)},l.bindVertexArray=function(f){c.bindVertexArrayOES(f)},l.isVertexArray=function(f){return c.isVertexArrayOES(f)},1}function Ri(l){var c=l.getExtension("WEBGL_draw_buffers");if(c)return l.drawBuffers=function(f,d){c.drawBuffersWEBGL(f,d)},1}function Mi(l){return!!(l.multiDrawWebgl=l.getExtension("WEBGL_multi_draw"))}var he={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(c){he.lastError||(he.lastError=c)},getNewId:function(l){for(var c=he.counter++,f=l.length;f<c;f++)l[f]=null;return c},getSource:function(l,c,f,d){for(var g="",w=0;w<c;++w){var b=d?N[d+w*4>>2]:-1;g+=Q(N[f+w*4>>2],b<0?void 0:b)}return g},createContext:function(l,c){if(!l.getContextSafariWebGL2Fixed){let g=function(w,b){var S=l.getContextSafariWebGL2Fixed(w,b);return w=="webgl"==S instanceof WebGLRenderingContext?S:null};l.getContextSafariWebGL2Fixed=l.getContext,l.getContext=g}var f=l.getContext("webgl",c);if(!f)return 0;var d=he.registerContext(f,c);return d},registerContext:function(l,c){var f=he.getNewId(he.contexts),d={handle:f,attributes:c,version:c.majorVersion,GLctx:l};return l.canvas&&(l.canvas.GLctxObject=d),he.contexts[f]=d,(typeof c.enableExtensionsByDefault>"u"||c.enableExtensionsByDefault)&&he.initExtensions(d),f},makeContextCurrent:function(l){return he.currentContext=he.contexts[l],t.ctx=ke=he.currentContext&&he.currentContext.GLctx,!(l&&!ke)},getContext:function(l){return he.contexts[l]},deleteContext:function(l){he.currentContext===he.contexts[l]&&(he.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(he.contexts[l].GLctx.canvas),he.contexts[l]&&he.contexts[l].GLctx.canvas&&(he.contexts[l].GLctx.canvas.GLctxObject=void 0),he.contexts[l]=null},initExtensions:function(l){if(l||(l=he.currentContext),!l.initExtensionsDone){l.initExtensionsDone=!0;var c=l.GLctx;Di(c),Li(c),Ri(c),c.disjointTimerQueryExt=c.getExtension("EXT_disjoint_timer_query"),Mi(c);var f=c.getSupportedExtensions()||[];f.forEach(function(d){!d.includes("lose_context")&&!d.includes("debug")&&c.getExtension(d)})}}};function cn(l){return l.slice(-1)=="]"&&l.lastIndexOf("[")}function Ni(l){var c=l.uniformLocsById,f=l.uniformSizeAndIdsByName,d,g;if(!c)for(l.uniformLocsById=c={},l.uniformArrayNamesById={},d=0;d<ke.getProgramParameter(l,35718);++d){var w=ke.getActiveUniform(l,d),b=w.name,S=w.size,_=cn(b),A=_>0?b.slice(0,_):b,R=l.uniformIdCounter;for(l.uniformIdCounter+=S,f[A]=[S,R],g=0;g<S;++g)c[R]=g,l.uniformArrayNamesById[R++]=A}}function Fi(l,c){if(c=Q(c),l=he.programs[l]){Ni(l);var f=l.uniformLocsById,d=0,g=c,w=cn(c);w>0&&(d=qt(c.slice(w+1))>>>0,g=c.slice(0,w));var b=l.uniformSizeAndIdsByName[g];if(b&&d<b[0]&&(d+=b[1],f[d]=f[d]||ke.getUniformLocation(l,c)))return d}else he.recordError(1281);return-1}function lt(l){var c=ke.currentProgram;if(c){var f=c.uniformLocsById[l];return typeof f=="number"&&(c.uniformLocsById[l]=f=ke.getUniformLocation(c,c.uniformArrayNamesById[l]+(f>0?"["+f+"]":""))),f}else he.recordError(1282)}function Bi(l,c){ke.uniform1f(lt(l),c)}function Ui(l,c){ke.uniform1i(lt(l),c)}var ur=[];function Gi(l,c,f){if(c<=144)for(var d=ur[2*c-1],g=0;g<2*c;g+=2)d[g]=Fe[f+4*g>>2],d[g+1]=Fe[f+(4*g+4)>>2];else var d=Fe.subarray(f>>2,f+c*8>>2);ke.uniform2fv(lt(l),d)}var cr=[];function Wi(l,c,f){if(c<=144)for(var d=cr[2*c-1],g=0;g<2*c;g+=2)d[g]=N[f+4*g>>2],d[g+1]=N[f+(4*g+4)>>2];else var d=N.subarray(f>>2,f+c*8>>2);ke.uniform2iv(lt(l),d)}function Vi(l,c,f){if(c<=96)for(var d=ur[3*c-1],g=0;g<3*c;g+=3)d[g]=Fe[f+4*g>>2],d[g+1]=Fe[f+(4*g+4)>>2],d[g+2]=Fe[f+(4*g+8)>>2];else var d=Fe.subarray(f>>2,f+c*12>>2);ke.uniform3fv(lt(l),d)}function Hi(l,c,f){if(c<=96)for(var d=cr[3*c-1],g=0;g<3*c;g+=3)d[g]=N[f+4*g>>2],d[g+1]=N[f+(4*g+4)>>2],d[g+2]=N[f+(4*g+8)>>2];else var d=N.subarray(f>>2,f+c*12>>2);ke.uniform3iv(lt(l),d)}function zi(l,c,f){if(c<=72){var d=ur[4*c-1],g=Fe;f>>=2;for(var w=0;w<4*c;w+=4){var b=f+w;d[w]=g[b],d[w+1]=g[b+1],d[w+2]=g[b+2],d[w+3]=g[b+3]}}else var d=Fe.subarray(f>>2,f+c*16>>2);ke.uniform4fv(lt(l),d)}function $i(l,c,f){if(c<=72)for(var d=cr[4*c-1],g=0;g<4*c;g+=4)d[g]=N[f+4*g>>2],d[g+1]=N[f+(4*g+4)>>2],d[g+2]=N[f+(4*g+8)>>2],d[g+3]=N[f+(4*g+12)>>2];else var d=N.subarray(f>>2,f+c*16>>2);ke.uniform4iv(lt(l),d)}function Yi(l){}function hr(l){return l%4===0&&(l%100!==0||l%400===0)}function qi(l,c){for(var f=0,d=0;d<=c;f+=l[d++]);return f}var hn=[31,29,31,30,31,30,31,31,30,31,30,31],fn=[31,28,31,30,31,30,31,31,30,31,30,31];function Xi(l,c){for(var f=new Date(l.getTime());c>0;){var d=hr(f.getFullYear()),g=f.getMonth(),w=(d?hn:fn)[g];if(c>w-f.getDate())c-=w-f.getDate()+1,f.setDate(1),g<11?f.setMonth(g+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+c),f}return f}function ji(l,c,f,d){var g=N[d+40>>2],w={tm_sec:N[d>>2],tm_min:N[d+4>>2],tm_hour:N[d+8>>2],tm_mday:N[d+12>>2],tm_mon:N[d+16>>2],tm_year:N[d+20>>2],tm_wday:N[d+24>>2],tm_yday:N[d+28>>2],tm_isdst:N[d+32>>2],tm_gmtoff:N[d+36>>2],tm_zone:g?Q(g):""},b=Q(f),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var _ in S)b=b.replace(new RegExp(_,"g"),S[_]);var A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],R=["January","February","March","April","May","June","July","August","September","October","November","December"];function M(D,H,we){for(var le=typeof D=="number"?D.toString():D||"";le.length<H;)le=we[0]+le;return le}function L(D,H){return M(D,H,"0")}function B(D,H){function we(De){return De<0?-1:De>0?1:0}var le;return(le=we(D.getFullYear()-H.getFullYear()))===0&&(le=we(D.getMonth()-H.getMonth()))===0&&(le=we(D.getDate()-H.getDate())),le}function z(D){switch(D.getDay()){case 0:return new Date(D.getFullYear()-1,11,29);case 1:return D;case 2:return new Date(D.getFullYear(),0,3);case 3:return new Date(D.getFullYear(),0,2);case 4:return new Date(D.getFullYear(),0,1);case 5:return new Date(D.getFullYear()-1,11,31);case 6:return new Date(D.getFullYear()-1,11,30)}}function ie(D){var H=Xi(new Date(D.tm_year+1900,0,1),D.tm_yday),we=new Date(H.getFullYear(),0,4),le=new Date(H.getFullYear()+1,0,4),De=z(we),ve=z(le);return B(De,H)<=0?B(ve,H)<=0?H.getFullYear()+1:H.getFullYear():H.getFullYear()-1}var pe={"%a":function(D){return A[D.tm_wday].substring(0,3)},"%A":function(D){return A[D.tm_wday]},"%b":function(D){return R[D.tm_mon].substring(0,3)},"%B":function(D){return R[D.tm_mon]},"%C":function(D){var H=D.tm_year+1900;return L(H/100|0,2)},"%d":function(D){return L(D.tm_mday,2)},"%e":function(D){return M(D.tm_mday,2," ")},"%g":function(D){return ie(D).toString().substring(2)},"%G":function(D){return ie(D)},"%H":function(D){return L(D.tm_hour,2)},"%I":function(D){var H=D.tm_hour;return H==0?H=12:H>12&&(H-=12),L(H,2)},"%j":function(D){return L(D.tm_mday+qi(hr(D.tm_year+1900)?hn:fn,D.tm_mon-1),3)},"%m":function(D){return L(D.tm_mon+1,2)},"%M":function(D){return L(D.tm_min,2)},"%n":function(){return`
`},"%p":function(D){return D.tm_hour>=0&&D.tm_hour<12?"AM":"PM"},"%S":function(D){return L(D.tm_sec,2)},"%t":function(){return"	"},"%u":function(D){return D.tm_wday||7},"%U":function(D){var H=D.tm_yday+7-D.tm_wday;return L(Math.floor(H/7),2)},"%V":function(D){var H=Math.floor((D.tm_yday+7-(D.tm_wday+6)%7)/7);if((D.tm_wday+371-D.tm_yday-2)%7<=2&&H++,H){if(H==53){var le=(D.tm_wday+371-D.tm_yday)%7;le!=4&&(le!=3||!hr(D.tm_year))&&(H=1)}}else{H=52;var we=(D.tm_wday+7-D.tm_yday-1)%7;(we==4||we==5&&hr(D.tm_year%400-1))&&H++}return L(H,2)},"%w":function(D){return D.tm_wday},"%W":function(D){var H=D.tm_yday+7-(D.tm_wday+6)%7;return L(Math.floor(H/7),2)},"%y":function(D){return(D.tm_year+1900).toString().substring(2)},"%Y":function(D){return D.tm_year+1900},"%z":function(D){var H=D.tm_gmtoff,we=H>=0;return H=Math.abs(H)/60,H=H/60*100+H%60,(we?"+":"-")+("0000"+H).slice(-4)},"%Z":function(D){return D.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var _ in pe)b.includes(_)&&(b=b.replace(new RegExp(_,"g"),pe[_](w)));b=b.replace(/\0\0/g,"%");var me=dr(b,!1);return me.length>c?0:(Ut(me,l),me.length-1)}function Zi(l,c,f,d){return ji(l,c,f,d)}var pn=function(l,c,f,d){l||(l=this),this.parent=l,this.mount=l.mount,this.mounted=null,this.id=y.nextInode++,this.name=c,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=d},fr=365,pr=146;Object.defineProperties(pn.prototype,{read:{get:function(){return(this.mode&fr)===fr},set:function(l){l?this.mode|=fr:this.mode&=~fr}},write:{get:function(){return(this.mode&pr)===pr},set:function(l){l?this.mode|=pr:this.mode&=~pr}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=pn,y.staticInit(),Zn(),Nt=t.BindingError=Er(Error,"BindingError"),jr=t.InternalError=Er(Error,"InternalError"),ds(),os(),Ss(),tn=t.UnboundTypeError=Er(Error,"UnboundTypeError"),Ls();for(var ke,Ki=new Float32Array(288),Qe=0;Qe<288;++Qe)ur[Qe]=Ki.subarray(0,Qe+1);for(var Qi=new Int32Array(288),Qe=0;Qe<288;++Qe)cr[Qe]=Qi.subarray(0,Qe+1);function dr(l,c,f){var d=X(l)+1,g=new Array(d),w=oe(l,g,0,g.length);return c&&(g.length=w),g}var Ji={_:On,k:In,a:Dn,b:Rn,S:Un,T:Gn,p:Vn,M:Hn,V:zn,J:$n,K:Yn,t:qn,L:Xn,B:jn,X:Jn,d:Cs,f:As,e:ks,c:Os,W:Rs,i:Ns,h:Fs,w:Us,j:Ws,g:Vs,v:Hs,q:zs,Y:$s,P:Ys,O:Xs,m:js,la:Qs,y:Ar,ma:Js,ka:ri,r:ni,z:si,ja:ii,na:oi,n:ai,l:li,x:ui,Q:ci,G:hi,R:Dr,s:pi,F:di,N:mi,E:gi,H:Ei,I:wi,$:bi,o:Si,U:Pi,A:_i,u:Ai,Z:Ii,ia:Fi,ga:Bi,ha:Ui,ca:Gi,fa:Wi,ba:Vi,ea:Hi,aa:zi,da:$i,C:Yi,D:Zi};kn(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.pa).apply(null,arguments)};var Je=t._malloc=function(){return(Je=t._malloc=t.asm.qa).apply(null,arguments)},et=t._free=function(){return(et=t._free=t.asm.ra).apply(null,arguments)},dn=t.___errno_location=function(){return(dn=t.___errno_location=t.asm.sa).apply(null,arguments)},mn=t.___getTypeName=function(){return(mn=t.___getTypeName=t.asm.ta).apply(null,arguments)};t.___embind_register_native_and_builtin_types=function(){return(t.___embind_register_native_and_builtin_types=t.asm.ua).apply(null,arguments)};var vn=t._htons=function(){return(vn=t._htons=t.asm.wa).apply(null,arguments)},gn=t._emscripten_builtin_memalign=function(){return(gn=t._emscripten_builtin_memalign=t.asm.xa).apply(null,arguments)},yn=t.___cxa_is_pointer_type=function(){return(yn=t.___cxa_is_pointer_type=t.asm.ya).apply(null,arguments)};t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.za).apply(null,arguments)},t.dynCall_viijii=function(){return(t.dynCall_viijii=t.asm.Aa).apply(null,arguments)},t.dynCall_iiiiij=function(){return(t.dynCall_iiiiij=t.asm.Ba).apply(null,arguments)},t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.Ca).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.Da).apply(null,arguments)},t.dynCall_viiiiji=function(){return(t.dynCall_viiiiji=t.asm.Ea).apply(null,arguments)},t.FS=y;var mr;function Rr(l){this.name="ExitStatus",this.message="Program terminated with exit("+l+")",this.status=l}Wt=function l(){mr||Mr(),mr||(Wt=l)};function Mr(l){if(wt>0||(bn(),wt>0))return;function c(){mr||(mr=!0,t.calledRun=!0,!ce&&(Sn(),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),xn()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),c()},1)):c()}t.run=Mr;function eo(l,c){to(l)}function to(l){Hr()||(t.onExit&&t.onExit(l),ce=!0),a(l,new Rr(l))}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return Mr(),t.ready}})(),opencascadeWasm="/assets/replicad_single-C4NBJ5vg.wasm";const OC={library:null},setOC=r=>{OC.library=r},getOC=()=>{if(!OC.library)throw new Error("oppencascade has not been loaded");return OC.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const deletetableRegistry=new globalThis.FinalizationRegistry(r=>{try{r.delete()}catch(e){console.error(e)}});class WrappingObj{constructor(e){this.oc=getOC(),e&&deletetableRegistry.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(deletetableRegistry.unregister(this._wrapped),this._wrapped.delete()),deletetableRegistry.register(this,e,e),this._wrapped=e}delete(){var e;deletetableRegistry.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const GCWithScope=()=>{function r(e){return deletetableRegistry.register(r,e),e}return r},GCWithObject=r=>{function e(t){return deletetableRegistry.register(r,t),t}return e},localGC=r=>{const e=new Set;return[t=>(e.add(t),t),()=>{[...e.values()].forEach(t=>t.delete()),e.clear()},r?e:void 0]},HASH_CODE_MAX=2147483647,DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI,round3=r=>Math.round(r*1e3)/1e3;function isPoint(r){return Array.isArray(r)?r.length===3||r.length===2:r instanceof Vector?!0:!!(r&&typeof(r==null?void 0:r.XYZ)=="function")}const makeAx3=(r,e,t)=>{const n=getOC(),s=asPnt(r),i=asDir(e);let o;if(t){const a=asDir(t);o=new n.gp_Ax3_3(s,i,a),a.delete()}else o=new n.gp_Ax3_4(s,i);return s.delete(),i.delete(),o},makeAx2=(r,e,t)=>{const n=getOC(),s=asPnt(r),i=asDir(e);let o;if(t){const a=asDir(t);o=new n.gp_Ax2_2(s,i,a),a.delete()}else o=new n.gp_Ax2_3(s,i);return s.delete(),i.delete(),o},makeAx1=(r,e)=>{const t=getOC(),n=asPnt(r),s=asDir(e),i=new t.gp_Ax1_2(n,s);return n.delete(),s.delete(),i},makeVec=(r=[0,0,0])=>{const e=getOC();if(Array.isArray(r)){if(r.length===3)return new e.gp_Vec_4(...r);if(r.length===2)return new e.gp_Vec_4(...r,0)}else{if(r instanceof Vector)return new e.gp_Vec_3(r.wrapped.XYZ());if(r.XYZ)return new e.gp_Vec_3(r.XYZ())}return new e.gp_Vec_4(0,0,0)};class Vector extends WrappingObj{constructor(e=[0,0,0]){super(makeVec(e))}get repr(){return`x: ${round3(this.x)}, y: ${round3(this.y)}, z: ${round3(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new Vector(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new Vector(this.wrapped.Subtracted(e.wrapped))}add(e){return new Vector(this.wrapped.Added(e.wrapped))}multiply(e){return new Vector(this.wrapped.Multiplied(e))}normalized(){return new Vector(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*RAD2DEG}projectToPlane(e){const t=e.origin,n=e.zDir,s=this.sub(t),i=n.multiply(s.dot(n)/n.Length**2),o=this.sub(i);return s.delete(),i.delete(),o}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,t=[0,0,0],n=[0,0,1]){const s=makeAx1(t,n);return this.wrapped.Rotate(s,e*DEG2RAD),s.delete(),this}}const DIRECTIONS$1={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function makeDirection(r){return r==="X"||r==="Y"||r==="Z"?DIRECTIONS$1[r]:r}function asPnt(r){const e=new Vector(r),t=e.toPnt();return e.delete(),t}function asDir(r){const e=new Vector(r),t=e.toDir();return e.delete(),t}class Transformation extends WrappingObj{constructor(e){const t=getOC();super(e||new t.gp_Trsf_1)}translate(e,t=0,n=0){const s=new Vector(typeof e=="number"?[e,t,n]:e);return this.wrapped.SetTranslation_1(s.wrapped),this}rotate(e,t=[0,0,0],n=[0,0,1]){const s=asDir(n),i=asPnt(t),o=new this.oc.gp_Ax1_2(i,s);return this.wrapped.SetRotation_1(o,e*DEG2RAD),o.delete(),s.delete(),i.delete(),this}mirror(e="YZ",t){const n=GCWithScope();let s,i;if(typeof e=="string"){const a=n(createNamedPlane(e,t));s=a.origin,i=a.zDir}else e instanceof Plane?(s=t||e.origin,i=e.zDir):(s=t||[0,0,0],i=e);const o=n(makeAx2(s,i));return this.wrapped.SetMirror_3(o),this}scale(e,t){const n=asPnt(e);return this.wrapped.SetScale(n,t),n.delete(),this}coordSystemChange(e,t){const n=GCWithScope(),s=n(e==="reference"?new this.oc.gp_Ax3_1:makeAx3(e.origin,e.zDir,e.xDir)),i=n(t==="reference"?new this.oc.gp_Ax3_1:makeAx3(t.origin,t.zDir,t.xDir));return this.wrapped.SetTransformation_1(s,i),this}transformPoint(e){const t=asPnt(e),n=t.Transformed(this.wrapped);return t.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Plane{constructor(e,t=null,n=[0,0,1]){this.oc=getOC();const s=new Vector(n);if(s.Length===0)throw new Error("normal should be non null");this.zDir=s.normalize();let i;if(t)i=new Vector(t);else{const o=makeAx3(e,s);i=new Vector(o.XDirection()),o.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new Vector(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Plane(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const t=this.clone();return t.origin=new Vector(e),t}translate(e,t=0,n=0){const s=new Vector(typeof e=="number"?[e,t,n]:e);return this.translateTo(this.origin.add(s))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,t=[1,0,0]){const n=makeDirection(t),s=new Vector(this.zDir).rotate(e,[0,0,0],n),i=new Vector(this.xDir).rotate(e,[0,0,0],n);return new Plane(this.origin,i,s)}rotate2DAxes(e){const t=new Vector(this.xDir).rotate(e,[0,0,0],this.zDir);return new Plane(this.origin,t,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,t=makeAx3(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,t),this.globalToLocal=new Transformation,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Transformation,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,t){this.origin=this.toWorldCoords([e,t])}toLocalCoords(e){const t=this.globalToLocal.transformPoint(e),n=new Vector(t);return t.delete(),n}toWorldCoords(e){const t=this.localToGlobal.transformPoint(e),n=new Vector(t);return t.delete(),n}}const PLANES_CONFIG={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},createNamedPlane=(r,e=[0,0,0])=>{const t=PLANES_CONFIG[r];if(!t)throw new Error(`Could not find plane ${r}`);let n;return typeof e=="number"?n=t.normal.map(s=>s*e):n=e,new Plane(n,t.xDir,t.normal)};let BoundingBox$1=class extends WrappingObj{constructor(e){const t=getOC();let n=e;n||(n=new t.Bnd_Box_1),super(n)}get repr(){const[e,t]=this.bounds;return`${new Vector(e).repr} - ${new Vector(t).repr}`}get bounds(){const e={current:0},t={current:0},n={current:0},s={current:0},i={current:0},o={current:0};return this.wrapped.Get(e,t,n,s,i,o),[[e.current,t.current,n.current],[s.current,i.current,o.current]]}get center(){const[[e,t,n],[s,i,o]]=this.bounds;return[e+(s-e)/2,t+(i-t)/2,n+(o-n)/2]}get width(){const[[e],[t]]=this.bounds;return Math.abs(t-e)}get height(){const[[,e],[,t]]=this.bounds;return Math.abs(t-e)}get depth(){const[[,,e],[,,t]]=this.bounds;return Math.abs(t-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};const makePlaneFromFace=(r,e=[0,0])=>{const t=r.pointOnSurface(...e),n=r.normalAt(t),s=new Vector([0,0,1]);let i=s.cross(n);return i.Length<1e-8&&(i.delete(),i=new Vector([1,0,0])),s.delete(),new Plane(t,i,n)};function makePlane(r="XY",e=[0,0,0]){return r instanceof Plane?r.clone():createNamedPlane(r,e)}function rotate$1(r,e,t=[0,0,0],n=[0,0,1]){const s=new Transformation;s.rotate(e,t,n);const i=s.transform(r);return s.delete(),i}function translate(r,e){const t=new Transformation;t.translate(e);const n=t.transform(r);return t.delete(),n}function mirror(r,e,t){const n=new Transformation;n.mirror(e,t);const s=n.transform(r);return n.delete(),s}function scale(r,e,t){const n=new Transformation;n.scale(e,t);const s=n.transform(r);return n.delete(),s}function isPoint2D(r){return Array.isArray(r)&&r.length===2}let CURVE_TYPES_MAP=null;const getCurveTypesMap=r=>{if(CURVE_TYPES_MAP&&!r)return CURVE_TYPES_MAP;const t=getOC().GeomAbs_CurveType;return CURVE_TYPES_MAP=new Map([[t.GeomAbs_Line,"LINE"],[t.GeomAbs_Circle,"CIRCLE"],[t.GeomAbs_Ellipse,"ELLIPSE"],[t.GeomAbs_Hyperbola,"HYPERBOLA"],[t.GeomAbs_Parabola,"PARABOLA"],[t.GeomAbs_BezierCurve,"BEZIER_CURVE"],[t.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[t.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[t.GeomAbs_OtherCurve,"OTHER_CURVE"]]),CURVE_TYPES_MAP},findCurveType=r=>{let e=getCurveTypesMap().get(r);if(e||(e=getCurveTypesMap(!0).get(r)),!e)throw new Error("unknown type");return e};function precisionRound(r,e){const t=Math.pow(10,e),n=e<0?r:.01/t+r;return Math.round(n*t)/t}function range$1(r){return Array.from(Array(r).keys())}function zip(r){const e=Math.min(...r.map(t=>t.length));return range$1(e).map(t=>r.map(n=>n[t]))}function round2(r){return Math.round(r*100)/100}const reprPnt=([r,e])=>`(${round2(r)},${round2(e)})`,asFixed=(r,e=1e-9)=>{let t=r;return Math.abs(r)<e&&(t=0),t.toFixed(-Math.log10(e))},removeDuplicatePoints=(r,e=1e-9)=>Array.from(new Map(r.map(([t,n])=>[`[${asFixed(t,e)},${asFixed(n,e)}]`,[t,n]])).values()),pnt=([r,e])=>{const t=getOC();return new t.gp_Pnt2d_3(r,e)},direction2d=([r,e])=>{const t=getOC();return new t.gp_Dir2d_4(r,e)},vec=([r,e])=>{const t=getOC();return new t.gp_Vec2d_4(r,e)},axis2d=(r,e)=>{const t=getOC(),[n,s]=localGC(),i=new t.gp_Ax2d_2(n(pnt(r)),n(direction2d(e)));return s(),i};class BoundingBox2d extends WrappingObj{constructor(e){const t=getOC();let n=e;n||(n=new t.Bnd_Box2d),super(n)}get repr(){const[e,t]=this.bounds;return`${reprPnt(e)} - ${reprPnt(t)}`}get bounds(){const e={current:0},t={current:0},n={current:0},s={current:0};return this.wrapped.Get(e,t,n,s),[[e.current,t.current],[n.current,s.current]]}get center(){const[[e,t],[n,s]]=this.bounds;return[e+(n-e)/2,t+(s-t)/2]}get width(){const[[e],[t]]=this.bounds;return Math.abs(t-e)}get height(){const[[,e],[,t]]=this.bounds;return Math.abs(t-e)}outsidePoint(e=1){const[t,n]=this.bounds,s=n[0]-t[0],i=n[1]-t[1];return[n[0]+s/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=GCWithScope()(pnt(e));return!this.wrapped.IsOut_1(n)}}const samePoint$2=([r,e],[t,n],s=1e-6)=>Math.abs(r-t)<=s&&Math.abs(e-n)<=s,add2d=([r,e],[t,n])=>[r+t,e+n],subtract2d=([r,e],[t,n])=>[r-t,e-n],scalarMultiply2d=([r,e],t)=>[r*t,e*t],distance2d=([r,e],[t,n]=[0,0])=>Math.sqrt((r-t)**2+(e-n)**2),squareDistance2d=([r,e],[t,n]=[0,0])=>(r-t)**2+(e-n)**2;function crossProduct2d([r,e],[t,n]){return r*n-e*t}const angle2d=([r,e],[t,n]=[0,0])=>Math.atan2(n*r-e*t,r*t+e*n),polarAngle2d=([r,e],[t,n]=[0,0])=>Math.atan2(n-e,t-r),normalize2d=([r,e])=>{const t=distance2d([r,e]);return[r/t,e/t]},rotate2d=(r,e,t=[0,0])=>{const[n,s]=r,[i,o]=t,a=n-i,u=s-o,h=Math.sin(e),p=Math.cos(e),m=a*p-u*h,v=a*h+u*p;return[m+i,v+o]},polarToCartesian=(r,e)=>{const t=Math.cos(e)*r,n=Math.sin(e)*r;return[t,n]},cartesianToPolar=([r,e])=>{const t=distance2d([r,e]),n=Math.atan2(e,r);return[t,n]};class Curve2D extends WrappingObj{constructor(e){const t=getOC(),n=e.get();super(new t.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=getOC(),t=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,t),this._boundingBox=new BoundingBox2d(t),this._boundingBox}get repr(){return`${this.geomType} ${reprPnt(this.firstPoint)} - ${reprPnt(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const t=this.innerCurve.Value(e),n=[t.X(),t.Y()];return t.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=getOC();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),t=findCurveType(e.GetType());return e.delete(),t}clone(){return new Curve2D(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const t=getOC(),n=GCWithScope(),s=n(new t.Geom2dAPI_ProjectPointOnCurve_2(n(pnt(e)),this.wrapped));let i=1/0;try{i=s.LowerDistance()}catch{i=1/0}return Math.min(i,distance2d(e,this.firstPoint),distance2d(e,this.lastPoint))}distanceFromCurve(e){const t=getOC(),n=GCWithScope();let s=1/0;const i=n(new t.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{s=i.LowerDistance()}catch{s=1/0}return Math.min(s,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return isPoint2D(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,t=1e-9){const n=getOC(),s=GCWithScope();let i,o;try{const a=s(new n.Geom2dAPI_ProjectPointOnCurve_2(s(pnt(e)),this.wrapped));i=a.LowerDistance(),o=a.LowerDistanceParameter()}catch{if(samePoint$2(e,this.firstPoint,t))return this.firstParameter;if(samePoint$2(e,this.lastPoint,t))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>t)throw new Error(`Point ${reprPnt(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return o}tangentAt(e){const t=getOC(),[n,s]=localGC();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const o=n(new t.gp_Pnt2d_1),a=n(new t.gp_Vec2d_1);this.innerCurve.D1(i,o,a);const u=[a.X(),a.Y()];return s(),u}splitAt(e,t=1e-9){const n=getOC(),s=GCWithScope();let i=e.map(u=>isPoint2D(u)?this.parameter(u,t):u);i=Array.from(new Map(i.map(u=>[precisionRound(u,-Math.log10(t)),u])).values()).sort((u,h)=>u-h);const o=this.firstParameter,a=this.lastParameter;return o>a&&i.reverse(),Math.abs(i[0]-o)<t*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-a)<t*100&&(i=i.slice(0,-1)),i.length?zip([[o,...i],[...i,a]]).map(([u,h])=>{try{if(this.geomType==="BEZIER_CURVE"){const m=new n.Geom2d_BezierCurve_1(s(this.adaptor()).Bezier().get().Poles_2());return m.Segment(u,h),new Curve2D(new n.Handle_Geom2d_Curve_2(m))}if(this.geomType==="BSPLINE_CURVE"){const m=s(this.adaptor()).BSpline().get(),v=new n.Geom2d_BSplineCurve_1(m.Poles_2(),m.Knots_2(),m.Multiplicities_2(),m.Degree(),m.IsPeriodic());return v.Segment(u,h,t),new Curve2D(new n.Handle_Geom2d_Curve_2(v))}const p=new n.Geom2d_TrimmedCurve(this.wrapped,u,h,!0,!0);return new Curve2D(new n.Handle_Geom2d_Curve_2(p))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const approximateAsBSpline=(r,e=1e-8)=>{const t=getOC(),s=GCWithScope()(new t.Geom2dConvert_ApproxCurve_2(r.ShallowCopy(),e,t.GeomAbs_Shape.GeomAbs_C0,30,3));return new Curve2D(s.Curve())},BSplineToBezier=r=>{if(findCurveType(r.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=r.BSpline(),t=getOC(),n=new t.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*s(){const o=n.NbArcs();if(o)for(let a=1;a<=o;a++){const u=n.Arc(a);yield new Curve2D(u)}}const i=Array.from(s());return n.delete(),i};function*pointsIteration(r){const e=r.NbPoints();if(e)for(let t=1;t<=e;t++){const n=r.Point(t);yield[n.X(),n.Y()]}}function*commonSegmentsIteration(r){const e=r.NbSegments();if(!e)return;const t=getOC();for(let n=1;n<=e;n++){const s=new t.Handle_Geom2d_Curve_1,i=new t.Handle_Geom2d_Curve_1;try{r.Segment(n,s,i)}catch{continue}yield new Curve2D(s),i.delete()}}const intersectCurves=(r,e,t=1e-9)=>{if(r.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=getOC(),s=new n.Geom2dAPI_InterCurveCurve_1;let i,o;try{s.Init_1(r.wrapped,e.wrapped,t),i=Array.from(pointsIteration(s)),o=Array.from(commonSegmentsIteration(s))}catch(h){throw console.error(r,e,h),new Error("Intersections failed between curves")}finally{s.delete()}const a=o.filter(h=>samePoint$2(h.firstPoint,h.lastPoint,t)).map(h=>h.firstPoint);a.length&&(i.push(...a),o=o.filter(h=>!samePoint$2(h.firstPoint,h.lastPoint,t)));const u=o.flatMap(h=>[h.firstPoint,h.lastPoint]);return{intersections:i,commonSegments:o,commonSegmentsPoints:u}},selfIntersections=(r,e=1e-9)=>{const t=getOC(),n=new t.Geom2dAPI_InterCurveCurve_1;let s;try{n.Init_1(r.wrapped,r.wrapped,e),s=Array.from(pointsIteration(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return s},make2dSegmentCurve=(r,e)=>{const t=getOC(),[n,s]=localGC(),i=n(new t.GCE2d_MakeSegment_1(n(pnt(r)),n(pnt(e)))).Value(),o=new Curve2D(i);return samePoint$2(o.firstPoint,r)||o.reverse(),s(),o},make2dThreePointArc=(r,e,t)=>{const n=getOC(),[s,i]=localGC(),o=s(new n.GCE2d_MakeArcOfCircle_4(s(pnt(r)),s(pnt(e)),s(pnt(t)))).Value();i();const a=new Curve2D(o);return samePoint$2(a.firstPoint,r)||a.wrapped.get().SetTrim(a.lastParameter,a.firstParameter,!0,!0),a},make2dTangentArc=(r,e,t)=>{const n=getOC(),[s,i]=localGC(),o=s(new n.GCE2d_MakeArcOfCircle_5(s(pnt(r)),s(vec(e)),s(pnt(t)))).Value();i();const a=new Curve2D(o);return samePoint$2(a.firstPoint,r)||a.wrapped.get().SetTrim(a.lastParameter,a.firstParameter,!0,!0),a},make2dCircle=(r,e=[0,0])=>{const t=getOC(),[n,s]=localGC(),i=n(new t.GCE2d_MakeCircle_7(n(pnt(e)),r,!0)).Value();return s(),new Curve2D(i)},make2dEllipse=(r,e,t=[1,0],n=[0,0],s=!0)=>{const i=getOC(),[o,a]=localGC(),u=o(new i.gp_Elips2d_2(o(axis2d(n,t)),r,e,s)),h=o(new i.GCE2d_MakeEllipse_1(u)).Value();return a(),new Curve2D(h)},make2dEllipseArc=(r,e,t,n,s=[0,0],i,o=!0)=>{const a=getOC(),[u,h]=localGC(),p=u(new a.gp_Elips2d_2(u(axis2d(s,i)),r,e,!0)),m=u(new a.GCE2d_MakeArcOfEllipse_1(p,t,n,o)).Value();return h(),new Curve2D(m)},make2dBezierCurve=(r,e,t)=>{const n=getOC(),[s,i]=localGC(),o=s(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));o.SetValue(1,s(pnt(r))),e.forEach((u,h)=>{o.SetValue(h+2,s(pnt(u)))}),o.SetValue(e.length+2,s(pnt(t)));const a=new n.Geom2d_BezierCurve_1(o);return i(),new Curve2D(new n.Handle_Geom2d_Curve_2(a))};function make2dInerpolatedBSplineCurve(r,{tolerance:e=.001,smoothing:t=null,degMax:n=3,degMin:s=1}={}){const i=GCWithScope(),o=getOC(),a=i(new o.TColgp_Array1OfPnt2d_2(1,r.length));r.forEach((h,p)=>{a.SetValue(p+1,i(pnt(h)))});let u;if(t?u=i(new o.Geom2dAPI_PointsToBSpline_6(a,t[0],t[1],t[2],n,o.GeomAbs_Shape.GeomAbs_C2,e)):u=i(new o.Geom2dAPI_PointsToBSpline_2(a,s,n,o.GeomAbs_Shape.GeomAbs_C2,e)),!u.IsDone())throw new Error("B-spline approximation failed");return new Curve2D(u.Curve())}const make2dArcFromCenter=(r,e,t)=>{const n=scalarMultiply2d(add2d(r,e),.5),s=distance2d(t,r),i=normalize2d(subtract2d(n,t));return make2dThreePointArc(r,add2d(scalarMultiply2d(i,s),t),e)},offsetEndPoints=(r,e,t)=>{const n=normalize2d(subtract2d(e,r)),s=[n[1],-n[0]],i=[s[0]*t,s[1]*t];return{firstPoint:add2d(r,i),lastPoint:add2d(e,i)}},make2dOffset=(r,e)=>{const t=GCWithScope(),n=r.geomType;if(n==="CIRCLE"){const u=t(t(r.adaptor()).Circle()),h=u.Radius(),p=u.IsDirect()?1:-1,m=e*p,v=h+m;if(v<1e-10){const C=t(u.Location()),I=[C.X(),C.Y()],O=G=>{const[F,Y]=normalize2d(subtract2d(G,I));return add2d(G,[m*F,m*Y])};return{collapsed:!0,firstPoint:O(r.firstPoint),lastPoint:O(r.lastPoint)}}const E=getOC(),x=new E.gp_Circ2d_3(u.Axis(),v),P=new E.Geom2d_Circle_1(x),T=new E.Geom2d_TrimmedCurve(new E.Handle_Geom2d_Curve_2(P),r.firstParameter,r.lastParameter,!0,!0);return new Curve2D(new E.Handle_Geom2d_Curve_2(T))}if(n==="LINE"){const{firstPoint:u,lastPoint:h}=offsetEndPoints(r.firstPoint,r.lastPoint,e);return make2dSegmentCurve(u,h)}const s=getOC(),i=new Curve2D(new s.Handle_Geom2d_Curve_2(new s.Geom2d_OffsetCurve(r.wrapped,e,!0))),o=approximateAsBSpline(i.adaptor());return selfIntersections(o).length?{collapsed:!0,firstPoint:o.firstPoint,lastPoint:o.lastPoint}:o};function removeCorner(r,e,t){const n=crossProduct2d(r.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const s=n>0?-1:1,i=Math.abs(t)*s,o=make2dOffset(r,i),a=make2dOffset(e,i);if(!(o instanceof Curve2D)||!(a instanceof Curve2D))return null;let u;try{const{intersections:E}=intersectCurves(o,a,1e-9);u=E.at(-1)}catch{return null}if(!isPoint2D(u))return null;const h=u,p=(E,x)=>{const[P,T]=x.tangentAt(h),C=normalize2d([-T,P]),I=add2d(h,scalarMultiply2d(C,i)),O=E.parameter(I,1e-6);return E.splitAt([O])},[m]=p(r,o),[,v]=p(e,a);return{first:m,second:v,center:h}}function filletCurves(r,e,t){const n=removeCorner(r,e,t);if(!n)return console.warn("Cannot fillet between curves",r.repr,e.repr),[r,e];const{first:s,second:i,center:o}=n;return[s,make2dArcFromCenter(s.lastPoint,i.firstPoint,o),i]}function chamferCurves(r,e,t){const n=removeCorner(r,e,t);if(!n)return console.warn("Cannot chamfer between curves",r.repr,e.repr),[r,e];const{first:s,second:i}=n;return[s,make2dSegmentCurve(s.lastPoint,i.firstPoint),i]}class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,t){let n=this.length++;for(;n>0;){const s=n-1>>1,i=this.values[s];if(t>=i)break;this.ids[n]=this.ids[s],this.values[n]=i,n=s}this.ids[n]=e,this.values[n]=t}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],s=this.length>>1;let i=0;for(;i<s;){let o=(i<<1)+1;const a=o+1;let u=this.ids[o],h=this.values[o];const p=this.values[a];if(a<this.length&&p<h&&(o=a,u=this.ids[a],h=p),h>=n)break;this.ids[i]=u,this.values[i]=h,i=o}this.ids[i]=t,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ARRAY_TYPES=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],VERSION=3;class Flatbush{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(t!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==VERSION)throw new Error(`Got v${n>>4} data when expected v${VERSION}.`);const[s]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Flatbush(i,s,ARRAY_TYPES[n&15],e)}constructor(e,t=16,n=Float64Array,s){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535);let i=e,o=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),o+=i,this._levelBounds.push(o*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=o<16384?Uint16Array:Uint32Array;const a=ARRAY_TYPES.indexOf(this.ArrayType),u=o*4*this.ArrayType.BYTES_PER_ELEMENT;if(a<0)throw new Error(`Unexpected typed array class: ${n}.`);s&&s instanceof ArrayBuffer?(this.data=s,this._boxes=new this.ArrayType(this.data,8,o*4),this._indices=new this.IndexArrayType(this.data,8+u,o),this._pos=o*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+u+o*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,o*4),this._indices=new this.IndexArrayType(this.data,8+u,o),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(VERSION<<4)+a]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e),this._queue=new FlatQueue}add(e,t,n,s){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=t,this._boxes[this._pos++]=n,this._boxes[this._pos++]=s,e<this.minX&&(this.minX=e),t<this.minY&&(this.minY=t),n>this.maxX&&(this.maxX=n),s>this.maxY&&(this.maxY=s),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,t=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),s=65535;for(let i=0;i<this.numItems;i++){let o=4*i;const a=this._boxes[o++],u=this._boxes[o++],h=this._boxes[o++],p=this._boxes[o++],m=Math.floor(s*((a+h)/2-this.minX)/e),v=Math.floor(s*((u+p)/2-this.minY)/t);n[i]=hilbert(m,v)}sort(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,o=0;i<this._levelBounds.length-1;i++){const a=this._levelBounds[i];for(;o<a;){const u=o;let h=1/0,p=1/0,m=-1/0,v=-1/0;for(let E=0;E<this.nodeSize&&o<a;E++)h=Math.min(h,this._boxes[o++]),p=Math.min(p,this._boxes[o++]),m=Math.max(m,this._boxes[o++]),v=Math.max(v,this._boxes[o++]);this._indices[this._pos>>2]=u,this._boxes[this._pos++]=h,this._boxes[this._pos++]=p,this._boxes[this._pos++]=m,this._boxes[this._pos++]=v}}}search(e,t,n,s,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const a=[],u=[];for(;o!==void 0;){const h=Math.min(o+this.nodeSize*4,upperBound(o,this._levelBounds));for(let p=o;p<h;p+=4){if(n<this._boxes[p]||s<this._boxes[p+1]||e>this._boxes[p+2]||t>this._boxes[p+3])continue;const m=this._indices[p>>2]|0;o<this.numItems*4?(i===void 0||i(m))&&u.push(m):a.push(m)}o=a.pop()}return u}neighbors(e,t,n=1/0,s=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const a=this._queue,u=[],h=s*s;for(;o!==void 0;){const p=Math.min(o+this.nodeSize*4,upperBound(o,this._levelBounds));for(let m=o;m<p;m+=4){const v=this._indices[m>>2]|0,E=axisDist(e,this._boxes[m],this._boxes[m+2]),x=axisDist(t,this._boxes[m+1],this._boxes[m+3]),P=E*E+x*x;o<this.numItems*4?(i===void 0||i(v))&&a.push((v<<1)+1,P):a.push(v<<1,P)}for(;a.length&&a.peek()&1;)if(a.peekValue()>h||(u.push(a.pop()>>1),u.length===n))return a.clear(),u;o=a.pop()>>1}return a.clear(),u}}function axisDist(r,e,t){return r<e?e-r:r<=t?0:r-t}function upperBound(r,e){let t=0,n=e.length-1;for(;t<n;){const s=t+n>>1;e[s]>r?n=s:t=s+1}return e[t]}function sort(r,e,t,n,s,i){if(Math.floor(n/i)>=Math.floor(s/i))return;const o=r[n+s>>1];let a=n-1,u=s+1;for(;;){do a++;while(r[a]<o);do u--;while(r[u]>o);if(a>=u)break;swap(r,e,t,a,u)}sort(r,e,t,n,u,i),sort(r,e,t,u+1,s,i)}function swap(r,e,t,n,s){const i=r[n];r[n]=r[s],r[s]=i;const o=4*n,a=4*s,u=e[o],h=e[o+1],p=e[o+2],m=e[o+3];e[o]=e[a],e[o+1]=e[a+1],e[o+2]=e[a+2],e[o+3]=e[a+3],e[a]=u,e[a+1]=h,e[a+2]=p,e[a+3]=m;const v=t[n];t[n]=t[s],t[s]=v}function hilbert(r,e){let t=r^e,n=65535^t,s=65535^(r|e),i=r&(e^65535),o=t|n>>1,a=t>>1^t,u=s>>1^n&i>>1^s,h=t&s>>1^i>>1^i;t=o,n=a,s=u,i=h,o=t&t>>2^n&n>>2,a=t&n>>2^n&(t^n)>>2,u^=t&s>>2^n&i>>2,h^=n&s>>2^(t^n)&i>>2,t=o,n=a,s=u,i=h,o=t&t>>4^n&n>>4,a=t&n>>4^n&(t^n)>>4,u^=t&s>>4^n&i>>4,h^=n&s>>4^(t^n)&i>>4,t=o,n=a,s=u,i=h,u^=t&s>>8^n&i>>8,h^=n&s>>8^(t^n)&i>>8,t=u^u>>1,n=h^h>>1;let p=r^e,m=n|65535^(p|t);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|p)>>>0}const stitchCurves=(r,e=1e-7)=>{const t=new Flatbush(r.length);r.forEach(i=>{const[o,a]=i.firstPoint;t.add(o-e,a-e,o+e,a+e)}),t.finish();const n=[],s=new Set;return r.forEach((i,o)=>{if(s.has(o))return;const a=[i];let u=o;s.add(o);let h=r.length;for(;;){if(h--<0)throw new Error("Infinite loop detected");const p=a[a.length-1].lastPoint,[m,v]=p,E=t.search(m-e,v-e,m+e,v+e),x=I=>Math.abs((u-I)%r.length),P=E.filter(I=>!s.has(I)).map(I=>[r[I],I,x(I)]).sort(([,,I],[,,O])=>x(I)-x(O));if(P.length===0){n.push(a);break}const[T,C]=P[0];a.push(T),s.add(C),u=C}}),n};function round5(r){return Math.round(r*1e5)/1e5}const fromPnt=r=>`${round2(r.X())} ${round2(r.Y())}`,adaptedCurveToPathElem=(r,e)=>{const t=getOC(),n=findCurveType(r.GetType()),[s,i]=e,o=`${round5(s)} ${round5(i)}`;if(n==="LINE")return`L ${o}`;if(n==="BEZIER_CURVE"){const h=r.Bezier().get(),p=h.Degree();if(p===1)return`L ${o}`;if(p===2)return`Q ${fromPnt(h.Pole(2))} ${o}`;if(p===3){const m=fromPnt(h.Pole(2)),v=fromPnt(h.Pole(3));return`C ${m} ${v} ${o}`}}if(n==="CIRCLE"){const h=r.Circle(),p=h.Radius(),m=r.FirstParameter(),E=(r.LastParameter()-m)*RAD2DEG,x=E!==360?o:`${round5(s)} ${round5(i+1e-4)}`;return`A ${p} ${p} 0 ${Math.abs(E)>180?"1":"0"} ${h.IsDirect()?"1":"0"} ${x}`}if(n==="ELLIPSE"){const h=r.Ellipse(),p=h.MajorRadius(),m=h.MinorRadius(),v=r.FirstParameter(),x=(r.LastParameter()-v)*RAD2DEG,P=x!==360?o:`${round5(s)} ${round5(i+1e-4)}`,T=new t.gp_Dir2d_1,C=180-h.XAxis().Direction().Angle(T)*RAD2DEG;return T.delete(),`A ${round5(p)} ${round5(m)} ${round5(C)} ${Math.abs(x)>180?"1":"0"} ${h.IsDirect()?"1":"0"} ${P}`}if(n==="BSPLINE_CURVE"&&r.BSpline().get().Degree()<4)return BSplineToBezier(r).map(m=>adaptedCurveToPathElem(m.adaptor(),m.lastPoint)).join(" ");const a=approximateAsBSpline(r);return BSplineToBezier(a.adaptor()).map(h=>adaptedCurveToPathElem(h.adaptor(),h.lastPoint)).join(" ")},DIRECTIONS={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},PLANE_TO_DIR={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Finder{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(t=>t(this)),this}not(e){const t=new this.constructor;e(t);const n=({element:s})=>!t.shouldKeep(s);return this.filters.push(n),this}either(e){const t=e.map(s=>{const i=new this.constructor;return s(i),i}),n=({element:s})=>t.some(i=>i.shouldKeep(s));return this.filters.push(n),this}find(e,{unique:t=!1}={}){const n=this.applyFilter(e);if(t){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Finder3d extends Finder{inList(e){const t=({element:n})=>!!e.find(s=>s.isSame(n));return this.filters.push(t),this}atAngleWith(e="Z",t=0){let n;typeof e=="string"?n=new Vector(DIRECTIONS[e]):n=new Vector(e);const s=({normal:i})=>{if(!i)return!1;const o=Math.acos(Math.abs(i.dot(n)));return Math.abs(o-DEG2RAD*t)<1e-6};return this.filters.push(s),this}atDistance(e,t=[0,0,0]){const n=asPnt(t),s=getOC(),i=new s.BRepBuilderAPI_MakeVertex(n),o=i.Vertex();i.delete();const a=new s.BRepExtrema_DistShapeShape_1;a.LoadS1(o);const u=({element:h})=>{const p=GCWithScope();a.LoadS2(h.wrapped);const m=p(new s.Message_ProgressRange_1);return a.Perform(m),Math.abs(a.Value()-e)<1e-6};return this.filters.push(u),GCWithObject(u)(a),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,t){const n=getOC(),s=new n.BRepPrimAPI_MakeBox_4(asPnt(e),asPnt(t)),i=s.Solid();s.delete();const o=new n.BRepExtrema_DistShapeShape_1;o.LoadS1(i);const a=({element:h})=>{const p=GCWithScope();o.LoadS2(h.wrapped);const m=p(new n.Message_ProgressRange_1);return o.Perform(m),o.Value()<1e-6},u=GCWithObject(a);return u(i),u(o),this.filters.push(a),this}}class EdgeFinder extends Finder3d{clone(){const e=new EdgeFinder;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const t=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(t),this}ofCurveType(e){const t=({element:n})=>n.geomType===e;return this.filters.push(t),this}parallelTo(e){if(typeof e=="string"&&PLANE_TO_DIR[e])return this.atAngleWith(PLANE_TO_DIR[e],90);if(typeof e!="string"&&e instanceof Plane)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const t=e.normalAt();return this.atAngleWith(t,90),this}return this}inPlane(e,t){const n=e instanceof Plane?makePlane(e):makePlane(e,t);this.parallelTo(n);const s=({element:i})=>{const o=i.startPoint,a=o.projectToPlane(n);return o.equals(a)};return this.filters.push(s),this}shouldKeep(e){let t=null;try{t=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:t,element:e}))}applyFilter(e){return e.edges.filter(t=>this.shouldKeep(t))}}class FaceFinder extends Finder3d{clone(){const e=new FaceFinder;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&PLANE_TO_DIR[e])return this.atAngleWith(PLANE_TO_DIR[e]);if(typeof e!="string"&&e instanceof Plane)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const t=e.normalAt();return this.atAngleWith(t),this}return this}ofSurfaceType(e){const t=({element:n})=>n.geomType===e;return this.filters.push(t),this}inPlane(e,t){const n=e instanceof Plane?makePlane(e):makePlane(e,t);this.parallelTo(n);const s=({element:i})=>{const o=i.center,a=o.projectToPlane(n);return o.equals(a)};return this.filters.push(s),this}shouldKeep(e){const t=e.normalAt();return this.filters.every(s=>s({normal:t,element:e}))}applyFilter(e){return e.faces.filter(t=>this.shouldKeep(t))}}const blueprintCorners=function(r){return r.curves.map((e,t)=>({firstCurve:e,secondCurve:r.curves[(t+1)%r.curves.length],point:e.lastPoint}))},PI_2=2*Math.PI,positiveHalfAngle=r=>{const e=r%PI_2,t=e<0?e+PI_2:e;return t<Math.PI?t:t===Math.PI?0:Math.abs(t-PI_2)};class CornerFinder extends Finder{clone(){const e=new CornerFinder;return e.filters=[...this.filters],e}inList(e){const t=({element:n})=>!!e.find(s=>samePoint$2(s,n.point));return this.filters.push(t),this}atDistance(e,t=[0,0]){function n({element:s}){return Math.abs(distance2d(t,s.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function t({element:n}){return samePoint$2(e,n.point)}return this.filters.push(t),this}inBox(e,t){const[n,s]=e,[i,o]=t,a=Math.min(n,i),u=Math.max(n,i),h=Math.min(s,o),p=Math.max(s,o);function m({element:v}){const[E,x]=v.point;return E>=a&&E<=u&&x>=h&&x<=p}return this.filters.push(m),this}ofAngle(e){function t({element:n}){const s=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(positiveHalfAngle(angle2d(s,i))-positiveHalfAngle(DEG2RAD*e))<1e-9}return this.filters.push(t),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return blueprintCorners(e).filter(t=>this.shouldKeep(t))}}const combineFinderFilters=r=>[t=>{for(const{filter:n,radius:s}of r)if(n.shouldKeep(t))return s;return 0},()=>r.forEach(t=>t.filter.delete())],asTopo=r=>{const e=getOC();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[r]},iterTopo=function*(e,t){const n=getOC(),s=new n.TopExp_Explorer_2(e,asTopo(t),asTopo("shape")),i=new Map;for(;s.More();){const o=s.Current(),a=o.HashCode(HASH_CODE_MAX);i.get(a)||(i.set(a,!0),yield o),s.Next()}s.delete()},shapeType=r=>{if(r.IsNull())throw new Error("This shape has not type, it is null");return r.ShapeType()};class Shape extends WrappingObj{constructor(e){super(e)}clone(){return new this.constructor(downcast(this.wrapped))}get hashCode(){return this.wrapped.HashCode(HASH_CODE_MAX)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=getOC(),t=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);t.Build();const n=cast(t.Shape());if(t.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,t=0,n=0){const s=typeof e=="number"?[e,t,n]:e,i=cast(translate(this.wrapped,s));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,t=[0,0,0],n=[0,0,1]){const s=cast(rotate$1(this.wrapped,e,t,n));if(this.delete(),this.constructor!==s.constructor)throw new Error("unexpected types mismatch");return s}mirror(e,t){const n=cast(mirror(this.wrapped,e,t));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,t=[0,0,0]){const n=cast(scale(this.wrapped,t,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return iterTopo(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(t=>downcast(t))}get edges(){return this._listTopo("edge").map(e=>new Edge(e))}get faces(){return this._listTopo("face").map(e=>new Face(e))}get wires(){return this._listTopo("wire").map(e=>new Wire(e))}get boundingBox(){const e=new BoundingBox$1;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:t=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,t,!1)}mesh({tolerance:e=.001,angularTolerance:t=.1}={}){this._mesh({tolerance:e,angularTolerance:t});let n=[],s=[],i=[];const o=[];for(const a of this.faces){const u=a.triangulation(s.length/3);if(!u)continue;const{trianglesIndexes:h,vertices:p,verticesNormals:m}=u;o.push({start:n.length,count:h.length,faceId:a.hashCode}),n=n.concat(h),s=s.concat(p),i=i.concat(m)}return{triangles:n,vertices:s,normals:i,faceGroups:o}}meshEdges({tolerance:e=.001,angularTolerance:t=.1}={}){var n;const s=GCWithScope(),i=new Set,o=[],a=[],u=()=>{const p=o.length;let m=null;return[v=>{m?(o.push(...m),m=[v.X(),v.Y(),v.Z()],o.push(...m)):m=[v.X(),v.Y(),v.Z()]},v=>{a.push({start:p/3,count:(o.length-p)/3,edgeId:v}),i.add(v)}]},h=s(new this.oc.TopLoc_Location_1);for(const p of this.faces){const m=s(this.oc.BRep_Tool.Triangulation(p.wrapped,h,0));if(m.IsNull())continue;const v=m.get();for(const E of p.edges){if(s(E),i.has(E.hashCode))continue;const x=s(new this.oc.TopLoc_Location_1),P=s(this.oc.BRep_Tool.PolygonOnTriangulation_1(E.wrapped,m,x)),T=(n=P==null?void 0:P.get())==null?void 0:n.Nodes();if(!T)continue;s(T);const[C,I]=u();for(let O=T.Lower();O<=T.Upper();O++){const G=s(s(v.Node(T.Value(O))).Transformed(x.Transformation()));C(G)}I(E.hashCode)}}for(const p of this.edges){s(p);const m=p.hashCode;if(i.has(m))continue;const v=s(new this.oc.BRepAdaptor_Curve_2(p.wrapped)),E=s(new this.oc.GCPnts_TangentialDeflection_2(v,e,t,2,1e-9,1e-7)),[x,P]=u();for(let T=0;T<E.NbPoints();T++){const C=s(E.Value(T+1).Transformed(h.Transformation()));x(C)}P(m)}return{lines:o,edgeGroups:a}}blobSTEP(){const e="blob.step",t=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),t.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;t.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const s=t.Write(e);if(t.delete(),n.delete(),s===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:t=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:t});const s="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,s,!n)){const o=this.oc.FS.readFile("/"+s);return this.oc.FS.unlink("/"+s),new Blob([o],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Vertex extends Shape{}class _1DShape extends Shape{get repr(){const{startPoint:e,endPoint:t}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),t.delete(),n}get curve(){return new Curve(this._geomAdaptor())}get startPoint(){const e=this.curve,t=e.startPoint;return e.delete(),t}get endPoint(){const e=this.curve,t=e.endPoint;return e.delete(),t}tangentAt(e=0){const t=this.curve,n=t.tangentAt(e);return t.delete(),n}get isClosed(){const e=this.curve,t=e.isClosed;return e.delete(),t}get isPeriodic(){const e=this.curve,t=e.isPeriodic;return e.delete(),t}get period(){const e=this.curve,t=e.period;return e.delete(),t}get geomType(){const e=this.curve,t=e.curveType;return e.delete(),t}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const t=e.Mass();return e.delete(),t}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Curve extends WrappingObj{get repr(){const{startPoint:e,endPoint:t}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),t.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return findCurveType(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new Vector(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new Vector(e)}tangentAt(e){let t=e;e||(t=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const n=new this.oc.gp_Pnt_1,s=new this.oc.gp_Vec_1;this.wrapped.D1(t,n,s);const i=new Vector(s);return n.delete(),s.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Edge extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Wire extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,t="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},s=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[t],!1);s.Perform(e,0);const i=cast(s.Shape());if(s.delete(),this.delete(),!(i instanceof Wire))throw new Error("Could not offset with a wire");return i}}class Surface extends WrappingObj{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Face extends Shape{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Surface(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,t=e.surfaceType;return e.delete(),t}get UVBounds(){const e={current:0},t={current:0},n={current:0},s={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,t,n,s),{uMin:e.current,uMax:t.current,vMin:n.current,vMax:s.current}}pointOnSurface(e,t){const{uMin:n,uMax:s,vMin:i,vMax:o}=this.UVBounds,a=this._geomAdaptor(),u=new this.oc.gp_Pnt_1,h=e*(s-n)+n,p=t*(o-i)+i;a.D0(h,p,u);const m=new Vector(u);return a.delete(),u.delete(),m}normalAt(e){let t=0,n=0;const s=GCWithScope();if(e){const h=s(this.oc.BRep_Tool.Surface_2(this.wrapped)),p=s(new this.oc.GeomAPI_ProjectPointOnSurf_2(s(asPnt(e)),h,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),m={current:0},v={current:0};p.LowerDistanceParameters(m,v),t=m.current,n=v.current}else{const{uMin:h,uMax:p,vMin:m,vMax:v}=this.UVBounds;t=.5*(h+p),n=.5*(m+v)}const i=s(new this.oc.gp_Pnt_1),o=s(new this.oc.gp_Vec_1);return s(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(t,n,i,o),new Vector(o)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const t=new Vector(e.CentreOfMass());return e.delete(),t}outerWire(){const e=new Wire(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),t=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),t}triangulation(e=0){const t=GCWithScope(),n=t(new this.oc.TopLoc_Location_1),s=t(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(s.IsNull())return null;const i=t(n.Transformation()),o={vertices:[],trianglesIndexes:[],verticesNormals:[]},a=s.get(),u=a.NbNodes();o.vertices=new Array(u*3);for(let x=1;x<=u;x++){const P=t(t(a.Node(x)).Transformed(i));o.vertices[(x-1)*3+0]=P.X(),o.vertices[(x-1)*3+1]=P.Y(),o.vertices[(x-1)*3+2]=P.Z()}const h=t(new this.oc.TColgp_Array1OfDir_2(1,u)),p=t(new this.oc.Poly_Connect_2(s));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,p,h),o.verticesNormals=new Array(h.Length()*3);for(let x=h.Lower();x<=h.Upper();x++){const P=t(t(h.Value(x)).Transformed(i));o.verticesNormals[(x-1)*3+0]=P.X(),o.verticesNormals[(x-1)*3+1]=P.Y(),o.verticesNormals[(x-1)*3+2]=P.Z()}const m=this.orientation,v=a.NbTriangles();o.trianglesIndexes=new Array(v*3);let E=0;for(let x=1;x<=v;x++){const P=t(a.Triangle(x));let T=P.Value(1),C=P.Value(2);const I=P.Value(3);if(m==="backward"){const O=T;T=C,C=O}o.trianglesIndexes[E*3+0]=T-1+e,o.trianglesIndexes[E*3+1]=C-1+e,o.trianglesIndexes[E*3+2]=I-1+e,E++}return o}}class _3DShape extends Shape{fuse(e,{optimisation:t="none"}={}){const n=GCWithScope(),s=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,s));t==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),t==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(s),i.SimplifyResult(!0,!0,.001);const o=cast(i.Shape());if(!isShape3D(o))throw new Error("Could not fuse as a 3d shape");return o}cut(e,{optimisation:t="none"}={}){const n=GCWithScope(),s=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,s));t==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),t==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(s),i.SimplifyResult(!0,!0,.001);const o=cast(i.Shape());if(!isShape3D(o))throw new Error("Could not cut as a 3d shape");return o}intersect(e){const t=GCWithScope(),n=t(new this.oc.Message_ProgressRange_1),s=t(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));s.Build(n),s.SimplifyResult(!0,!0,.001);const i=cast(s.Shape());if(!isShape3D(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,t=null,n=.001){const s=typeof t=="number"?t:n;let i,o;if(typeof e=="number"){o=e;const E=new FaceFinder;i=typeof t=="function"?t(E):E}else o=e.thickness,i=e.filter;const a=GCWithScope(),u=i.find(this),h=a(new this.oc.TopTools_ListOfShape_1);u.forEach(E=>{h.Append_1(E.wrapped)});const p=a(new this.oc.Message_ProgressRange_1),m=a(new this.oc.BRepOffsetAPI_MakeThickSolid);m.MakeThickSolidByJoin(this.wrapped,h,-o,s,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,p);const v=cast(m.Shape());if(!isShape3D(v))throw new Error("Could not shell as a 3d shape");return v}_builderIter(e,t){if(typeof e=="number"){let o=0;for(const a of this._iterTopo("edge"))t(e,downcast(a)),o+=1;return o}let n,s=null;typeof e=="function"?n=e:(n=o=>e.filter.shouldKeep(o)?e.radius||1:0,e.filter&&!e.keep&&(s=()=>e.filter.delete()));let i=0;for(const o of this._iterTopo("edge")){const a=downcast(o),u=new Edge(a),h=n(u);h&&(t(h,a),i+=1),u.delete()}return s&&s(),i}fillet(e,t){const s=GCWithScope()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&t&&(i={radius:e,filter:t(new EdgeFinder)}),!this._builderIter(i,(u,h)=>s.Add_2(u,h)))throw new Error("Could not fillet, no edge was selected");const a=cast(s.Shape());if(!isShape3D(a))throw new Error("Could not fillet as a 3d shape");return a}chamfer(e,t){const s=GCWithScope()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&t&&(i={radius:e,filter:t(new EdgeFinder)}),!this._builderIter(i,(u,h)=>s.Add_2(u,h)))throw new Error("Could not chamfer, no edge was selected");const a=cast(s.Shape());if(!isShape3D(a))throw new Error("Could not chamfer as a 3d shape");return a}}class Shell extends _3DShape{}class Solid extends _3DShape{}class CompSolid extends _3DShape{}class Compound extends _3DShape{}function isShape3D(r){return r instanceof Shell||r instanceof Solid||r instanceof CompSolid||r instanceof Compound}function isWire(r){return r instanceof Wire}function downcast(r){const e=getOC(),t=e.TopAbs_ShapeEnum,n=new Map([[t.TopAbs_EDGE,e.TopoDS.Edge_1],[t.TopAbs_WIRE,e.TopoDS.Wire_1],[t.TopAbs_FACE,e.TopoDS.Face_1],[t.TopAbs_SHELL,e.TopoDS.Shell_1],[t.TopAbs_SOLID,e.TopoDS.Solid_1],[t.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[t.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),s=shapeType(r),i=n.get(s);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(r)}function cast(r){const t=getOC().TopAbs_ShapeEnum,s=new Map([[t.TopAbs_VERTEX,Vertex],[t.TopAbs_EDGE,Edge],[t.TopAbs_WIRE,Wire],[t.TopAbs_FACE,Face],[t.TopAbs_SHELL,Shell],[t.TopAbs_SOLID,Solid],[t.TopAbs_COMPSOLID,CompSolid],[t.TopAbs_COMPOUND,Compound]]).get(shapeType(r));if(!s)throw new Error("Could not find a wrapper for this shape type");return new s(downcast(r))}const makeLine=(r,e)=>{const t=getOC();return new Edge(new t.BRepBuilderAPI_MakeEdge_3(asPnt(r),asPnt(e)).Edge())},makeCircle=(r,e=[0,0,0],t=[0,0,1])=>{const n=getOC(),[s,i]=localGC(),o=s(makeAx2(e,t)),a=s(new n.gp_Circ_2(o,r)),u=s(new n.BRepBuilderAPI_MakeEdge_8(a)),h=new Edge(u.Edge());return i(),h},makeEllipse=(r,e,t=[0,0,0],n=[0,0,1],s)=>{const i=getOC(),[o,a]=localGC(),u=o(makeAx2(t,n,s));if(e>r)throw new Error("The minor radius must be smaller than the major one");const h=o(new i.gp_Elips_2(u,r,e)),p=o(new i.BRepBuilderAPI_MakeEdge_12(h)),m=new Edge(p.Edge());return a(),m},makeHelix=(r,e,t,n=[0,0,0],s=[0,0,1],i=!1)=>{const o=getOC(),[a,u]=localGC();let h=2*Math.PI;i&&(h=-2*Math.PI);const p=a(new o.Geom2d_Line_3(a(new o.gp_Pnt2d_3(0,0)),a(new o.gp_Dir2d_4(h,r)))),m=e/r,v=p.Value(0),E=p.Value(m*Math.sqrt((2*Math.PI)**2+r**2)),x=a(new o.GCE2d_MakeSegment_1(v,E)),P=new o.Geom_CylindricalSurface_1(a(makeAx3(n,s)),t),T=a(new o.BRepBuilderAPI_MakeEdge_30(a(new o.Handle_Geom2d_Curve_2(x.Value().get())),a(new o.Handle_Geom_Surface_2(P)))).Edge(),C=a(new o.BRepBuilderAPI_MakeWire_2(T)).Wire();return o.BRepLib.BuildCurves3d_2(C),u(),new Edge(C)},makeThreePointArc=(r,e,t)=>{const n=getOC(),s=new n.GC_MakeArcOfCircle_4(asPnt(r),asPnt(e),asPnt(t)).Value(),i=new n.Handle_Geom_Curve_2(s.get());return new Edge(new n.BRepBuilderAPI_MakeEdge_24(i).Edge())},makeEllipseArc=(r,e,t,n,s=[0,0,0],i=[0,0,1],o)=>{const a=getOC(),[u,h]=localGC(),p=u(makeAx2(s,i,o));if(e>r)throw new Error("The minor radius must be smaller than the major one");const m=u(new a.gp_Elips_2(p,r,e)),v=u(new a.BRepBuilderAPI_MakeEdge_13(m,t,n)),E=new Edge(v.Edge());return h(),E},makeBSplineApproximation=function(e,{tolerance:t=.001,smoothing:n=null,degMax:s=6,degMin:i=1}={}){const o=getOC(),[a,u]=localGC(),h=a(new o.TColgp_Array1OfPnt_2(1,e.length));e.forEach((x,P)=>{h.SetValue(P+1,a(asPnt(x)))});let p;if(n?p=a(new o.GeomAPI_PointsToBSpline_5(h,n[0],n[1],n[2],s,o.GeomAbs_Shape.GeomAbs_C2,t)):p=a(new o.GeomAPI_PointsToBSpline_2(h,i,s,o.GeomAbs_Shape.GeomAbs_C2,t)),!p.IsDone())throw u(),new Error("B-spline approximation failed");const m=a(p.Curve()),v=a(new o.Handle_Geom_Curve_2(m.get())),E=new Edge(new o.BRepBuilderAPI_MakeEdge_24(v).Edge());return u(),E},makeBezierCurve=r=>{const e=getOC(),t=new e.TColgp_Array1OfPnt_2(1,r.length);r.forEach((i,o)=>{t.SetValue(o+1,asPnt(i))});const n=new e.Geom_BezierCurve_1(t),s=new e.Handle_Geom_Curve_2(n);return new Edge(new e.BRepBuilderAPI_MakeEdge_24(s).Edge())},makeTangentArc=(r,e,t)=>{const n=getOC(),[s,i]=localGC(),o=s(new n.GC_MakeArcOfCircle_5(s(asPnt(r)),new Vector(e).wrapped,s(asPnt(t))).Value()),a=s(new n.Handle_Geom_Curve_2(o.get())),u=new Edge(s(new n.BRepBuilderAPI_MakeEdge_24(a)).Edge());return i(),u},assembleWire=r=>{const e=getOC(),t=new e.BRepBuilderAPI_MakeWire_1;r.forEach(o=>{o instanceof Edge&&t.Add_1(o.wrapped),o instanceof Wire&&t.Add_2(o.wrapped)});const n=new e.Message_ProgressRange_1;t.Build(n);const s=t.Error();if(s!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const o=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${o.get(s)||"unknown error"}`)}const i=new Wire(t.Wire());return t.delete(),n.delete(),i},makeFace=(r,e)=>{const t=getOC(),n=new t.BRepBuilderAPI_MakeFace_15(r.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const s=n.Face();return n.delete(),new Face(s)},makeNewFaceWithinFace=(r,e)=>{const t=getOC(),[n,s]=localGC(),i=n(t.BRep_Tool.Surface_2(r.wrapped)),a=n(new t.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return s(),new Face(a)},makeNonPlanarFace=r=>{const e=getOC(),[t,n]=localGC(),s=t(new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9));r.edges.forEach(a=>{s.Add_1(t(a).wrapped,e.GeomAbs_Shape.GeomAbs_C0,!0)});const i=t(new e.Message_ProgressRange_1);s.Build(i);const o=cast(s.Shape());if(n(),!(o instanceof Face))throw new Error("Failed to create a face");return o},makeCylinder=(r,e,t=[0,0,0],n=[0,0,1])=>{const s=getOC(),i=makeAx2(t,n),o=new s.BRepPrimAPI_MakeCylinder_3(i,r,e),a=new Solid(o.Shape());return i.delete(),o.delete(),a},makeSphere=r=>{const e=getOC(),t=new e.BRepPrimAPI_MakeSphere_1(r),n=new Solid(t.Shape());return t.delete(),n},makeVertex=r=>{const e=getOC(),t=asPnt(r),n=new e.BRepBuilderAPI_MakeVertex(t),s=n.Vertex();return n.delete(),new Vertex(s)},makeOffset=(r,e,t=1e-6)=>{const n=getOC(),s=new n.Message_ProgressRange_1,i=new n.BRepOffsetAPI_MakeOffsetShape;i.PerformByJoin(r.wrapped,e,t,n.BRepOffset_Mode.BRepOffset_Skin,!1,!1,n.GeomAbs_JoinType.GeomAbs_Arc,!1,s);const o=cast(downcast(i.Shape()));if(i.delete(),s.delete(),!isShape3D(o))throw new Error("Could not offset to a 3d shape");return o},compoundShapes=r=>{const e=getOC(),t=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return t.MakeCompound(n),r.forEach(i=>{t.Add(n,i.wrapped),i.delete()}),cast(n)},makeCompound=compoundShapes;function makeSolid(r){const e=getOC(),[t,n]=localGC(),s=t(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));r.forEach(({wrapped:a})=>{s.Add(a)}),s.Perform(t(new e.Message_ProgressRange_1));const i=t(downcast(s.SewedShape())),o=cast(t(new e.ShapeFix_Solid_1).SolidFromShell(i));if(n(),!(o instanceof Solid))throw new Error("Could not make a solid of faces and shells");return o}const addHolesInFace=(r,e)=>{const t=getOC(),[n,s]=localGC(),i=n(new t.BRepBuilderAPI_MakeFace_2(r.wrapped));e.forEach(h=>{i.Add(h.wrapped)});const o=n(i.Face()),a=n(new t.ShapeFix_Face_2(o));a.FixOrientation_1();const u=a.Face();return s(),new Face(u)},makePolygon=r=>{if(r.length<3)throw new Error("You need at least 3 points to make a polygon");const e=zip([r,[...r.slice(1),r[0]]]).map(([t,n])=>makeLine(t,n));return makeFace(assembleWire(e))},isTangent=r=>r==="symmetric"||typeof r=="number"||Array.isArray(r)&&r.length===2,defaultsSplineConfig=r=>{let e;r?isTangent(r)?e={endTangent:r}:e={endTangent:0,...r}:e={endTangent:[1,0]};const{endTangent:t,startFactor:n=1,endFactor:s=1,startTangent:i}=e;let o;typeof t=="number"?o=polarToCartesian(1,t*DEG2RAD):o=t;let a;return typeof i=="number"?a=polarToCartesian(1,i*DEG2RAD):a=i,{endTangent:o,startFactor:n,endFactor:s,startTangent:a}};function radianAngle(r,e,t,n){const s=r*t+e*n,i=Math.sqrt((r*r+e*e)*(t*t+n*n));let o=Math.acos(s/i);return r*n-e*t<0&&(o=-o),o}function convertSvgEllipseParams([r,e],[t,n],s,i,o,a,u){const h=Math.PI*2;if(s<0&&(s=-s),i<0&&(i=-i),s==0||i==0)throw Error("rx and ry can not be 0");const p=Math.sin(o),m=Math.cos(o),v=(r-t)/2,E=(e-n)/2,x=(r+t)/2,P=(e+n)/2,T=m*v+p*E,C=m*E-p*v,I=T*T/(s*s)+C*C/(i*i);I>1&&(s=s*Math.sqrt(I),i=i*Math.sqrt(I));const O=s*i,G=s*C,F=i*T,Y=G*G+F*F;if(!Y)throw Error("start point can not be same as end point");let V=Math.sqrt(Math.abs((O*O-Y)/Y));a==u&&(V=-V);const W=V*G/i,q=-V*F/s,ce=m*W-p*q+x,J=p*W+m*q+P,ge=(T-W)/s,fe=(T+W)/s,Q=(C-q)/i,oe=(C+q)/i,$=radianAngle(1,0,ge,Q);let X=radianAngle(ge,Q,-fe,-oe);for(;X>h;)X-=h;for(;X<0;)X+=h;u||(X-=h);let ae=$+X;for(;ae>h;)ae-=h;for(;ae<0;)ae+=h;return{cx:ce,cy:J,startAngle:$,deltaAngle:X,endAngle:ae,clockwise:!!u,rx:s,ry:i}}const basicFaceExtrusion=(r,e)=>{const t=getOC(),n=new t.BRepPrimAPI_MakePrism_1(r.wrapped,e.wrapped,!1,!0),s=new Solid(downcast(n.Shape()));return n.delete(),s},revolution=(r,e=[0,0,0],t=[0,0,1],n=360)=>{const s=getOC(),i=makeAx1(e,t),o=new s.BRepPrimAPI_MakeRevol_1(r.wrapped,i,n*DEG2RAD,!1),a=cast(o.Shape());if(i.delete(),o.delete(),!isShape3D(a))throw new Error("Could not revolve to a 3d shape");return a};function genericSweep(r,e,{frenet:t=!1,auxiliarySpine:n,law:s=null,transitionMode:i="right",withContact:o,support:a,forceProfileSpineOthogonality:u}={},h=!1){const p=getOC(),m=i==="round"?!0:!!u,v=new p.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const P={transformed:p.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:p.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:p.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];P&&v.SetTransitionMode(P)}a?v.SetMode_4(a):t&&v.SetMode_1(t),n&&v.SetMode_5(n.wrapped,!1,p.BRepFill_TypeOfContact.BRepFill_NoContact),s?v.SetLaw_1(r.wrapped,s,!!o,m):v.Add_1(r.wrapped,!!o,m);const E=new p.Message_ProgressRange_1;v.Build(E),h||v.MakeSolid();const x=cast(v.Shape());if(!isShape3D(x))throw new Error("Could not sweep to a 3d shape");if(h){const P=cast(v.FirstShape()),T=cast(v.LastShape());if(!isWire(P))throw new Error("Could not sweep with one start wire");if(!isWire(T))throw new Error("Could not sweep with one end wire");return v.delete(),[x,P,T]}return v.delete(),E.delete(),x}const buildLawFromProfile=(r,{profile:e,endFactor:t=1})=>{let n;const s=getOC();if(e==="s-curve")n=new s.Law_S,n.Set_1(0,1,r,t);else if(e==="linear")n=new s.Law_Linear,n.Set(0,1,r,t);else throw new Error("Could not generate a law function");return n.Trim(0,r,1e-6)},supportExtrude=(r,e,t,n)=>{const s=new Vector(e),i=new Vector(t),o=makeLine(s,s.add(i)),a=assembleWire([o]);return genericSweep(r,a,{support:n})};function complexExtrude(r,e,t,n,s=!1){const i=new Vector(e),o=new Vector(t),a=makeLine(i,i.add(o)),u=assembleWire([a]),h=n?buildLawFromProfile(o.Length,n):null;return s?genericSweep(r,u,{law:h},s):genericSweep(r,u,{law:h},s)}function twistExtrude(r,e,t,n,s,i=!1){const o=new Vector(t),a=new Vector(n),u=makeLine(o,o.add(a)),h=assembleWire([u]),p=360/e*a.Length,v=makeHelix(p,a.Length,1,t,n),E=s?buildLawFromProfile(a.Length,s):null;return i?genericSweep(r,h,{auxiliarySpine:v,law:E},i):genericSweep(r,h,{auxiliarySpine:v,law:E},i)}const loft=(r,{ruled:e=!0,startPoint:t,endPoint:n}={},s=!1)=>{const i=getOC(),[o,a]=localGC(),u=o(new i.BRepOffsetAPI_ThruSections(!s,e,1e-6));t&&u.AddVertex(o(makeVertex(t)).wrapped),r.forEach(m=>u.AddWire(m.wrapped)),n&&u.AddVertex(o(makeVertex(n)).wrapped);const h=o(new i.Message_ProgressRange_1);u.Build(h);const p=cast(u.Shape());if(a(),!isShape3D(p))throw new Error("Could not loft to a 3d shape");return p};class Sketch{constructor(e,{defaultOrigin:t=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=t,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Sketch(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new Vector(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new Vector(e)}face(){let e;return this.baseFace?e=makeNewFaceWithinFace(this.baseFace,this.wire):e=makeFace(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:t}={}){const n=makeFace(this.wire),s=revolution(n,t||this.defaultOrigin,e);return n.delete(),this.delete(),s}extrude(e,{extrusionDirection:t,extrusionProfile:n,twistAngle:s,origin:i}={}){const[o,a]=localGC(),u=o(new Vector(t||this.defaultDirection).normalized().multiply(e));if(n&&!s){const m=complexExtrude(this.wire,i||this.defaultOrigin,u,n);return a(),this.delete(),m}if(s){const m=twistExtrude(this.wire,s,i||this.defaultOrigin,u,n);return a(),this.delete(),m}const h=makeFace(this.wire),p=basicFaceExtrusion(h,u);return a(),this.delete(),p}sweepSketch(e,t={}){const n=this.wire.startPoint,s=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=s.cross(this.defaultDirection).multiply(-1),o=e(new Plane(n,i,s),n),a={forceProfileSpineOthogonality:!0,...t};this.baseFace&&(a.support=this.baseFace.wrapped);const u=genericSweep(o.wire,this.wire,a);return this.delete(),u}loftWith(e,t={},n=!1){const s=Array.isArray(e)?[this,...e]:[this,e],i=loft(s.map(o=>o.wire),t,n);return s.forEach(o=>o.delete()),i}}class Sketcher{constructor(e,t){this.plane=e instanceof Plane?makePlane(e):makePlane(e,t),this.pointer=new Vector(this.plane.origin),this.firstPoint=new Vector(this.plane.origin),this.pendingEdges=[],this._mirrorWire=!1}delete(){this.plane.delete()}_updatePointer(e){this.pointer=e}movePointerTo([e,t]){if(this.pendingEdges.length)throw new Error("You can only move the pointer if there is no edge defined");return this._updatePointer(this.plane.toWorldCoords([e,t])),this.firstPoint=new Vector(this.pointer),this}lineTo([e,t]){const n=this.plane.toWorldCoords([e,t]);return this.pendingEdges.push(makeLine(this.pointer,n)),this._updatePointer(n),this}line(e,t){const n=this.plane.toLocalCoords(this.pointer);return this.lineTo([e+n.x,t+n.y])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){const t=this.plane.toLocalCoords(this.pointer);return this.lineTo([t.x,e])}hLineTo(e){const t=this.plane.toLocalCoords(this.pointer);return this.lineTo([e,t.y])}polarLine(e,t){const n=t*DEG2RAD,[s,i]=polarToCartesian(e,n);return this.line(s,i)}polarLineTo([e,t]){const n=t*DEG2RAD,s=polarToCartesian(e,n);return this.lineTo(s)}tangentLine(e){const[t,n]=localGC(),s=this.pendingEdges.length?this.pendingEdges[this.pendingEdges.length-1]:null;if(!s)throw new Error("you need a previous edge to create a tangent line");const i=t(s.tangentAt(1)),o=t(i.normalized().multiply(e)).add(this.pointer);return this.pendingEdges.push(makeLine(this.pointer,o)),this._updatePointer(o),n(),this}threePointsArcTo(e,t){const n=this.plane.toWorldCoords(t),s=this.plane.toWorldCoords(e);return this.pendingEdges.push(makeThreePointArc(this.pointer,n,s)),this._updatePointer(s),this}threePointsArc(e,t,n,s){const i=this.plane.toLocalCoords(this.pointer);return this.threePointsArcTo([i.x+e,i.y+t],[i.x+n,i.y+s])}tangentArcTo(e){const t=this.plane.toWorldCoords(e),n=this.pendingEdges[this.pendingEdges.length-1];return this.pendingEdges.push(makeTangentArc(n.endPoint,n.tangentAt(1),t)),this._updatePointer(t),this}tangentArc(e,t){const n=this.plane.toLocalCoords(this.pointer);return this.tangentArcTo([e+n.x,t+n.y])}sagittaArcTo(e,t){const n=this.pointer,s=this.plane.toWorldCoords(e);let i=s.add(n);const o=i.multiply(.5);i=s.sub(n);const u=i.cross(this.plane.zDir).normalized().multiply(t),h=o.add(u);return this.pendingEdges.push(makeThreePointArc(this.pointer,h,s)),this._updatePointer(s),this}sagittaArc(e,t,n){const s=this.plane.toLocalCoords(this.pointer);return this.sagittaArcTo([e+s.x,t+s.y],n)}vSagittaArc(e,t){return this.sagittaArc(0,e,t)}hSagittaArc(e,t){return this.sagittaArc(e,0,t)}bulgeArcTo(e,t){if(!t)return this.lineTo(e);const n=this.plane.toLocalCoords(this.pointer),s=distance2d([n.x,n.y],e)/2,i=-t*s;return this.sagittaArcTo(e,i)}bulgeArc(e,t,n){const s=this.plane.toLocalCoords(this.pointer);return this.bulgeArcTo([e+s.x,t+this.pointer.y],n)}vBulgeArc(e,t){return this.bulgeArc(0,e,t)}hBulgeArc(e,t){return this.bulgeArc(e,0,t)}ellipseTo(e,t,n,s=0,i=!1,o=!1){const[a,u]=localGC(),h=this.plane.toLocalCoords(this.pointer);let p=s,m=t,v=n;t<n&&(p=s+90,m=n,v=t);const{cx:E,cy:x,rx:P,ry:T,startAngle:C,endAngle:I,clockwise:O}=convertSvgEllipseParams([h.x,h.y],e,m,v,p*DEG2RAD,i,o),G=a(new Vector(this.plane.xDir).rotate(p,this.plane.origin,this.plane.zDir)),F=makeEllipseArc(P,T,O?C:I,O?I:C,a(this.plane.toWorldCoords([E,x])),this.plane.zDir,G);return O||F.wrapped.Reverse(),this.pendingEdges.push(F),this._updatePointer(this.plane.toWorldCoords(e)),u(),this}ellipse(e,t,n,s,i=0,o=!1,a=!1){const u=this.plane.toLocalCoords(this.pointer);return this.ellipseTo([e+u.x,t+u.y],n,s,i,o,a)}halfEllipseTo(e,t,n=!1){const s=this.plane.toLocalCoords(this.pointer),i=[s.x,s.y],o=polarAngle2d(e,i),a=distance2d(e,i);return this.ellipseTo(e,a/2,t,o*RAD2DEG,!1,n)}halfEllipse(e,t,n,s=!1){const i=this.plane.toLocalCoords(this.pointer);return this.halfEllipseTo([e+i.x,t+i.y],n,s)}bezierCurveTo(e,t){let n;t.length===2&&!Array.isArray(t[0])?n=[t]:n=t;const s=n.map(o=>this.plane.toWorldCoords(o)),i=this.plane.toWorldCoords(e);return this.pendingEdges.push(makeBezierCurve([this.pointer,...s,i])),this._updatePointer(i),this}quadraticBezierCurveTo(e,t){return this.bezierCurveTo(e,[t])}cubicBezierCurveTo(e,t,n){return this.bezierCurveTo(e,[t,n])}smoothSplineTo(e,t){const[n,s]=localGC(),{endTangent:i,startTangent:o,startFactor:a,endFactor:u}=defaultsSplineConfig(t),h=this.plane.toWorldCoords(e),p=this.pendingEdges.length?this.pendingEdges[this.pendingEdges.length-1]:null,m=n(h.sub(this.pointer)).Length*.25;let v;if(o)v=this.plane.toWorldCoords(o);else if(!p)v=this.plane.toWorldCoords([1,0]);else if(p.geomType==="BEZIER_CURVE"){const I=n(p.curve).wrapped.Bezier().get(),O=n(new Vector(I.Pole(I.NbPoles()-1)));v=n(this.pointer.sub(O))}else v=n(p.tangentAt(1));const E=n(v.normalized().multiply(a*m)),x=n(this.pointer.add(E));let P;i==="symmetric"?P=n(v.multiply(-1)):P=n(this.plane.toWorldCoords(i));const T=n(P.normalized().multiply(u*m)),C=n(h.sub(T));return this.pendingEdges.push(makeBezierCurve([this.pointer,x,C,h])),this._updatePointer(h),s(),this}smoothSpline(e,t,n={}){const s=this.plane.toLocalCoords(this.pointer);return this.smoothSplineTo([e+s.x,t+s.y],n)}_mirrorWireOnStartEnd(e){const n=this.pointer.sub(this.firstPoint).normalize().cross(this.plane.zDir),s=e.clone().mirror(n,this.pointer);return assembleWire([e,s])}buildWire(){if(!this.pendingEdges.length)throw new Error("No lines to convert into a wire");let e=assembleWire(this.pendingEdges);return this._mirrorWire&&(e=this._mirrorWireOnStartEnd(e)),e}_closeSketch(){if(!this.pointer.equals(this.firstPoint)&&!this._mirrorWire){const e=this.plane.toLocalCoords(this.firstPoint);this.lineTo([e.x,e.y])}}done(){return new Sketch(this.buildWire(),{defaultOrigin:this.plane.origin,defaultDirection:this.plane.zDir})}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._mirrorWire=!0,this.close()}}const curvesBoundingBox=r=>{const e=getOC(),t=new e.Bnd_Box2d;return r.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,t)}),new BoundingBox2d(t)};function curvesAsEdgesOnPlane(r,e){const[t,n]=localGC(),s=t(makeAx2(e.origin,e.zDir,e.xDir)),i=getOC(),o=r.map(a=>{const u=i.GeomLib.To3d(s,a.wrapped);return new Edge(new i.BRepBuilderAPI_MakeEdge_24(u).Edge())});return n(),o}const curvesAsEdgesOnSurface=(r,e)=>{const[t,n]=localGC(),s=getOC(),i=r.map(o=>{const a=t(new s.BRepBuilderAPI_MakeEdge_30(o.wrapped,e));return new Edge(a.Edge())});return n(),i},transformCurves=(r,e)=>{const t=getOC();return r.map(s=>e?new Curve2D(t.GeomLib.GTransform(s.wrapped,e)):s.clone())};class Transformation2D extends WrappingObj{transformCurves(e){return transformCurves(e,this.wrapped)}}const stretchTransform2d=(r,e,t=[0,0])=>{const n=getOC(),s=axis2d(t,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(s,r),s.delete(),new Transformation2D(i)},translationTransform2d=r=>{const e=getOC(),[t,n]=localGC(),s=new e.gp_Trsf2d_1;s.SetTranslation_1(t(vec(r)));const i=new e.gp_GTrsf2d_2(s);return n(),new Transformation2D(i)},mirrorTransform2d=(r,e=[0,0],t="center")=>{const n=getOC(),[s,i]=localGC(),o=new n.gp_Trsf2d_1;t==="center"?o.SetMirror_1(s(pnt(r))):o.SetMirror_2(s(axis2d(e,r)));const a=new n.gp_GTrsf2d_2(o);return i(),new Transformation2D(a)},rotateTransform2d=(r,e=[0,0])=>{const t=getOC(),[n,s]=localGC(),i=new t.gp_Trsf2d_1;i.SetRotation(n(pnt(e)),r);const o=new t.gp_GTrsf2d_2(i);return s(),new Transformation2D(o)},scaleTransform2d=(r,e=[0,0])=>{const t=getOC(),[n,s]=localGC(),i=new t.gp_Trsf2d_1;i.SetScale(n(pnt(e)),r);const o=new t.gp_GTrsf2d_2(i);return s(),new Transformation2D(o)};function curvesAsEdgesOnFace(r,e,t="original"){const[n,s]=localGC(),i=getOC();let o=n(i.BRep_Tool.Surface_2(e.wrapped));const a=e.UVBounds;let u=null;const h=n(axis2d([0,0],[0,1])),p=n(axis2d([0,0],[1,0]));if(t==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const E=n(o.get().Cylinder());E.Direct()||(o=o.get().UReversed());const x=E.Radius();u=stretchTransform2d(1/x,[0,1]).wrapped}if(t==="bounds"){if(u=n(new i.gp_GTrsf2d_1),u.SetAffinity(h,a.uMax-a.uMin),a.uMin!==0){const x=n(new i.gp_GTrsf2d_1);x.SetTranslationPart(new i.gp_XY_2(0,-a.uMin)),u.Multiply(x)}const E=n(new i.gp_GTrsf2d_1);if(E.SetAffinity(p,a.vMax-a.vMin),u.Multiply(E),a.vMin!==0){const x=n(new i.gp_GTrsf2d_1);x.SetTranslationPart(n(new i.gp_XY_2(0,-a.vMin))),u.Multiply(x)}}const m=transformCurves(r,u),v=curvesAsEdgesOnSurface(m,o);return s(),v}function edgeToCurve(r,e){const t=getOC(),s=GCWithScope()(new t.BRepAdaptor_Curve2d_2(r.wrapped,e.wrapped)),i=new t.Geom2d_TrimmedCurve(s.Curve(),s.FirstParameter(),s.LastParameter(),!0,!0);return r.orientation==="backward"&&i.Reverse(),new Curve2D(new t.Handle_Geom2d_Curve_2(i))}const viewbox=(r,e=1)=>{const t=r.bounds[0][0]-e,n=-r.bounds[1][1]-e;return`${t} ${n} ${r.width+2*e} ${r.height+2*e}`},asSVG=(r,e,t=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${viewbox(e,t)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${r}
</svg>`;class Blueprint{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new Blueprint(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=curvesBoundingBox(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),t=e.map((n,s)=>{const i=e[(s+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,s)=>n+s,0);return this._guessedOrientation=t>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,t,n=[0,0]){const s=stretchTransform2d(e,t,n).transformCurves(this.curves);return new Blueprint(s)}scale(e,t){const n=t||this.boundingBox.center,s=scaleTransform2d(e,n).transformCurves(this.curves);return new Blueprint(s)}rotate(e,t){const n=rotateTransform2d(e*DEG2RAD,t).transformCurves(this.curves);return new Blueprint(n)}translate(e,t=0){const n=isPoint2D(e)?e:[e,t],s=translationTransform2d(n).transformCurves(this.curves);return new Blueprint(s)}mirror(e,t=[0,0],n="center"){const s=mirrorTransform2d(e,t,n).transformCurves(this.curves);return new Blueprint(s)}sketchOnPlane(e,t){const n=e instanceof Plane?makePlane(e):makePlane(e,t),s=curvesAsEdgesOnPlane(this.curves,n),i=assembleWire(s);return new Sketch(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,t){const n=getOC(),s=curvesAsEdgesOnFace(this.curves,e,t),i=assembleWire(s);n.BRepLib.BuildCurves3d_2(i.wrapped);const o=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);o.FixEdgeCurves(),o.delete();const a=new Sketch(i);if(i.isClosed){const u=a.clone().face();a.defaultOrigin=u.pointOnSurface(.5,.5),a.defaultDirection=u.normalAt(),u.orientation!==e.orientation&&(a.defaultDirection=a.defaultDirection.multiply(-1)),a.baseFace=e}else{const u=i.startPoint;a.defaultOrigin=u,a.defaultDirection=e.normalAt(u),a.baseFace=e}return a}toSVGPathD(){const e=GCWithScope(),t=this.clone().mirror([1,0],[0,0],"plane"),n=t.curves.flatMap(o=>{if((o.geomType==="ELLIPSE"||o.geomType==="CIRCLE")&&samePoint$2(o.firstPoint,o.lastPoint)){const[a,u]=o.splitAt([.5]);return[adaptedCurveToPathElem(e(a.adaptor()),a.lastPoint),adaptedCurveToPathElem(e(u.adaptor()),u.lastPoint)]}return adaptedCurveToPathElem(e(o.adaptor()),o.lastPoint)}),[s,i]=t.curves[0].firstPoint;return`M ${round5(s)} ${round5(i)} ${n.join(" ")}${t.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return asSVG(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const t=getOC(),n=new t.Geom2dAPI_InterCurveCurve_1,s=make2dSegmentCurve(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(a=>a.isOnCurve(e))?!1:(this.curves.forEach(a=>{a.boundingBox.isOut(s.boundingBox)||(n.Init_1(s.wrapped,a.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return samePoint$2(this.firstPoint,this.lastPoint)}intersects(e){const t=getOC(),n=new t.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const s of this.curves)for(const i of e.curves)if(!s.boundingBox.isOut(i.boundingBox)&&(n.Init_1(s.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class BaseSketcher2d{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,t]){return[e,t]}_convertFromUV([e,t]){return[e,t]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const t=this.pendingCurves.pop();if(!t)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...n(t,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const t=make2dSegmentCurve(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(t),this}line(e,t){return this.lineTo([this.pointer[0]+e,this.pointer[1]+t])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,t]){const n=t*DEG2RAD,s=polarToCartesian(e,n);return this.lineTo(s)}polarLine(e,t){const n=t*DEG2RAD,[s,i]=polarToCartesian(e,n);return this.line(s,i)}tangentLine(e){const t=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!t)throw new Error("You need a previous curve to sketch a tangent line");const n=normalize2d(this._convertFromUV(t.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,t){return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(t),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,t,n,s){const[i,o]=this.pointer;return this.threePointsArcTo([i+e,o+t],[i+n,o+s])}sagittaArcTo(e,t){const[n,s]=this.pointer,[i,o]=e,a=[(n+i)/2,(s+o)/2],u=[-(o-s),i-n],h=Math.sqrt(u[0]**2+u[1]**2),p=[a[0]+u[0]/h*t,a[1]+u[1]/h*t];return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(p),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,t,n){return this.sagittaArcTo([e+this.pointer[0],t+this.pointer[1]],n)}vSagittaArc(e,t){return this.sagittaArc(0,e,t)}hSagittaArc(e,t){return this.sagittaArc(e,0,t)}bulgeArcTo(e,t){if(!t)return this.lineTo(e);const n=distance2d(this.pointer,e)/2,s=-t*n;return this.sagittaArcTo(e,s)}bulgeArc(e,t,n){return this.bulgeArcTo([e+this.pointer[0],t+this.pointer[1]],n)}vBulgeArc(e,t){return this.bulgeArc(0,e,t)}hBulgeArc(e,t){return this.bulgeArc(e,0,t)}tangentArcTo(e){const t=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!t)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(make2dTangentArc(this._convertToUV(this.pointer),t.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,t){const[n,s]=this.pointer;return this.tangentArcTo([e+n,t+s])}ellipseTo(e,t,n,s=0,i=!1,o=!1){let a=s,u=t,h=n;t<n&&(a=s+90,u=n,h=t);const p=a*DEG2RAD,m=W=>distance2d(this._convertToUV(W)),v=m(polarToCartesian(u,p)),E=m(polarToCartesian(h,p+Math.PI/2)),x=normalize2d(this._convertToUV(rotate2d([1,0],p))),[,P]=cartesianToPolar(x),{cx:T,cy:C,startAngle:I,endAngle:O,clockwise:G,rx:F,ry:Y}=convertSvgEllipseParams(this._convertToUV(this.pointer),this._convertToUV(e),v,E,P,i,o),V=make2dEllipseArc(F,Y,G?I:O,G?O:I,[T,C],x);return G||V.reverse(),this.saveCurve(V),this.pointer=e,this}ellipse(e,t,n,s,i=0,o=!1,a=!1){const[u,h]=this.pointer;return this.ellipseTo([e+u,t+h],n,s,i,o,a)}halfEllipseTo(e,t,n=!1){const s=polarAngle2d(e,this.pointer),i=distance2d(e,this.pointer);return this.ellipseTo(e,i/2,t,s*RAD2DEG,!0,n)}halfEllipse(e,t,n,s=!1){const[i,o]=this.pointer;return this.halfEllipseTo([i+e,o+t],n,s)}bezierCurveTo(e,t){let n;return t.length===2&&!Array.isArray(t[0])?n=[t]:n=t,this.saveCurve(make2dBezierCurve(this._convertToUV(this.pointer),n.map(s=>this._convertToUV(s)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,t){return this.bezierCurveTo(e,[t])}cubicBezierCurveTo(e,t,n){return this.bezierCurveTo(e,[t,n])}smoothSplineTo(e,t){const{endTangent:n,startTangent:s,startFactor:i,endFactor:o}=defaultsSplineConfig(t),a=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,u=distance2d(this.pointer,e)*.25;let h;s?h=s:a?h=this._convertFromUV(a.tangentAt(1)):h=[1,0],h=normalize2d(h);const p=[this.pointer[0]+h[0]*i*u,this.pointer[1]+h[1]*i*u];let m;n==="symmetric"?m=[-h[0],-h[1]]:m=n,m=normalize2d(m);const v=[e[0]-m[0]*o*u,e[1]-m[1]*o*u];return this.cubicBezierCurveTo(e,p,v)}smoothSpline(e,t,n){return this.smoothSplineTo([e+this.pointer[0],t+this.pointer[1]],n)}customCorner(e,t="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:t,radius:e},this}_customCornerLastWithFirst(e,t="fillet"){if(!e)return;const n=this.pendingCurves.pop(),s=this.pendingCurves.shift();if(!n||!s)throw new Error("Not enough curves to close and fillet");const i=t==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...i(n,s,e))}_closeSketch(){samePoint$2(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(samePoint$2(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],t=axis2d(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(s=>new Curve2D(s.innerCurve.Mirrored_2(t)));n.reverse(),n.map(s=>s.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class FaceSketcher extends BaseSketcher2d{constructor(e,t=[0,0]){super(t),this.face=e.clone(),this._bounds=e.UVBounds}_convertToUV([e,t]){const{uMin:n,uMax:s,vMin:i,vMax:o}=this._bounds;return[n+e*(s-n),i+t*(o-i)]}_convertFromUV([e,t]){const{uMin:n,uMax:s,vMin:i,vMax:o}=this._bounds;return[(e-n)/(s-n),(t-i)/(o-i)]}_adaptSurface(){return getOC().BRep_Tool.Surface_2(this.face.wrapped)}buildWire(){const[e,t]=localGC(),n=getOC(),s=e(this._adaptSurface()),i=this.pendingCurves.map(a=>e(new Edge(e(new n.BRepBuilderAPI_MakeEdge_30(a.wrapped,s)).Edge()))),o=assembleWire(i);return n.BRepLib.BuildCurves3d_2(o.wrapped),t(),o}done(){const[e,t]=localGC(),n=this.buildWire(),s=new Sketch(n);if(n.isClosed){const i=e(s.clone().face());s.defaultOrigin=e(i.pointOnSurface(.5,.5)),s.defaultDirection=e(e(i.normalAt()).multiply(-1))}else{const i=e(n.startPoint);s.defaultOrigin=i,s.defaultDirection=e(this.face.normalAt(i))}return s.baseFace=this.face,t(),s}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,t="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,t),this.done()}}class BlueprintSketcher extends BaseSketcher2d{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Blueprint(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,t="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,t),this.done()}}class PhysicalProperties extends WrappingObj{get centerOfMass(){const t=GCWithScope()(this.wrapped.CentreOfMass());return[t.X(),t.Y(),t.Z()]}}class VolumePhysicalProperties extends PhysicalProperties{get volume(){return this.wrapped.Mass()}}class SurfacePhysicalProperties extends PhysicalProperties{get area(){return this.wrapped.Mass()}}class LinearPhysicalProperties extends PhysicalProperties{get length(){return this.wrapped.Mass()}}function measureShapeSurfaceProperties(r){const e=getOC(),t=new e.GProp_GProps_1;return e.BRepGProp.SurfaceProperties_1(r.wrapped,t,!1,!1),new SurfacePhysicalProperties(t)}function measureShapeLinearProperties(r){const e=getOC(),t=new e.GProp_GProps_1;return e.BRepGProp.LinearProperties(r.wrapped,t,!1,!1),new LinearPhysicalProperties(t)}function measureShapeVolumeProperties(r){const e=getOC(),t=new e.GProp_GProps_1;return e.BRepGProp.VolumeProperties_1(r.wrapped,t,!1,!1,!1),new VolumePhysicalProperties(t)}function measureVolume(r){return measureShapeVolumeProperties(r).volume}function measureArea(r){return measureShapeSurfaceProperties(r).area}function measureLength(r){return measureShapeLinearProperties(r).length}const makeBaseBox=(r,e,t)=>new Sketcher().movePointerTo([-r/2,e/2]).hLine(r).vLine(-e).hLine(-r).close().extrude(t),guessFaceFromWires=r=>{const e=getOC(),t=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);r.forEach((i,o)=>{i.edges.forEach(a=>{t.Add_1(a.wrapped,e.GeomAbs_Shape.GeomAbs_C0,o===0)})});const n=new e.Message_ProgressRange_1;t.Build(n),n.delete();const s=cast(t.Shape());if(t.delete(),!(s instanceof Face))throw new Error("Failed to create a face");return s},fixWire=(r,e)=>{const t=getOC(),n=new t.ShapeFix_Wire_2(r.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),r},faceFromWires=r=>{let e,t;try{e=makeFace(r[0]),t=r.slice(1)}catch{e=guessFaceFromWires(r),t=r.slice(1).map(s=>fixWire(s,e))}return addHolesInFace(e,t)},solidFromShellGenerator=(r,e)=>{const t=[],n=[],s=[];r.forEach(u=>{const[h,p,m]=e(u);t.push(h),n.push(p),s.push(m)});const i=faceFromWires(n),o=faceFromWires(s);return makeSolid([i,...t,o])};class CompoundSketch{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(t=>t.wire);return compoundShapes(e)}face(){const e=this.outerSketch.face();return addHolesInFace(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:t,extrusionProfile:n,twistAngle:s,origin:i}={}){const o=new Vector(t||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!s?solidFromShellGenerator(this.sketches,h=>complexExtrude(h.wire,i||this.outerSketch.defaultOrigin,o,n,!0)):s?solidFromShellGenerator(this.sketches,h=>twistExtrude(h.wire,s,i||this.outerSketch.defaultOrigin,o,n,!0)):basicFaceExtrusion(this.face(),o)}revolve(e,{origin:t}={}){return revolution(this.face(),t||this.outerSketch.defaultOrigin,e)}loftWith(e,t){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,o)=>{const a=e.sketches[o];return i.clone().loftWith(a.clone(),{ruled:t.ruled},!0)}),s=this.face().clone();return n.push(s,e.face()),makeSolid(n)}}class CompoundBlueprint{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new CompoundBlueprint(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new BoundingBox2d;this.blueprints.forEach(t=>e.add(t.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,t,n){return new CompoundBlueprint(this.blueprints.map(s=>s.stretch(e,t,n)))}rotate(e,t){return new CompoundBlueprint(this.blueprints.map(n=>n.rotate(e,t)))}scale(e,t){const n=t||this.boundingBox.center;return new CompoundBlueprint(this.blueprints.map(s=>s.scale(e,n)))}translate(e,t=0){return new CompoundBlueprint(this.blueprints.map(n=>n.translate(e,t)))}mirror(e,t,n){return new CompoundBlueprint(this.blueprints.map(s=>s.mirror(e,t,n)))}sketchOnPlane(e,t){const n=this.blueprints.map(s=>s.sketchOnPlane(e,t));return new CompoundSketch(n)}sketchOnFace(e,t){const n=this.blueprints.map(s=>s.sketchOnFace(e,t));return new CompoundSketch(n)}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return asSVG(this.toSVGGroup(),this.boundingBox,e)}}class Sketches{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(t=>t instanceof Sketch?t.wire:t.wires);return compoundShapes(e)}faces(){const e=this.sketches.map(t=>t.face());return compoundShapes(e)}extrude(e,t={}){const n=this.sketches.map(s=>s.extrude(e,t));return compoundShapes(n)}revolve(e,t){return compoundShapes(this.sketches.map(n=>n.revolve(e,t)))}}class Blueprints{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new Blueprints(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new BoundingBox2d;this.blueprints.forEach(t=>e.add(t.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,t,n){return new Blueprints(this.blueprints.map(s=>s.stretch(e,t,n)))}rotate(e,t){return new Blueprints(this.blueprints.map(n=>n.rotate(e,t)))}scale(e,t){const n=t||this.boundingBox.center;return new Blueprints(this.blueprints.map(s=>s.scale(e,n)))}translate(e,t=0){return new Blueprints(this.blueprints.map(n=>n.translate(e,t)))}mirror(e,t,n){return new Blueprints(this.blueprints.map(s=>s.mirror(e,t,n)))}sketchOnPlane(e,t){return new Sketches(this.blueprints.map(n=>n.sketchOnPlane(e,t)))}sketchOnFace(e,t){return new Sketches(this.blueprints.map(n=>n.sketchOnFace(e,t)))}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const t=this.blueprints.map(n=>n instanceof Blueprint?n.toSVGPath():n.toSVGGroup());return asSVG(t.join(`
    `),this.boundingBox,e)}}const groupByBoundingBoxOverlap=r=>{const e=r.map((s,i)=>r.slice(i+1).map((o,a)=>[a+i+1,o]).filter(([,o])=>!s.boundingBox.isOut(o.boundingBox)).map(([o])=>o)),t=[],n=Array(e.length);return e.forEach((s,i)=>{let o=n[i];o||(o=[],t.push(o)),o.push(r[i]),s.length&&s.forEach(a=>{n[a]=o})}),t},addContainmentInfo=r=>r.map((e,t)=>{const n=e.curves[0],s=n.value((n.lastParameter+n.firstParameter)/2),i=r.filter((o,a)=>t===a?!1:o.isInside(s));return{blueprint:e,isIn:i}}),splitMultipleOuterBlueprints=(r,e)=>r.flatMap(({blueprint:t})=>cleanEdgeCases(e.filter(({blueprint:n,isIn:s})=>n===t||s.indexOf(t)!==-1))),handleNestedBlueprints=(r,e)=>{const t=e.filter(({isIn:s})=>s.length<=1),n=cleanEdgeCases(addContainmentInfo(r.map(({blueprint:s})=>s)));return[t,...n]},cleanEdgeCases=r=>{if(!r.length)return[];const e=r.filter(({isIn:n})=>!n.length),t=r.filter(({isIn:n})=>n.length>1);return e.length===1&&t.length===0?[r]:e.length>1?splitMultipleOuterBlueprints(e,r):handleNestedBlueprints(t,r)},organiseBlueprints=r=>{const e=groupByBoundingBoxOverlap(r).map(addContainmentInfo);return new Blueprints(e.flatMap(cleanEdgeCases).map(t=>t.length===1?t[0].blueprint:(t.sort((n,s)=>n.isIn.length-s.isIn.length),new CompoundBlueprint(t.map(({blueprint:n})=>n)))))},polysidesBlueprint=(r,e,t=0)=>{const n=[...Array(e).keys()].map(i=>{const o=-(Math.PI*2/e)*i;return[r*Math.sin(o),r*Math.cos(o)]}),s=new BlueprintSketcher().movePointerTo([n[n.length-1][0],n[n.length-1][1]]);return t?n.forEach(([i,o])=>s.sagittaArcTo([i,o],t)):n.forEach(([i,o])=>s.lineTo([i,o])),s.done()},roundedRectangleBlueprint$1=(r,e,t=0)=>{const{rx:n=0,ry:s=0}=typeof t=="number"?{ry:t,rx:t}:t;let i=Math.min(n,r/2),o=Math.min(s,e/2);const a=i&&o;a||(i=0,o=0);const u=i===o,h=new BlueprintSketcher([Math.min(0,-(r/2-i)),-e/2]),p=(m,v)=>{a&&(u?h.tangentArc(m,v):h.ellipse(m,v,i,o,0,!1,!0))};return i<r/2&&h.hLine(r-2*i),p(i,o),o<e/2&&h.vLine(e-2*o),p(-i,o),i<r/2&&h.hLine(-(r-2*i)),p(-i,-o),o<e/2&&h.vLine(-(e-2*o)),p(i,-o),h.close()},PRECISION$1=1e-9,samePoint$1=(r,e)=>samePoint$2(r,e,PRECISION$1),curveMidPoint=r=>{const e=(r.lastParameter+r.firstParameter)/2;return r.value(e)},rotateToStartAt=(r,e)=>{const t=r.findIndex(i=>samePoint$1(e,i.firstPoint)),n=r.slice(0,t);return r.slice(t).concat(n)},rotateToStartAtSegment=(r,e)=>{const t=o=>samePoint$1(e.firstPoint,o.firstPoint)&&samePoint$1(e.lastPoint,o.lastPoint);let n=r.findIndex(t);if(n===-1&&(r=reverseSegment(r),n=r.findIndex(t),n===-1))throw console.error(r.map(o=>o.repr),e.repr),new Error("Failed to rotate to segment start");const s=r.slice(0,n);return r.slice(n).concat(s)};function*createSegmentOnPoints(r,e,t){const n=o=>!!e.find(a=>samePoint$1(a,o.lastPoint)),s=o=>!!t.find(a=>samePoint$1(a.firstPoint,o.firstPoint)&&samePoint$1(a.lastPoint,o.lastPoint)||samePoint$1(a.firstPoint,o.lastPoint)&&samePoint$1(a.lastPoint,o.firstPoint));let i=[];for(const o of r)n(o)?(i.push(o),yield i,i=[]):s(o)?(i.length&&(yield i,i=[]),yield[o]):i.push(o);i.length&&(yield i)}const startOfSegment=r=>r[0].firstPoint,endOfSegment=r=>r[r.length-1].lastPoint,reverseSegment=r=>(r.reverse(),r.map(e=>{const t=e.clone();return t.reverse(),t})),reverseSegments=r=>(r.reverse(),r.map(reverseSegment));function removeNonCrossingPoint(r,e,t){return r.filter(n=>{const s=e.filter(a=>samePoint$1(a.firstPoint,n)||samePoint$1(a.lastPoint,n));if(s.length%2)throw console.error(s,n),new Error("Bug in the intersection algo on non crossing point");const i=s.map(a=>t.isInside(curveMidPoint(a)));return!(i.every(a=>a)||!i.some(a=>a))})}function blueprintsIntersectionSegments(r,e){let t=[];const n=[],s=new Array(r.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(r.curves.forEach((v,E)=>{e.curves.forEach((x,P)=>{const{intersections:T,commonSegments:C,commonSegmentsPoints:I}=intersectCurves(v,x,PRECISION$1/100);t.push(...T),s[E].push(...T),i[P].push(...T),n.push(...C),t.push(...I),s[E].push(...I),i[P].push(...I)})}),t=removeDuplicatePoints(t,PRECISION$1),!t.length||t.length===1)return null;const o=([v,E])=>E.length?v.splitAt(E,PRECISION$1/100):[v];let a=zip([r.curves,s]).flatMap(o),u=zip([e.curves,i]).flatMap(o);const h=n.map(v=>[v.firstPoint,v.lastPoint]);if(t=removeNonCrossingPoint(t,a,e),!t.length&&!n.length)return null;if(n.length){const v=n[0];a=rotateToStartAtSegment(a,v),u=rotateToStartAtSegment(u,v)}else{const v=t[0];a=rotateToStartAt(a,v),u=rotateToStartAt(u,v)}const p=Array.from(createSegmentOnPoints(a,t,n));let m=Array.from(createSegmentOnPoints(u,t,n));return(!samePoint$1(endOfSegment(m[0]),endOfSegment(p[0]))||n.length>0&&m[0].length!==1)&&(m=reverseSegments(m)),zip([p,m]).map(([v,E])=>{const x=startOfSegment(v),P=endOfSegment(v);return h.find(([T,C])=>samePoint$1(T,x)&&samePoint$1(C,P)||samePoint$1(T,P)&&samePoint$1(T,x))?[v,"same"]:[v,E]})}const splitPaths=r=>{const e=r.map(o=>o.firstPoint);let t=r.map(o=>o.lastPoint);t=t.slice(-1).concat(t.slice(0,-1));const n=zip([e,t]).map(([o,a],u)=>samePoint$1(o,a)?null:u).filter(o=>o!==null);if(!n.length)return[r];const s=zip([n.slice(0,-1),n.slice(1)]).map(([o,a])=>r.slice(o,a));let i=r.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(r.slice(0,n[0]))),s.push(i),s};function booleanOperation(r,e,{firstInside:t,secondInside:n}){const s=blueprintsIntersectionSegments(r,e);if(!s){const h=curveMidPoint(r.curves[0]),p=e.isInside(h),m=curveMidPoint(e.curves[0]),v=r.isInside(m);return{identical:!1,firstCurveInSecond:p,secondCurveInFirst:v}}if(s.every(([,h])=>h==="same"))return{identical:!0};let i=null,o=null;const a=s.flatMap(([h,p])=>{let m=[],v=0;if(p==="same")return o===1?(o=1,[...h]):o===2||o===0?(o=null,[]):o===null?(i?i=[...i,...h]:i=h,[]):(console.error("weird situation"),[]);const E=curveMidPoint(h[0]),x=e.isInside(E);(t==="keep"&&x||t==="remove"&&!x)&&(v+=1,m.push(...h));const P=curveMidPoint(p[0]),T=r.isInside(P);if(n==="keep"&&T||n==="remove"&&!T){let C=p;v===1&&(C=reverseSegment(p)),v+=1,m.push(...C)}return o===null&&v===1&&i&&(m=[...i,...m]),v===1&&(o=v,i=null),m}),u=splitPaths(a).filter(h=>h.length).map(h=>new Blueprint(h));return u.length===0?null:u.length===1?u[0]:organiseBlueprints(u)}const fuseBlueprints=(r,e)=>{const t=booleanOperation(r,e,{firstInside:"remove",secondInside:"remove"});return t===null||t instanceof Blueprint||t instanceof Blueprints?t:t.identical?r.clone():t.firstCurveInSecond?e.clone():t.secondCurveInFirst?r.clone():new Blueprints([r,e])},cutBlueprints=(r,e)=>{const t=booleanOperation(r,e,{firstInside:"remove",secondInside:"keep"});return t===null||t instanceof Blueprint||t instanceof Blueprints?t:t.identical||t.firstCurveInSecond?null:t.secondCurveInFirst?new Blueprints([new CompoundBlueprint([r,e])]):r.clone()},intersectBlueprints=(r,e)=>{const t=booleanOperation(r,e,{firstInside:"keep",secondInside:"keep"});return t===null||t instanceof Blueprint||t instanceof Blueprints?t:t.identical||t.firstCurveInSecond?r.clone():t.secondCurveInFirst?e.clone():null},genericIntersects=(r,e)=>{if(r instanceof Blueprint&&e instanceof Blueprint){let t=[];return r.curves.forEach(n=>{e.curves.forEach(s=>{const{intersections:i,commonSegmentsPoints:o}=intersectCurves(n,s);t.push(...i),t.push(...o)})}),t=removeDuplicatePoints(t),t.length>1}if(r instanceof CompoundBlueprint||r instanceof Blueprints)return r.blueprints.some(t=>genericIntersects(t,e));if(e instanceof CompoundBlueprint||e instanceof Blueprints)return e.blueprints.some(t=>genericIntersects(r,t));throw new Error("Bug in the generic intersects algorithm")},genericFuse=(r,e)=>{if(r instanceof CompoundBlueprint){if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,r);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(r,e)}if(e instanceof CompoundBlueprint){if(r instanceof Blueprint)return fuseBlueprintWithCompound(r,e);if(r instanceof CompoundBlueprint)return fuseCompoundWithCompound(r,e)}if(r instanceof Blueprint&&e instanceof Blueprint)return fuseBlueprints(r,e);throw new Error("Bug in the generic fuse algorithm")},fuseIntersectingBlueprints$1=r=>{const e=new Map,t=[];return r.forEach((n,s)=>{let i;e.has(s)?i=e.get(s):(i={current:n,fusedWith:new Set([s])},t.push(i)),r.slice(s+1).forEach((o,a)=>{const u=i.current,h=s+a+1;if(i.fusedWith.has(h))return;let p=o,m=!1;if(e.has(h)&&(p=e.get(h).current,m=!0),u.boundingBox.isOut(p.boundingBox)||!genericIntersects(u,p))return;let v;if(u instanceof Blueprints||p instanceof Blueprints?v=fuse2D(u,p):v=genericFuse(u,p),!(v instanceof Blueprint||v instanceof CompoundBlueprint)){if(v instanceof Blueprints&&v.blueprints.length===2)return;if(v instanceof Blueprints&&v.blueprints.length===1)v=v.blueprints[0];else if(!(v instanceof Blueprints))throw console.error(v),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(h),i.current=v,m||e.set(h,i)})}),organiseBlueprints(t.map(({current:n})=>n).filter(n=>n).flatMap(n=>allBlueprints(n)))},allBlueprints=r=>r instanceof Blueprint?[r]:r instanceof CompoundBlueprint?r.blueprints:r instanceof Blueprints?r.blueprints.flatMap(e=>allBlueprints(e)):[],fuseBlueprintWithCompound=(r,e)=>{const t=fuseBlueprints(r,e.blueprints[0]),n=e.blueprints.slice(1).map(s=>cutBlueprints(s,r));return organiseBlueprints([...allBlueprints(t),...n.flatMap(s=>allBlueprints(s))])};function allPairs(r,e){const t=[];for(const n of r)for(const s of e)t.push([n,s]);return t}const fuseCompoundWithCompound=(r,e)=>{const t=fuseBlueprints(r.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(o=>cutBlueprints(o,r.blueprints[0])),s=r.blueprints.slice(1).map(o=>cutBlueprints(o,e.blueprints[0])),i=allPairs(r.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([o,a])=>allBlueprints(intersectBlueprints(o,a)));return organiseBlueprints([...allBlueprints(t),...n.flatMap(o=>allBlueprints(o)),...s.flatMap(o=>allBlueprints(o)),...i])},fuse2D=(r,e)=>{if(r===null)return e&&e.clone();if(e===null)return r&&r.clone();if(!(r instanceof Blueprints)&&e instanceof Blueprints)return fuseIntersectingBlueprints$1([r,...e.blueprints]);if(!(e instanceof Blueprints)&&r instanceof Blueprints)return fuseIntersectingBlueprints$1([e,...r.blueprints]);if(r instanceof Blueprints&&e instanceof Blueprints){let t=fuse2D(r.blueprints[0],e);return r.blueprints.slice(1).forEach(n=>{t=fuse2D(n,t)}),t}if(r instanceof CompoundBlueprint){if(e instanceof Blueprints)return fuse2D(e,r);if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,r);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(r,e)}if(e instanceof CompoundBlueprint){if(r instanceof Blueprints)return fuse2D(r,e);if(r instanceof Blueprint)return fuseBlueprintWithCompound(r,e);if(r instanceof CompoundBlueprint)return fuseCompoundWithCompound(r,e)}return r instanceof Blueprint&&e instanceof Blueprint?fuseBlueprints(r,e):null},mergeNonIntersecting=r=>{const e=r.flatMap(t=>t===null?[]:t instanceof Blueprints?t.blueprints:t);return e.length===1?e[0]:new Blueprints(e)},cut2D=(r,e)=>{if(r===null)return null;if(e===null)return r.clone();if(r instanceof Blueprints)return mergeNonIntersecting(r.blueprints.map(n=>cut2D(n,e)));if(r instanceof CompoundBlueprint){const n=r.blueprints[0];if(e instanceof Blueprint&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const s=fuse2D(e,new Blueprints(r.blueprints.slice(1)));return organiseBlueprints([n,...allBlueprints(s)])}else{let s=cut2D(r.blueprints[0],e);return r.blueprints.slice(1).forEach(i=>{s=cut2D(s,i)}),s}}if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(n=>cut2D(r,n)));if(e instanceof CompoundBlueprint){let n=cutBlueprints(r,e.blueprints[0]);return e.blueprints.slice(1).forEach(s=>{n=fuse2D(n,intersectBlueprints(s,r))}),n}return cutBlueprints(r,e)};function intersect2D(r,e){if(r===null||e===null)return null;if(r instanceof Blueprint&&e instanceof Blueprint)return intersectBlueprints(r,e);if(r instanceof Blueprints)return mergeNonIntersecting(r.blueprints.map(t=>intersect2D(t,e)));if(r instanceof CompoundBlueprint){const t=r.blueprints[0],n=r.blueprints[1];return cut2D(intersect2D(t,e),n)}if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(t=>intersect2D(r,t)));if(e instanceof CompoundBlueprint){const t=e.blueprints[0],n=e.blueprints[1];return cut2D(intersect2D(t,r),n)}throw new Error("intersct 2D algorithm error")}const sketchCircle=(r,e={})=>{const t=e.plane instanceof Plane?makePlane(e.plane):makePlane(e.plane,e.origin),n=assembleWire([makeCircle(r,t.origin,t.zDir)]),s=new Sketch(n,{defaultOrigin:t.origin,defaultDirection:t.zDir});return t.delete(),s},sketchEllipse=(r=1,e=2,t={})=>{const n=t.plane instanceof Plane?makePlane(t.plane):makePlane(t.plane,t.origin),s=new Vector(n.xDir);let i=r,o=e;e>r&&(s.rotate(90,n.origin,n.zDir),i=e,o=r);const a=assembleWire([makeEllipse(i,o,n.origin,n.zDir,s)]);s.delete();const u=new Sketch(a,{defaultOrigin:n.origin,defaultDirection:n.zDir});return n.delete(),u},sketchRectangle=(r,e,t={})=>(t.plane instanceof Plane?new Sketcher(t.plane):new Sketcher(t.plane,t.origin)).movePointerTo([-r/2,-e/2]).hLine(r).vLine(e).hLine(-r).vLine(-e).done(),sketchRoundedRectangle=(r,e,t=0,n={})=>roundedRectangleBlueprint$1(r,e,t).sketchOnPlane(n.plane,n.origin),sketchPolysides=(r,e,t=0,n={})=>{const s=[...Array(e).keys()].map(a=>{const u=-(Math.PI*2/e)*a;return[r*Math.sin(u),r*Math.cos(u)]}),o=(n.plane instanceof Plane?new Sketcher(n.plane):new Sketcher(n.plane,n.origin)).movePointerTo([s[s.length-1][0],s[s.length-1][1]]);return t?s.forEach(([a,u])=>o.sagittaArcTo([a,u],t)):s.forEach(([a,u])=>o.lineTo([a,u])),o.done()},polysideInnerRadius=(r,e,t=0)=>{const n=Math.PI/e,s=Math.cos(n)*r;return t>=0?s:s+t},sketchFaceOffset=(r,e)=>{const t=r.center,n=r.normalAt(),s=r.outerWire().offset2D(e),i=new Sketch(s,{defaultOrigin:t,defaultDirection:n});return t.delete(),n.delete(),i},sketchParametricFunction=(r,e={},{pointsCount:t=400,start:n=0,stop:s=1}={},i={})=>{const[o,a]=localGC(),u=o(e.plane instanceof Plane?makePlane(e.plane):makePlane(e.plane,e.origin)),h=(s-n)/t,p=[...Array(t+1).keys()].map(E=>{const x=r(n+E*h);return o(u.toWorldCoords(x))}),m=assembleWire([o(makeBSplineApproximation(p,i))]),v=new Sketch(m,{defaultOrigin:u.origin,defaultDirection:u.zDir});return a(),v},sketchHelix=(r,e,t,n=[0,0,0],s=[0,0,1],i=!1)=>new Sketch(assembleWire(makeHelix(r,e,t,n,s,i).wires));/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var r=function(){try{var t={},n=Object.defineProperty,s=n(t,t,t)&&n}catch{}return s}(),e=function(t){if(this==null)throw TypeError();var n=String(this),s=n.length,i=t?Number(t):0;if(i!=i&&(i=0),!(i<0||i>=s)){var o=n.charCodeAt(i),a;return o>=55296&&o<=56319&&s>i+1&&(a=n.charCodeAt(i+1),a>=56320&&a<=57343)?(o-55296)*1024+a-56320+65536:o}};r?r(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();var TINF_OK=0,TINF_DATA_ERROR=-3;function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Data(r,e){this.source=r,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new Tree,this.dtree=new Tree}var sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30),clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),code_tree=new Tree,lengths=new Uint8Array(320);function tinf_build_bits_base(r,e,t,n){var s,i;for(s=0;s<t;++s)r[s]=0;for(s=0;s<30-t;++s)r[s+t]=s/t|0;for(i=n,s=0;s<30;++s)e[s]=i,i+=1<<r[s]}function tinf_build_fixed_trees(r,e){var t;for(t=0;t<7;++t)r.table[t]=0;for(r.table[7]=24,r.table[8]=152,r.table[9]=112,t=0;t<24;++t)r.trans[t]=256+t;for(t=0;t<144;++t)r.trans[24+t]=t;for(t=0;t<8;++t)r.trans[168+t]=280+t;for(t=0;t<112;++t)r.trans[176+t]=144+t;for(t=0;t<5;++t)e.table[t]=0;for(e.table[5]=32,t=0;t<32;++t)e.trans[t]=t}var offs=new Uint16Array(16);function tinf_build_tree(r,e,t,n){var s,i;for(s=0;s<16;++s)r.table[s]=0;for(s=0;s<n;++s)r.table[e[t+s]]++;for(r.table[0]=0,i=0,s=0;s<16;++s)offs[s]=i,i+=r.table[s];for(s=0;s<n;++s)e[t+s]&&(r.trans[offs[e[t+s]]++]=s)}function tinf_getbit(r){r.bitcount--||(r.tag=r.source[r.sourceIndex++],r.bitcount=7);var e=r.tag&1;return r.tag>>>=1,e}function tinf_read_bits(r,e,t){if(!e)return t;for(;r.bitcount<24;)r.tag|=r.source[r.sourceIndex++]<<r.bitcount,r.bitcount+=8;var n=r.tag&65535>>>16-e;return r.tag>>>=e,r.bitcount-=e,n+t}function tinf_decode_symbol(r,e){for(;r.bitcount<24;)r.tag|=r.source[r.sourceIndex++]<<r.bitcount,r.bitcount+=8;var t=0,n=0,s=0,i=r.tag;do n=2*n+(i&1),i>>>=1,++s,t+=e.table[s],n-=e.table[s];while(n>=0);return r.tag=i,r.bitcount-=s,e.trans[t+n]}function tinf_decode_trees(r,e,t){var n,s,i,o,a,u;for(n=tinf_read_bits(r,5,257),s=tinf_read_bits(r,5,1),i=tinf_read_bits(r,4,4),o=0;o<19;++o)lengths[o]=0;for(o=0;o<i;++o){var h=tinf_read_bits(r,3,0);lengths[clcidx[o]]=h}for(tinf_build_tree(code_tree,lengths,0,19),a=0;a<n+s;){var p=tinf_decode_symbol(r,code_tree);switch(p){case 16:var m=lengths[a-1];for(u=tinf_read_bits(r,2,3);u;--u)lengths[a++]=m;break;case 17:for(u=tinf_read_bits(r,3,3);u;--u)lengths[a++]=0;break;case 18:for(u=tinf_read_bits(r,7,11);u;--u)lengths[a++]=0;break;default:lengths[a++]=p;break}}tinf_build_tree(e,lengths,0,n),tinf_build_tree(t,lengths,n,s)}function tinf_inflate_block_data(r,e,t){for(;;){var n=tinf_decode_symbol(r,e);if(n===256)return TINF_OK;if(n<256)r.dest[r.destLen++]=n;else{var s,i,o,a;for(n-=257,s=tinf_read_bits(r,length_bits[n],length_base[n]),i=tinf_decode_symbol(r,t),o=r.destLen-tinf_read_bits(r,dist_bits[i],dist_base[i]),a=o;a<o+s;++a)r.dest[r.destLen++]=r.dest[a]}}}function tinf_inflate_uncompressed_block(r){for(var e,t,n;r.bitcount>8;)r.sourceIndex--,r.bitcount-=8;if(e=r.source[r.sourceIndex+1],e=256*e+r.source[r.sourceIndex],t=r.source[r.sourceIndex+3],t=256*t+r.source[r.sourceIndex+2],e!==(~t&65535))return TINF_DATA_ERROR;for(r.sourceIndex+=4,n=e;n;--n)r.dest[r.destLen++]=r.source[r.sourceIndex++];return r.bitcount=0,TINF_OK}function tinf_uncompress(r,e){var t=new Data(r,e),n,s,i;do{switch(n=tinf_getbit(t),s=tinf_read_bits(t,2,0),s){case 0:i=tinf_inflate_uncompressed_block(t);break;case 1:i=tinf_inflate_block_data(t,sltree,sdtree);break;case 2:tinf_decode_trees(t,t.ltree,t.dtree),i=tinf_inflate_block_data(t,t.ltree,t.dtree);break;default:i=TINF_DATA_ERROR}if(i!==TINF_OK)throw new Error("Data error")}while(!n);return t.destLen<t.dest.length?typeof t.dest.slice=="function"?t.dest.slice(0,t.destLen):t.dest.subarray(0,t.destLen):t.dest}tinf_build_fixed_trees(sltree,sdtree),tinf_build_bits_base(length_bits,length_base,4,3),tinf_build_bits_base(dist_bits,dist_base,2,1),length_bits[28]=0,length_base[28]=258;var tinyInflate=tinf_uncompress;function derive(r,e,t,n,s){return Math.pow(1-s,3)*r+3*Math.pow(1-s,2)*s*e+3*(1-s)*Math.pow(s,2)*t+Math.pow(s,3)*n}function BoundingBox2(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}BoundingBox2.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},BoundingBox2.prototype.addPoint=function(r,e){typeof r=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=r,this.x2=r),r<this.x1&&(this.x1=r),r>this.x2&&(this.x2=r)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},BoundingBox2.prototype.addX=function(r){this.addPoint(r,null)},BoundingBox2.prototype.addY=function(r){this.addPoint(null,r)},BoundingBox2.prototype.addBezier=function(r,e,t,n,s,i,o,a){var u=[r,e],h=[t,n],p=[s,i],m=[o,a];this.addPoint(r,e),this.addPoint(o,a);for(var v=0;v<=1;v++){var E=6*u[v]-12*h[v]+6*p[v],x=-3*u[v]+9*h[v]-9*p[v]+3*m[v],P=3*h[v]-3*u[v];if(x===0){if(E===0)continue;var T=-P/E;0<T&&T<1&&(v===0&&this.addX(derive(u[v],h[v],p[v],m[v],T)),v===1&&this.addY(derive(u[v],h[v],p[v],m[v],T)));continue}var C=Math.pow(E,2)-4*P*x;if(!(C<0)){var I=(-E+Math.sqrt(C))/(2*x);0<I&&I<1&&(v===0&&this.addX(derive(u[v],h[v],p[v],m[v],I)),v===1&&this.addY(derive(u[v],h[v],p[v],m[v],I)));var O=(-E-Math.sqrt(C))/(2*x);0<O&&O<1&&(v===0&&this.addX(derive(u[v],h[v],p[v],m[v],O)),v===1&&this.addY(derive(u[v],h[v],p[v],m[v],O)))}}},BoundingBox2.prototype.addQuad=function(r,e,t,n,s,i){var o=r+.6666666666666666*(t-r),a=e+2/3*(n-e),u=o+1/3*(s-r),h=a+1/3*(i-e);this.addBezier(r,e,o,a,u,h,s,i)};function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Path.prototype.moveTo=function(r,e){this.commands.push({type:"M",x:r,y:e})},Path.prototype.lineTo=function(r,e){this.commands.push({type:"L",x:r,y:e})},Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(r,e,t,n,s,i){this.commands.push({type:"C",x1:r,y1:e,x2:t,y2:n,x:s,y:i})},Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(r,e,t,n){this.commands.push({type:"Q",x1:r,y1:e,x:t,y:n})},Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})},Path.prototype.extend=function(r){if(r.commands)r=r.commands;else if(r instanceof BoundingBox2){var e=r;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,r)},Path.prototype.getBoundingBox=function(){for(var r=new BoundingBox2,e=0,t=0,n=0,s=0,i=0;i<this.commands.length;i++){var o=this.commands[i];switch(o.type){case"M":r.addPoint(o.x,o.y),e=n=o.x,t=s=o.y;break;case"L":r.addPoint(o.x,o.y),n=o.x,s=o.y;break;case"Q":r.addQuad(n,s,o.x1,o.y1,o.x,o.y),n=o.x,s=o.y;break;case"C":r.addBezier(n,s,o.x1,o.y1,o.x2,o.y2,o.x,o.y),n=o.x,s=o.y;break;case"Z":n=e,s=t;break;default:throw new Error("Unexpected path command "+o.type)}}return r.isEmpty()&&r.addPoint(0,0),r},Path.prototype.draw=function(r){r.beginPath();for(var e=0;e<this.commands.length;e+=1){var t=this.commands[e];t.type==="M"?r.moveTo(t.x,t.y):t.type==="L"?r.lineTo(t.x,t.y):t.type==="C"?r.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y):t.type==="Q"?r.quadraticCurveTo(t.x1,t.y1,t.x,t.y):t.type==="Z"&&r.closePath()}this.fill&&(r.fillStyle=this.fill,r.fill()),this.stroke&&(r.strokeStyle=this.stroke,r.lineWidth=this.strokeWidth,r.stroke())},Path.prototype.toPathData=function(r){r=r!==void 0?r:2;function e(o){return Math.round(o)===o?""+Math.round(o):o.toFixed(r)}function t(){for(var o=arguments,a="",u=0;u<arguments.length;u+=1){var h=o[u];h>=0&&u>0&&(a+=" "),a+=e(h)}return a}for(var n="",s=0;s<this.commands.length;s+=1){var i=this.commands[s];i.type==="M"?n+="M"+t(i.x,i.y):i.type==="L"?n+="L"+t(i.x,i.y):i.type==="C"?n+="C"+t(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+t(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n},Path.prototype.toSVG=function(r){var e='<path d="';return e+=this.toPathData(r),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Path.prototype.toDOMElement=function(r){var e=this.toPathData(r),t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t};function fail(r){throw new Error(r)}function argument(r,e){r||fail(e)}var check={fail,argument,assert:argument},LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};function constant(r){return function(){return r}}encode.BYTE=function(r){return check.argument(r>=0&&r<=255,"Byte value should be between 0 and 255."),[r]},sizeOf.BYTE=constant(1),encode.CHAR=function(r){return[r.charCodeAt(0)]},sizeOf.CHAR=constant(1),encode.CHARARRAY=function(r){typeof r>"u"&&(r="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],t=0;t<r.length;t+=1)e[t]=r.charCodeAt(t);return e},sizeOf.CHARARRAY=function(r){return typeof r>"u"?0:r.length},encode.USHORT=function(r){return[r>>8&255,r&255]},sizeOf.USHORT=constant(2),encode.SHORT=function(r){return r>=LIMIT16&&(r=-(2*LIMIT16-r)),[r>>8&255,r&255]},sizeOf.SHORT=constant(2),encode.UINT24=function(r){return[r>>16&255,r>>8&255,r&255]},sizeOf.UINT24=constant(3),encode.ULONG=function(r){return[r>>24&255,r>>16&255,r>>8&255,r&255]},sizeOf.ULONG=constant(4),encode.LONG=function(r){return r>=LIMIT32&&(r=-(2*LIMIT32-r)),[r>>24&255,r>>16&255,r>>8&255,r&255]},sizeOf.LONG=constant(4),encode.FIXED=encode.ULONG,sizeOf.FIXED=sizeOf.ULONG,encode.FWORD=encode.SHORT,sizeOf.FWORD=sizeOf.SHORT,encode.UFWORD=encode.USHORT,sizeOf.UFWORD=sizeOf.USHORT,encode.LONGDATETIME=function(r){return[0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255]},sizeOf.LONGDATETIME=constant(8),encode.TAG=function(r){return check.argument(r.length===4,"Tag should be exactly 4 ASCII characters."),[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]},sizeOf.TAG=constant(4),encode.Card8=encode.BYTE,sizeOf.Card8=sizeOf.BYTE,encode.Card16=encode.USHORT,sizeOf.Card16=sizeOf.USHORT,encode.OffSize=encode.BYTE,sizeOf.OffSize=sizeOf.BYTE,encode.SID=encode.USHORT,sizeOf.SID=sizeOf.USHORT,encode.NUMBER=function(r){return r>=-107&&r<=107?[r+139]:r>=108&&r<=1131?(r=r-108,[(r>>8)+247,r&255]):r>=-1131&&r<=-108?(r=-r-108,[(r>>8)+251,r&255]):r>=-32768&&r<=32767?encode.NUMBER16(r):encode.NUMBER32(r)},sizeOf.NUMBER=function(r){return encode.NUMBER(r).length},encode.NUMBER16=function(r){return[28,r>>8&255,r&255]},sizeOf.NUMBER16=constant(3),encode.NUMBER32=function(r){return[29,r>>24&255,r>>16&255,r>>8&255,r&255]},sizeOf.NUMBER32=constant(5),encode.REAL=function(r){var e=r.toString(),t=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(t){var n=parseFloat("1e"+((t[2]?+t[2]:0)+t[1].length));e=(Math.round(r*n)/n).toString()}for(var s="",i=0,o=e.length;i<o;i+=1){var a=e[i];a==="e"?s+=e[++i]==="-"?"c":"b":a==="."?s+="a":a==="-"?s+="e":s+=a}s+=s.length&1?"f":"ff";for(var u=[30],h=0,p=s.length;h<p;h+=2)u.push(parseInt(s.substr(h,2),16));return u},sizeOf.REAL=function(r){return encode.REAL(r).length},encode.NAME=encode.CHARARRAY,sizeOf.NAME=sizeOf.CHARARRAY,encode.STRING=encode.CHARARRAY,sizeOf.STRING=sizeOf.CHARARRAY,decode.UTF8=function(r,e,t){for(var n=[],s=t,i=0;i<s;i++,e+=1)n[i]=r.getUint8(e);return String.fromCharCode.apply(null,n)},decode.UTF16=function(r,e,t){for(var n=[],s=t/2,i=0;i<s;i++,e+=2)n[i]=r.getUint16(e);return String.fromCharCode.apply(null,n)},encode.UTF16=function(r){for(var e=[],t=0;t<r.length;t+=1){var n=r.charCodeAt(t);e[e.length]=n>>8&255,e[e.length]=n&255}return e},sizeOf.UTF16=function(r){return r.length*2};var eightBitMacEncodings={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};decode.MACSTRING=function(r,e,t,n){var s=eightBitMacEncodings[n];if(s!==void 0){for(var i="",o=0;o<t;o++){var a=r.getUint8(e+o);a<=127?i+=String.fromCharCode(a):i+=s[a&127]}return i}};var macEncodingTableCache=typeof WeakMap=="function"&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(r){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var e in eightBitMacEncodings)macEncodingCacheKeys[e]=new String(e)}var t=macEncodingCacheKeys[r];if(t!==void 0){if(macEncodingTableCache){var n=macEncodingTableCache.get(t);if(n!==void 0)return n}var s=eightBitMacEncodings[r];if(s!==void 0){for(var i={},o=0;o<s.length;o++)i[s.charCodeAt(o)]=o+128;return macEncodingTableCache&&macEncodingTableCache.set(t,i),i}}};encode.MACSTRING=function(r,e){var t=getMacEncodingTable(e);if(t!==void 0){for(var n=[],s=0;s<r.length;s++){var i=r.charCodeAt(s);if(i>=128&&(i=t[i],i===void 0))return;n[s]=i}return n}},sizeOf.MACSTRING=function(r,e){var t=encode.MACSTRING(r,e);return t!==void 0?t.length:0};function isByteEncodable(r){return r>=-128&&r<=127}function encodeVarDeltaRunAsZeroes(r,e,t){for(var n=0,s=r.length;e<s&&n<64&&r[e]===0;)++e,++n;return t.push(128|n-1),e}function encodeVarDeltaRunAsBytes(r,e,t){for(var n=0,s=r.length,i=e;i<s&&n<64;){var o=r[i];if(!isByteEncodable(o)||o===0&&i+1<s&&r[i+1]===0)break;++i,++n}t.push(n-1);for(var a=e;a<i;++a)t.push(r[a]+256&255);return i}function encodeVarDeltaRunAsWords(r,e,t){for(var n=0,s=r.length,i=e;i<s&&n<64;){var o=r[i];if(o===0||isByteEncodable(o)&&i+1<s&&isByteEncodable(r[i+1]))break;++i,++n}t.push(64|n-1);for(var a=e;a<i;++a){var u=r[a];t.push(u+65536>>8&255,u+256&255)}return i}encode.VARDELTAS=function(r){for(var e=0,t=[];e<r.length;){var n=r[e];n===0?e=encodeVarDeltaRunAsZeroes(r,e,t):n>=-128&&n<=127?e=encodeVarDeltaRunAsBytes(r,e,t):e=encodeVarDeltaRunAsWords(r,e,t)}return t},encode.INDEX=function(r){for(var e=1,t=[e],n=[],s=0;s<r.length;s+=1){var i=encode.OBJECT(r[s]);Array.prototype.push.apply(n,i),e+=i.length,t.push(e)}if(n.length===0)return[0,0];for(var o=[],a=1+Math.floor(Math.log(e)/Math.log(2))/8|0,u=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][a],h=0;h<t.length;h+=1){var p=u(t[h]);Array.prototype.push.apply(o,p)}return Array.prototype.concat(encode.Card16(r.length),encode.OffSize(a),o,n)},sizeOf.INDEX=function(r){return encode.INDEX(r).length},encode.DICT=function(r){for(var e=[],t=Object.keys(r),n=t.length,s=0;s<n;s+=1){var i=parseInt(t[s],0),o=r[i];e=e.concat(encode.OPERAND(o.value,o.type)),e=e.concat(encode.OPERATOR(i))}return e},sizeOf.DICT=function(r){return encode.DICT(r).length},encode.OPERATOR=function(r){return r<1200?[r]:[12,r-1200]},encode.OPERAND=function(r,e){var t=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)check.argument(r.length===e.length,"Not enough arguments given for type"+e),t=t.concat(encode.OPERAND(r[n],e[n]));else if(e==="SID")t=t.concat(encode.NUMBER(r));else if(e==="offset")t=t.concat(encode.NUMBER32(r));else if(e==="number")t=t.concat(encode.NUMBER(r));else if(e==="real")t=t.concat(encode.REAL(r));else throw new Error("Unknown operand type "+e);return t},encode.OP=encode.BYTE,sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap=="function"&&new WeakMap;encode.CHARSTRING=function(r){if(wmm){var e=wmm.get(r);if(e!==void 0)return e}for(var t=[],n=r.length,s=0;s<n;s+=1){var i=r[s];t=t.concat(encode[i.type](i.value))}return wmm&&wmm.set(r,t),t},sizeOf.CHARSTRING=function(r){return encode.CHARSTRING(r).length},encode.OBJECT=function(r){var e=encode[r.type];return check.argument(e!==void 0,"No encoding function for type "+r.type),e(r.value)},sizeOf.OBJECT=function(r){var e=sizeOf[r.type];return check.argument(e!==void 0,"No sizeOf function for type "+r.type),e(r.value)},encode.TABLE=function(r){for(var e=[],t=r.fields.length,n=[],s=[],i=0;i<t;i+=1){var o=r.fields[i],a=encode[o.type];check.argument(a!==void 0,"No encoding function for field type "+o.type+" ("+o.name+")");var u=r[o.name];u===void 0&&(u=o.value);var h=a(u);o.type==="TABLE"?(s.push(e.length),e=e.concat([0,0]),n.push(h)):e=e.concat(h)}for(var p=0;p<n.length;p+=1){var m=s[p],v=e.length;check.argument(v<65536,"Table "+r.tableName+" too big."),e[m]=v>>8,e[m+1]=v&255,e=e.concat(n[p])}return e},sizeOf.TABLE=function(r){for(var e=0,t=r.fields.length,n=0;n<t;n+=1){var s=r.fields[n],i=sizeOf[s.type];check.argument(i!==void 0,"No sizeOf function for field type "+s.type+" ("+s.name+")");var o=r[s.name];o===void 0&&(o=s.value),e+=i(o),s.type==="TABLE"&&(e+=2)}return e},encode.RECORD=encode.TABLE,sizeOf.RECORD=sizeOf.TABLE,encode.LITERAL=function(r){return r},sizeOf.LITERAL=function(r){return r.length};function Table(r,e,t){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var s=e[n];this[s.name]=s.value}if(this.tableName=r,this.fields=e,t)for(var i=Object.keys(t),o=0;o<i.length;o+=1){var a=i[o],u=t[a];this[a]!==void 0&&(this[a]=u)}}Table.prototype.encode=function(){return encode.TABLE(this)},Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function ushortList(r,e,t){t===void 0&&(t=e.length);var n=new Array(e.length+1);n[0]={name:r+"Count",type:"USHORT",value:t};for(var s=0;s<e.length;s++)n[s+1]={name:r+s,type:"USHORT",value:e[s]};return n}function tableList(r,e,t){var n=e.length,s=new Array(n+1);s[0]={name:r+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)s[i+1]={name:r+i,type:"TABLE",value:t(e[i],i)};return s}function recordList(r,e,t){var n=e.length,s=[];s[0]={name:r+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)s=s.concat(t(e[i],i));return s}function Coverage(r){r.format===1?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ushortList("glyph",r.glyphs))):r.format===2?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(recordList("rangeRecord",r.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):check.assert(!1,"Coverage format must be 1 or 2.")}Coverage.prototype=Object.create(Table.prototype),Coverage.prototype.constructor=Coverage;function ScriptList(r){Table.call(this,"scriptListTable",recordList("scriptRecord",r,function(e,t){var n=e.script,s=n.defaultLangSys;return check.assert(!!s,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new Table("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Table("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:s.reqFeatureIndex}].concat(ushortList("featureIndex",s.featureIndexes)))}].concat(recordList("langSys",n.langSysRecords,function(i,o){var a=i.langSys;return[{name:"langSysTag"+o,type:"TAG",value:i.tag},{name:"langSys"+o,type:"TABLE",value:new Table("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:a.reqFeatureIndex}].concat(ushortList("featureIndex",a.featureIndexes)))}]})))}]}))}ScriptList.prototype=Object.create(Table.prototype),ScriptList.prototype.constructor=ScriptList;function FeatureList(r){Table.call(this,"featureListTable",recordList("featureRecord",r,function(e,t){var n=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new Table("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(ushortList("lookupListIndex",n.lookupListIndexes)))}]}))}FeatureList.prototype=Object.create(Table.prototype),FeatureList.prototype.constructor=FeatureList;function LookupList(r,e){Table.call(this,"lookupListTable",tableList("lookup",r,function(t){var n=e[t.lookupType];return check.assert(!!n,"Unable to write GSUB lookup type "+t.lookupType+" tables."),new Table("lookupTable",[{name:"lookupType",type:"USHORT",value:t.lookupType},{name:"lookupFlag",type:"USHORT",value:t.lookupFlag}].concat(tableList("subtable",t.subtables,n)))}))}LookupList.prototype=Object.create(Table.prototype),LookupList.prototype.constructor=LookupList;var table={Table,Record:Table,Coverage,ScriptList,FeatureList,LookupList,ushortList,tableList,recordList};function getByte(r,e){return r.getUint8(e)}function getUShort(r,e){return r.getUint16(e,!1)}function getShort(r,e){return r.getInt16(e,!1)}function getULong(r,e){return r.getUint32(e,!1)}function getFixed(r,e){var t=r.getInt16(e,!1),n=r.getUint16(e+2,!1);return t+n/65535}function getTag(r,e){for(var t="",n=e;n<e+4;n+=1)t+=String.fromCharCode(r.getInt8(n));return t}function getOffset(r,e,t){for(var n=0,s=0;s<t;s+=1)n<<=8,n+=r.getUint8(e+s);return n}function getBytes(r,e,t){for(var n=[],s=e;s<t;s+=1)n.push(r.getUint8(s));return n}function bytesToString(r){for(var e="",t=0;t<r.length;t+=1)e+=String.fromCharCode(r[t]);return e}var typeOffsets={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(r,e){this.data=r,this.offset=e,this.relativeOffset=0}Parser.prototype.parseByte=function(){var r=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,r},Parser.prototype.parseChar=function(){var r=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,r},Parser.prototype.parseCard8=Parser.prototype.parseByte,Parser.prototype.parseUShort=function(){var r=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,r},Parser.prototype.parseCard16=Parser.prototype.parseUShort,Parser.prototype.parseSID=Parser.prototype.parseUShort,Parser.prototype.parseOffset16=Parser.prototype.parseUShort,Parser.prototype.parseShort=function(){var r=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,r},Parser.prototype.parseF2Dot14=function(){var r=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,r},Parser.prototype.parseULong=function(){var r=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,r},Parser.prototype.parseOffset32=Parser.prototype.parseULong,Parser.prototype.parseFixed=function(){var r=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,r},Parser.prototype.parseString=function(r){var e=this.data,t=this.offset+this.relativeOffset,n="";this.relativeOffset+=r;for(var s=0;s<r;s++)n+=String.fromCharCode(e.getUint8(t+s));return n},Parser.prototype.parseTag=function(){return this.parseString(4)},Parser.prototype.parseLongDateTime=function(){var r=getULong(this.data,this.offset+this.relativeOffset+4);return r-=2082844800,this.relativeOffset+=8,r},Parser.prototype.parseVersion=function(r){var e=getUShort(this.data,this.offset+this.relativeOffset),t=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,r===void 0&&(r=4096),e+t/r/10},Parser.prototype.skip=function(r,e){e===void 0&&(e=1),this.relativeOffset+=typeOffsets[r]*e},Parser.prototype.parseULongList=function(r){r===void 0&&(r=this.parseULong());for(var e=new Array(r),t=this.data,n=this.offset+this.relativeOffset,s=0;s<r;s++)e[s]=t.getUint32(n),n+=4;return this.relativeOffset+=r*4,e},Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(r){r===void 0&&(r=this.parseUShort());for(var e=new Array(r),t=this.data,n=this.offset+this.relativeOffset,s=0;s<r;s++)e[s]=t.getUint16(n),n+=2;return this.relativeOffset+=r*2,e},Parser.prototype.parseShortList=function(r){for(var e=new Array(r),t=this.data,n=this.offset+this.relativeOffset,s=0;s<r;s++)e[s]=t.getInt16(n),n+=2;return this.relativeOffset+=r*2,e},Parser.prototype.parseByteList=function(r){for(var e=new Array(r),t=this.data,n=this.offset+this.relativeOffset,s=0;s<r;s++)e[s]=t.getUint8(n++);return this.relativeOffset+=r,e},Parser.prototype.parseList=function(r,e){e||(e=r,r=this.parseUShort());for(var t=new Array(r),n=0;n<r;n++)t[n]=e.call(this);return t},Parser.prototype.parseList32=function(r,e){e||(e=r,r=this.parseULong());for(var t=new Array(r),n=0;n<r;n++)t[n]=e.call(this);return t},Parser.prototype.parseRecordList=function(r,e){e||(e=r,r=this.parseUShort());for(var t=new Array(r),n=Object.keys(e),s=0;s<r;s++){for(var i={},o=0;o<n.length;o++){var a=n[o],u=e[a];i[a]=u.call(this)}t[s]=i}return t},Parser.prototype.parseRecordList32=function(r,e){e||(e=r,r=this.parseULong());for(var t=new Array(r),n=Object.keys(e),s=0;s<r;s++){for(var i={},o=0;o<n.length;o++){var a=n[o],u=e[a];i[a]=u.call(this)}t[s]=i}return t},Parser.prototype.parseStruct=function(r){if(typeof r=="function")return r.call(this);for(var e=Object.keys(r),t={},n=0;n<e.length;n++){var s=e[n],i=r[s];t[s]=i.call(this)}return t},Parser.prototype.parseValueRecord=function(r){if(r===void 0&&(r=this.parseUShort()),r!==0){var e={};return r&1&&(e.xPlacement=this.parseShort()),r&2&&(e.yPlacement=this.parseShort()),r&4&&(e.xAdvance=this.parseShort()),r&8&&(e.yAdvance=this.parseShort()),r&16&&(e.xPlaDevice=void 0,this.parseShort()),r&32&&(e.yPlaDevice=void 0,this.parseShort()),r&64&&(e.xAdvDevice=void 0,this.parseShort()),r&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},Parser.prototype.parseValueRecordList=function(){for(var r=this.parseUShort(),e=this.parseUShort(),t=new Array(e),n=0;n<e;n++)t[n]=this.parseValueRecord(r);return t},Parser.prototype.parsePointer=function(r){var e=this.parseOffset16();if(e>0)return new Parser(this.data,this.offset+e).parseStruct(r)},Parser.prototype.parsePointer32=function(r){var e=this.parseOffset32();if(e>0)return new Parser(this.data,this.offset+e).parseStruct(r)},Parser.prototype.parseListOfLists=function(r){for(var e=this.parseOffset16List(),t=e.length,n=this.relativeOffset,s=new Array(t),i=0;i<t;i++){var o=e[i];if(o===0){s[i]=void 0;continue}if(this.relativeOffset=o,r){for(var a=this.parseOffset16List(),u=new Array(a.length),h=0;h<a.length;h++)this.relativeOffset=o+a[h],u[h]=r.call(this);s[i]=u}else s[i]=this.parseUShortList()}return this.relativeOffset=n,s},Parser.prototype.parseCoverage=function(){var r=this.offset+this.relativeOffset,e=this.parseUShort(),t=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(t)};if(e===2){for(var n=new Array(t),s=0;s<t;s++)n[s]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+r.toString(16)+": Coverage format must be 1 or 2.")},Parser.prototype.parseClassDef=function(){var r=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:Parser.uShort,end:Parser.uShort,classId:Parser.uShort})};throw new Error("0x"+r.toString(16)+": ClassDef format must be 1 or 2.")},Parser.list=function(r,e){return function(){return this.parseList(r,e)}},Parser.list32=function(r,e){return function(){return this.parseList32(r,e)}},Parser.recordList=function(r,e){return function(){return this.parseRecordList(r,e)}},Parser.recordList32=function(r,e){return function(){return this.parseRecordList32(r,e)}},Parser.pointer=function(r){return function(){return this.parsePointer(r)}},Parser.pointer32=function(r){return function(){return this.parsePointer32(r)}},Parser.tag=Parser.prototype.parseTag,Parser.byte=Parser.prototype.parseByte,Parser.uShort=Parser.offset16=Parser.prototype.parseUShort,Parser.uShortList=Parser.prototype.parseUShortList,Parser.uLong=Parser.offset32=Parser.prototype.parseULong,Parser.uLongList=Parser.prototype.parseULongList,Parser.struct=Parser.prototype.parseStruct,Parser.coverage=Parser.prototype.parseCoverage,Parser.classDef=Parser.prototype.parseClassDef;var langSysTable={reserved:Parser.uShort,reqFeatureIndex:Parser.uShort,featureIndexes:Parser.uShortList};Parser.prototype.parseScriptList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,script:Parser.pointer({defaultLangSys:Parser.pointer(langSysTable),langSysRecords:Parser.recordList({tag:Parser.tag,langSys:Parser.pointer(langSysTable)})})}))||[]},Parser.prototype.parseFeatureList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,feature:Parser.pointer({featureParams:Parser.offset16,lookupListIndexes:Parser.uShortList})}))||[]},Parser.prototype.parseLookupList=function(r){return this.parsePointer(Parser.list(Parser.pointer(function(){var e=this.parseUShort();check.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var t=this.parseUShort(),n=t&16;return{lookupType:e,lookupFlag:t,subtables:this.parseList(Parser.pointer(r[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},Parser.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var r=this.parseUShort(),e=this.parseUShort();check.argument(r===1&&e<1,"GPOS/GSUB feature variations table unknown.");var t=this.parseRecordList32({conditionSetOffset:Parser.offset32,featureTableSubstitutionOffset:Parser.offset32});return t})||[]};var parse$1={getByte,getCard8:getByte,getUShort,getCard16:getUShort,getShort,getULong,getFixed,getTag,getOffset,getBytes,bytesToString,Parser};function parseCmapTableFormat12(r,e){e.parseUShort(),r.length=e.parseULong(),r.language=e.parseULong();var t;r.groupCount=t=e.parseULong(),r.glyphIndexMap={};for(var n=0;n<t;n+=1)for(var s=e.parseULong(),i=e.parseULong(),o=e.parseULong(),a=s;a<=i;a+=1)r.glyphIndexMap[a]=o,o++}function parseCmapTableFormat4(r,e,t,n,s){r.length=e.parseUShort(),r.language=e.parseUShort();var i;r.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),r.glyphIndexMap={};for(var o=new parse$1.Parser(t,n+s+14),a=new parse$1.Parser(t,n+s+16+i*2),u=new parse$1.Parser(t,n+s+16+i*4),h=new parse$1.Parser(t,n+s+16+i*6),p=n+s+16+i*8,m=0;m<i-1;m+=1)for(var v=void 0,E=o.parseUShort(),x=a.parseUShort(),P=u.parseShort(),T=h.parseUShort(),C=x;C<=E;C+=1)T!==0?(p=h.offset+h.relativeOffset-2,p+=T,p+=(C-x)*2,v=parse$1.getUShort(t,p),v!==0&&(v=v+P&65535)):v=C+P&65535,r.glyphIndexMap[C]=v}function parseCmapTable(r,e){var t={};t.version=parse$1.getUShort(r,e),check.argument(t.version===0,"cmap table version should be 0."),t.numTables=parse$1.getUShort(r,e+2);for(var n=-1,s=t.numTables-1;s>=0;s-=1){var i=parse$1.getUShort(r,e+4+s*8),o=parse$1.getUShort(r,e+4+s*8+2);if(i===3&&(o===0||o===1||o===10)||i===0&&(o===0||o===1||o===2||o===3||o===4)){n=parse$1.getULong(r,e+4+s*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var a=new parse$1.Parser(r,e+n);if(t.format=a.parseUShort(),t.format===12)parseCmapTableFormat12(t,a);else if(t.format===4)parseCmapTableFormat4(t,a,r,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+t.format+").");return t}function addSegment(r,e,t){r.segments.push({end:e,start:e,delta:-(e-t),offset:0,glyphIndex:t})}function addTerminatorSegment(r){r.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(r){var e=!0,t;for(t=r.length-1;t>0;t-=1){var n=r.get(t);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var s=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(s=s.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),s=s.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new table.Table("cmap",s);for(i.segments=[],t=0;t<r.length;t+=1){for(var o=r.get(t),a=0;a<o.unicodes.length;a+=1)addSegment(i,o.unicodes[a],t);i.segments=i.segments.sort(function(I,O){return I.start-O.start})}addTerminatorSegment(i);var u=i.segments.length,h=0,p=[],m=[],v=[],E=[],x=[],P=[];for(t=0;t<u;t+=1){var T=i.segments[t];T.end<=65535&&T.start<=65535?(p=p.concat({name:"end_"+t,type:"USHORT",value:T.end}),m=m.concat({name:"start_"+t,type:"USHORT",value:T.start}),v=v.concat({name:"idDelta_"+t,type:"SHORT",value:T.delta}),E=E.concat({name:"idRangeOffset_"+t,type:"USHORT",value:T.offset}),T.glyphId!==void 0&&(x=x.concat({name:"glyph_"+t,type:"USHORT",value:T.glyphId}))):h+=1,!e&&T.glyphIndex!==void 0&&(P=P.concat({name:"cmap12Start_"+t,type:"ULONG",value:T.start}),P=P.concat({name:"cmap12End_"+t,type:"ULONG",value:T.end}),P=P.concat({name:"cmap12Glyph_"+t,type:"ULONG",value:T.glyphIndex}))}if(i.segCountX2=(u-h)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(u-h)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(p),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(m),i.fields=i.fields.concat(v),i.fields=i.fields.concat(E),i.fields=i.fields.concat(x),i.cmap4Length=14+p.length*2+2+m.length*2+v.length*2+E.length*2+x.length*2,!e){var C=16+P.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:C},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:P.length/3}]),i.fields=i.fields.concat(P)}return i}var cmap={parse:parseCmapTable,make:makeCmapTable},cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(r){this.font=r}DefaultEncoding.prototype.charToGlyphIndex=function(r){var e=r.codePointAt(0),t=this.font.glyphs;if(t){for(var n=0;n<t.length;n+=1)for(var s=t.get(n),i=0;i<s.unicodes.length;i+=1)if(s.unicodes[i]===e)return n}return null};function CmapEncoding(r){this.cmap=r}CmapEncoding.prototype.charToGlyphIndex=function(r){return this.cmap.glyphIndexMap[r.codePointAt(0)]||0};function CffEncoding(r,e){this.encoding=r,this.charset=e}CffEncoding.prototype.charToGlyphIndex=function(r){var e=r.codePointAt(0),t=this.encoding[e];return this.charset.indexOf(t)};function GlyphNames(r){switch(r.version){case 1:this.names=standardNames.slice();break;case 2:this.names=new Array(r.numberOfGlyphs);for(var e=0;e<r.numberOfGlyphs;e++)r.glyphNameIndex[e]<standardNames.length?this.names[e]=standardNames[r.glyphNameIndex[e]]:this.names[e]=r.names[r.glyphNameIndex[e]-standardNames.length];break;case 2.5:this.names=new Array(r.numberOfGlyphs);for(var t=0;t<r.numberOfGlyphs;t++)this.names[t]=standardNames[t+r.glyphNameIndex[t]];break;case 3:this.names=[];break;default:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(r){return this.names.indexOf(r)},GlyphNames.prototype.glyphIndexToName=function(r){return this.names[r]};function addGlyphNamesAll(r){for(var e,t=r.tables.cmap.glyphIndexMap,n=Object.keys(t),s=0;s<n.length;s+=1){var i=n[s],o=t[i];e=r.glyphs.get(o),e.addUnicode(parseInt(i))}for(var a=0;a<r.glyphs.length;a+=1)e=r.glyphs.get(a),r.cffEncoding?r.isCIDFont?e.name="gid"+a:e.name=r.cffEncoding.charset[a]:r.glyphNames.names&&(e.name=r.glyphNames.glyphIndexToName(a))}function addGlyphNamesToUnicodeMap(r){r._IndexToUnicodeMap={};for(var e=r.tables.cmap.glyphIndexMap,t=Object.keys(e),n=0;n<t.length;n+=1){var s=t[n],i=e[s];r._IndexToUnicodeMap[i]===void 0?r._IndexToUnicodeMap[i]={unicodes:[parseInt(s)]}:r._IndexToUnicodeMap[i].unicodes.push(parseInt(s))}}function addGlyphNames(r,e){e.lowMemory?addGlyphNamesToUnicodeMap(r):addGlyphNamesAll(r)}function line(r,e,t,n,s){r.beginPath(),r.moveTo(e,t),r.lineTo(n,s),r.stroke()}var draw$1={line};function getPathDefinition(r,e){var t=e||new Path;return{configurable:!0,get:function(){return typeof t=="function"&&(t=t()),t},set:function(n){t=n}}}function Glyph(r){this.bindConstructorValues(r)}Glyph.prototype.bindConstructorValues=function(r){this.index=r.index||0,this.name=r.name||null,this.unicode=r.unicode||void 0,this.unicodes=r.unicodes||r.unicode!==void 0?[r.unicode]:[],"xMin"in r&&(this.xMin=r.xMin),"yMin"in r&&(this.yMin=r.yMin),"xMax"in r&&(this.xMax=r.xMax),"yMax"in r&&(this.yMax=r.yMax),"advanceWidth"in r&&(this.advanceWidth=r.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,r.path))},Glyph.prototype.addUnicode=function(r){this.unicodes.length===0&&(this.unicode=r),this.unicodes.push(r)},Glyph.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Glyph.prototype.getPath=function(r,e,t,n,s){r=r!==void 0?r:0,e=e!==void 0?e:0,t=t!==void 0?t:72;var i,o;n||(n={});var a=n.xScale,u=n.yScale;if(n.hinting&&s&&s.hinting&&(o=this.path&&s.hinting.exec(this,t)),o)i=s.hinting.getCommands(o),r=Math.round(r),e=Math.round(e),a=u=1;else{i=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*t;a===void 0&&(a=h),u===void 0&&(u=h)}for(var p=new Path,m=0;m<i.length;m+=1){var v=i[m];v.type==="M"?p.moveTo(r+v.x*a,e+-v.y*u):v.type==="L"?p.lineTo(r+v.x*a,e+-v.y*u):v.type==="Q"?p.quadraticCurveTo(r+v.x1*a,e+-v.y1*u,r+v.x*a,e+-v.y*u):v.type==="C"?p.curveTo(r+v.x1*a,e+-v.y1*u,r+v.x2*a,e+-v.y2*u,r+v.x*a,e+-v.y*u):v.type==="Z"&&p.closePath()}return p},Glyph.prototype.getContours=function(){if(this.points===void 0)return[];for(var r=[],e=[],t=0;t<this.points.length;t+=1){var n=this.points[t];e.push(n),n.lastPointOfContour&&(r.push(e),e=[])}return check.argument(e.length===0,"There are still points left in the current contour."),r},Glyph.prototype.getMetrics=function(){for(var r=this.path.commands,e=[],t=[],n=0;n<r.length;n+=1){var s=r[n];s.type!=="Z"&&(e.push(s.x),t.push(s.y)),(s.type==="Q"||s.type==="C")&&(e.push(s.x1),t.push(s.y1)),s.type==="C"&&(e.push(s.x2),t.push(s.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,t),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,t),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i},Glyph.prototype.draw=function(r,e,t,n,s){this.getPath(e,t,n,s).draw(r)},Glyph.prototype.drawPoints=function(r,e,t,n){function s(m,v,E,x){r.beginPath();for(var P=0;P<m.length;P+=1)r.moveTo(v+m[P].x*x,E+m[P].y*x),r.arc(v+m[P].x*x,E+m[P].y*x,2,0,Math.PI*2,!1);r.closePath(),r.fill()}e=e!==void 0?e:0,t=t!==void 0?t:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,o=[],a=[],u=this.path,h=0;h<u.commands.length;h+=1){var p=u.commands[h];p.x!==void 0&&o.push({x:p.x,y:-p.y}),p.x1!==void 0&&a.push({x:p.x1,y:-p.y1}),p.x2!==void 0&&a.push({x:p.x2,y:-p.y2})}r.fillStyle="blue",s(o,e,t,i),r.fillStyle="red",s(a,e,t,i)},Glyph.prototype.drawMetrics=function(r,e,t,n){var s;e=e!==void 0?e:0,t=t!==void 0?t:0,n=n!==void 0?n:24,s=1/this.path.unitsPerEm*n,r.lineWidth=1,r.strokeStyle="black",draw$1.line(r,e,-1e4,e,1e4),draw$1.line(r,-1e4,t,1e4,t);var i=this.xMin||0,o=this.yMin||0,a=this.xMax||0,u=this.yMax||0,h=this.advanceWidth||0;r.strokeStyle="blue",draw$1.line(r,e+i*s,-1e4,e+i*s,1e4),draw$1.line(r,e+a*s,-1e4,e+a*s,1e4),draw$1.line(r,-1e4,t+-o*s,1e4,t+-o*s),draw$1.line(r,-1e4,t+-u*s,1e4,t+-u*s),r.strokeStyle="green",draw$1.line(r,e+h*s,-1e4,e+h*s,1e4)};function defineDependentProperty(r,e,t){Object.defineProperty(r,e,{get:function(){return r.path,r[t]},set:function(n){r[t]=n},enumerable:!0,configurable:!0})}function GlyphSet(r,e){if(this.font=r,this.glyphs={},Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];n.path.unitsPerEm=r.unitsPerEm,this.glyphs[t]=n}this.length=e&&e.length||0}GlyphSet.prototype.get=function(r){if(this.glyphs[r]===void 0){this.font._push(r),typeof this.glyphs[r]=="function"&&(this.glyphs[r]=this.glyphs[r]());var e=this.glyphs[r],t=this.font._IndexToUnicodeMap[r];if(t)for(var n=0;n<t.unicodes.length;n++)e.addUnicode(t.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+r:e.name=this.font.cffEncoding.charset[r]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(r)),this.glyphs[r].advanceWidth=this.font._hmtxTableData[r].advanceWidth,this.glyphs[r].leftSideBearing=this.font._hmtxTableData[r].leftSideBearing}else typeof this.glyphs[r]=="function"&&(this.glyphs[r]=this.glyphs[r]());return this.glyphs[r]},GlyphSet.prototype.push=function(r,e){this.glyphs[r]=e,this.length++};function glyphLoader(r,e){return new Glyph({index:e,font:r})}function ttfGlyphLoader(r,e,t,n,s,i){return function(){var o=new Glyph({index:e,font:r});return o.path=function(){t(o,n,s);var a=i(r.glyphs,o);return a.unitsPerEm=r.unitsPerEm,a},defineDependentProperty(o,"xMin","_xMin"),defineDependentProperty(o,"xMax","_xMax"),defineDependentProperty(o,"yMin","_yMin"),defineDependentProperty(o,"yMax","_yMax"),o}}function cffGlyphLoader(r,e,t,n){return function(){var s=new Glyph({index:e,font:r});return s.path=function(){var i=t(r,s,n);return i.unitsPerEm=r.unitsPerEm,i},s}}var glyphset={GlyphSet,glyphLoader,ttfGlyphLoader,cffGlyphLoader};function equals(r,e){if(r===e)return!0;if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t+=1)if(!equals(r[t],e[t]))return!1;return!0}else return!1}function calcCFFSubroutineBias(r){var e;return r.length<1240?e=107:r.length<33900?e=1131:e=32768,e}function parseCFFIndex(r,e,t){var n=[],s=[],i=parse$1.getCard16(r,e),o,a;if(i!==0){var u=parse$1.getByte(r,e+2);o=e+(i+1)*u+2;for(var h=e+3,p=0;p<i+1;p+=1)n.push(parse$1.getOffset(r,h,u)),h+=u;a=o+n[i]}else a=e+2;for(var m=0;m<n.length-1;m+=1){var v=parse$1.getBytes(r,o+n[m],o+n[m+1]);t&&(v=t(v)),s.push(v)}return{objects:s,startOffset:e,endOffset:a}}function parseCFFIndexLowMemory(r,e){var t=[],n=parse$1.getCard16(r,e),s,i;if(n!==0){var o=parse$1.getByte(r,e+2);s=e+(n+1)*o+2;for(var a=e+3,u=0;u<n+1;u+=1)t.push(parse$1.getOffset(r,a,o)),a+=o;i=s+t[n]}else i=e+2;return{offsets:t,startOffset:e,endOffset:i}}function getCffIndexObject(r,e,t,n,s){var i=parse$1.getCard16(t,n),o=0;if(i!==0){var a=parse$1.getByte(t,n+2);o=n+(i+1)*a+2}var u=parse$1.getBytes(t,o+e[r],o+e[r+1]);return u}function parseFloatOperand(r){for(var e="",t=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var s=r.parseByte(),i=s>>4,o=s&15;if(i===t||(e+=n[i],o===t))break;e+=n[o]}return parseFloat(e)}function parseOperand(r,e){var t,n,s,i;if(e===28)return t=r.parseByte(),n=r.parseByte(),t<<8|n;if(e===29)return t=r.parseByte(),n=r.parseByte(),s=r.parseByte(),i=r.parseByte(),t<<24|n<<16|s<<8|i;if(e===30)return parseFloatOperand(r);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return t=r.parseByte(),(e-247)*256+t+108;if(e>=251&&e<=254)return t=r.parseByte(),-(e-251)*256-t-108;throw new Error("Invalid b0 "+e)}function entriesToObject(r){for(var e={},t=0;t<r.length;t+=1){var n=r[t][0],s=r[t][1],i=void 0;if(s.length===1?i=s[0]:i=s,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function parseCFFDict(r,e,t){e=e!==void 0?e:0;var n=new parse$1.Parser(r,e),s=[],i=[];for(t=t!==void 0?t:r.length;n.relativeOffset<t;){var o=n.parseByte();o<=21?(o===12&&(o=1200+n.parseByte()),s.push([o,i]),i=[]):i.push(parseOperand(n,o))}return entriesToObject(s)}function getCFFString(r,e){return e<=390?e=cffStandardStrings[e]:e=r[e-391],e}function interpretDict(r,e,t){for(var n={},s,i=0;i<e.length;i+=1){var o=e[i];if(Array.isArray(o.type)){var a=[];a.length=o.type.length;for(var u=0;u<o.type.length;u++)s=r[o.op]!==void 0?r[o.op][u]:void 0,s===void 0&&(s=o.value!==void 0&&o.value[u]!==void 0?o.value[u]:null),o.type[u]==="SID"&&(s=getCFFString(t,s)),a[u]=s;n[o.name]=a}else s=r[o.op],s===void 0&&(s=o.value!==void 0?o.value:null),o.type==="SID"&&(s=getCFFString(t,s)),n[o.name]=s}return n}function parseCFFHeader(r,e){var t={};return t.formatMajor=parse$1.getCard8(r,e),t.formatMinor=parse$1.getCard8(r,e+1),t.size=parse$1.getCard8(r,e+2),t.offsetSize=parse$1.getCard8(r,e+3),t.startOffset=e,t.endOffset=e+4,t}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(r,e){var t=parseCFFDict(r,0,r.byteLength);return interpretDict(t,TOP_DICT_META,e)}function parseCFFPrivateDict(r,e,t,n){var s=parseCFFDict(r,e,t);return interpretDict(s,PRIVATE_DICT_META,n)}function gatherCFFTopDicts(r,e,t,n){for(var s=[],i=0;i<t.length;i+=1){var o=new DataView(new Uint8Array(t[i]).buffer),a=parseCFFTopDict(o,n);a._subrs=[],a._subrsBias=0,a._defaultWidthX=0,a._nominalWidthX=0;var u=a.private[0],h=a.private[1];if(u!==0&&h!==0){var p=parseCFFPrivateDict(r,h+e,u,n);if(a._defaultWidthX=p.defaultWidthX,a._nominalWidthX=p.nominalWidthX,p.subrs!==0){var m=h+p.subrs,v=parseCFFIndex(r,m+e);a._subrs=v.objects,a._subrsBias=calcCFFSubroutineBias(a._subrs)}a._privateDict=p}s.push(a)}return s}function parseCFFCharset(r,e,t,n){var s,i,o=new parse$1.Parser(r,e);t-=1;var a=[".notdef"],u=o.parseCard8();if(u===0)for(var h=0;h<t;h+=1)s=o.parseSID(),a.push(getCFFString(n,s));else if(u===1)for(;a.length<=t;){s=o.parseSID(),i=o.parseCard8();for(var p=0;p<=i;p+=1)a.push(getCFFString(n,s)),s+=1}else if(u===2)for(;a.length<=t;){s=o.parseSID(),i=o.parseCard16();for(var m=0;m<=i;m+=1)a.push(getCFFString(n,s)),s+=1}else throw new Error("Unknown charset format "+u);return a}function parseCFFEncoding(r,e,t){var n,s={},i=new parse$1.Parser(r,e),o=i.parseCard8();if(o===0)for(var a=i.parseCard8(),u=0;u<a;u+=1)n=i.parseCard8(),s[n]=u;else if(o===1){var h=i.parseCard8();n=1;for(var p=0;p<h;p+=1)for(var m=i.parseCard8(),v=i.parseCard8(),E=m;E<=m+v;E+=1)s[E]=n,n+=1}else throw new Error("Unknown encoding format "+o);return new CffEncoding(s,t)}function parseCFFCharstring(r,e,t){var n,s,i,o,a=new Path,u=[],h=0,p=!1,m=!1,v=0,E=0,x,P,T,C;if(r.isCIDFont){var I=r.tables.cff.topDict._fdSelect[e.index],O=r.tables.cff.topDict._fdArray[I];x=O._subrs,P=O._subrsBias,T=O._defaultWidthX,C=O._nominalWidthX}else x=r.tables.cff.topDict._subrs,P=r.tables.cff.topDict._subrsBias,T=r.tables.cff.topDict._defaultWidthX,C=r.tables.cff.topDict._nominalWidthX;var G=T;function F(W,q){m&&a.closePath(),a.moveTo(W,q),m=!0}function Y(){var W;W=u.length%2!==0,W&&!p&&(G=u.shift()+C),h+=u.length>>1,u.length=0,p=!0}function V(W){for(var q,ce,J,ge,fe,Q,oe,$,X,ae,ye,xe,ue=0;ue<W.length;){var be=W[ue];switch(ue+=1,be){case 1:Y();break;case 3:Y();break;case 4:u.length>1&&!p&&(G=u.shift()+C,p=!0),E+=u.pop(),F(v,E);break;case 5:for(;u.length>0;)v+=u.shift(),E+=u.shift(),a.lineTo(v,E);break;case 6:for(;u.length>0&&(v+=u.shift(),a.lineTo(v,E),u.length!==0);)E+=u.shift(),a.lineTo(v,E);break;case 7:for(;u.length>0&&(E+=u.shift(),a.lineTo(v,E),u.length!==0);)v+=u.shift(),a.lineTo(v,E);break;case 8:for(;u.length>0;)n=v+u.shift(),s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),v=i+u.shift(),E=o+u.shift(),a.curveTo(n,s,i,o,v,E);break;case 10:fe=u.pop()+P,Q=x[fe],Q&&V(Q);break;case 11:return;case 12:switch(be=W[ue],ue+=1,be){case 35:n=v+u.shift(),s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),oe=i+u.shift(),$=o+u.shift(),X=oe+u.shift(),ae=$+u.shift(),ye=X+u.shift(),xe=ae+u.shift(),v=ye+u.shift(),E=xe+u.shift(),u.shift(),a.curveTo(n,s,i,o,oe,$),a.curveTo(X,ae,ye,xe,v,E);break;case 34:n=v+u.shift(),s=E,i=n+u.shift(),o=s+u.shift(),oe=i+u.shift(),$=o,X=oe+u.shift(),ae=o,ye=X+u.shift(),xe=E,v=ye+u.shift(),a.curveTo(n,s,i,o,oe,$),a.curveTo(X,ae,ye,xe,v,E);break;case 36:n=v+u.shift(),s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),oe=i+u.shift(),$=o,X=oe+u.shift(),ae=o,ye=X+u.shift(),xe=ae+u.shift(),v=ye+u.shift(),a.curveTo(n,s,i,o,oe,$),a.curveTo(X,ae,ye,xe,v,E);break;case 37:n=v+u.shift(),s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),oe=i+u.shift(),$=o+u.shift(),X=oe+u.shift(),ae=$+u.shift(),ye=X+u.shift(),xe=ae+u.shift(),Math.abs(ye-v)>Math.abs(xe-E)?v=ye+u.shift():E=xe+u.shift(),a.curveTo(n,s,i,o,oe,$),a.curveTo(X,ae,ye,xe,v,E);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+be),u.length=0}break;case 14:u.length>0&&!p&&(G=u.shift()+C,p=!0),m&&(a.closePath(),m=!1);break;case 18:Y();break;case 19:case 20:Y(),ue+=h+7>>3;break;case 21:u.length>2&&!p&&(G=u.shift()+C,p=!0),E+=u.pop(),v+=u.pop(),F(v,E);break;case 22:u.length>1&&!p&&(G=u.shift()+C,p=!0),v+=u.pop(),F(v,E);break;case 23:Y();break;case 24:for(;u.length>2;)n=v+u.shift(),s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),v=i+u.shift(),E=o+u.shift(),a.curveTo(n,s,i,o,v,E);v+=u.shift(),E+=u.shift(),a.lineTo(v,E);break;case 25:for(;u.length>6;)v+=u.shift(),E+=u.shift(),a.lineTo(v,E);n=v+u.shift(),s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),v=i+u.shift(),E=o+u.shift(),a.curveTo(n,s,i,o,v,E);break;case 26:for(u.length%2&&(v+=u.shift());u.length>0;)n=v,s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),v=i,E=o+u.shift(),a.curveTo(n,s,i,o,v,E);break;case 27:for(u.length%2&&(E+=u.shift());u.length>0;)n=v+u.shift(),s=E,i=n+u.shift(),o=s+u.shift(),v=i+u.shift(),E=o,a.curveTo(n,s,i,o,v,E);break;case 28:q=W[ue],ce=W[ue+1],u.push((q<<24|ce<<16)>>16),ue+=2;break;case 29:fe=u.pop()+r.gsubrsBias,Q=r.gsubrs[fe],Q&&V(Q);break;case 30:for(;u.length>0&&(n=v,s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),v=i+u.shift(),E=o+(u.length===1?u.shift():0),a.curveTo(n,s,i,o,v,E),u.length!==0);)n=v+u.shift(),s=E,i=n+u.shift(),o=s+u.shift(),E=o+u.shift(),v=i+(u.length===1?u.shift():0),a.curveTo(n,s,i,o,v,E);break;case 31:for(;u.length>0&&(n=v+u.shift(),s=E,i=n+u.shift(),o=s+u.shift(),E=o+u.shift(),v=i+(u.length===1?u.shift():0),a.curveTo(n,s,i,o,v,E),u.length!==0);)n=v,s=E+u.shift(),i=n+u.shift(),o=s+u.shift(),v=i+u.shift(),E=o+(u.length===1?u.shift():0),a.curveTo(n,s,i,o,v,E);break;default:be<32?console.log("Glyph "+e.index+": unknown operator "+be):be<247?u.push(be-139):be<251?(q=W[ue],ue+=1,u.push((be-247)*256+q+108)):be<255?(q=W[ue],ue+=1,u.push(-(be-251)*256-q-108)):(q=W[ue],ce=W[ue+1],J=W[ue+2],ge=W[ue+3],ue+=4,u.push((q<<24|ce<<16|J<<8|ge)/65536))}}}return V(t),e.advanceWidth=G,a}function parseCFFFDSelect(r,e,t,n){var s=[],i,o=new parse$1.Parser(r,e),a=o.parseCard8();if(a===0)for(var u=0;u<t;u++){if(i=o.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");s.push(i)}else if(a===3){var h=o.parseCard16(),p=o.parseCard16();if(p!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+p);for(var m,v=0;v<h;v++){if(i=o.parseCard8(),m=o.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(m>t)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+m);for(;p<m;p++)s.push(i);p=m}if(m!==t)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+m)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+a);return s}function parseCFFTable(r,e,t,n){t.tables.cff={};var s=parseCFFHeader(r,e),i=parseCFFIndex(r,s.endOffset,parse$1.bytesToString),o=parseCFFIndex(r,i.endOffset),a=parseCFFIndex(r,o.endOffset,parse$1.bytesToString),u=parseCFFIndex(r,a.endOffset);t.gsubrs=u.objects,t.gsubrsBias=calcCFFSubroutineBias(t.gsubrs);var h=gatherCFFTopDicts(r,e,o.objects,a.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var p=h[0];if(t.tables.cff.topDict=p,p._privateDict&&(t.defaultWidthX=p._privateDict.defaultWidthX,t.nominalWidthX=p._privateDict.nominalWidthX),p.ros[0]!==void 0&&p.ros[1]!==void 0&&(t.isCIDFont=!0),t.isCIDFont){var m=p.fdArray,v=p.fdSelect;if(m===0||v===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");m+=e;var E=parseCFFIndex(r,m),x=gatherCFFTopDicts(r,e,E.objects,a.objects);p._fdArray=x,v+=e,p._fdSelect=parseCFFFDSelect(r,v,t.numGlyphs,x.length)}var P=e+p.private[1],T=parseCFFPrivateDict(r,P,p.private[0],a.objects);if(t.defaultWidthX=T.defaultWidthX,t.nominalWidthX=T.nominalWidthX,T.subrs!==0){var C=P+T.subrs,I=parseCFFIndex(r,C);t.subrs=I.objects,t.subrsBias=calcCFFSubroutineBias(t.subrs)}else t.subrs=[],t.subrsBias=0;var O;n.lowMemory?(O=parseCFFIndexLowMemory(r,e+p.charStrings),t.nGlyphs=O.offsets.length):(O=parseCFFIndex(r,e+p.charStrings),t.nGlyphs=O.objects.length);var G=parseCFFCharset(r,e+p.charset,t.nGlyphs,a.objects);if(p.encoding===0?t.cffEncoding=new CffEncoding(cffStandardEncoding,G):p.encoding===1?t.cffEncoding=new CffEncoding(cffExpertEncoding,G):t.cffEncoding=parseCFFEncoding(r,e+p.encoding,G),t.encoding=t.encoding||t.cffEncoding,t.glyphs=new glyphset.GlyphSet(t),n.lowMemory)t._push=function(V){var W=getCffIndexObject(V,O.offsets,r,e+p.charStrings);t.glyphs.push(V,glyphset.cffGlyphLoader(t,V,parseCFFCharstring,W))};else for(var F=0;F<t.nGlyphs;F+=1){var Y=O.objects[F];t.glyphs.push(F,glyphset.cffGlyphLoader(t,F,parseCFFCharstring,Y))}}function encodeString(r,e){var t,n=cffStandardStrings.indexOf(r);return n>=0&&(t=n),n=e.indexOf(r),n>=0?t=n+cffStandardStrings.length:(t=cffStandardStrings.length+e.length,e.push(r)),t}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(r){var e=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var t=0;t<r.length;t+=1)e.names.push({name:"name_"+t,type:"NAME",value:r[t]});return e}function makeDict(r,e,t){for(var n={},s=0;s<r.length;s+=1){var i=r[s],o=e[i.name];o!==void 0&&!equals(o,i.value)&&(i.type==="SID"&&(o=encodeString(o,t)),n[i.op]={name:i.name,type:i.type,value:o})}return n}function makeTopDict(r,e){var t=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return t.dict=makeDict(TOP_DICT_META,r,e),t}function makeTopDictIndex(r){var e=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:r}],e}function makeStringIndex(r){var e=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var t=0;t<r.length;t+=1)e.strings.push({name:"string_"+t,type:"STRING",value:r[t]});return e}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(r,e){for(var t=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<r.length;n+=1){var s=r[n],i=encodeString(s,e);t.fields.push({name:"glyph_"+n,type:"SID",value:i})}return t}function glyphToOps(r){var e=[],t=r.path;e.push({name:"width",type:"NUMBER",value:r.advanceWidth});for(var n=0,s=0,i=0;i<t.commands.length;i+=1){var o=void 0,a=void 0,u=t.commands[i];if(u.type==="Q"){var h=.3333333333333333,p=2/3;u={type:"C",x:u.x,y:u.y,x1:Math.round(h*n+p*u.x1),y1:Math.round(h*s+p*u.y1),x2:Math.round(h*u.x+p*u.x1),y2:Math.round(h*u.y+p*u.y1)}}if(u.type==="M")o=Math.round(u.x-n),a=Math.round(u.y-s),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(u.x),s=Math.round(u.y);else if(u.type==="L")o=Math.round(u.x-n),a=Math.round(u.y-s),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(u.x),s=Math.round(u.y);else if(u.type==="C"){var m=Math.round(u.x1-n),v=Math.round(u.y1-s),E=Math.round(u.x2-u.x1),x=Math.round(u.y2-u.y1);o=Math.round(u.x-u.x2),a=Math.round(u.y-u.y2),e.push({name:"dx1",type:"NUMBER",value:m}),e.push({name:"dy1",type:"NUMBER",value:v}),e.push({name:"dx2",type:"NUMBER",value:E}),e.push({name:"dy2",type:"NUMBER",value:x}),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(u.x),s=Math.round(u.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function makeCharStringsIndex(r){for(var e=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),t=0;t<r.length;t+=1){var n=r.get(t),s=glyphToOps(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:s})}return e}function makePrivateDict(r,e){var t=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return t.dict=makeDict(PRIVATE_DICT_META,r,e),t}function makeCFFTable(r,e){for(var t=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,s={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},o=[],a,u=1;u<r.length;u+=1)a=r.get(u),o.push(a.name);var h=[];t.header=makeHeader(),t.nameIndex=makeNameIndex([e.postScriptName]);var p=makeTopDict(s,h);t.topDictIndex=makeTopDictIndex(p),t.globalSubrIndex=makeGlobalSubrIndex(),t.charsets=makeCharsets(o,h),t.charStringsIndex=makeCharStringsIndex(r),t.privateDict=makePrivateDict(i,h),t.stringIndex=makeStringIndex(h);var m=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();return s.charset=m,s.encoding=0,s.charStrings=s.charset+t.charsets.sizeOf(),s.private[1]=s.charStrings+t.charStringsIndex.sizeOf(),p=makeTopDict(s,h),t.topDictIndex=makeTopDictIndex(p),t}var cff={parse:parseCFFTable,make:makeCFFTable};function parseHeadTable(r,e){var t={},n=new parse$1.Parser(r,e);return t.version=n.parseVersion(),t.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,t.checkSumAdjustment=n.parseULong(),t.magicNumber=n.parseULong(),check.argument(t.magicNumber===1594834165,"Font header has wrong magic number."),t.flags=n.parseUShort(),t.unitsPerEm=n.parseUShort(),t.created=n.parseLongDateTime(),t.modified=n.parseLongDateTime(),t.xMin=n.parseShort(),t.yMin=n.parseShort(),t.xMax=n.parseShort(),t.yMax=n.parseShort(),t.macStyle=n.parseUShort(),t.lowestRecPPEM=n.parseUShort(),t.fontDirectionHint=n.parseShort(),t.indexToLocFormat=n.parseShort(),t.glyphDataFormat=n.parseShort(),t}function makeHeadTable(r){var e=Math.round(new Date().getTime()/1e3)+2082844800,t=e;return r.createdTimestamp&&(t=r.createdTimestamp+2082844800),new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:t},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],r)}var head={parse:parseHeadTable,make:makeHeadTable};function parseHheaTable(r,e){var t={},n=new parse$1.Parser(r,e);return t.version=n.parseVersion(),t.ascender=n.parseShort(),t.descender=n.parseShort(),t.lineGap=n.parseShort(),t.advanceWidthMax=n.parseUShort(),t.minLeftSideBearing=n.parseShort(),t.minRightSideBearing=n.parseShort(),t.xMaxExtent=n.parseShort(),t.caretSlopeRise=n.parseShort(),t.caretSlopeRun=n.parseShort(),t.caretOffset=n.parseShort(),n.relativeOffset+=8,t.metricDataFormat=n.parseShort(),t.numberOfHMetrics=n.parseUShort(),t}function makeHheaTable(r){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],r)}var hhea={parse:parseHheaTable,make:makeHheaTable};function parseHmtxTableAll(r,e,t,n,s){for(var i,o,a=new parse$1.Parser(r,e),u=0;u<n;u+=1){u<t&&(i=a.parseUShort(),o=a.parseShort());var h=s.get(u);h.advanceWidth=i,h.leftSideBearing=o}}function parseHmtxTableOnLowMemory(r,e,t,n,s){r._hmtxTableData={};for(var i,o,a=new parse$1.Parser(e,t),u=0;u<s;u+=1)u<n&&(i=a.parseUShort(),o=a.parseShort()),r._hmtxTableData[u]={advanceWidth:i,leftSideBearing:o}}function parseHmtxTable(r,e,t,n,s,i,o){o.lowMemory?parseHmtxTableOnLowMemory(r,e,t,n,s):parseHmtxTableAll(e,t,n,s,i)}function makeHmtxTable(r){for(var e=new table.Table("hmtx",[]),t=0;t<r.length;t+=1){var n=r.get(t),s=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+t,type:"USHORT",value:s}),e.fields.push({name:"leftSideBearing_"+t,type:"SHORT",value:i})}return e}var hmtx={parse:parseHmtxTable,make:makeHmtxTable};function makeLtagTable(r){for(var e=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:r.length}]),t="",n=12+r.length*4,s=0;s<r.length;++s){var i=t.indexOf(r[s]);i<0&&(i=t.length,t+=r[s]),e.fields.push({name:"offset "+s,type:"USHORT",value:n+i}),e.fields.push({name:"length "+s,type:"USHORT",value:r[s].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:t}),e}function parseLtagTable(r,e){var t=new parse$1.Parser(r,e),n=t.parseULong();check.argument(n===1,"Unsupported ltag table version."),t.skip("uLong",1);for(var s=t.parseULong(),i=[],o=0;o<s;o++){for(var a="",u=e+t.parseUShort(),h=t.parseUShort(),p=u;p<u+h;++p)a+=String.fromCharCode(r.getInt8(p));i.push(a)}return i}var ltag={make:makeLtagTable,parse:parseLtagTable};function parseMaxpTable(r,e){var t={},n=new parse$1.Parser(r,e);return t.version=n.parseVersion(),t.numGlyphs=n.parseUShort(),t.version===1&&(t.maxPoints=n.parseUShort(),t.maxContours=n.parseUShort(),t.maxCompositePoints=n.parseUShort(),t.maxCompositeContours=n.parseUShort(),t.maxZones=n.parseUShort(),t.maxTwilightPoints=n.parseUShort(),t.maxStorage=n.parseUShort(),t.maxFunctionDefs=n.parseUShort(),t.maxInstructionDefs=n.parseUShort(),t.maxStackElements=n.parseUShort(),t.maxSizeOfInstructions=n.parseUShort(),t.maxComponentElements=n.parseUShort(),t.maxComponentDepth=n.parseUShort()),t}function makeMaxpTable(r){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:r}])}var maxp={parse:parseMaxpTable,make:makeMaxpTable},nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function getLanguageCode(r,e,t){switch(r){case 0:if(e===65535)return"und";if(t)return t[e];break;case 1:return macLanguages[e];case 3:return windowsLanguages[e]}}var utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function getEncoding(r,e,t){switch(r){case 0:return utf16;case 1:return macLanguageEncodings[t]||macScriptEncodings[e];case 3:if(e===1||e===10)return utf16;break}}function parseNameTable(r,e,t){for(var n={},s=new parse$1.Parser(r,e),i=s.parseUShort(),o=s.parseUShort(),a=s.offset+s.parseUShort(),u=0;u<o;u++){var h=s.parseUShort(),p=s.parseUShort(),m=s.parseUShort(),v=s.parseUShort(),E=nameTableNames[v]||v,x=s.parseUShort(),P=s.parseUShort(),T=getLanguageCode(h,m,t),C=getEncoding(h,p,m);if(C!==void 0&&T!==void 0){var I=void 0;if(C===utf16?I=decode.UTF16(r,a+P,x):I=decode.MACSTRING(r,a+P,x,C),I){var O=n[E];O===void 0&&(O=n[E]={}),O[T]=I}}}return i===1&&s.parseUShort(),n}function reverseDict(r){var e={};for(var t in r)e[r[t]]=parseInt(t);return e}function makeNameRecord(r,e,t,n,s,i){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:r},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:t},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:s},{name:"offset",type:"USHORT",value:i}])}function findSubArray(r,e){var t=r.length,n=e.length-t+1;e:for(var s=0;s<n;s++)for(;s<n;s++){for(var i=0;i<t;i++)if(e[s+i]!==r[i])continue e;return s}return-1}function addStringToPool(r,e){var t=findSubArray(r,e);if(t<0){t=e.length;for(var n=0,s=r.length;n<s;++n)e.push(r[n])}return t}function makeNameTable(r,e){var t,n=[],s={},i=reverseDict(nameTableNames);for(var o in r){var a=i[o];if(a===void 0&&(a=o),t=parseInt(a),isNaN(t))throw new Error('Name table entry "'+o+'" does not exist, see nameTableNames for complete list.');s[t]=r[o],n.push(t)}for(var u=reverseDict(macLanguages),h=reverseDict(windowsLanguages),p=[],m=[],v=0;v<n.length;v++){t=n[v];var E=s[t];for(var x in E){var P=E[x],T=1,C=u[x],I=macLanguageToScript[C],O=getEncoding(T,I,C),G=encode.MACSTRING(P,O);G===void 0&&(T=0,C=e.indexOf(x),C<0&&(C=e.length,e.push(x)),I=4,G=encode.UTF16(P));var F=addStringToPool(G,m);p.push(makeNameRecord(T,I,C,t,G.length,F));var Y=h[x];if(Y!==void 0){var V=encode.UTF16(P),W=addStringToPool(V,m);p.push(makeNameRecord(3,1,Y,t,V.length,W))}}}p.sort(function(J,ge){return J.platformID-ge.platformID||J.encodingID-ge.encodingID||J.languageID-ge.languageID||J.nameID-ge.nameID});for(var q=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:p.length},{name:"stringOffset",type:"USHORT",value:6+p.length*12}]),ce=0;ce<p.length;ce++)q.fields.push({name:"record_"+ce,type:"RECORD",value:p[ce]});return q.fields.push({name:"strings",type:"LITERAL",value:m}),q}var _name={parse:parseNameTable,make:makeNameTable},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(r){for(var e=0;e<unicodeRanges.length;e+=1){var t=unicodeRanges[e];if(r>=t.begin&&r<t.end)return e}return-1}function parseOS2Table(r,e){var t={},n=new parse$1.Parser(r,e);t.version=n.parseUShort(),t.xAvgCharWidth=n.parseShort(),t.usWeightClass=n.parseUShort(),t.usWidthClass=n.parseUShort(),t.fsType=n.parseUShort(),t.ySubscriptXSize=n.parseShort(),t.ySubscriptYSize=n.parseShort(),t.ySubscriptXOffset=n.parseShort(),t.ySubscriptYOffset=n.parseShort(),t.ySuperscriptXSize=n.parseShort(),t.ySuperscriptYSize=n.parseShort(),t.ySuperscriptXOffset=n.parseShort(),t.ySuperscriptYOffset=n.parseShort(),t.yStrikeoutSize=n.parseShort(),t.yStrikeoutPosition=n.parseShort(),t.sFamilyClass=n.parseShort(),t.panose=[];for(var s=0;s<10;s++)t.panose[s]=n.parseByte();return t.ulUnicodeRange1=n.parseULong(),t.ulUnicodeRange2=n.parseULong(),t.ulUnicodeRange3=n.parseULong(),t.ulUnicodeRange4=n.parseULong(),t.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),t.fsSelection=n.parseUShort(),t.usFirstCharIndex=n.parseUShort(),t.usLastCharIndex=n.parseUShort(),t.sTypoAscender=n.parseShort(),t.sTypoDescender=n.parseShort(),t.sTypoLineGap=n.parseShort(),t.usWinAscent=n.parseUShort(),t.usWinDescent=n.parseUShort(),t.version>=1&&(t.ulCodePageRange1=n.parseULong(),t.ulCodePageRange2=n.parseULong()),t.version>=2&&(t.sxHeight=n.parseShort(),t.sCapHeight=n.parseShort(),t.usDefaultChar=n.parseUShort(),t.usBreakChar=n.parseUShort(),t.usMaxContent=n.parseUShort()),t}function makeOS2Table(r){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],r)}var os2={parse:parseOS2Table,make:makeOS2Table,unicodeRanges,getUnicodeRange};function parsePostTable(r,e){var t={},n=new parse$1.Parser(r,e);switch(t.version=n.parseVersion(),t.italicAngle=n.parseFixed(),t.underlinePosition=n.parseShort(),t.underlineThickness=n.parseShort(),t.isFixedPitch=n.parseULong(),t.minMemType42=n.parseULong(),t.maxMemType42=n.parseULong(),t.minMemType1=n.parseULong(),t.maxMemType1=n.parseULong(),t.version){case 1:t.names=standardNames.slice();break;case 2:t.numberOfGlyphs=n.parseUShort(),t.glyphNameIndex=new Array(t.numberOfGlyphs);for(var s=0;s<t.numberOfGlyphs;s++)t.glyphNameIndex[s]=n.parseUShort();t.names=[];for(var i=0;i<t.numberOfGlyphs;i++)if(t.glyphNameIndex[i]>=standardNames.length){var o=n.parseChar();t.names.push(n.parseString(o))}break;case 2.5:t.numberOfGlyphs=n.parseUShort(),t.offset=new Array(t.numberOfGlyphs);for(var a=0;a<t.numberOfGlyphs;a++)t.offset[a]=n.parseChar();break}return t}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var post={parse:parsePostTable,make:makePostTable},subtableParsers=new Array(9);subtableParsers[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),deltaGlyphId:this.parseUShort()};if(t===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),substitute:this.parseOffset16List()};check.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},subtableParsers[2]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),sequences:this.parseListOfLists()}},subtableParsers[3]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),alternateSets:this.parseListOfLists()}},subtableParsers[4]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var lookupRecordDesc={sequenceIndex:Parser.uShort,lookupListIndex:Parser.uShort};subtableParsers[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:t,coverage:this.parsePointer(Parser.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),o=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(o,lookupRecordDesc)}})};if(t===2)return{substFormat:t,coverage:this.parsePointer(Parser.coverage),classDef:this.parsePointer(Parser.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),o=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(o,lookupRecordDesc)}})};if(t===3){var n=this.parseUShort(),s=this.parseUShort();return{substFormat:t,coverages:this.parseList(n,Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(s,lookupRecordDesc)}}check.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},subtableParsers[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(t===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),backtrackClassDef:this.parsePointer(Parser.classDef),inputClassDef:this.parsePointer(Parser.classDef),lookaheadClassDef:this.parsePointer(Parser.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(t===3)return{substFormat:3,backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),inputCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(lookupRecordDesc)};check.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},subtableParsers[7]=function(){var e=this.parseUShort();check.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),n=new Parser(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:subtableParsers[t].call(n)}},subtableParsers[8]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),substitutes:this.parseUShortList()}};function parseGsubTable(r,e){e=e||0;var t=new Parser(r,e),n=t.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(subtableParsers)}:{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(subtableParsers),variations:t.parseFeatureVariationsList()}}var subtableMakers=new Array(9);subtableMakers[1]=function(e){return e.substFormat===1?new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.ushortList("substitute",e.substitute)))},subtableMakers[2]=function(e){return check.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("seqSet",e.sequences,function(t){return new table.Table("sequenceSetTable",table.ushortList("sequence",t))})))},subtableMakers[3]=function(e){return check.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("altSet",e.alternateSets,function(t){return new table.Table("alternateSetTable",table.ushortList("alternate",t))})))},subtableMakers[4]=function(e){return check.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("ligSet",e.ligatureSets,function(t){return new table.Table("ligatureSetTable",table.tableList("ligature",t,function(n){return new table.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(table.ushortList("component",n.components,n.components.length+1)))}))})))},subtableMakers[6]=function(e){if(e.substFormat===1){var t=new table.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("chainRuleSet",e.chainRuleSets,function(i){return new table.Table("chainRuleSetTable",table.tableList("chainRule",i,function(o){var a=table.ushortList("backtrackGlyph",o.backtrack,o.backtrack.length).concat(table.ushortList("inputGlyph",o.input,o.input.length+1)).concat(table.ushortList("lookaheadGlyph",o.lookahead,o.lookahead.length)).concat(table.ushortList("substitution",[],o.lookupRecords.length));return o.lookupRecords.forEach(function(u,h){a=a.concat({name:"sequenceIndex"+h,type:"USHORT",value:u.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:u.lookupListIndex})}),new table.Table("chainRuleTable",a)}))})));return t}else if(e.substFormat===2)check.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,o){n.push({name:"backtrackCoverage"+o,type:"TABLE",value:new table.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,o){n.push({name:"inputCoverage"+o,type:"TABLE",value:new table.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,o){n.push({name:"lookaheadCoverage"+o,type:"TABLE",value:new table.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,o){n=n.concat({name:"sequenceIndex"+o,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+o,type:"USHORT",value:i.lookupListIndex})});var s=new table.Table("chainContextTable",n);return s}check.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function makeGsubTable(r){return new table.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(r.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(r.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(r.lookups,subtableMakers)}])}var gsub={parse:parseGsubTable,make:makeGsubTable};function parseMetaTable(r,e){var t=new parse$1.Parser(r,e),n=t.parseULong();check.argument(n===1,"Unsupported META table version."),t.parseULong(),t.parseULong();for(var s=t.parseULong(),i={},o=0;o<s;o++){var a=t.parseTag(),u=t.parseULong(),h=t.parseULong(),p=decode.UTF8(r,e+u,h);i[a]=p}return i}function makeMetaTable(r){var e=Object.keys(r).length,t="",n=16+e*12,s=new table.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in r){var o=t.length;t+=r[i],s.fields.push({name:"tag "+i,type:"TAG",value:i}),s.fields.push({name:"offset "+i,type:"ULONG",value:n+o}),s.fields.push({name:"length "+i,type:"ULONG",value:r[i].length})}return s.fields.push({name:"stringPool",type:"CHARARRAY",value:t}),s}var meta={parse:parseMetaTable,make:makeMetaTable};function log2(r){return Math.log(r)/Math.log(2)|0}function computeCheckSum(r){for(;r.length%4!==0;)r.push(0);for(var e=0,t=0;t<r.length;t+=4)e+=(r[t]<<24)+(r[t+1]<<16)+(r[t+2]<<8)+r[t+3];return e%=Math.pow(2,32),e}function makeTableRecord(r,e,t,n){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:r!==void 0?r:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:t!==void 0?t:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function makeSfntTable(r){var e=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=r,e.numTables=r.length;var t=Math.pow(2,log2(e.numTables));e.searchRange=16*t,e.entrySelector=log2(t),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],s=[],i=e.sizeOf()+makeTableRecord().sizeOf()*e.numTables;i%4!==0;)i+=1,s.push({name:"padding",type:"BYTE",value:0});for(var o=0;o<r.length;o+=1){var a=r[o];check.argument(a.tableName.length===4,"Table name"+a.tableName+" is invalid.");var u=a.sizeOf(),h=makeTableRecord(a.tableName,computeCheckSum(a.encode()),i,u);for(n.push({name:h.tag+" Table Record",type:"RECORD",value:h}),s.push({name:a.tableName+" table",type:"RECORD",value:a}),i+=u,check.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,s.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(p,m){return p.value.tag>m.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(s),e}function metricsForChar(r,e,t){for(var n=0;n<e.length;n+=1){var s=r.charToGlyphIndex(e[n]);if(s>0){var i=r.glyphs.get(s);return i.getMetrics()}}return t}function average(r){for(var e=0,t=0;t<r.length;t+=1)e+=r[t];return e/r.length}function fontToSfntTable(r){for(var e=[],t=[],n=[],s=[],i=[],o=[],a=[],u,h=0,p=0,m=0,v=0,E=0,x=0;x<r.glyphs.length;x+=1){var P=r.glyphs.get(x),T=P.unicode|0;if(isNaN(P.advanceWidth))throw new Error("Glyph "+P.name+" ("+x+"): advanceWidth is not a number.");(u>T||u===void 0)&&T>0&&(u=T),h<T&&(h=T);var C=os2.getUnicodeRange(T);if(C<32)p|=1<<C;else if(C<64)m|=1<<C-32;else if(C<96)v|=1<<C-64;else if(C<123)E|=1<<C-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(P.name!==".notdef"){var I=P.getMetrics();e.push(I.xMin),t.push(I.yMin),n.push(I.xMax),s.push(I.yMax),o.push(I.leftSideBearing),a.push(I.rightSideBearing),i.push(P.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,t),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:average(i),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,a)};O.ascender=r.ascender,O.descender=r.descender;var G=head.make({flags:3,unitsPerEm:r.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:r.createdTimestamp}),F=hhea.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:r.glyphs.length}),Y=maxp.make(r.glyphs.length),V=os2.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:u,usLastCharIndex:h,ulUnicodeRange1:p,ulUnicodeRange2:m,ulUnicodeRange3:v,ulUnicodeRange4:E,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(r,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:metricsForChar(r,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:r.hasChar(" ")?32:0,usBreakChar:r.hasChar(" ")?32:0},r.tables.os2)),W=hmtx.make(r.glyphs),q=cmap.make(r.glyphs),ce=r.getEnglishName("fontFamily"),J=r.getEnglishName("fontSubfamily"),ge=ce+" "+J,fe=r.getEnglishName("postScriptName");fe||(fe=ce.replace(/\s/g,"")+"-"+J);var Q={};for(var oe in r.names)Q[oe]=r.names[oe];Q.uniqueID||(Q.uniqueID={en:r.getEnglishName("manufacturer")+":"+ge}),Q.postScriptName||(Q.postScriptName={en:fe}),Q.preferredFamily||(Q.preferredFamily=r.names.fontFamily),Q.preferredSubfamily||(Q.preferredSubfamily=r.names.fontSubfamily);var $=[],X=_name.make(Q,$),ae=$.length>0?ltag.make($):void 0,ye=post.make(),xe=cff.make(r.glyphs,{version:r.getEnglishName("version"),fullName:ge,familyName:ce,weightName:J,postScriptName:fe,unitsPerEm:r.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),ue=r.metas&&Object.keys(r.metas).length>0?meta.make(r.metas):void 0,be=[G,F,Y,V,X,q,ye,xe,W];ae&&be.push(ae),r.tables.gsub&&be.push(gsub.make(r.tables.gsub)),ue&&be.push(ue);for(var Bt=makeSfntTable(be),vr=Bt.encode(),jt=computeCheckSum(vr),Ut=Bt.fields,Zt=!1,Xe=0;Xe<Ut.length;Xe+=1)if(Ut[Xe].name==="head table"){Ut[Xe].value.checkSumAdjustment=2981146554-jt,Zt=!0;break}if(!Zt)throw new Error("Could not find head table with checkSum to adjust.");return Bt}var sfnt={make:makeSfntTable,fontToTable:fontToSfntTable,computeCheckSum};function searchTag(r,e){for(var t=0,n=r.length-1;t<=n;){var s=t+n>>>1,i=r[s].tag;if(i===e)return s;i<e?t=s+1:n=s-1}return-t-1}function binSearch(r,e){for(var t=0,n=r.length-1;t<=n;){var s=t+n>>>1,i=r[s];if(i===e)return s;i<e?t=s+1:n=s-1}return-t-1}function searchRange(r,e){for(var t,n=0,s=r.length-1;n<=s;){var i=n+s>>>1;t=r[i];var o=t.start;if(o===e)return t;o<e?n=i+1:s=i-1}if(n>0)return t=r[n-1],e>t.end?0:t}function Layout(r,e){this.font=r,this.tableName=e}Layout.prototype={searchTag,binSearch,getTable:function(r){var e=this.font.tables[this.tableName];return!e&&r&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var r=this.getTable();return r?r.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var r=this.getTable();if(r){for(var e=!1,t=0;t<r.scripts.length;t++){var n=r.scripts[t].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(r,e){var t=this.getTable(e);if(t){r=r||"DFLT";var n=t.scripts,s=searchTag(t.scripts,r);if(s>=0)return n[s].script;if(e){var i={tag:r,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-s,0,i),i.script}}},getLangSysTable:function(r,e,t){var n=this.getScriptTable(r,t);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var s=searchTag(n.langSysRecords,e);if(s>=0)return n.langSysRecords[s].langSys;if(t){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-s,0,i),i.langSys}}},getFeatureTable:function(r,e,t,n){var s=this.getLangSysTable(r,e,n);if(s){for(var i,o=s.featureIndexes,a=this.font.tables[this.tableName].features,u=0;u<o.length;u++)if(i=a[o[u]],i.tag===t)return i.feature;if(n){var h=a.length;return check.assert(h===0||t>=a[h-1].tag,"Features must be added in alphabetical order."),i={tag:t,feature:{params:0,lookupListIndexes:[]}},a.push(i),o.push(h),i.feature}}},getLookupTables:function(r,e,t,n,s){var i=this.getFeatureTable(r,e,t,s),o=[];if(i){for(var a,u=i.lookupListIndexes,h=this.font.tables[this.tableName].lookups,p=0;p<u.length;p++)a=h[u[p]],a.lookupType===n&&o.push(a);if(o.length===0&&s){a={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var m=h.length;return h.push(a),u.push(m),[a]}}return o},getGlyphClass:function(r,e){switch(r.format){case 1:return r.startGlyph<=e&&e<r.startGlyph+r.classes.length?r.classes[e-r.startGlyph]:0;case 2:var t=searchRange(r.ranges,e);return t?t.classId:0}},getCoverageIndex:function(r,e){switch(r.format){case 1:var t=binSearch(r.glyphs,e);return t>=0?t:-1;case 2:var n=searchRange(r.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(r){if(r.format===1)return r.glyphs;for(var e=[],t=r.ranges,n=0;n<t.length;n++)for(var s=t[n],i=s.start,o=s.end,a=i;a<=o;a++)e.push(a);return e}};function Position(r){Layout.call(this,r,"gpos")}Position.prototype=Layout.prototype,Position.prototype.init=function(){var r=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(r)},Position.prototype.getKerningValue=function(r,e,t){for(var n=0;n<r.length;n++)for(var s=r[n].subtables,i=0;i<s.length;i++){var o=s[i],a=this.getCoverageIndex(o.coverage,e);if(!(a<0))switch(o.posFormat){case 1:for(var u=o.pairSets[a],h=0;h<u.length;h++){var p=u[h];if(p.secondGlyph===t)return p.value1&&p.value1.xAdvance||0}break;case 2:var m=this.getGlyphClass(o.classDef1,e),v=this.getGlyphClass(o.classDef2,t),E=o.classRecords[m][v];return E.value1&&E.value1.xAdvance||0}}return 0},Position.prototype.getKerningTables=function(r,e){if(this.font.tables.gpos)return this.getLookupTables(r,e,"kern",2)};function Substitution(r){Layout.call(this,r,"gsub")}function arraysEqual(r,e){var t=r.length;if(t!==e.length)return!1;for(var n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}function getSubstFormat(r,e,t){for(var n=r.subtables,s=0;s<n.length;s++){var i=n[s];if(i.substFormat===e)return i}if(t)return n.push(t),t}Substitution.prototype=Layout.prototype,Substitution.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Substitution.prototype.getSingle=function(r,e,t){for(var n=[],s=this.getLookupTables(e,t,r,1),i=0;i<s.length;i++)for(var o=s[i].subtables,a=0;a<o.length;a++){var u=o[a],h=this.expandCoverage(u.coverage),p=void 0;if(u.substFormat===1){var m=u.deltaGlyphId;for(p=0;p<h.length;p++){var v=h[p];n.push({sub:v,by:v+m})}}else{var E=u.substitute;for(p=0;p<h.length;p++)n.push({sub:h[p],by:E[p]})}}return n},Substitution.prototype.getMultiple=function(r,e,t){for(var n=[],s=this.getLookupTables(e,t,r,2),i=0;i<s.length;i++)for(var o=s[i].subtables,a=0;a<o.length;a++){var u=o[a],h=this.expandCoverage(u.coverage),p=void 0;for(p=0;p<h.length;p++){var m=h[p],v=u.sequences[p];n.push({sub:m,by:v})}}return n},Substitution.prototype.getAlternates=function(r,e,t){for(var n=[],s=this.getLookupTables(e,t,r,3),i=0;i<s.length;i++)for(var o=s[i].subtables,a=0;a<o.length;a++)for(var u=o[a],h=this.expandCoverage(u.coverage),p=u.alternateSets,m=0;m<h.length;m++)n.push({sub:h[m],by:p[m]});return n},Substitution.prototype.getLigatures=function(r,e,t){for(var n=[],s=this.getLookupTables(e,t,r,4),i=0;i<s.length;i++)for(var o=s[i].subtables,a=0;a<o.length;a++)for(var u=o[a],h=this.expandCoverage(u.coverage),p=u.ligatureSets,m=0;m<h.length;m++)for(var v=h[m],E=p[m],x=0;x<E.length;x++){var P=E[x];n.push({sub:[v].concat(P.components),by:P.ligGlyph})}return n},Substitution.prototype.addSingle=function(r,e,t,n){var s=this.getLookupTables(t,n,r,1,!0)[0],i=getSubstFormat(s,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});check.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var o=e.sub,a=this.binSearch(i.coverage.glyphs,o);a<0&&(a=-1-a,i.coverage.glyphs.splice(a,0,o),i.substitute.splice(a,0,0)),i.substitute[a]=e.by},Substitution.prototype.addMultiple=function(r,e,t,n){check.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var s=this.getLookupTables(t,n,r,2,!0)[0],i=getSubstFormat(s,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});check.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var o=e.sub,a=this.binSearch(i.coverage.glyphs,o);a<0&&(a=-1-a,i.coverage.glyphs.splice(a,0,o),i.sequences.splice(a,0,0)),i.sequences[a]=e.by},Substitution.prototype.addAlternate=function(r,e,t,n){var s=this.getLookupTables(t,n,r,3,!0)[0],i=getSubstFormat(s,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});check.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var o=e.sub,a=this.binSearch(i.coverage.glyphs,o);a<0&&(a=-1-a,i.coverage.glyphs.splice(a,0,o),i.alternateSets.splice(a,0,0)),i.alternateSets[a]=e.by},Substitution.prototype.addLigature=function(r,e,t,n){var s=this.getLookupTables(t,n,r,4,!0)[0],i=s.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},s.subtables[0]=i),check.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var o=e.sub[0],a=e.sub.slice(1),u={ligGlyph:e.by,components:a},h=this.binSearch(i.coverage.glyphs,o);if(h>=0){for(var p=i.ligatureSets[h],m=0;m<p.length;m++)if(arraysEqual(p[m].components,a))return;p.push(u)}else h=-1-h,i.coverage.glyphs.splice(h,0,o),i.ligatureSets.splice(h,0,[u])},Substitution.prototype.getFeature=function(r,e,t){if(/ss\d\d/.test(r))return this.getSingle(r,e,t);switch(r){case"aalt":case"salt":return this.getSingle(r,e,t).concat(this.getAlternates(r,e,t));case"dlig":case"liga":case"rlig":return this.getLigatures(r,e,t);case"ccmp":return this.getMultiple(r,e,t).concat(this.getLigatures(r,e,t));case"stch":return this.getMultiple(r,e,t)}},Substitution.prototype.add=function(r,e,t,n){if(/ss\d\d/.test(r))return this.addSingle(r,e,t,n);switch(r){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(r,e,t,n):this.addAlternate(r,e,t,n);case"dlig":case"liga":case"rlig":return this.addLigature(r,e,t,n);case"ccmp":return e.by instanceof Array?this.addMultiple(r,e,t,n):this.addLigature(r,e,t,n)}};function isBrowser(){return typeof window<"u"}function nodeBufferToArrayBuffer(r){for(var e=new ArrayBuffer(r.length),t=new Uint8Array(e),n=0;n<r.length;++n)t[n]=r[n];return e}function arrayBufferToNodeBuffer(r){for(var e=new Buffer(r.byteLength),t=new Uint8Array(r),n=0;n<e.length;++n)e[n]=t[n];return e}function checkArgument(r,e){if(!r)throw e}function parseGlyphCoordinate(r,e,t,n,s){var i;return(e&n)>0?(i=r.parseByte(),e&s||(i=-i),i=t+i):(e&s)>0?i=t:i=t+r.parseShort(),i}function parseGlyph(r,e,t){var n=new parse$1.Parser(e,t);r.numberOfContours=n.parseShort(),r._xMin=n.parseShort(),r._yMin=n.parseShort(),r._xMax=n.parseShort(),r._yMax=n.parseShort();var s,i;if(r.numberOfContours>0){for(var o=r.endPointIndices=[],a=0;a<r.numberOfContours;a+=1)o.push(n.parseUShort());r.instructionLength=n.parseUShort(),r.instructions=[];for(var u=0;u<r.instructionLength;u+=1)r.instructions.push(n.parseByte());var h=o[o.length-1]+1;s=[];for(var p=0;p<h;p+=1)if(i=n.parseByte(),s.push(i),(i&8)>0)for(var m=n.parseByte(),v=0;v<m;v+=1)s.push(i),p+=1;if(check.argument(s.length===h,"Bad flags."),o.length>0){var E=[],x;if(h>0){for(var P=0;P<h;P+=1)i=s[P],x={},x.onCurve=!!(i&1),x.lastPointOfContour=o.indexOf(P)>=0,E.push(x);for(var T=0,C=0;C<h;C+=1)i=s[C],x=E[C],x.x=parseGlyphCoordinate(n,i,T,2,16),T=x.x;for(var I=0,O=0;O<h;O+=1)i=s[O],x=E[O],x.y=parseGlyphCoordinate(n,i,I,4,32),I=x.y}r.points=E}else r.points=[]}else if(r.numberOfContours===0)r.points=[];else{r.isComposite=!0,r.points=[],r.components=[];for(var G=!0;G;){s=n.parseUShort();var F={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(s&1)>0?(s&2)>0?(F.dx=n.parseShort(),F.dy=n.parseShort()):F.matchedPoints=[n.parseUShort(),n.parseUShort()]:(s&2)>0?(F.dx=n.parseChar(),F.dy=n.parseChar()):F.matchedPoints=[n.parseByte(),n.parseByte()],(s&8)>0?F.xScale=F.yScale=n.parseF2Dot14():(s&64)>0?(F.xScale=n.parseF2Dot14(),F.yScale=n.parseF2Dot14()):(s&128)>0&&(F.xScale=n.parseF2Dot14(),F.scale01=n.parseF2Dot14(),F.scale10=n.parseF2Dot14(),F.yScale=n.parseF2Dot14()),r.components.push(F),G=!!(s&32)}if(s&256){r.instructionLength=n.parseUShort(),r.instructions=[];for(var Y=0;Y<r.instructionLength;Y+=1)r.instructions.push(n.parseByte())}}}function transformPoints(r,e){for(var t=[],n=0;n<r.length;n+=1){var s=r[n],i={x:e.xScale*s.x+e.scale01*s.y+e.dx,y:e.scale10*s.x+e.yScale*s.y+e.dy,onCurve:s.onCurve,lastPointOfContour:s.lastPointOfContour};t.push(i)}return t}function getContours(r){for(var e=[],t=[],n=0;n<r.length;n+=1){var s=r[n];t.push(s),s.lastPointOfContour&&(e.push(t),t=[])}return check.argument(t.length===0,"There are still points left in the current contour."),e}function getPath(r){var e=new Path;if(!r)return e;for(var t=getContours(r),n=0;n<t.length;++n){var s=t[n],i=null,o=s[s.length-1],a=s[0];if(o.onCurve)e.moveTo(o.x,o.y);else if(a.onCurve)e.moveTo(a.x,a.y);else{var u={x:(o.x+a.x)*.5,y:(o.y+a.y)*.5};e.moveTo(u.x,u.y)}for(var h=0;h<s.length;++h)if(i=o,o=a,a=s[(h+1)%s.length],o.onCurve)e.lineTo(o.x,o.y);else{var p=a;i.onCurve||((o.x+i.x)*.5,(o.y+i.y)*.5),a.onCurve||(p={x:(o.x+a.x)*.5,y:(o.y+a.y)*.5}),e.quadraticCurveTo(o.x,o.y,p.x,p.y)}e.closePath()}return e}function buildPath(r,e){if(e.isComposite)for(var t=0;t<e.components.length;t+=1){var n=e.components[t],s=r.get(n.glyphIndex);if(s.getPath(),s.points){var i=void 0;if(n.matchedPoints===void 0)i=transformPoints(s.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>s.points.length-1)throw Error("Matched points out of range in "+e.name);var o=e.points[n.matchedPoints[0]],a=s.points[n.matchedPoints[1]],u={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};a=transformPoints([a],u)[0],u.dx=o.x-a.x,u.dy=o.y-a.y,i=transformPoints(s.points,u)}e.points=e.points.concat(i)}}return getPath(e.points)}function parseGlyfTableAll(r,e,t,n){for(var s=new glyphset.GlyphSet(n),i=0;i<t.length-1;i+=1){var o=t[i],a=t[i+1];o!==a?s.push(i,glyphset.ttfGlyphLoader(n,i,parseGlyph,r,e+o,buildPath)):s.push(i,glyphset.glyphLoader(n,i))}return s}function parseGlyfTableOnLowMemory(r,e,t,n){var s=new glyphset.GlyphSet(n);return n._push=function(i){var o=t[i],a=t[i+1];o!==a?s.push(i,glyphset.ttfGlyphLoader(n,i,parseGlyph,r,e+o,buildPath)):s.push(i,glyphset.glyphLoader(n,i))},s}function parseGlyfTable(r,e,t,n,s){return s.lowMemory?parseGlyfTableOnLowMemory(r,e,t,n):parseGlyfTableAll(r,e,t,n)}var glyf={getPath,parse:parseGlyfTable},instructionTable,exec,execGlyph,execComponent;function Hinting(r){this.font=r,this.getCommands=function(e){return glyf.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function roundOff(r){return r}function roundToGrid(r){return Math.sign(r)*Math.round(Math.abs(r))}function roundToDoubleGrid(r){return Math.sign(r)*Math.round(Math.abs(r*2))/2}function roundToHalfGrid(r){return Math.sign(r)*(Math.round(Math.abs(r)+.5)-.5)}function roundUpToGrid(r){return Math.sign(r)*Math.ceil(Math.abs(r))}function roundDownToGrid(r){return Math.sign(r)*Math.floor(Math.abs(r))}var roundSuper=function(r){var e=this.srPeriod,t=this.srPhase,n=this.srThreshold,s=1;return r<0&&(r=-r,s=-1),r+=n-t,r=Math.trunc(r/e)*e,r+=t,r<0?t*s:r*s},xUnitVector={x:1,y:0,axis:"x",distance:function(r,e,t,n){return(t?r.xo:r.x)-(n?e.xo:e.x)},interpolate:function(r,e,t,n){var s,i,o,a,u,h,p;if(!n||n===this){if(s=r.xo-e.xo,i=r.xo-t.xo,u=e.x-e.xo,h=t.x-t.xo,o=Math.abs(s),a=Math.abs(i),p=o+a,p===0){r.x=r.xo+(u+h)/2;return}r.x=r.xo+(u*a+h*o)/p;return}if(s=n.distance(r,e,!0,!0),i=n.distance(r,t,!0,!0),u=n.distance(e,e,!1,!0),h=n.distance(t,t,!1,!0),o=Math.abs(s),a=Math.abs(i),p=o+a,p===0){xUnitVector.setRelative(r,r,(u+h)/2,n,!0);return}xUnitVector.setRelative(r,r,(u*a+h*o)/p,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(r,e,t,n,s){if(!n||n===this){r.x=(s?e.xo:e.x)+t;return}var i=s?e.xo:e.x,o=s?e.yo:e.y,a=i+t*n.x,u=o+t*n.y;r.x=a+(r.y-u)/n.normalSlope},slope:0,touch:function(r){r.xTouched=!0},touched:function(r){return r.xTouched},untouch:function(r){r.xTouched=!1}},yUnitVector={x:0,y:1,axis:"y",distance:function(r,e,t,n){return(t?r.yo:r.y)-(n?e.yo:e.y)},interpolate:function(r,e,t,n){var s,i,o,a,u,h,p;if(!n||n===this){if(s=r.yo-e.yo,i=r.yo-t.yo,u=e.y-e.yo,h=t.y-t.yo,o=Math.abs(s),a=Math.abs(i),p=o+a,p===0){r.y=r.yo+(u+h)/2;return}r.y=r.yo+(u*a+h*o)/p;return}if(s=n.distance(r,e,!0,!0),i=n.distance(r,t,!0,!0),u=n.distance(e,e,!1,!0),h=n.distance(t,t,!1,!0),o=Math.abs(s),a=Math.abs(i),p=o+a,p===0){yUnitVector.setRelative(r,r,(u+h)/2,n,!0);return}yUnitVector.setRelative(r,r,(u*a+h*o)/p,n,!0)},normalSlope:0,setRelative:function(r,e,t,n,s){if(!n||n===this){r.y=(s?e.yo:e.y)+t;return}var i=s?e.xo:e.x,o=s?e.yo:e.y,a=i+t*n.x,u=o+t*n.y;r.y=u+n.normalSlope*(r.x-a)},slope:Number.POSITIVE_INFINITY,touch:function(r){r.yTouched=!0},touched:function(r){return r.yTouched},untouch:function(r){r.yTouched=!1}};Object.freeze(xUnitVector),Object.freeze(yUnitVector);function UnitVector(r,e){this.x=r,this.y=e,this.axis=void 0,this.slope=e/r,this.normalSlope=-r/e,Object.freeze(this)}UnitVector.prototype.distance=function(r,e,t,n){return this.x*xUnitVector.distance(r,e,t,n)+this.y*yUnitVector.distance(r,e,t,n)},UnitVector.prototype.interpolate=function(r,e,t,n){var s,i,o,a,u,h,p;if(o=n.distance(r,e,!0,!0),a=n.distance(r,t,!0,!0),s=n.distance(e,e,!1,!0),i=n.distance(t,t,!1,!0),u=Math.abs(o),h=Math.abs(a),p=u+h,p===0){this.setRelative(r,r,(s+i)/2,n,!0);return}this.setRelative(r,r,(s*h+i*u)/p,n,!0)},UnitVector.prototype.setRelative=function(r,e,t,n,s){n=n||this;var i=s?e.xo:e.x,o=s?e.yo:e.y,a=i+t*n.x,u=o+t*n.y,h=n.normalSlope,p=this.slope,m=r.x,v=r.y;r.x=(p*m-h*a+u-v)/(p-h),r.y=p*(r.x-m)+v},UnitVector.prototype.touch=function(r){r.xTouched=!0,r.yTouched=!0};function getUnitVector(r,e){var t=Math.sqrt(r*r+e*e);return r/=t,e/=t,r===1&&e===0?xUnitVector:r===0&&e===1?yUnitVector:new UnitVector(r,e)}function HPoint(r,e,t,n){this.x=this.xo=Math.round(r*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=t,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}HPoint.prototype.nextTouched=function(r){for(var e=this.nextPointOnContour;!r.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},HPoint.prototype.prevTouched=function(r){for(var e=this.prevPointOnContour;!r.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var HPZero=Object.freeze(new HPoint(0,0)),defaultState={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function State(r,e){switch(this.env=r,this.stack=[],this.prog=e,r){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xUnitVector,this.round=roundToGrid}}Hinting.prototype.exec=function(r,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var t=this.font,n=this._prepState;if(!n||n.ppem!==e){var s=this._fpgmState;if(!s){State.prototype=defaultState,s=this._fpgmState=new State("fpgm",t.tables.fpgm),s.funcs=[],s.font=t,exports.DEBUG&&(console.log("---EXEC FPGM---"),s.step=-1);try{exec(s)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}State.prototype=s,n=this._prepState=new State("prep",t.tables.prep),n.ppem=e;var i=t.tables.cvt;if(i)for(var o=n.cvt=new Array(i.length),a=e/t.unitsPerEm,u=0;u<i.length;u++)o[u]=i[u]*a;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{exec(n)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return execGlyph(r,n)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},execGlyph=function(r,e){var t=e.ppem/e.font.unitsPerEm,n=t,s=r.components,i,o,a;if(State.prototype=e,!s)a=new State("glyf",r.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),a.step=-1),execComponent(r,a,t,n),o=a.gZone;else{var u=e.font;o=[],i=[];for(var h=0;h<s.length;h++){var p=s[h],m=u.glyphs.get(p.glyphIndex);a=new State("glyf",m.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+h+"---"),a.step=-1),execComponent(m,a,t,n);for(var v=Math.round(p.dx*t),E=Math.round(p.dy*n),x=a.gZone,P=a.contours,T=0;T<x.length;T++){var C=x[T];C.xTouched=C.yTouched=!1,C.xo=C.x=C.x+v,C.yo=C.y=C.y+E}var I=o.length;o.push.apply(o,x);for(var O=0;O<P.length;O++)i.push(P[O]+I)}r.instructions&&!a.inhibitGridFit&&(a=new State("glyf",r.instructions),a.gZone=a.z0=a.z1=a.z2=o,a.contours=i,o.push(new HPoint(0,0),new HPoint(Math.round(r.advanceWidth*t),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),a.step=-1),exec(a),o.length-=2)}return o},execComponent=function(r,e,t,n){for(var s=r.points||[],i=s.length,o=e.gZone=e.z0=e.z1=e.z2=[],a=e.contours=[],u,h=0;h<i;h++)u=s[h],o[h]=new HPoint(u.x*t,u.y*n,u.lastPointOfContour,u.onCurve);for(var p,m,v=0;v<i;v++)u=o[v],p||(p=u,a.push(v)),u.lastPointOfContour?(u.nextPointOnContour=p,p.prevPointOnContour=u,p=void 0):(m=o[v+1],u.nextPointOnContour=m,m.prevPointOnContour=u);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var E=0;E<i;E++)console.log(E,o[E].x,o[E].y)}if(o.push(new HPoint(0,0),new HPoint(Math.round(r.advanceWidth*t),0)),exec(e),o.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var x=0;x<i;x++)console.log(x,o[x].x,o[x].y)}}},exec=function(r){var e=r.prog;if(e){var t=e.length,n;for(r.ip=0;r.ip<t;r.ip++){if(exports.DEBUG&&r.step++,n=instructionTable[e[r.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[r.ip]).toString(16));n(r)}}};function initTZone(r){for(var e=r.tZone=new Array(r.gZone.length),t=0;t<e.length;t++)e[t]=new HPoint(0,0)}function skip(r,e){var t=r.prog,n=r.ip,s=1,i;do if(i=t[++n],i===88)s++;else if(i===89)s--;else if(i===64)n+=t[n+1]+1;else if(i===65)n+=2*t[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&s===1&&i===27)break;while(s>0);r.ip=n}function SVTCA(r,e){exports.DEBUG&&console.log(e.step,"SVTCA["+r.axis+"]"),e.fv=e.pv=e.dpv=r}function SPVTCA(r,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+r.axis+"]"),e.pv=e.dpv=r}function SFVTCA(r,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+r.axis+"]"),e.fv=r}function SPVTL(r,e){var t=e.stack,n=t.pop(),s=t.pop(),i=e.z2[n],o=e.z1[s];exports.DEBUG&&console.log("SPVTL["+r+"]",n,s);var a,u;r?(a=i.y-o.y,u=o.x-i.x):(a=o.x-i.x,u=o.y-i.y),e.pv=e.dpv=getUnitVector(a,u)}function SFVTL(r,e){var t=e.stack,n=t.pop(),s=t.pop(),i=e.z2[n],o=e.z1[s];exports.DEBUG&&console.log("SFVTL["+r+"]",n,s);var a,u;r?(a=i.y-o.y,u=o.x-i.x):(a=o.x-i.x,u=o.y-i.y),e.fv=getUnitVector(a,u)}function SPVFS(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"SPVFS[]",t,n),r.pv=r.dpv=getUnitVector(n,t)}function SFVFS(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"SPVFS[]",t,n),r.fv=getUnitVector(n,t)}function GPV(r){var e=r.stack,t=r.pv;exports.DEBUG&&console.log(r.step,"GPV[]"),e.push(t.x*16384),e.push(t.y*16384)}function GFV(r){var e=r.stack,t=r.fv;exports.DEBUG&&console.log(r.step,"GFV[]"),e.push(t.x*16384),e.push(t.y*16384)}function SFVTPV(r){r.fv=r.pv,exports.DEBUG&&console.log(r.step,"SFVTPV[]")}function ISECT(r){var e=r.stack,t=e.pop(),n=e.pop(),s=e.pop(),i=e.pop(),o=e.pop(),a=r.z0,u=r.z1,h=a[t],p=a[n],m=u[s],v=u[i],E=r.z2[o];exports.DEBUG&&console.log("ISECT[], ",t,n,s,i,o);var x=h.x,P=h.y,T=p.x,C=p.y,I=m.x,O=m.y,G=v.x,F=v.y,Y=(x-T)*(O-F)-(P-C)*(I-G),V=x*C-P*T,W=I*F-O*G;E.x=(V*(I-G)-W*(x-T))/Y,E.y=(V*(O-F)-W*(P-C))/Y}function SRP0(r){r.rp0=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SRP0[]",r.rp0)}function SRP1(r){r.rp1=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SRP1[]",r.rp1)}function SRP2(r){r.rp2=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SRP2[]",r.rp2)}function SZP0(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZP0[]",e),r.zp0=e,e){case 0:r.tZone||initTZone(r),r.z0=r.tZone;break;case 1:r.z0=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP1(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZP1[]",e),r.zp1=e,e){case 0:r.tZone||initTZone(r),r.z1=r.tZone;break;case 1:r.z1=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP2(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZP2[]",e),r.zp2=e,e){case 0:r.tZone||initTZone(r),r.z2=r.tZone;break;case 1:r.z2=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZPS(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZPS[]",e),r.zp0=r.zp1=r.zp2=e,e){case 0:r.tZone||initTZone(r),r.z0=r.z1=r.z2=r.tZone;break;case 1:r.z0=r.z1=r.z2=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function SLOOP(r){r.loop=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SLOOP[]",r.loop)}function RTG(r){exports.DEBUG&&console.log(r.step,"RTG[]"),r.round=roundToGrid}function RTHG(r){exports.DEBUG&&console.log(r.step,"RTHG[]"),r.round=roundToHalfGrid}function SMD(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SMD[]",e),r.minDis=e/64}function ELSE(r){exports.DEBUG&&console.log(r.step,"ELSE[]"),skip(r,!1)}function JMPR(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"JMPR[]",e),r.ip+=e-1}function SCVTCI(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SCVTCI[]",e),r.cvCutIn=e/64}function DUP(r){var e=r.stack;exports.DEBUG&&console.log(r.step,"DUP[]"),e.push(e[e.length-1])}function POP(r){exports.DEBUG&&console.log(r.step,"POP[]"),r.stack.pop()}function CLEAR(r){exports.DEBUG&&console.log(r.step,"CLEAR[]"),r.stack.length=0}function SWAP(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"SWAP[]"),e.push(t),e.push(n)}function DEPTH(r){var e=r.stack;exports.DEBUG&&console.log(r.step,"DEPTH[]"),e.push(e.length)}function LOOPCALL(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"LOOPCALL[]",t,n);var s=r.ip,i=r.prog;r.prog=r.funcs[t];for(var o=0;o<n;o++)exec(r),exports.DEBUG&&console.log(++r.step,o+1<n?"next loopcall":"done loopcall",o);r.ip=s,r.prog=i}function CALL(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"CALL[]",e);var t=r.ip,n=r.prog;r.prog=r.funcs[e],exec(r),r.ip=t,r.prog=n,exports.DEBUG&&console.log(++r.step,"returning from",e)}function CINDEX(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"CINDEX[]",t),e.push(e[e.length-t])}function MINDEX(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"MINDEX[]",t),e.push(e.splice(e.length-t,1)[0])}function FDEF(r){if(r.env!=="fpgm")throw new Error("FDEF not allowed here");var e=r.stack,t=r.prog,n=r.ip,s=e.pop(),i=n;for(exports.DEBUG&&console.log(r.step,"FDEF[]",s);t[++n]!==45;);r.ip=n,r.funcs[s]=t.slice(i+1,n)}function MDAP(r,e){var t=e.stack.pop(),n=e.z0[t],s=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+r+"]",t);var o=i.distance(n,HPZero);r&&(o=e.round(o)),s.setRelative(n,HPZero,o,i),s.touch(n),e.rp0=e.rp1=t}function IUP(r,e){var t=e.z2,n=t.length-2,s,i,o;exports.DEBUG&&console.log(e.step,"IUP["+r.axis+"]");for(var a=0;a<n;a++)s=t[a],!r.touched(s)&&(i=s.prevTouched(r),i!==s&&(o=s.nextTouched(r),i===o&&r.setRelative(s,s,r.distance(i,i,!1,!0),r,!0),r.interpolate(s,i,o,r)))}function SHP(r,e){for(var t=e.stack,n=r?e.rp1:e.rp2,s=(r?e.z0:e.z1)[n],i=e.fv,o=e.pv,a=e.loop,u=e.z2;a--;){var h=t.pop(),p=u[h],m=o.distance(s,s,!1,!0);i.setRelative(p,p,m,o),i.touch(p),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-a)+": ":"")+"SHP["+(r?"rp1":"rp2")+"]",h)}e.loop=1}function SHC(r,e){var t=e.stack,n=r?e.rp1:e.rp2,s=(r?e.z0:e.z1)[n],i=e.fv,o=e.pv,a=t.pop(),u=e.z2[e.contours[a]],h=u;exports.DEBUG&&console.log(e.step,"SHC["+r+"]",a);var p=o.distance(s,s,!1,!0);do h!==s&&i.setRelative(h,h,p,o),h=h.nextPointOnContour;while(h!==u)}function SHZ(r,e){var t=e.stack,n=r?e.rp1:e.rp2,s=(r?e.z0:e.z1)[n],i=e.fv,o=e.pv,a=t.pop();exports.DEBUG&&console.log(e.step,"SHZ["+r+"]",a);var u;switch(a){case 0:u=e.tZone;break;case 1:u=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,p=o.distance(s,s,!1,!0),m=u.length-2,v=0;v<m;v++)h=u[v],i.setRelative(h,h,p,o)}function SHPIX(r){for(var e=r.stack,t=r.loop,n=r.fv,s=e.pop()/64,i=r.z2;t--;){var o=e.pop(),a=i[o];exports.DEBUG&&console.log(r.step,(r.loop>1?"loop "+(r.loop-t)+": ":"")+"SHPIX[]",o,s),n.setRelative(a,a,s),n.touch(a)}r.loop=1}function IP(r){for(var e=r.stack,t=r.rp1,n=r.rp2,s=r.loop,i=r.z0[t],o=r.z1[n],a=r.fv,u=r.dpv,h=r.z2;s--;){var p=e.pop(),m=h[p];exports.DEBUG&&console.log(r.step,(r.loop>1?"loop "+(r.loop-s)+": ":"")+"IP[]",p,t,"<->",n),a.interpolate(m,i,o,u),a.touch(m)}r.loop=1}function MSIRP(r,e){var t=e.stack,n=t.pop()/64,s=t.pop(),i=e.z1[s],o=e.z0[e.rp0],a=e.fv,u=e.pv;a.setRelative(i,o,n,u),a.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+r+"]",n,s),e.rp1=e.rp0,e.rp2=s,r&&(e.rp0=s)}function ALIGNRP(r){for(var e=r.stack,t=r.rp0,n=r.z0[t],s=r.loop,i=r.fv,o=r.pv,a=r.z1;s--;){var u=e.pop(),h=a[u];exports.DEBUG&&console.log(r.step,(r.loop>1?"loop "+(r.loop-s)+": ":"")+"ALIGNRP[]",u),i.setRelative(h,n,0,o),i.touch(h)}r.loop=1}function RTDG(r){exports.DEBUG&&console.log(r.step,"RTDG[]"),r.round=roundToDoubleGrid}function MIAP(r,e){var t=e.stack,n=t.pop(),s=t.pop(),i=e.z0[s],o=e.fv,a=e.pv,u=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+r+"]",n,"(",u,")",s);var h=a.distance(i,HPZero);r&&(Math.abs(h-u)<e.cvCutIn&&(h=u),h=e.round(h)),o.setRelative(i,HPZero,h,a),e.zp0===0&&(i.xo=i.x,i.yo=i.y),o.touch(i),e.rp0=e.rp1=s}function NPUSHB(r){var e=r.prog,t=r.ip,n=r.stack,s=e[++t];exports.DEBUG&&console.log(r.step,"NPUSHB[]",s);for(var i=0;i<s;i++)n.push(e[++t]);r.ip=t}function NPUSHW(r){var e=r.ip,t=r.prog,n=r.stack,s=t[++e];exports.DEBUG&&console.log(r.step,"NPUSHW[]",s);for(var i=0;i<s;i++){var o=t[++e]<<8|t[++e];o&32768&&(o=-((o^65535)+1)),n.push(o)}r.ip=e}function WS(r){var e=r.stack,t=r.store;t||(t=r.store=[]);var n=e.pop(),s=e.pop();exports.DEBUG&&console.log(r.step,"WS",n,s),t[s]=n}function RS(r){var e=r.stack,t=r.store,n=e.pop();exports.DEBUG&&console.log(r.step,"RS",n);var s=t&&t[n]||0;e.push(s)}function WCVTP(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"WCVTP",t,n),r.cvt[n]=t/64}function RCVT(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"RCVT",t),e.push(r.cvt[t]*64)}function GC(r,e){var t=e.stack,n=t.pop(),s=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+r+"]",n),t.push(e.dpv.distance(s,HPZero,r,!1)*64)}function MD(r,e){var t=e.stack,n=t.pop(),s=t.pop(),i=e.z1[n],o=e.z0[s],a=e.dpv.distance(o,i,r,r);exports.DEBUG&&console.log(e.step,"MD["+r+"]",n,s,"->",a),e.stack.push(Math.round(a*64))}function MPPEM(r){exports.DEBUG&&console.log(r.step,"MPPEM[]"),r.stack.push(r.ppem)}function FLIPON(r){exports.DEBUG&&console.log(r.step,"FLIPON[]"),r.autoFlip=!0}function LT(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"LT[]",t,n),e.push(n<t?1:0)}function LTEQ(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"LTEQ[]",t,n),e.push(n<=t?1:0)}function GT(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"GT[]",t,n),e.push(n>t?1:0)}function GTEQ(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"GTEQ[]",t,n),e.push(n>=t?1:0)}function EQ(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"EQ[]",t,n),e.push(t===n?1:0)}function NEQ(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"NEQ[]",t,n),e.push(t!==n?1:0)}function ODD(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"ODD[]",t),e.push(Math.trunc(t)%2?1:0)}function EVEN(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"EVEN[]",t),e.push(Math.trunc(t)%2?0:1)}function IF(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"IF[]",e),e||(skip(r,!0),exports.DEBUG&&console.log(r.step,"EIF[]"))}function EIF(r){exports.DEBUG&&console.log(r.step,"EIF[]")}function AND(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"AND[]",t,n),e.push(t&&n?1:0)}function OR(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"OR[]",t,n),e.push(t||n?1:0)}function NOT(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"NOT[]",t),e.push(t?0:1)}function DELTAP123(r,e){var t=e.stack,n=t.pop(),s=e.fv,i=e.pv,o=e.ppem,a=e.deltaBase+(r-1)*16,u=e.deltaShift,h=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+r+"]",n,t);for(var p=0;p<n;p++){var m=t.pop(),v=t.pop(),E=a+((v&240)>>4);if(E===o){var x=(v&15)-8;x>=0&&x++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",m,"by",x*u);var P=h[m];s.setRelative(P,P,x*u,i)}}}function SDB(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"SDB[]",t),r.deltaBase=t}function SDS(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"SDS[]",t),r.deltaShift=Math.pow(.5,t)}function ADD(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"ADD[]",t,n),e.push(n+t)}function SUB(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"SUB[]",t,n),e.push(n-t)}function DIV(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"DIV[]",t,n),e.push(n*64/t)}function MUL(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"MUL[]",t,n),e.push(n*t/64)}function ABS(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"ABS[]",t),e.push(Math.abs(t))}function NEG(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"NEG[]",t),e.push(-t)}function FLOOR(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"FLOOR[]",t),e.push(Math.floor(t/64)*64)}function CEILING(r){var e=r.stack,t=e.pop();exports.DEBUG&&console.log(r.step,"CEILING[]",t),e.push(Math.ceil(t/64)*64)}function ROUND(r,e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),t.push(e.round(n/64)*64)}function WCVTF(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"WCVTF[]",t,n),r.cvt[n]=t*r.ppem/r.font.unitsPerEm}function DELTAC123(r,e){var t=e.stack,n=t.pop(),s=e.ppem,i=e.deltaBase+(r-1)*16,o=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+r+"]",n,t);for(var a=0;a<n;a++){var u=t.pop(),h=t.pop(),p=i+((h&240)>>4);if(p===s){var m=(h&15)-8;m>=0&&m++;var v=m*o;exports.DEBUG&&console.log(e.step,"DELTACFIX",u,"by",v),e.cvt[u]+=v}}}function SROUND(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SROUND[]",e),r.round=roundSuper;var t;switch(e&192){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(r.srPeriod=t,e&48){case 0:r.srPhase=0;break;case 16:r.srPhase=.25*t;break;case 32:r.srPhase=.5*t;break;case 48:r.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?r.srThreshold=0:r.srThreshold=(e/8-.5)*t}function S45ROUND(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"S45ROUND[]",e),r.round=roundSuper;var t;switch(e&192){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(r.srPeriod=t,e&48){case 0:r.srPhase=0;break;case 16:r.srPhase=.25*t;break;case 32:r.srPhase=.5*t;break;case 48:r.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?r.srThreshold=0:r.srThreshold=(e/8-.5)*t}function ROFF(r){exports.DEBUG&&console.log(r.step,"ROFF[]"),r.round=roundOff}function RUTG(r){exports.DEBUG&&console.log(r.step,"RUTG[]"),r.round=roundUpToGrid}function RDTG(r){exports.DEBUG&&console.log(r.step,"RDTG[]"),r.round=roundDownToGrid}function SCANCTRL(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SCANCTRL[]",e)}function SDPVTL(r,e){var t=e.stack,n=t.pop(),s=t.pop(),i=e.z2[n],o=e.z1[s];exports.DEBUG&&console.log(e.step,"SDPVTL["+r+"]",n,s);var a,u;r?(a=i.y-o.y,u=o.x-i.x):(a=o.x-i.x,u=o.y-i.y),e.dpv=getUnitVector(a,u)}function GETINFO(r){var e=r.stack,t=e.pop(),n=0;exports.DEBUG&&console.log(r.step,"GETINFO[]",t),t&1&&(n=35),t&32&&(n|=4096),e.push(n)}function ROLL(r){var e=r.stack,t=e.pop(),n=e.pop(),s=e.pop();exports.DEBUG&&console.log(r.step,"ROLL[]"),e.push(n),e.push(t),e.push(s)}function MAX(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"MAX[]",t,n),e.push(Math.max(n,t))}function MIN(r){var e=r.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(r.step,"MIN[]",t,n),e.push(Math.min(n,t))}function SCANTYPE(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SCANTYPE[]",e)}function INSTCTRL(r){var e=r.stack.pop(),t=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"INSTCTRL[]",e,t),e){case 1:r.inhibitGridFit=!!t;return;case 2:r.ignoreCvt=!!t;return;default:throw new Error("invalid INSTCTRL[] selector")}}function PUSHB(r,e){var t=e.stack,n=e.prog,s=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+r+"]");for(var i=0;i<r;i++)t.push(n[++s]);e.ip=s}function PUSHW(r,e){var t=e.ip,n=e.prog,s=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+r+"]");for(var i=0;i<r;i++){var o=n[++t]<<8|n[++t];o&32768&&(o=-((o^65535)+1)),s.push(o)}e.ip=t}function MDRP_MIRP(r,e,t,n,s,i){var o=i.stack,a=r&&o.pop(),u=o.pop(),h=i.rp0,p=i.z0[h],m=i.z1[u],v=i.minDis,E=i.fv,x=i.dpv,P,T,C,I;T=P=x.distance(m,p,!0,!0),C=T>=0?1:-1,T=Math.abs(T),r&&(I=i.cvt[a],n&&Math.abs(T-I)<i.cvCutIn&&(T=I)),t&&T<v&&(T=v),n&&(T=i.round(T)),E.setRelative(m,p,C*T,x),E.touch(m),exports.DEBUG&&console.log(i.step,(r?"MIRP[":"MDRP[")+(e?"M":"m")+(t?">":"_")+(n?"R":"_")+(s===0?"Gr":s===1?"Bl":s===2?"Wh":"")+"]",r?a+"("+i.cvt[a]+","+I+")":"",u,"(d =",P,"->",C*T,")"),i.rp1=i.rp0,i.rp2=u,e&&(i.rp0=u)}instructionTable=[SVTCA.bind(void 0,yUnitVector),SVTCA.bind(void 0,xUnitVector),SPVTCA.bind(void 0,yUnitVector),SPVTCA.bind(void 0,xUnitVector),SFVTCA.bind(void 0,yUnitVector),SFVTCA.bind(void 0,xUnitVector),SPVTL.bind(void 0,0),SPVTL.bind(void 0,1),SFVTL.bind(void 0,0),SFVTL.bind(void 0,1),SPVFS,SFVFS,GPV,GFV,SFVTPV,ISECT,SRP0,SRP1,SRP2,SZP0,SZP1,SZP2,SZPS,SLOOP,RTG,RTHG,SMD,ELSE,JMPR,SCVTCI,void 0,void 0,DUP,POP,CLEAR,SWAP,DEPTH,CINDEX,MINDEX,void 0,void 0,void 0,LOOPCALL,CALL,FDEF,void 0,MDAP.bind(void 0,0),MDAP.bind(void 0,1),IUP.bind(void 0,yUnitVector),IUP.bind(void 0,xUnitVector),SHP.bind(void 0,0),SHP.bind(void 0,1),SHC.bind(void 0,0),SHC.bind(void 0,1),SHZ.bind(void 0,0),SHZ.bind(void 0,1),SHPIX,IP,MSIRP.bind(void 0,0),MSIRP.bind(void 0,1),ALIGNRP,RTDG,MIAP.bind(void 0,0),MIAP.bind(void 0,1),NPUSHB,NPUSHW,WS,RS,WCVTP,RCVT,GC.bind(void 0,0),GC.bind(void 0,1),void 0,MD.bind(void 0,0),MD.bind(void 0,1),MPPEM,void 0,FLIPON,void 0,void 0,LT,LTEQ,GT,GTEQ,EQ,NEQ,ODD,EVEN,IF,EIF,AND,OR,NOT,DELTAP123.bind(void 0,1),SDB,SDS,ADD,SUB,DIV,MUL,ABS,NEG,FLOOR,CEILING,ROUND.bind(void 0,0),ROUND.bind(void 0,1),ROUND.bind(void 0,2),ROUND.bind(void 0,3),void 0,void 0,void 0,void 0,WCVTF,DELTAP123.bind(void 0,2),DELTAP123.bind(void 0,3),DELTAC123.bind(void 0,1),DELTAC123.bind(void 0,2),DELTAC123.bind(void 0,3),SROUND,S45ROUND,void 0,void 0,ROFF,void 0,RUTG,RDTG,POP,POP,void 0,void 0,void 0,void 0,void 0,SCANCTRL,SDPVTL.bind(void 0,0),SDPVTL.bind(void 0,1),GETINFO,void 0,ROLL,MAX,MIN,SCANTYPE,INSTCTRL,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,PUSHB.bind(void 0,1),PUSHB.bind(void 0,2),PUSHB.bind(void 0,3),PUSHB.bind(void 0,4),PUSHB.bind(void 0,5),PUSHB.bind(void 0,6),PUSHB.bind(void 0,7),PUSHB.bind(void 0,8),PUSHW.bind(void 0,1),PUSHW.bind(void 0,2),PUSHW.bind(void 0,3),PUSHW.bind(void 0,4),PUSHW.bind(void 0,5),PUSHW.bind(void 0,6),PUSHW.bind(void 0,7),PUSHW.bind(void 0,8),MDRP_MIRP.bind(void 0,0,0,0,0,0),MDRP_MIRP.bind(void 0,0,0,0,0,1),MDRP_MIRP.bind(void 0,0,0,0,0,2),MDRP_MIRP.bind(void 0,0,0,0,0,3),MDRP_MIRP.bind(void 0,0,0,0,1,0),MDRP_MIRP.bind(void 0,0,0,0,1,1),MDRP_MIRP.bind(void 0,0,0,0,1,2),MDRP_MIRP.bind(void 0,0,0,0,1,3),MDRP_MIRP.bind(void 0,0,0,1,0,0),MDRP_MIRP.bind(void 0,0,0,1,0,1),MDRP_MIRP.bind(void 0,0,0,1,0,2),MDRP_MIRP.bind(void 0,0,0,1,0,3),MDRP_MIRP.bind(void 0,0,0,1,1,0),MDRP_MIRP.bind(void 0,0,0,1,1,1),MDRP_MIRP.bind(void 0,0,0,1,1,2),MDRP_MIRP.bind(void 0,0,0,1,1,3),MDRP_MIRP.bind(void 0,0,1,0,0,0),MDRP_MIRP.bind(void 0,0,1,0,0,1),MDRP_MIRP.bind(void 0,0,1,0,0,2),MDRP_MIRP.bind(void 0,0,1,0,0,3),MDRP_MIRP.bind(void 0,0,1,0,1,0),MDRP_MIRP.bind(void 0,0,1,0,1,1),MDRP_MIRP.bind(void 0,0,1,0,1,2),MDRP_MIRP.bind(void 0,0,1,0,1,3),MDRP_MIRP.bind(void 0,0,1,1,0,0),MDRP_MIRP.bind(void 0,0,1,1,0,1),MDRP_MIRP.bind(void 0,0,1,1,0,2),MDRP_MIRP.bind(void 0,0,1,1,0,3),MDRP_MIRP.bind(void 0,0,1,1,1,0),MDRP_MIRP.bind(void 0,0,1,1,1,1),MDRP_MIRP.bind(void 0,0,1,1,1,2),MDRP_MIRP.bind(void 0,0,1,1,1,3),MDRP_MIRP.bind(void 0,1,0,0,0,0),MDRP_MIRP.bind(void 0,1,0,0,0,1),MDRP_MIRP.bind(void 0,1,0,0,0,2),MDRP_MIRP.bind(void 0,1,0,0,0,3),MDRP_MIRP.bind(void 0,1,0,0,1,0),MDRP_MIRP.bind(void 0,1,0,0,1,1),MDRP_MIRP.bind(void 0,1,0,0,1,2),MDRP_MIRP.bind(void 0,1,0,0,1,3),MDRP_MIRP.bind(void 0,1,0,1,0,0),MDRP_MIRP.bind(void 0,1,0,1,0,1),MDRP_MIRP.bind(void 0,1,0,1,0,2),MDRP_MIRP.bind(void 0,1,0,1,0,3),MDRP_MIRP.bind(void 0,1,0,1,1,0),MDRP_MIRP.bind(void 0,1,0,1,1,1),MDRP_MIRP.bind(void 0,1,0,1,1,2),MDRP_MIRP.bind(void 0,1,0,1,1,3),MDRP_MIRP.bind(void 0,1,1,0,0,0),MDRP_MIRP.bind(void 0,1,1,0,0,1),MDRP_MIRP.bind(void 0,1,1,0,0,2),MDRP_MIRP.bind(void 0,1,1,0,0,3),MDRP_MIRP.bind(void 0,1,1,0,1,0),MDRP_MIRP.bind(void 0,1,1,0,1,1),MDRP_MIRP.bind(void 0,1,1,0,1,2),MDRP_MIRP.bind(void 0,1,1,0,1,3),MDRP_MIRP.bind(void 0,1,1,1,0,0),MDRP_MIRP.bind(void 0,1,1,1,0,1),MDRP_MIRP.bind(void 0,1,1,1,0,2),MDRP_MIRP.bind(void 0,1,1,1,0,3),MDRP_MIRP.bind(void 0,1,1,1,1,0),MDRP_MIRP.bind(void 0,1,1,1,1,1),MDRP_MIRP.bind(void 0,1,1,1,1,2),MDRP_MIRP.bind(void 0,1,1,1,1,3)];function Token(r){this.char=r,this.state={},this.activeState=null}function ContextRange(r,e,t){this.contextName=t,this.startIndex=r,this.endOffset=e}function ContextChecker(r,e,t){this.contextName=r,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=t}function ContextParams(r,e){this.context=r,this.index=e,this.length=r.length,this.current=r[e],this.backtrack=r.slice(0,e),this.lookahead=r.slice(e+1)}function Event(r){this.eventId=r,this.subscribers=[]}function initializeCoreEvents(r){var e=this,t=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];t.forEach(function(s){Object.defineProperty(e.events,s,{value:new Event(s)})}),r&&t.forEach(function(s){var i=r[s];typeof i=="function"&&e.events[s].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(s){e.events[s].subscribe(e.updateContextsRanges)})}function Tokenizer(r){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],initializeCoreEvents.call(this,r)}Token.prototype.setState=function(r,e){return this.state[r]=e,this.activeState={key:r,value:this.state[r]},this.activeState},Token.prototype.getState=function(r){return this.state[r]||null},Tokenizer.prototype.inboundIndex=function(r){return r>=0&&r<this.tokens.length},Tokenizer.prototype.composeRUD=function(r){var e=this,t=!0,n=r.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(t))}),s=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(s))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(s)};this.dispatch("composeRUD",[n.filter(function(i){return!s(i)})])},Tokenizer.prototype.replaceRange=function(r,e,t,n){e=e!==null?e:this.tokens.length;var s=t.every(function(o){return o instanceof Token});if(!isNaN(r)&&this.inboundIndex(r)&&s){var i=this.tokens.splice.apply(this.tokens,[r,e].concat(t));return n||this.dispatch("replaceToken",[r,e,t]),[i,t]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Tokenizer.prototype.replaceToken=function(r,e,t){if(!isNaN(r)&&this.inboundIndex(r)&&e instanceof Token){var n=this.tokens.splice(r,1,e);return t||this.dispatch("replaceToken",[r,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Tokenizer.prototype.removeRange=function(r,e,t){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(r,e);return t||this.dispatch("removeRange",[n,r,e]),n},Tokenizer.prototype.removeToken=function(r,e){if(!isNaN(r)&&this.inboundIndex(r)){var t=this.tokens.splice(r,1);return e||this.dispatch("removeToken",[t,r]),t}else return{FAIL:"removeToken: invalid token index."}},Tokenizer.prototype.insertToken=function(r,e,t){var n=r.every(function(s){return s instanceof Token});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(r)),t||this.dispatch("insertToken",[r,e]),r):{FAIL:"insertToken: invalid token(s)."}},Tokenizer.prototype.registerModifier=function(r,e,t){this.events.newToken.subscribe(function(n,s){var i=[n,s],o=e===null||e.apply(this,i)===!0,a=[n,s];if(o){var u=t.apply(this,a);n.setState(r,u)}}),this.registeredModifiers.push(r)},Event.prototype.subscribe=function(r){return typeof r=="function"?this.subscribers.push(r)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Event.prototype.unsubscribe=function(r){this.subscribers.splice(r,1)},ContextParams.prototype.setCurrentIndex=function(r){this.index=r,this.current=this.context[r],this.backtrack=this.context.slice(0,r),this.lookahead=this.context.slice(r+1)},ContextParams.prototype.get=function(r){switch(!0){case r===0:return this.current;case(r<0&&Math.abs(r)<=this.backtrack.length):return this.backtrack.slice(r)[0];case(r>0&&r<=this.lookahead.length):return this.lookahead[r-1];default:return null}},Tokenizer.prototype.rangeToText=function(r){if(r instanceof ContextRange)return this.getRangeTokens(r).map(function(e){return e.char}).join("")},Tokenizer.prototype.getText=function(){return this.tokens.map(function(r){return r.char}).join("")},Tokenizer.prototype.getContext=function(r){var e=this.registeredContexts[r];return e||null},Tokenizer.prototype.on=function(r,e){var t=this.events[r];return t?t.subscribe(e):null},Tokenizer.prototype.dispatch=function(r,e){var t=this,n=this.events[r];n instanceof Event&&n.subscribers.forEach(function(s){s.apply(t,e||[])})},Tokenizer.prototype.registerContextChecker=function(r,e,t){if(this.getContext(r))return{FAIL:"context name '"+r+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof t!="function")return{FAIL:"missing context end check."};var n=new ContextChecker(r,e,t);return this.registeredContexts[r]=n,this.contextCheckers.push(n),n},Tokenizer.prototype.getRangeTokens=function(r){var e=r.startIndex+r.endOffset;return[].concat(this.tokens.slice(r.startIndex,e))},Tokenizer.prototype.getContextRanges=function(r){var e=this.getContext(r);return e?e.ranges:{FAIL:"context checker '"+r+"' is not registered."}},Tokenizer.prototype.resetContextsRanges=function(){var r=this.registeredContexts;for(var e in r)if(r.hasOwnProperty(e)){var t=r[e];t.ranges=[]}},Tokenizer.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var r=this.tokens.map(function(n){return n.char}),e=0;e<r.length;e++){var t=new ContextParams(r,e);this.runContextCheck(t)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Tokenizer.prototype.setEndOffset=function(r,e){var t=this.getContext(e).openRange.startIndex,n=new ContextRange(t,r,e),s=this.getContext(e).ranges;return n.rangeId=e+"."+s.length,s.push(n),this.getContext(e).openRange=null,n},Tokenizer.prototype.runContextCheck=function(r){var e=this,t=r.index;this.contextCheckers.forEach(function(n){var s=n.contextName,i=e.getContext(s).openRange;if(!i&&n.checkStart(r)&&(i=new ContextRange(t,null,s),e.getContext(s).openRange=i,e.dispatch("contextStart",[s,t])),i&&n.checkEnd(r)){var o=t-i.startIndex+1,a=e.setEndOffset(o,s);e.dispatch("contextEnd",[s,a])}})},Tokenizer.prototype.tokenize=function(r){this.tokens=[],this.resetContextsRanges();var e=Array.from(r);this.dispatch("start");for(var t=0;t<e.length;t++){var n=e[t],s=new ContextParams(e,t);this.dispatch("next",[s]),this.runContextCheck(s);var i=new Token(n);this.tokens.push(i),this.dispatch("newToken",[i,s])}return this.dispatch("end",[this.tokens]),this.tokens};function isArabicChar(r){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(r)}function isIsolatedArabicChar(r){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(r)}function isTashkeelArabicChar(r){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(r)}function isLatinChar(r){return/[A-z]/.test(r)}function isWhiteSpace(r){return/\s/.test(r)}function FeatureQuery(r){this.font=r,this.features={}}function SubstitutionAction(r){this.id=r.id,this.tag=r.tag,this.substitution=r.substitution}function lookupCoverage(r,e){if(!r)return-1;switch(e.format){case 1:return e.glyphs.indexOf(r);case 2:for(var t=e.ranges,n=0;n<t.length;n++){var s=t[n];if(r>=s.start&&r<=s.end){var i=r-s.start;return s.index+i}}break;default:return-1}return-1}function singleSubstitutionFormat1(r,e){var t=lookupCoverage(r,e.coverage);return t===-1?null:r+e.deltaGlyphId}function singleSubstitutionFormat2(r,e){var t=lookupCoverage(r,e.coverage);return t===-1?null:e.substitute[t]}function lookupCoverageList(r,e){for(var t=[],n=0;n<r.length;n++){var s=r[n],i=e.current;i=Array.isArray(i)?i[0]:i;var o=lookupCoverage(i,s);o!==-1&&t.push(o)}return t.length!==r.length?-1:t}function chainingSubstitutionFormat3(r,e){var t=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(r.context.length<t)return[];var n=lookupCoverageList(e.inputCoverage,r);if(n===-1)return[];var s=e.inputCoverage.length-1;if(r.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=r.lookahead.slice(s);i.length&&isTashkeelArabicChar(i[0].char);)i.shift();var o=new ContextParams(i,0),a=lookupCoverageList(e.lookaheadCoverage,o),u=[].concat(r.backtrack);for(u.reverse();u.length&&isTashkeelArabicChar(u[0].char);)u.shift();if(u.length<e.backtrackCoverage.length)return[];var h=new ContextParams(u,0),p=lookupCoverageList(e.backtrackCoverage,h),m=n.length===e.inputCoverage.length&&a.length===e.lookaheadCoverage.length&&p.length===e.backtrackCoverage.length,v=[];if(m)for(var E=0;E<e.lookupRecords.length;E++)for(var x=e.lookupRecords[E],P=x.lookupListIndex,T=this.getLookupByIndex(P),C=0;C<T.subtables.length;C++){var I=T.subtables[C],O=this.getLookupMethod(T,I),G=this.getSubstitutionType(T,I);if(G==="12")for(var F=0;F<n.length;F++){var Y=r.get(F),V=O(Y);V&&v.push(V)}}return v}function ligatureSubstitutionFormat1(r,e){var t=r.current,n=lookupCoverage(t,e.coverage);if(n===-1)return null;for(var s,i=e.ligatureSets[n],o=0;o<i.length;o++){s=i[o];for(var a=0;a<s.components.length;a++){var u=r.lookahead[a],h=s.components[a];if(u!==h)break;if(a===s.components.length-1)return s}}return null}function decompositionSubstitutionFormat1(r,e){var t=lookupCoverage(r,e.coverage);return t===-1?null:e.sequences[t]}FeatureQuery.prototype.getDefaultScriptFeaturesIndexes=function(){for(var r=this.font.tables.gsub.scripts,e=0;e<r.length;e++){var t=r[e];if(t.tag==="DFLT")return t.script.defaultLangSys.featureIndexes}return[]},FeatureQuery.prototype.getScriptFeaturesIndexes=function(r){var e=this.font.tables;if(!e.gsub)return[];if(!r)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,n=0;n<t.length;n++){var s=t[n];if(s.tag===r&&s.script.defaultLangSys)return s.script.defaultLangSys.featureIndexes;var i=s.langSysRecords;if(i)for(var o=0;o<i.length;o++){var a=i[o];if(a.tag===r){var u=a.langSys;return u.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},FeatureQuery.prototype.mapTagsToFeatures=function(r,e){for(var t={},n=0;n<r.length;n++){var s=r[n].tag,i=r[n].feature;t[s]=i}this.features[e].tags=t},FeatureQuery.prototype.getScriptFeatures=function(r){var e=this.features[r];if(this.features.hasOwnProperty(r))return e;var t=this.getScriptFeaturesIndexes(r);if(!t)return null;var n=this.font.tables.gsub;return e=t.map(function(s){return n.features[s]}),this.features[r]=e,this.mapTagsToFeatures(e,r),e},FeatureQuery.prototype.getSubstitutionType=function(r,e){var t=r.lookupType.toString(),n=e.substFormat.toString();return t+n},FeatureQuery.prototype.getLookupMethod=function(r,e){var t=this,n=this.getSubstitutionType(r,e);switch(n){case"11":return function(s){return singleSubstitutionFormat1.apply(t,[s,e])};case"12":return function(s){return singleSubstitutionFormat2.apply(t,[s,e])};case"63":return function(s){return chainingSubstitutionFormat3.apply(t,[s,e])};case"41":return function(s){return ligatureSubstitutionFormat1.apply(t,[s,e])};case"21":return function(s){return decompositionSubstitutionFormat1.apply(t,[s,e])};default:throw new Error("lookupType: "+r.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},FeatureQuery.prototype.lookupFeature=function(r){var e=r.contextParams,t=e.index,n=this.getFeature({tag:r.tag,script:r.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+r.tag+"' for script '"+r.script+"'.");for(var s=this.getFeatureLookups(n),i=[].concat(e.context),o=0;o<s.length;o++)for(var a=s[o],u=this.getLookupSubtables(a),h=0;h<u.length;h++){var p=u[h],m=this.getSubstitutionType(a,p),v=this.getLookupMethod(a,p),E=void 0;switch(m){case"11":E=v(e.current),E&&i.splice(t,1,new SubstitutionAction({id:11,tag:r.tag,substitution:E}));break;case"12":E=v(e.current),E&&i.splice(t,1,new SubstitutionAction({id:12,tag:r.tag,substitution:E}));break;case"63":E=v(e),Array.isArray(E)&&E.length&&i.splice(t,1,new SubstitutionAction({id:63,tag:r.tag,substitution:E}));break;case"41":E=v(e),E&&i.splice(t,1,new SubstitutionAction({id:41,tag:r.tag,substitution:E}));break;case"21":E=v(e.current),E&&i.splice(t,1,new SubstitutionAction({id:21,tag:r.tag,substitution:E}));break}e=new ContextParams(i,t),!(Array.isArray(E)&&!E.length)&&(E=null)}return i.length?i:null},FeatureQuery.prototype.supports=function(r){if(!r.script)return!1;this.getScriptFeatures(r.script);var e=this.features.hasOwnProperty(r.script);if(!r.tag)return e;var t=this.features[r.script].some(function(n){return n.tag===r.tag});return e&&t},FeatureQuery.prototype.getLookupSubtables=function(r){return r.subtables||null},FeatureQuery.prototype.getLookupByIndex=function(r){var e=this.font.tables.gsub.lookups;return e[r]||null},FeatureQuery.prototype.getFeatureLookups=function(r){return r.lookupListIndexes.map(this.getLookupByIndex.bind(this))},FeatureQuery.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function arabicWordStartCheck(r){var e=r.current,t=r.get(-1);return t===null&&isArabicChar(e)||!isArabicChar(t)&&isArabicChar(e)}function arabicWordEndCheck(r){var e=r.get(1);return e===null||!isArabicChar(e)}var arabicWordCheck={startCheck:arabicWordStartCheck,endCheck:arabicWordEndCheck};function arabicSentenceStartCheck(r){var e=r.current,t=r.get(-1);return(isArabicChar(e)||isTashkeelArabicChar(e))&&!isArabicChar(t)}function arabicSentenceEndCheck(r){var e=r.get(1);switch(!0){case e===null:return!0;case(!isArabicChar(e)&&!isTashkeelArabicChar(e)):var t=isWhiteSpace(e);if(!t)return!0;if(t){var n=!1;if(n=r.lookahead.some(function(s){return isArabicChar(s)||isTashkeelArabicChar(s)}),!n)return!0}break;default:return!1}}var arabicSentenceCheck={startCheck:arabicSentenceStartCheck,endCheck:arabicSentenceEndCheck};function singleSubstitutionFormat1$1(r,e,t){e[t].setState(r.tag,r.substitution)}function singleSubstitutionFormat2$1(r,e,t){e[t].setState(r.tag,r.substitution)}function chainingSubstitutionFormat3$1(r,e,t){r.substitution.forEach(function(n,s){var i=e[t+s];i.setState(r.tag,n)})}function ligatureSubstitutionFormat1$1(r,e,t){var n=e[t];n.setState(r.tag,r.substitution.ligGlyph);for(var s=r.substitution.components.length,i=0;i<s;i++)n=e[t+i+1],n.setState("deleted",!0)}var SUBSTITUTIONS={11:singleSubstitutionFormat1$1,12:singleSubstitutionFormat2$1,63:chainingSubstitutionFormat3$1,41:ligatureSubstitutionFormat1$1};function applySubstitution(r,e,t){r instanceof SubstitutionAction&&SUBSTITUTIONS[r.id]&&SUBSTITUTIONS[r.id](r,e,t)}function willConnectPrev(r){for(var e=[].concat(r.backtrack),t=e.length-1;t>=0;t--){var n=e[t],s=isIsolatedArabicChar(n),i=isTashkeelArabicChar(n);if(!s&&!i)return!0;if(s)return!1}return!1}function willConnectNext(r){if(isIsolatedArabicChar(r.current))return!1;for(var e=0;e<r.lookahead.length;e++){var t=r.lookahead[e],n=isTashkeelArabicChar(t);if(!n)return!0}return!1}function arabicPresentationForms(r){var e=this,t="arab",n=this.featuresTags[t],s=this.tokenizer.getRangeTokens(r);if(s.length!==1){var i=new ContextParams(s.map(function(a){return a.getState("glyphIndex")}),0),o=new ContextParams(s.map(function(a){return a.char}),0);s.forEach(function(a,u){if(!isTashkeelArabicChar(a.char)){i.setCurrentIndex(u),o.setCurrentIndex(u);var h=0;willConnectPrev(o)&&(h|=1),willConnectNext(o)&&(h|=2);var p;switch(h){case 1:p="fina";break;case 2:p="init";break;case 3:p="medi";break}if(n.indexOf(p)!==-1){var m=e.query.lookupFeature({tag:p,script:t,contextParams:i});if(m instanceof Error)return console.info(m.message);m.forEach(function(v,E){v instanceof SubstitutionAction&&(applySubstitution(v,s,E),i.context[E]=v.substitution)})}}})}}function getContextParams(r,e){var t=r.map(function(n){return n.activeState.value});return new ContextParams(t,0)}function arabicRequiredLigatures(r){var e=this,t="arab",n=this.tokenizer.getRangeTokens(r),s=getContextParams(n);s.context.forEach(function(i,o){s.setCurrentIndex(o);var a=e.query.lookupFeature({tag:"rlig",script:t,contextParams:s});a.length&&(a.forEach(function(u){return applySubstitution(u,n,o)}),s=getContextParams(n))})}function latinWordStartCheck(r){var e=r.current,t=r.get(-1);return t===null&&isLatinChar(e)||!isLatinChar(t)&&isLatinChar(e)}function latinWordEndCheck(r){var e=r.get(1);return e===null||!isLatinChar(e)}var latinWordCheck={startCheck:latinWordStartCheck,endCheck:latinWordEndCheck};function getContextParams$1(r,e){var t=r.map(function(n){return n.activeState.value});return new ContextParams(t,0)}function latinLigature(r){var e=this,t="latn",n=this.tokenizer.getRangeTokens(r),s=getContextParams$1(n);s.context.forEach(function(i,o){s.setCurrentIndex(o);var a=e.query.lookupFeature({tag:"liga",script:t,contextParams:s});a.length&&(a.forEach(function(u){return applySubstitution(u,n,o)}),s=getContextParams$1(n))})}function Bidi(r){this.baseDir=r||"ltr",this.tokenizer=new Tokenizer,this.featuresTags={}}Bidi.prototype.setText=function(r){this.text=r},Bidi.prototype.contextChecks={latinWordCheck,arabicWordCheck,arabicSentenceCheck};function registerContextChecker(r){var e=this.contextChecks[r+"Check"];return this.tokenizer.registerContextChecker(r,e.startCheck,e.endCheck)}function tokenizeText(){return registerContextChecker.call(this,"latinWord"),registerContextChecker.call(this,"arabicWord"),registerContextChecker.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function reverseArabicSentences(){var r=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(t){var n=r.tokenizer.getRangeTokens(t);r.tokenizer.replaceRange(t.startIndex,t.endOffset,n.reverse())})}Bidi.prototype.registerFeatures=function(r,e){var t=this,n=e.filter(function(s){return t.query.supports({script:r,tag:s})});this.featuresTags.hasOwnProperty(r)?this.featuresTags[r]=this.featuresTags[r].concat(n):this.featuresTags[r]=n},Bidi.prototype.applyFeatures=function(r,e){if(!r)throw new Error("No valid font was provided to apply features");this.query||(this.query=new FeatureQuery(r));for(var t=0;t<e.length;t++){var n=e[t];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},Bidi.prototype.registerModifier=function(r,e,t){this.tokenizer.registerModifier(r,e,t)};function checkGlyphIndexStatus(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function applyArabicPresentationForms(){var r=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){checkGlyphIndexStatus.call(this);var t=this.tokenizer.getContextRanges("arabicWord");t.forEach(function(n){arabicPresentationForms.call(r,n)})}}function applyArabicRequireLigatures(){var r=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var t=this.featuresTags[e];if(t.indexOf("rlig")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(s){arabicRequiredLigatures.call(r,s)})}}}function applyLatinLigatures(){var r=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var t=this.featuresTags[e];if(t.indexOf("liga")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(s){latinLigature.call(r,s)})}}}Bidi.prototype.checkContextReady=function(r){return!!this.tokenizer.getContext(r)},Bidi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(applyArabicPresentationForms.call(this),applyArabicRequireLigatures.call(this)),this.checkContextReady("latinWord")&&applyLatinLigatures.call(this),this.checkContextReady("arabicSentence")&&reverseArabicSentences.call(this)},Bidi.prototype.processText=function(r){(!this.text||this.text!==r)&&(this.setText(r),tokenizeText.call(this),this.applyFeaturesToContexts())},Bidi.prototype.getBidiText=function(r){return this.processText(r),this.tokenizer.getText()},Bidi.prototype.getTextGlyphs=function(r){this.processText(r);for(var e=[],t=0;t<this.tokenizer.tokens.length;t++){var n=this.tokenizer.tokens[t];if(!n.state.deleted){var s=n.activeState.value;e.push(Array.isArray(s)?s[0]:s)}}return e};function Font(r){r=r||{},r.tables=r.tables||{},r.empty||(checkArgument(r.familyName,"When creating a new Font object, familyName is required."),checkArgument(r.styleName,"When creating a new Font object, styleName is required."),checkArgument(r.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),checkArgument(r.ascender,"When creating a new Font object, ascender is required."),checkArgument(r.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:r.familyName||" "},fontSubfamily:{en:r.styleName||" "},fullName:{en:r.fullName||r.familyName+" "+r.styleName},postScriptName:{en:r.postScriptName||(r.familyName+r.styleName).replace(/\s/g,"")},designer:{en:r.designer||" "},designerURL:{en:r.designerURL||" "},manufacturer:{en:r.manufacturer||" "},manufacturerURL:{en:r.manufacturerURL||" "},license:{en:r.license||" "},licenseURL:{en:r.licenseURL||" "},version:{en:r.version||"Version 0.1"},description:{en:r.description||" "},copyright:{en:r.copyright||" "},trademark:{en:r.trademark||" "}},this.unitsPerEm=r.unitsPerEm||1e3,this.ascender=r.ascender,this.descender=r.descender,this.createdTimestamp=r.createdTimestamp,this.tables=Object.assign(r.tables,{os2:Object.assign({usWeightClass:r.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:r.widthClass||this.usWidthClasses.MEDIUM,fsSelection:r.fsSelection||this.fsSelectionValues.REGULAR},r.tables.os2)})),this.supported=!0,this.glyphs=new glyphset.GlyphSet(this,r.glyphs||[]),this.encoding=new DefaultEncoding(this),this.position=new Position(this),this.substitution=new Substitution(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hinting(this)}})}Font.prototype.hasChar=function(r){return this.encoding.charToGlyphIndex(r)!==null},Font.prototype.charToGlyphIndex=function(r){return this.encoding.charToGlyphIndex(r)},Font.prototype.charToGlyph=function(r){var e=this.charToGlyphIndex(r),t=this.glyphs.get(e);return t||(t=this.glyphs.get(0)),t},Font.prototype.updateFeatures=function(r){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(t){return r[t]})}:e})},Font.prototype.stringToGlyphs=function(r,e){var t=this,n=new Bidi,s=function(m){return t.charToGlyphIndex(m.char)};n.registerModifier("glyphIndex",null,s);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var o=n.getTextGlyphs(r),a=o.length,u=new Array(a),h=this.glyphs.get(0),p=0;p<a;p+=1)u[p]=this.glyphs.get(o[p])||h;return u},Font.prototype.nameToGlyphIndex=function(r){return this.glyphNames.nameToGlyphIndex(r)},Font.prototype.nameToGlyph=function(r){var e=this.nameToGlyphIndex(r),t=this.glyphs.get(e);return t||(t=this.glyphs.get(0)),t},Font.prototype.glyphIndexToName=function(r){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(r):""},Font.prototype.getKerningValue=function(r,e){r=r.index||r,e=e.index||e;var t=this.position.defaultKerningTables;return t?this.position.getKerningValue(t,r,e):this.kerningPairs[r+","+e]||0},Font.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Font.prototype.forEachGlyph=function(r,e,t,n,s,i){e=e!==void 0?e:0,t=t!==void 0?t:0,n=n!==void 0?n:72,s=Object.assign({},this.defaultRenderOptions,s);var o=1/this.unitsPerEm*n,a=this.stringToGlyphs(r,s),u;if(s.kerning){var h=s.script||this.position.getDefaultScriptName();u=this.position.getKerningTables(h,s.language)}for(var p=0;p<a.length;p+=1){var m=a[p];if(i.call(this,m,e,t,n,s),m.advanceWidth&&(e+=m.advanceWidth*o),s.kerning&&p<a.length-1){var v=u?this.position.getKerningValue(u,m.index,a[p+1].index):this.getKerningValue(m,a[p+1]);e+=v*o}s.letterSpacing?e+=s.letterSpacing*n:s.tracking&&(e+=s.tracking/1e3*n)}return e},Font.prototype.getPath=function(r,e,t,n,s){var i=new Path;return this.forEachGlyph(r,e,t,n,s,function(o,a,u,h){var p=o.getPath(a,u,h,s,this);i.extend(p)}),i},Font.prototype.getPaths=function(r,e,t,n,s){var i=[];return this.forEachGlyph(r,e,t,n,s,function(o,a,u,h){var p=o.getPath(a,u,h,s,this);i.push(p)}),i},Font.prototype.getAdvanceWidth=function(r,e,t){return this.forEachGlyph(r,0,0,e,t,function(){})},Font.prototype.draw=function(r,e,t,n,s,i){this.getPath(e,t,n,s,i).draw(r)},Font.prototype.drawPoints=function(r,e,t,n,s,i){this.forEachGlyph(e,t,n,s,i,function(o,a,u,h){o.drawPoints(r,a,u,h)})},Font.prototype.drawMetrics=function(r,e,t,n,s,i){this.forEachGlyph(e,t,n,s,i,function(o,a,u,h){o.drawMetrics(r,a,u,h)})},Font.prototype.getEnglishName=function(r){var e=this.names[r];if(e)return e.en},Font.prototype.validate=function(){var r=this;function e(n,s){}function t(n){var s=r.getEnglishName(n);s&&s.trim().length>0}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm>0},Font.prototype.toTables=function(){return sfnt.fontToTable(this)},Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Font.prototype.toArrayBuffer=function(){for(var r=this.toTables(),e=r.encode(),t=new ArrayBuffer(e.length),n=new Uint8Array(t),s=0;s<e.length;s++)n[s]=e[s];return t},Font.prototype.download=function(r){var e=this.getEnglishName("fontFamily"),t=this.getEnglishName("fontSubfamily");r=r||e.replace(/\s/g,"")+"-"+t+".otf";var n=this.toArrayBuffer();if(isBrowser())if(window.URL=window.URL||window.webkitURL,window.URL){var s=new DataView(n),i=new Blob([s],{type:"font/opentype"}),o=document.createElement("a");o.href=window.URL.createObjectURL(i),o.download=r;var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!1),o.dispatchEvent(a)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var u=require("fs"),h=arrayBufferToNodeBuffer(n);u.writeFileSync(r,h)}},Font.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Font.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Font.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function addName(r,e){var t=JSON.stringify(r),n=256;for(var s in e){var i=parseInt(s);if(!(!i||i<256)){if(JSON.stringify(e[s])===t)return i;n<=i&&(n=i+1)}}return e[n]=r,n}function makeFvarAxis(r,e,t){var n=addName(e.name,t);return[{name:"tag_"+r,type:"TAG",value:e.tag},{name:"minValue_"+r,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+r,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+r,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+r,type:"USHORT",value:0},{name:"nameID_"+r,type:"USHORT",value:n}]}function parseFvarAxis(r,e,t){var n={},s=new parse$1.Parser(r,e);return n.tag=s.parseTag(),n.minValue=s.parseFixed(),n.defaultValue=s.parseFixed(),n.maxValue=s.parseFixed(),s.skip("uShort",1),n.name=t[s.parseUShort()]||{},n}function makeFvarInstance(r,e,t,n){for(var s=addName(e.name,n),i=[{name:"nameID_"+r,type:"USHORT",value:s},{name:"flags_"+r,type:"USHORT",value:0}],o=0;o<t.length;++o){var a=t[o].tag;i.push({name:"axis_"+r+" "+a,type:"FIXED",value:e.coordinates[a]<<16})}return i}function parseFvarInstance(r,e,t,n){var s={},i=new parse$1.Parser(r,e);s.name=n[i.parseUShort()]||{},i.skip("uShort",1),s.coordinates={};for(var o=0;o<t.length;++o)s.coordinates[t[o].tag]=i.parseFixed();return s}function makeFvarTable(r,e){var t=new table.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:r.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:r.instances.length},{name:"instanceSize",type:"USHORT",value:4+r.axes.length*4}]);t.offsetToData=t.sizeOf();for(var n=0;n<r.axes.length;n++)t.fields=t.fields.concat(makeFvarAxis(n,r.axes[n],e));for(var s=0;s<r.instances.length;s++)t.fields=t.fields.concat(makeFvarInstance(s,r.instances[s],r.axes,e));return t}function parseFvarTable(r,e,t){var n=new parse$1.Parser(r,e),s=n.parseULong();check.argument(s===65536,"Unsupported fvar table version.");var i=n.parseOffset16();n.skip("uShort",1);for(var o=n.parseUShort(),a=n.parseUShort(),u=n.parseUShort(),h=n.parseUShort(),p=[],m=0;m<o;m++)p.push(parseFvarAxis(r,e+i+m*a,t));for(var v=[],E=e+i+o*a,x=0;x<u;x++)v.push(parseFvarInstance(r,E+x*h,p,t));return{axes:p,instances:v}}var fvar={make:makeFvarTable,parse:parseFvarTable},attachList=function(){return{coverage:this.parsePointer(Parser.coverage),attachPoints:this.parseList(Parser.pointer(Parser.uShortList))}},caretValue=function(){var r=this.parseUShort();if(check.argument(r===1||r===2||r===3,"Unsupported CaretValue table version."),r===1)return{coordinate:this.parseShort()};if(r===2)return{pointindex:this.parseShort()};if(r===3)return{coordinate:this.parseShort()}},ligGlyph=function(){return this.parseList(Parser.pointer(caretValue))},ligCaretList=function(){return{coverage:this.parsePointer(Parser.coverage),ligGlyphs:this.parseList(Parser.pointer(ligGlyph))}},markGlyphSets=function(){return this.parseUShort(),this.parseList(Parser.pointer(Parser.coverage))};function parseGDEFTable(r,e){e=e||0;var t=new Parser(r,e),n=t.parseVersion(1);check.argument(n===1||n===1.2||n===1.3,"Unsupported GDEF table version.");var s={version:n,classDef:t.parsePointer(Parser.classDef),attachList:t.parsePointer(attachList),ligCaretList:t.parsePointer(ligCaretList),markAttachClassDef:t.parsePointer(Parser.classDef)};return n>=1.2&&(s.markGlyphSets=t.parsePointer(markGlyphSets)),s}var gdef={parse:parseGDEFTable},subtableParsers$1=new Array(10);subtableParsers$1[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{posFormat:1,coverage:this.parsePointer(Parser.coverage),value:this.parseValueRecord()};if(t===2)return{posFormat:2,coverage:this.parsePointer(Parser.coverage),values:this.parseValueRecordList()};check.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},subtableParsers$1[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();check.assert(t===1||t===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(Parser.coverage),s=this.parseUShort(),i=this.parseUShort();if(t===1)return{posFormat:t,coverage:n,valueFormat1:s,valueFormat2:i,pairSets:this.parseList(Parser.pointer(Parser.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(s),value2:this.parseValueRecord(i)}})))};if(t===2){var o=this.parsePointer(Parser.classDef),a=this.parsePointer(Parser.classDef),u=this.parseUShort(),h=this.parseUShort();return{posFormat:t,coverage:n,valueFormat1:s,valueFormat2:i,classDef1:o,classDef2:a,class1Count:u,class2Count:h,classRecords:this.parseList(u,Parser.list(h,function(){return{value1:this.parseValueRecord(s),value2:this.parseValueRecord(i)}}))}}},subtableParsers$1[3]=function(){return{error:"GPOS Lookup 3 not supported"}},subtableParsers$1[4]=function(){return{error:"GPOS Lookup 4 not supported"}},subtableParsers$1[5]=function(){return{error:"GPOS Lookup 5 not supported"}},subtableParsers$1[6]=function(){return{error:"GPOS Lookup 6 not supported"}},subtableParsers$1[7]=function(){return{error:"GPOS Lookup 7 not supported"}},subtableParsers$1[8]=function(){return{error:"GPOS Lookup 8 not supported"}},subtableParsers$1[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function parseGposTable(r,e){e=e||0;var t=new Parser(r,e),n=t.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GPOS table version "+n),n===1?{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(subtableParsers$1)}:{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(subtableParsers$1),variations:t.parseFeatureVariationsList()}}var subtableMakers$1=new Array(10);function makeGposTable(r){return new table.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(r.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(r.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(r.lookups,subtableMakers$1)}])}var gpos={parse:parseGposTable,make:makeGposTable};function parseWindowsKernTable(r){var e={};r.skip("uShort");var t=r.parseUShort();check.argument(t===0,"Unsupported kern sub-table version."),r.skip("uShort",2);var n=r.parseUShort();r.skip("uShort",3);for(var s=0;s<n;s+=1){var i=r.parseUShort(),o=r.parseUShort(),a=r.parseShort();e[i+","+o]=a}return e}function parseMacKernTable(r){var e={};r.skip("uShort");var t=r.parseULong();t>1&&console.warn("Only the first kern subtable is supported."),r.skip("uLong");var n=r.parseUShort(),s=n&255;if(r.skip("uShort"),s===0){var i=r.parseUShort();r.skip("uShort",3);for(var o=0;o<i;o+=1){var a=r.parseUShort(),u=r.parseUShort(),h=r.parseShort();e[a+","+u]=h}}return e}function parseKernTable(r,e){var t=new parse$1.Parser(r,e),n=t.parseUShort();if(n===0)return parseWindowsKernTable(t);if(n===1)return parseMacKernTable(t);throw new Error("Unsupported kern table version ("+n+").")}var kern={parse:parseKernTable};function parseLocaTable(r,e,t,n){for(var s=new parse$1.Parser(r,e),i=n?s.parseUShort:s.parseULong,o=[],a=0;a<t+1;a+=1){var u=i.call(s);n&&(u*=2),o.push(u)}return o}var loca={parse:parseLocaTable};function loadFromFile(r,e){var t=require("fs");t.readFile(r,function(n,s){if(n)return e(n.message);e(null,nodeBufferToArrayBuffer(s))})}function loadFromUrl(r,e){var t=new XMLHttpRequest;t.open("get",r,!0),t.responseType="arraybuffer",t.onload=function(){return t.response?e(null,t.response):e("Font could not be loaded: "+t.statusText)},t.onerror=function(){e("Font could not be loaded")},t.send()}function parseOpenTypeTableEntries(r,e){for(var t=[],n=12,s=0;s<e;s+=1){var i=parse$1.getTag(r,n),o=parse$1.getULong(r,n+4),a=parse$1.getULong(r,n+8),u=parse$1.getULong(r,n+12);t.push({tag:i,checksum:o,offset:a,length:u,compression:!1}),n+=16}return t}function parseWOFFTableEntries(r,e){for(var t=[],n=44,s=0;s<e;s+=1){var i=parse$1.getTag(r,n),o=parse$1.getULong(r,n+4),a=parse$1.getULong(r,n+8),u=parse$1.getULong(r,n+12),h=void 0;a<u?h="WOFF":h=!1,t.push({tag:i,offset:o,compression:h,compressedLength:a,length:u}),n+=20}return t}function uncompressTable(r,e){if(e.compression==="WOFF"){var t=new Uint8Array(r.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(tinyInflate(t,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var s=new DataView(n.buffer,0);return{data:s,offset:0}}else return{data:r,offset:e.offset}}function parseBuffer(r,e){e=e??{};var t,n,s=new Font({empty:!0}),i=new DataView(r,0),o,a=[],u=parse$1.getTag(i,0);if(u==="\0\0\0"||u==="true"||u==="typ1")s.outlinesFormat="truetype",o=parse$1.getUShort(i,4),a=parseOpenTypeTableEntries(i,o);else if(u==="OTTO")s.outlinesFormat="cff",o=parse$1.getUShort(i,4),a=parseOpenTypeTableEntries(i,o);else if(u==="wOFF"){var h=parse$1.getTag(i,4);if(h==="\0\0\0")s.outlinesFormat="truetype";else if(h==="OTTO")s.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+u);o=parse$1.getUShort(i,12),a=parseWOFFTableEntries(i,o)}else throw new Error("Unsupported OpenType signature "+u);for(var p,m,v,E,x,P,T,C,I,O,G,F,Y=0;Y<o;Y+=1){var V=a[Y],W=void 0;switch(V.tag){case"cmap":W=uncompressTable(i,V),s.tables.cmap=cmap.parse(W.data,W.offset),s.encoding=new CmapEncoding(s.tables.cmap);break;case"cvt ":W=uncompressTable(i,V),F=new parse$1.Parser(W.data,W.offset),s.tables.cvt=F.parseShortList(V.length/2);break;case"fvar":m=V;break;case"fpgm":W=uncompressTable(i,V),F=new parse$1.Parser(W.data,W.offset),s.tables.fpgm=F.parseByteList(V.length);break;case"head":W=uncompressTable(i,V),s.tables.head=head.parse(W.data,W.offset),s.unitsPerEm=s.tables.head.unitsPerEm,t=s.tables.head.indexToLocFormat;break;case"hhea":W=uncompressTable(i,V),s.tables.hhea=hhea.parse(W.data,W.offset),s.ascender=s.tables.hhea.ascender,s.descender=s.tables.hhea.descender,s.numberOfHMetrics=s.tables.hhea.numberOfHMetrics;break;case"hmtx":T=V;break;case"ltag":W=uncompressTable(i,V),n=ltag.parse(W.data,W.offset);break;case"maxp":W=uncompressTable(i,V),s.tables.maxp=maxp.parse(W.data,W.offset),s.numGlyphs=s.tables.maxp.numGlyphs;break;case"name":O=V;break;case"OS/2":W=uncompressTable(i,V),s.tables.os2=os2.parse(W.data,W.offset);break;case"post":W=uncompressTable(i,V),s.tables.post=post.parse(W.data,W.offset),s.glyphNames=new GlyphNames(s.tables.post);break;case"prep":W=uncompressTable(i,V),F=new parse$1.Parser(W.data,W.offset),s.tables.prep=F.parseByteList(V.length);break;case"glyf":v=V;break;case"loca":I=V;break;case"CFF ":p=V;break;case"kern":C=V;break;case"GDEF":E=V;break;case"GPOS":x=V;break;case"GSUB":P=V;break;case"meta":G=V;break}}var q=uncompressTable(i,O);if(s.tables.name=_name.parse(q.data,q.offset,n),s.names=s.tables.name,v&&I){var ce=t===0,J=uncompressTable(i,I),ge=loca.parse(J.data,J.offset,s.numGlyphs,ce),fe=uncompressTable(i,v);s.glyphs=glyf.parse(fe.data,fe.offset,ge,s,e)}else if(p){var Q=uncompressTable(i,p);cff.parse(Q.data,Q.offset,s,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var oe=uncompressTable(i,T);if(hmtx.parse(s,oe.data,oe.offset,s.numberOfHMetrics,s.numGlyphs,s.glyphs,e),addGlyphNames(s,e),C){var $=uncompressTable(i,C);s.kerningPairs=kern.parse($.data,$.offset)}else s.kerningPairs={};if(E){var X=uncompressTable(i,E);s.tables.gdef=gdef.parse(X.data,X.offset)}if(x){var ae=uncompressTable(i,x);s.tables.gpos=gpos.parse(ae.data,ae.offset),s.position.init()}if(P){var ye=uncompressTable(i,P);s.tables.gsub=gsub.parse(ye.data,ye.offset)}if(m){var xe=uncompressTable(i,m);s.tables.fvar=fvar.parse(xe.data,xe.offset,s.names)}if(G){var ue=uncompressTable(i,G);s.tables.meta=meta.parse(ue.data,ue.offset),s.metas=s.tables.meta}return s}function load(r,e,t){t=t??{};var n=typeof window>"u",s=n&&!t.isUrl?loadFromFile:loadFromUrl;return new Promise(function(i,o){s(r,function(a,u){if(a){if(e)return e(a);o(a)}var h;try{h=parseBuffer(u,t)}catch(p){if(e)return e(p,null);o(p)}if(e)return e(null,h);i(h)})})}function loadSync(r,e){var t=require("fs"),n=t.readFileSync(r);return parseBuffer(nodeBufferToArrayBuffer(n),e)}var opentype=Object.freeze({__proto__:null,Font,Glyph,Path,BoundingBox:BoundingBox2,_parse:parse$1,parse:parseBuffer,load,loadSync});const FONT_REGISTER={},loadFont=async(r,e="default")=>{const t=await opentype.load(r,null,{isUrl:!0});return FONT_REGISTER[e]=t,FONT_REGISTER.default||(FONT_REGISTER.default=t),t},getFont=(r="default")=>FONT_REGISTER[r],sketchFontCommands=function*(r){let e=null,t=null;for(const n of r){if(n.type==="Z"){e&&(yield e.close()),e=null;continue}const s=[-n.x,n.y];if(n.type==="M"){e&&(yield e.done()),e=new BlueprintSketcher,e.movePointerTo(s),t=s;continue}t&&Math.abs(s[0]-t[0])<1e-9&&Math.abs(s[1]-t[1])<1e-9||(n.type==="L"&&(e==null||e.lineTo(s)),n.type==="C"&&(e==null||e.cubicBezierCurveTo(s,[-n.x1,n.y1],[-n.x2,n.y2])),n.type==="Q"&&(e==null||e.quadraticBezierCurveTo(s,[-n.x1,n.y1])),t=s)}};function textBlueprints(r,{startX:e=0,startY:t=0,fontSize:n=16,fontFamily:s="default"}={}){const o=getFont(s).getPath(r,-e,-t,n),a=Array.from(sketchFontCommands(o.commands));return organiseBlueprints(a).mirror([0,0])}function sketchText(r,e,t={}){const n=textBlueprints(r,e);return t.plane instanceof Plane?n.sketchOnPlane(t.plane):n.sketchOnPlane(t.plane,t.origin)}const uniqueId=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);async function importSTEP(r){const e=getOC(),[t,n]=localGC(),s=uniqueId(),i=new Uint8Array(await r.arrayBuffer());e.FS.writeFile(`/${s}`,i);const o=t(new e.STEPControl_Reader_1);if(o.ReadFile(s)){e.FS.unlink("/"+s),o.TransferRoots(t(new e.Message_ProgressRange_1));const a=t(o.OneShape()),u=cast(a);return n(),u}else throw e.FS.unlink("/"+s),n(),new Error("Failed to load STEP file")}async function importSTL(r){const e=getOC(),[t,n]=localGC(),s=uniqueId(),i=new Uint8Array(await r.arrayBuffer());e.FS.writeFile(`/${s}`,i);const o=t(new e.StlAPI_Reader),a=t(new e.TopoDS_Shell);if(o.Read(a,s)){e.FS.unlink("/"+s);const u=t(new e.ShapeUpgrade_UnifySameDomain_2(a,!0,!0,!1));u.Build();const h=t(u.Shape()),p=t(new e.BRepBuilderAPI_MakeSolid_1);p.Add(e.TopoDS.Shell_1(h));const m=t(p.Solid()),v=cast(m);return n(),v}else throw e.FS.unlink("/"+s),n(),new Error("Failed to load STL file")}const PROJECTION_PLANES={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function isProjectionPlane(r){return typeof r=="string"&&r in PROJECTION_PLANES}function lookFromPlane(r){const{dir:e,xAxis:t}=PROJECTION_PLANES[r];return new ProjectionCamera([0,0,0],e,t)}function defaultXDir(r){const e=new Vector(r);let t=new Vector([0,0,1]),n=t.cross(e);return n.Length===0&&(t=new Vector([0,1,0]),n=t.cross(e)),n.normalize()}class ProjectionCamera extends WrappingObj{constructor(e=[0,0,0],t=[0,0,1],n){const s=n?new Vector(n):defaultXDir(t),i=makeAx2(e,t,s);super(i)}get position(){return new Vector(this.wrapped.Location())}get direction(){return new Vector(this.wrapped.Direction())}get xAxis(){return new Vector(this.wrapped.XDirection())}get yAxis(){return new Vector(this.wrapped.YDirection())}autoAxes(){const e=defaultXDir(this.direction);this.wrapped.SetXDirection(asDir(e))}setPosition(e){return this.wrapped.SetLocation(asPnt(e)),this}setXAxis(e){return this.wrapped.SetYDirection(asDir(e)),this}setYAxis(e){return this.wrapped.SetYDirection(asDir(e)),this}lookAt(e){const t=new Vector("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(t).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const getEdges=r=>r.IsNull()?[]:cast(r).edges;function makeProjectedEdges(r,e,t=!0){const n=getOC(),s=GCWithScope(),i=s(new n.HLRBRep_Algo_1);i.Add_2(r.wrapped,0);const o=s(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(o),i.Update(),i.Hide_1();const a=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),u=[...getEdges(a.VCompound_1()),...getEdges(a.Rg1LineVCompound_1()),...getEdges(a.OutLineVCompound_1())];u.forEach(p=>n.BRepLib.BuildCurves3d_2(p.wrapped));const h=t?[...getEdges(a.HCompound_1()),...getEdges(a.Rg1LineHCompound_1()),...getEdges(a.OutLineHCompound_1())]:[];return h.forEach(p=>n.BRepLib.BuildCurves3d_2(p.wrapped)),{visible:u,hidden:h}}const PRECISION=1e-8,samePoint=(r,e)=>samePoint$2(r,e,PRECISION*10);function rawOffsets(r,e){const t=r.orientation==="clockwise"?-e:e,n=r.curves.map(h=>({offset:make2dOffset(h,t),original:h})),s=[];let i=null,o=n.at(-1);if(!o)return[];if(s.length===1)return s;const a=h=>{i?h.offset instanceof Curve2D?s.push(h.offset):samePoint(h.offset.firstPoint,h.offset.lastPoint)||s.push(make2dSegmentCurve(h.offset.firstPoint,h.offset.lastPoint)):i=h},u=function*(){for(const h of n.slice(0,-1))yield h;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const h of u()){const p=o.offset.lastPoint,m=h.offset.firstPoint;if(samePoint(p,m)){a(o),o=h;continue}let v=[];if(o.offset instanceof Curve2D&&h.offset instanceof Curve2D){const{intersections:x,commonSegmentsPoints:P}=intersectCurves(o.offset,h.offset,PRECISION/100);v=[...x,...P]}if(v.length>0){let x=v[0];if(v.length>1){const C=o==null?void 0:o.original.lastPoint,I=v.map(O=>squareDistance2d(O,C));x=v[I.indexOf(Math.min(...I))]}const P=o.offset.splitAt([x],PRECISION)[0],T=h.offset.splitAt([x],PRECISION).at(-1);if(!T)throw new Error("Bug in the splitting algo in offset");a({offset:P,original:o.original}),o={offset:T,original:h.original};continue}const E=make2dArcFromCenter(p,m,o.original.lastPoint);a(o),s.push(E),o=h}return a(o),s}function offsetBlueprint(r,e){const t=rawOffsets(r,e);if(t.length<2)return null;const n=new Map,s=(h,p)=>{const m=n.get(h)||[];n.set(h,[...m,...p])};if(t.forEach((h,p)=>{t.slice(p+1).forEach((m,v)=>{const{intersections:E,commonSegmentsPoints:x}=intersectCurves(h,m,PRECISION),P=[...E,...x].filter(T=>{const C=samePoint(T,h.firstPoint)||samePoint(T,h.lastPoint),I=samePoint(T,m.firstPoint)||samePoint(T,m.lastPoint);return!(C&&I)});P.length&&(s(p,P),s(v+p+1,P))})}),!n.size){const h=new Blueprint(t);return r.intersects(h)?null:h}const o=t.flatMap((h,p)=>{if(!n.has(p))return h;const m=n.get(p)||[];return h.splitAt(m,PRECISION*100)}).filter(h=>!r.curves.find(m=>m.distanceFrom(h)<Math.abs(e)-PRECISION));if(!o.length)return null;const u=stitchCurves(o).filter(h=>h.length>1).map(h=>new Blueprint(h)).filter(h=>h.isClosed());return u.length?u.length===1?u[0]:new Blueprints(u):null}const fuseAll=r=>{let e=r[0];for(let t=1;t<r.length;t++)e=fuse2D(e,r[t]);return e};function offset(r,e){if(r instanceof Blueprint)return offsetBlueprint(r,e);if(r instanceof Blueprints)return fuseAll(r.blueprints.map(t=>offset(t,e)));if(r instanceof CompoundBlueprint){const t=fuseAll(r.blueprints.slice(1).map(n=>offset(n,e)));return cut2D(offset(r.blueprints[0],e),t)}return null}function modifyCorners(r,e,t,n){let s=()=>!0;n&&(s=n.shouldKeep.bind(n));const i=[e.curves[0]],o=(u,h)=>{s({firstCurve:u,secondCurve:h,point:u.lastPoint})?i.push(...r(u,h,t)):i.push(u,h)};e.curves.slice(1).forEach(u=>{const h=i.pop();if(!h)throw new Error("Bug in the blueprint filletting algo");o(h,u)});const a=i.at(-1);if(!a)throw new Error("Bug in the blueprint corner algo");if(samePoint$2(i[0].firstPoint,a.lastPoint)&&i.length>1){const u=i.pop(),h=i.shift();if(!u||!h)throw new Error("Bug in the blueprint filletting algo");o(u,h)}return new Blueprint(i)}function modifyCorner2D(r,e,t,n){if(e instanceof Blueprint)return modifyCorners(r,e,t,n);if(e instanceof CompoundBlueprint)return new CompoundBlueprint(e.blueprints.map(s=>modifyCorners(r,s,t,n)));if(e instanceof Blueprints){const s=e.blueprints.map(i=>modifyCorner2D(r,i,t,n)).filter(i=>i!==null);return new Blueprints(s)}return null}function fillet2D(r,e,t){return modifyCorner2D(filletCurves,r,e,t)}function chamfer2D(r,e,t){return modifyCorner2D(chamferCurves,r,e,t)}class Drawing{constructor(e=null){this.innerShape=e}clone(){var e;return new Drawing(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new BoundingBox2d}stretch(e,t,n){return this.innerShape?new Drawing(this.innerShape.stretch(e,t,n)):new Drawing}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,t){return this.innerShape?new Drawing(this.innerShape.rotate(e,t)):new Drawing}translate(e,t=0){return this.innerShape?new Drawing(this.innerShape.translate(e,t)):new Drawing}scale(e,t){return this.innerShape?new Drawing(this.innerShape.scale(e,t)):new Drawing}mirror(e,t,n){return this.innerShape?new Drawing(this.innerShape.mirror(e,t,n)):new Drawing}cut(e){return new Drawing(cut2D(this.innerShape,e.innerShape))}fuse(e){return new Drawing(fuse2D(this.innerShape,e.innerShape))}intersect(e){return new Drawing(intersect2D(this.innerShape,e.innerShape))}fillet(e,t){const n=t&&t(new CornerFinder);return new Drawing(fillet2D(this.innerShape,e,n))}chamfer(e,t){const n=t&&t(new CornerFinder);return new Drawing(chamfer2D(this.innerShape,e,n))}sketchOnPlane(e,t){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,t)}sketchOnFace(e,t){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,t)}toSVG(e){var t;return((t=this.innerShape)==null?void 0:t.toSVG(e))||""}toSVGViewBox(e=1){var t;return((t=this.innerShape)==null?void 0:t.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Drawing(offset(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof Blueprint)){if(this.innerShape instanceof Blueprints&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof Blueprint)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class DrawingPen extends BaseSketcher2d{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Drawing(new Blueprint(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,t="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,t),this.done()}}function draw(r){const e=new DrawingPen;return r&&e.movePointerTo(r),e}function drawRoundedRectangle(r,e,t=0){return new Drawing(roundedRectangleBlueprint$1(r,e,t))}const drawRectangle=drawRoundedRectangle;function drawSingleCircle(r){return new Drawing(new Blueprint([make2dCircle(r)]))}function drawSingleEllipse(r,e){const[t,n]=[r,e].sort((i,o)=>i-o),s=n===r?[1,0]:[0,1];return new Drawing(new Blueprint([make2dEllipse(n,t,s)]))}function drawCircle(r){return draw().movePointerTo([-r,0]).sagittaArc(2*r,0,r).sagittaArc(-2*r,0,r).close()}function drawEllipse(r,e){return draw().movePointerTo([-r,0]).halfEllipse(2*r,0,e).halfEllipse(-2*r,0,e).close()}function drawPolysides(r,e,t=0){return new Drawing(polysidesBlueprint(r,e,t))}function drawText(r,{startX:e=0,startY:t=0,fontSize:n=16,fontFamily:s="default"}={}){return new Drawing(textBlueprints(r,{startX:e,startY:t,fontSize:n,fontFamily:s}))}const drawPointsInterpolation=(r,e={})=>new Drawing(new Blueprint([make2dInerpolatedBSplineCurve(r,e)])),drawParametricFunction=(r,{pointsCount:e=400,start:t=0,stop:n=1}={},s={})=>{const i=(n-t)/e,o=[...Array(e+1).keys()].map(a=>r(t+a*i));return drawPointsInterpolation(o,s)};function drawFaceOutline(r){const t=r.clone().outerWire().edges.map(s=>edgeToCurve(s,r)),n=stitchCurves(t).map(s=>new Blueprint(s));return n.length===0?new Drawing:n.length===1?new Drawing(n[0]):new Drawing(new Blueprints(n))}const edgesToDrawing=r=>{const e=drawRectangle(1e3,1e3).sketchOnPlane().face(),t=r.map(s=>edgeToCurve(s,e)),n=stitchCurves(t).map(s=>new Blueprint(s));return n.length===0?new Drawing:n.length===1?new Drawing(n[0]):new Drawing(new Blueprints(n))};function drawProjection(r,e="front"){let t;e instanceof ProjectionCamera?t=e:t=lookFromPlane(e);const{visible:n,hidden:s}=makeProjectedEdges(r,t);return{visible:edgesToDrawing(n),hidden:edgesToDrawing(s)}}function uuidv(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,r=>(r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16))}const wrapString=r=>{const e=getOC();return new e.TCollection_ExtendedString_2(r,!0)};function parseSlice(r,e){return parseInt(r.slice(e*2,(e+1)*2),16)}function colorFromHex(r){let e=r;return e.indexOf("#")===0&&(e=e.slice(1)),e.length===3&&(e=e.replace(/([0-9a-f])/gi,"$1$1")),[parseSlice(e,0),parseSlice(e,1),parseSlice(e,2)]}const wrapColor=(r,e=1)=>{const t=getOC(),[n,s,i]=colorFromHex(r);return new t.Quantity_ColorRGBA_5(n/255,s/255,i/255,e)};class AssemblyExporter extends WrappingObj{}function createAssembly(r=[]){const e=getOC(),t=new e.TDocStd_Document(wrapString("XmlOcaf"));e.XCAFDoc_ShapeTool.SetAutoNaming(!1);const n=t.Main(),s=e.XCAFDoc_DocumentTool.ShapeTool(n).get(),i=e.XCAFDoc_DocumentTool.ColorTool(n).get();for(const{shape:o,name:a,color:u,alpha:h}of r){const p=s.NewShape();s.SetShape(p,o.wrapped),e.TDataStd_Name.Set_1(p,wrapString(a||uuidv())),i.SetColor_3(p,wrapColor(u||"#f00",h??1),e.XCAFDoc_ColorType.XCAFDoc_ColorSurf)}return s.UpdateAssemblies(),new AssemblyExporter(t)}function exportSTEP(r=[],{unit:e,modelUnit:t}={}){const n=getOC(),s=GCWithScope(),i=createAssembly(r);(e||t)&&(s(new n.STEPCAFControl_Writer_1),n.Interface_Static.SetCVal("xstep.cascade.unit",(t||e||"MM").toUpperCase()),n.Interface_Static.SetCVal("write.step.unit",(e||t||"MM").toUpperCase()));const o=s(new n.XSControl_WorkSession),a=s(new n.STEPCAFControl_Writer_2(s(new n.Handle_XSControl_WorkSession_2(o)),!1));a.SetColorMode(!0),a.SetLayerMode(!0),a.SetNameMode(!0),n.Interface_Static.SetIVal("write.surfacecurve.mode",!0),n.Interface_Static.SetIVal("write.precision.mode",0),n.Interface_Static.SetIVal("write.step.assembly",2),n.Interface_Static.SetIVal("write.step.schema",5);const u=s(new n.Message_ProgressRange_1);a.Transfer_1(new n.Handle_TDocStd_Document_2(i.wrapped),n.STEPControl_StepModelType.STEPControl_AsIs,null,u);const h="export.step";if(a.Write(h)===n.IFSelect_ReturnStatus.IFSelect_RetDone){const m=n.FS.readFile("/"+h);return n.FS.unlink("/"+h),new Blob([m],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}var replicad=Object.freeze({__proto__:null,AssemblyExporter,BaseSketcher2d,Blueprint,BlueprintSketcher,Blueprints,BoundingBox:BoundingBox$1,BoundingBox2d,CompSolid,Compound,CompoundBlueprint,CompoundSketch,CornerFinder,Curve,Curve2D,DEG2RAD,Drawing,DrawingPen,Edge,EdgeFinder,Face,FaceFinder,FaceSketcher,GCWithObject,GCWithScope,HASH_CODE_MAX,LinearPhysicalProperties,Plane,ProjectionCamera,RAD2DEG,Shape,Shell,Sketch,Sketcher,Sketches,Solid,Surface,SurfacePhysicalProperties,Transformation,Vector,Vertex,VolumePhysicalProperties,Wire,WrappingObj,_1DShape,_3DShape,addHolesInFace,asDir,asPnt,assembleWire,axis2d,basicFaceExtrusion,cast,combineFinderFilters,complexExtrude,compoundShapes,createAssembly,createNamedPlane,cut2D,cutBlueprints,downcast,draw,drawCircle,drawEllipse,drawFaceOutline,drawParametricFunction,drawPointsInterpolation,drawPolysides,drawProjection,drawRectangle,drawRoundedRectangle,drawSingleCircle,drawSingleEllipse,drawText,exportSTEP,fuse2D,fuseBlueprints,genericSweep,getFont,getOC,importSTEP,importSTL,intersect2D,intersectBlueprints,isPoint,isProjectionPlane,isShape3D,isWire,iterTopo,loadFont,localGC,loft,lookFromPlane,makeAx1,makeAx2,makeAx3,makeBSplineApproximation,makeBaseBox,makeBezierCurve,makeCircle,makeCompound,makeCylinder,makeDirection,makeEllipse,makeEllipseArc,makeFace,makeHelix,makeLine,makeNewFaceWithinFace,makeNonPlanarFace,makeOffset,makePlane,makePlaneFromFace,makePolygon,makeProjectedEdges,makeSolid,makeSphere,makeTangentArc,makeThreePointArc,makeVertex,measureArea,measureLength,measureShapeLinearProperties,measureShapeSurfaceProperties,measureShapeVolumeProperties,measureVolume,mirror,organiseBlueprints,polysideInnerRadius,polysidesBlueprint,revolution,rotate:rotate$1,roundedRectangleBlueprint:roundedRectangleBlueprint$1,scale,setOC,shapeType,sketchCircle,sketchEllipse,sketchFaceOffset,sketchHelix,sketchParametricFunction,sketchPolysides,sketchRectangle,sketchRoundedRectangle,sketchText,supportExtrude,textBlueprints,translate,twistExtrude});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=r=>typeof r=="object"&&r!==null||typeof r=="function",proxyTransferHandler={canHandle:r=>isObject(r)&&r[proxyMarker],serialize(r){const{port1:e,port2:t}=new MessageChannel;return expose(r,e),[t,[t]]},deserialize(r){return r.start(),wrap(r)}},throwTransferHandler={canHandle:r=>isObject(r)&&throwMarker in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function expose(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!isAllowedOrigin(t,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:i,type:o,path:a}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(fromWireValue);let h;try{const p=a.slice(0,-1).reduce((v,E)=>v[E],r),m=a.reduce((v,E)=>v[E],r);switch(o){case"GET":h=m;break;case"SET":p[a.slice(-1)[0]]=fromWireValue(s.data.value),h=!0;break;case"APPLY":h=m.apply(p,u);break;case"CONSTRUCT":{const v=new m(...u);h=proxy(v)}break;case"ENDPOINT":{const{port1:v,port2:E}=new MessageChannel;expose(r,E),h=transfer(v,[v])}break;case"RELEASE":h=void 0;break;default:return}}catch(p){h={value:p,[throwMarker]:0}}Promise.resolve(h).catch(p=>({value:p,[throwMarker]:0})).then(p=>{const[m,v]=toWireValue(p);e.postMessage(Object.assign(Object.assign({},m),{id:i}),v),o==="RELEASE"&&(e.removeEventListener("message",n),closeEndPoint(e),finalizer in r&&typeof r[finalizer]=="function"&&r[finalizer]())}).catch(p=>{const[m,v]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});e.postMessage(Object.assign(Object.assign({},m),{id:i}),v)})}),e.start&&e.start()}function isMessagePort(r){return r.constructor.name==="MessagePort"}function closeEndPoint(r){isMessagePort(r)&&r.close()}function wrap(r,e){const t=new Map;return r.addEventListener("message",function(s){const{data:i}=s;if(!i||!i.id)return;const o=t.get(i.id);if(o)try{o(i)}finally{t.delete(i.id)}}),createProxy(r,t,[],e)}function throwIfProxyReleased(r){if(r)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(r){return requestResponseMessage(r,new Map,{type:"RELEASE"}).then(()=>{closeEndPoint(r)})}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(proxyCounter.get(r)||0)-1;proxyCounter.set(r,e),e===0&&releaseEndpoint(r)});function registerProxy(r,e){const t=(proxyCounter.get(e)||0)+1;proxyCounter.set(e,t),proxyFinalizers&&proxyFinalizers.register(r,e,r)}function unregisterProxy(r){proxyFinalizers&&proxyFinalizers.unregister(r)}function createProxy(r,e,t=[],n=function(){}){let s=!1;const i=new Proxy(n,{get(o,a){if(throwIfProxyReleased(s),a===releaseProxy)return()=>{unregisterProxy(i),releaseEndpoint(r),e.clear(),s=!0};if(a==="then"){if(t.length===0)return{then:()=>i};const u=requestResponseMessage(r,e,{type:"GET",path:t.map(h=>h.toString())}).then(fromWireValue);return u.then.bind(u)}return createProxy(r,e,[...t,a])},set(o,a,u){throwIfProxyReleased(s);const[h,p]=toWireValue(u);return requestResponseMessage(r,e,{type:"SET",path:[...t,a].map(m=>m.toString()),value:h},p).then(fromWireValue)},apply(o,a,u){throwIfProxyReleased(s);const h=t[t.length-1];if(h===createEndpoint)return requestResponseMessage(r,e,{type:"ENDPOINT"}).then(fromWireValue);if(h==="bind")return createProxy(r,e,t.slice(0,-1));const[p,m]=processArguments(u);return requestResponseMessage(r,e,{type:"APPLY",path:t.map(v=>v.toString()),argumentList:p},m).then(fromWireValue)},construct(o,a){throwIfProxyReleased(s);const[u,h]=processArguments(a);return requestResponseMessage(r,e,{type:"CONSTRUCT",path:t.map(p=>p.toString()),argumentList:u},h).then(fromWireValue)}});return registerProxy(i,r),i}function myFlat(r){return Array.prototype.concat.apply([],r)}function processArguments(r){const e=r.map(toWireValue);return[e.map(t=>t[0]),myFlat(e.map(t=>t[1]))]}const transferCache=new WeakMap;function transfer(r,e){return transferCache.set(r,e),r}function proxy(r){return Object.assign(r,{[proxyMarker]:!0})}function toWireValue(r){for(const[e,t]of transferHandlers)if(t.canHandle(r)){const[n,s]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:r},transferCache.get(r)||[]]}function fromWireValue(r){switch(r.type){case"HANDLER":return transferHandlers.get(r.name).deserialize(r.value);case"RAW":return r.value}}function requestResponseMessage(r,e,t,n){return new Promise(s=>{const i=generateUUID();e.set(i,s),r.start&&r.start(),r.postMessage(Object.assign({id:i},t),n)})}function generateUUID(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let EPS=1e-6;const atan2=Math.atan2,grahamScan2=(r,e=EPS)=>{const t=r.length;if(t<=3)return r.slice();let n=1,s,i,o,a,u,h;const p=findMin(r);[u,h]=r[p];const m=[];for(s=0;s<t;s++)i=r[s],m[s]={p:i,t:atan2(i[1]-h,i[0]-u)};m.sort((E,x)=>E.t!==x.t?E.t-x.t:E.p[0]-x.p[0]);const v=[m[0].p];for(s=1;s<t;s++){for(i=v[n-2],o=v[n-1],a=m[s].p,u=a[0],h=a[1];n>1&&notCCW(i[0],i[1],o[0],o[1],u,h,e)||n===1&&o[0]===u&&o[1]===h;)n--,o=i,i=v[n-2];v[n++]=a}return v.length=n,v},notCCW=(r,e,t,n,s,i,o)=>(n-e)*(s-r)>=(t-r)*(i-e)-o,findMin=r=>{let e=r.length-1,t=e,[n,s]=r[e],i,o;for(;e-- >0;)i=r[e],o=i[1],(o<s||o===s&&i[0]<n)&&(n=i[0],s=o,t=e);return t};function makeSegmentCurve(r,e){return draw(r).lineTo(e).pendingCurves[0]}const range=r=>Array.from({length:r},(e,t)=>t),isSamePoint=([r,e],[t,n],s=1e-6)=>Math.abs(r-t)<=s&&Math.abs(e-n)<=s,zipWithNext=r=>r.slice(0,-1).map((e,t)=>[r[t],r[t+1]]).concat([[r.at(-1),r[0]]]),asPoints=(r,e)=>{const t=r.innerShape,n=t.blueprints||[t],s=0,i=e-1;let o=0;return n.flatMap(a=>{const u=a.curves;let h=u.flatMap((p,m)=>{const v=p.firstParameter,E=p.lastParameter,x=E-v,P=p.value(E),T=(m+1)%u.length,C=u[T];P.meta=[{curve:p,param:E,curveIndex:m+o,pointIndex:i},{curve:C,param:C.firstParameter,curveIndex:T+o,pointIndex:s}];const I=O=>v+O*x;return[P,...range(e-2).map(O=>{const G=I((O+1)/e),F=p.value(G);return F.meta={curve:p,param:G,curveIndex:m+o,pointIndex:O+1},F})]});return o+=u.length,h})};function shrinkWrap(r,e=100){const t=asPoints(r,e);let n=grahamScan2(t);n=n.flatMap((o,a)=>{const u=o.meta;if(!Array.isArray(u))return[o];const[h,p]=u.map(P=>{const T=[o[0],o[1]];return T.meta=P,T}),m=h.meta.curveIndex,v=p.meta.curveIndex,E=n[(a+1)%n.length].meta.curveIndex,x=n[(a-1+n.length)%n.length].meta.curveIndex;return m===E&&v===x?[p,h]:[h,p]});let s=zipWithNext(n).filter(([o,a])=>o.meta.curveIndex===a.meta.curveIndex?o.meta.curve.geomType==="LINE"?!1:Math.abs(a.meta.pointIndex-o.meta.pointIndex)!==1:!0).flat();s=s.filter((o,a)=>{const u=s[(a+1)%s.length],h=o.meta.curveIndex===u.meta.curveIndex,p=o.meta.pointIndex===u.meta.pointIndex;return!h||!p});const i=zipWithNext(s).filter(([o,a])=>!isSamePoint(o,a)).map(([o,a])=>{if(o.meta.curveIndex===a.meta.curveIndex){if(o.meta.pointIndex===0&&a.meta.pointIndex===e-1)return o.meta.curve;if(o.meta.pointIndex===e-1&&a.meta.pointIndex===0){let m=o.meta.curve.clone();return m.reverse(),m}const u=[o,a].filter(m=>m.meta.pointIndex!==0&&m.meta.pointIndex!==e-1).map(m=>m.meta.param),h=o.meta.curve.splitAt(u);let p=h[0];return o.meta.pointIndex!==0&&a.meta.pointIndex!==0&&(p=h[1]),o.meta.pointIndex>a.meta.pointIndex&&p.reverse(),p}return makeSegmentCurve(o,a)});return new Drawing(new Blueprint(i))}var entities={};entities.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",times:"",divide:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",euro:"",trade:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:""};var sax$1={},nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function ParseError$1(r,e){this.message=r,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError$1)}ParseError$1.prototype=new Error,ParseError$1.prototype.name=ParseError$1.name;function XMLReader$1(){}XMLReader$1.prototype={parse:function(r,e,t){var n=this.domBuilder;n.startDocument(),_copy(e,e={}),parse(r,e,t,n,this.errorHandler),n.endDocument()}};function parse(r,e,t,n,s){function i($){if($>65535){$-=65536;var X=55296+($>>10),ae=56320+($&1023);return String.fromCharCode(X,ae)}else return String.fromCharCode($)}function o($){var X=$.slice(1,-1);return X in t?t[X]:X.charAt(0)==="#"?i(parseInt(X.substr(1).replace("x","0x"))):(s.error("entity not found:"+$),$)}function a($){if($>P){var X=r.substring(P,$).replace(/&#?\w+;/g,o);v&&u(P),n.characters(X,0,$-P),P=$}}function u($,X){for(;$>=p&&(X=m.exec(r));)h=X.index,p=h+X[0].length,v.lineNumber++;v.columnNumber=$-h+1}for(var h=0,p=0,m=/.*(?:\r\n?|\n)|.*$/g,v=n.locator,E=[{currentNSMap:e}],x={},P=0;;){try{var T=r.indexOf("<",P);if(T<0){if(!r.substr(P).match(/^\s*$/)){var C=n.doc,I=C.createTextNode(r.substr(P));C.appendChild(I),n.currentElement=I}return}switch(T>P&&a(T),r.charAt(T+1)){case"/":var J=r.indexOf(">",T+3),O=r.substring(T+2,J),G=E.pop();J<0?(O=r.substring(T+2).replace(/[\s<].*/,""),s.error("end tag name: "+O+" is not complete:"+G.tagName),J=T+1+O.length):O.match(/\s</)&&(O=O.replace(/[\s<].*/,""),s.error("end tag name: "+O+" maybe not complete"),J=T+1+O.length);var F=G.localNSMap,Y=G.tagName==O,V=Y||G.tagName&&G.tagName.toLowerCase()==O.toLowerCase();if(V){if(n.endElement(G.uri,G.localName,O),F)for(var W in F)n.endPrefixMapping(W);Y||s.fatalError("end tag name: "+O+" is not match the current start tagName:"+G.tagName)}else E.push(G);J++;break;case"?":v&&u(T),J=parseInstruction(r,T,n);break;case"!":v&&u(T),J=parseDCC(r,T,n,s);break;default:v&&u(T);var q=new ElementAttributes,ce=E[E.length-1].currentNSMap,J=parseElementStartPart(r,T,q,ce,o,s),ge=q.length;if(!q.closed&&fixSelfClosed(r,J,q.tagName,x)&&(q.closed=!0,t.nbsp||s.warning("unclosed xml attribute")),v&&ge){for(var fe=copyLocator(v,{}),Q=0;Q<ge;Q++){var oe=q[Q];u(oe.offset),oe.locator=copyLocator(v,{})}n.locator=fe,appendElement$1(q,n,ce)&&E.push(q),n.locator=v}else appendElement$1(q,n,ce)&&E.push(q);q.uri==="http://www.w3.org/1999/xhtml"&&!q.closed?J=parseHtmlSpecialContent(r,J,q.tagName,o,n):J++}}catch($){if($ instanceof ParseError$1)throw $;s.error("element parse error: "+$),J=-1}J>P?P=J:a(Math.max(T,P)+1)}}function copyLocator(r,e){return e.lineNumber=r.lineNumber,e.columnNumber=r.columnNumber,e}function parseElementStartPart(r,e,t,n,s,i){function o(v,E,x){v in t.attributeNames&&i.fatalError("Attribute "+v+" redefined"),t.addValue(v,E,x)}for(var a,u,h=++e,p=S_TAG;;){var m=r.charAt(h);switch(m){case"=":if(p===S_ATTR)a=r.slice(e,h),p=S_EQ;else if(p===S_ATTR_SPACE)p=S_EQ;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(p===S_EQ||p===S_ATTR)if(p===S_ATTR&&(i.warning('attribute value must after "="'),a=r.slice(e,h)),e=h+1,h=r.indexOf(m,e),h>0)u=r.slice(e,h).replace(/&#?\w+;/g,s),o(a,u,e-1),p=S_ATTR_END;else throw new Error("attribute value no end '"+m+"' match");else if(p==S_ATTR_NOQUOT_VALUE)u=r.slice(e,h).replace(/&#?\w+;/g,s),o(a,u,e),i.warning('attribute "'+a+'" missed start quot('+m+")!!"),e=h+1,p=S_ATTR_END;else throw new Error('attribute value must after "="');break;case"/":switch(p){case S_TAG:t.setTagName(r.slice(e,h));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:p=S_TAG_CLOSE,t.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),p==S_TAG&&t.setTagName(r.slice(e,h)),h;case">":switch(p){case S_TAG:t.setTagName(r.slice(e,h));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:u=r.slice(e,h),u.slice(-1)==="/"&&(t.closed=!0,u=u.slice(0,-1));case S_ATTR_SPACE:p===S_ATTR_SPACE&&(u=a),p==S_ATTR_NOQUOT_VALUE?(i.warning('attribute "'+u+'" missed quot(")!'),o(a,u.replace(/&#?\w+;/g,s),e)):((n[""]!=="http://www.w3.org/1999/xhtml"||!u.match(/^(?:disabled|checked|selected)$/i))&&i.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),o(u,u,e));break;case S_EQ:throw new Error("attribute value missed!!")}return h;case"":m=" ";default:if(m<=" ")switch(p){case S_TAG:t.setTagName(r.slice(e,h)),p=S_TAG_SPACE;break;case S_ATTR:a=r.slice(e,h),p=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var u=r.slice(e,h).replace(/&#?\w+;/g,s);i.warning('attribute "'+u+'" missed quot(")!!'),o(a,u,e);case S_ATTR_END:p=S_TAG_SPACE;break}else switch(p){case S_ATTR_SPACE:t.tagName,(n[""]!=="http://www.w3.org/1999/xhtml"||!a.match(/^(?:disabled|checked|selected)$/i))&&i.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),o(a,a,e),e=h,p=S_ATTR;break;case S_ATTR_END:i.warning('attribute space is required"'+a+'"!!');case S_TAG_SPACE:p=S_ATTR,e=h;break;case S_EQ:p=S_ATTR_NOQUOT_VALUE,e=h;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}h++}}function appendElement$1(r,e,t){for(var n=r.tagName,s=null,m=r.length;m--;){var i=r[m],o=i.qName,a=i.value,v=o.indexOf(":");if(v>0)var u=i.prefix=o.slice(0,v),h=o.slice(v+1),p=u==="xmlns"&&h;else h=o,u=null,p=o==="xmlns"&&"";i.localName=h,p!==!1&&(s==null&&(s={},_copy(t,t={})),t[p]=s[p]=a,i.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(p,a))}for(var m=r.length;m--;){i=r[m];var u=i.prefix;u&&(u==="xml"&&(i.uri="http://www.w3.org/XML/1998/namespace"),u!=="xmlns"&&(i.uri=t[u||""]))}var v=n.indexOf(":");v>0?(u=r.prefix=n.slice(0,v),h=r.localName=n.slice(v+1)):(u=null,h=r.localName=n);var E=r.uri=t[u||""];if(e.startElement(E,h,n,r),r.closed){if(e.endElement(E,h,n),s)for(u in s)e.endPrefixMapping(u)}else return r.currentNSMap=t,r.localNSMap=s,!0}function parseHtmlSpecialContent(r,e,t,n,s){if(/^(?:script|textarea)$/i.test(t)){var i=r.indexOf("</"+t+">",e),o=r.substring(e+1,i);if(/[&<]/.test(o))return/^script$/i.test(t)?(s.characters(o,0,o.length),i):(o=o.replace(/&#?\w+;/g,n),s.characters(o,0,o.length),i)}return e+1}function fixSelfClosed(r,e,t,n){var s=n[t];return s==null&&(s=r.lastIndexOf("</"+t+">"),s<e&&(s=r.lastIndexOf("</"+t)),n[t]=s),s<e}function _copy(r,e){for(var t in r)e[t]=r[t]}function parseDCC(r,e,t,n){var s=r.charAt(e+2);switch(s){case"-":if(r.charAt(e+3)==="-"){var i=r.indexOf("-->",e+4);return i>e?(t.comment(r,e+4,i-e-4),i+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(r.substr(e+3,6)=="CDATA["){var i=r.indexOf("]]>",e+9);return t.startCDATA(),t.characters(r,e+9,i-e-9),t.endCDATA(),i+3}var o=split(r,e),a=o.length;if(a>1&&/!doctype/i.test(o[0][0])){var u=o[1][0],h=!1,p=!1;a>3&&(/^public$/i.test(o[2][0])?(h=o[3][0],p=a>4&&o[4][0]):/^system$/i.test(o[2][0])&&(p=o[3][0]));var m=o[a-1];return t.startDTD(u,h,p),t.endDTD(),m.index+m[0].length}}return-1}function parseInstruction(r,e,t){var n=r.indexOf("?>",e);if(n){var s=r.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return s?(s[0].length,t.processingInstruction(s[1],s[2]),n+2):-1}return-1}function ElementAttributes(){this.attributeNames={}}ElementAttributes.prototype={setTagName:function(r){if(!tagNamePattern.test(r))throw new Error("invalid tagName:"+r);this.tagName=r},addValue:function(r,e,t){if(!tagNamePattern.test(r))throw new Error("invalid attribute:"+r);this.attributeNames[r]=this.length,this[this.length++]={qName:r,value:e,offset:t}},length:0,getLocalName:function(r){return this[r].localName},getLocator:function(r){return this[r].locator},getQName:function(r){return this[r].qName},getURI:function(r){return this[r].uri},getValue:function(r){return this[r].value}};function split(r,e){var t,n=[],s=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(s.lastIndex=e,s.exec(r);t=s.exec(r);)if(n.push(t),t[1])return n}sax$1.XMLReader=XMLReader$1,sax$1.ParseError=ParseError$1;var dom={};function copy(r,e){for(var t in r)e[t]=r[t]}function _extends(r,e){var t=r.prototype;if(!(t instanceof e)){let n=function(){};n.prototype=e.prototype,n=new n,copy(t,n),r.prototype=t=n}t.constructor!=r&&(typeof r!="function"&&console.error("unknow Class:"+r),t.constructor=r)}var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(r,e){if(e instanceof Error)var t=e;else t=this,Error.call(this,ExceptionMessage[r]),this.message=ExceptionMessage[r],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return t.code=r,e&&(this.message=this.message+": "+e),t}DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(r){return this[r]||null},toString:function(r,e){for(var t=[],n=0;n<this.length;n++)serializeToString(this[n],t,r,e);return t.join("")}};function LiveNodeList(r,e){this._node=r,this._refresh=e,_updateLiveList(this)}function _updateLiveList(r){var e=r._node._inc||r._node.ownerDocument._inc;if(r._inc!=e){var t=r._refresh(r._node);__set__(r,"length",t.length),copy(t,r),r._inc=e}}LiveNodeList.prototype.item=function(r){return _updateLiveList(this),this[r]},_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(r,e){for(var t=r.length;t--;)if(r[t]===e)return t}function _addNamedNode(r,e,t,n){if(n?e[_findNodeIndex(e,n)]=t:e[e.length++]=t,r){t.ownerElement=r;var s=r.ownerDocument;s&&(n&&_onRemoveAttribute(s,r,n),_onAddAttribute(s,r,t))}}function _removeNamedNode(r,e,t){var n=_findNodeIndex(e,t);if(n>=0){for(var s=e.length-1;n<s;)e[n]=e[++n];if(e.length=s,r){var i=r.ownerDocument;i&&(_onRemoveAttribute(i,r,t),t.ownerElement=null)}}else throw DOMException(NOT_FOUND_ERR,new Error(r.tagName+"@"+t))}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(r){for(var e=this.length;e--;){var t=this[e];if(t.nodeName==r)return t}},setNamedItem:function(r){var e=r.ownerElement;if(e&&e!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var t=this.getNamedItem(r.nodeName);return _addNamedNode(this._ownerElement,this,r,t),t},setNamedItemNS:function(r){var e=r.ownerElement,t;if(e&&e!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return t=this.getNamedItemNS(r.namespaceURI,r.localName),_addNamedNode(this._ownerElement,this,r,t),t},removeNamedItem:function(r){var e=this.getNamedItem(r);return _removeNamedNode(this._ownerElement,this,e),e},removeNamedItemNS:function(r,e){var t=this.getNamedItemNS(r,e);return _removeNamedNode(this._ownerElement,this,t),t},getNamedItemNS:function(r,e){for(var t=this.length;t--;){var n=this[t];if(n.localName==e&&n.namespaceURI==r)return n}return null}};function DOMImplementation$1(r){if(this._features={},r)for(var e in r)this._features=r[e]}DOMImplementation$1.prototype={hasFeature:function(r,e){var t=this._features[r.toLowerCase()];return!!(t&&(!e||e in t))},createDocument:function(r,e,t){var n=new Document;if(n.implementation=this,n.childNodes=new NodeList,n.doctype=t,t&&n.appendChild(t),e){var s=n.createElementNS(r,e);n.appendChild(s)}return n},createDocumentType:function(r,e,t){var n=new DocumentType;return n.name=r,n.nodeName=r,n.publicId=e,n.systemId=t,n}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(r,e){return _insertBefore(this,r,e)},replaceChild:function(r,e){this.insertBefore(r,e),e&&this.removeChild(e)},removeChild:function(r){return _removeChild(this,r)},appendChild:function(r){return this.insertBefore(r,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(r){return cloneNode(this.ownerDocument||this,this,r)},normalize:function(){for(var r=this.firstChild;r;){var e=r.nextSibling;e&&e.nodeType==TEXT_NODE&&r.nodeType==TEXT_NODE?(this.removeChild(e),r.appendData(e.data)):(r.normalize(),r=e)}},isSupported:function(r,e){return this.ownerDocument.implementation.hasFeature(r,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(r){for(var e=this;e;){var t=e._nsMap;if(t){for(var n in t)if(t[n]==r)return n}e=e.nodeType==ATTRIBUTE_NODE?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(r){for(var e=this;e;){var t=e._nsMap;if(t&&r in t)return t[r];e=e.nodeType==ATTRIBUTE_NODE?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(r){var e=this.lookupPrefix(r);return e==null}};function _xmlEncoder(r){return r=="<"&&"&lt;"||r==">"&&"&gt;"||r=="&"&&"&amp;"||r=='"'&&"&quot;"||"&#"+r.charCodeAt()+";"}copy(NodeType,Node),copy(NodeType,Node.prototype);function _visitNode(r,e){if(e(r))return!0;if(r=r.firstChild)do if(_visitNode(r,e))return!0;while(r=r.nextSibling)}function Document(){}function _onAddAttribute(r,e,t){r&&r._inc++;var n=t.namespaceURI;n=="http://www.w3.org/2000/xmlns/"&&(e._nsMap[t.prefix?t.localName:""]=t.value)}function _onRemoveAttribute(r,e,t,n){r&&r._inc++;var s=t.namespaceURI;s=="http://www.w3.org/2000/xmlns/"&&delete e._nsMap[t.prefix?t.localName:""]}function _onUpdateChild(r,e,t){if(r&&r._inc){r._inc++;var n=e.childNodes;if(t)n[n.length++]=t;else{for(var s=e.firstChild,i=0;s;)n[i++]=s,s=s.nextSibling;n.length=i}}}function _removeChild(r,e){var t=e.previousSibling,n=e.nextSibling;return t?t.nextSibling=n:r.firstChild=n,n?n.previousSibling=t:r.lastChild=t,_onUpdateChild(r.ownerDocument,r),e}function _insertBefore(r,e,t){var n=e.parentNode;if(n&&n.removeChild(e),e.nodeType===DOCUMENT_FRAGMENT_NODE){var s=e.firstChild;if(s==null)return e;var i=e.lastChild}else s=i=e;var o=t?t.previousSibling:r.lastChild;s.previousSibling=o,i.nextSibling=t,o?o.nextSibling=s:r.firstChild=s,t==null?r.lastChild=i:t.previousSibling=i;do s.parentNode=r;while(s!==i&&(s=s.nextSibling));return _onUpdateChild(r.ownerDocument||r,r),e.nodeType==DOCUMENT_FRAGMENT_NODE&&(e.firstChild=e.lastChild=null),e}function _appendSingleChild(r,e){var t=e.parentNode;if(t){var n=r.lastChild;t.removeChild(e);var n=r.lastChild}var n=r.lastChild;return e.parentNode=r,e.previousSibling=n,e.nextSibling=null,n?n.nextSibling=e:r.firstChild=e,r.lastChild=e,_onUpdateChild(r.ownerDocument,r,e),e}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(r,e){if(r.nodeType==DOCUMENT_FRAGMENT_NODE){for(var t=r.firstChild;t;){var n=t.nextSibling;this.insertBefore(t,e),t=n}return r}return this.documentElement==null&&r.nodeType==ELEMENT_NODE&&(this.documentElement=r),_insertBefore(this,r,e),r.ownerDocument=this,r},removeChild:function(r){return this.documentElement==r&&(this.documentElement=null),_removeChild(this,r)},importNode:function(r,e){return importNode(this,r,e)},getElementById:function(r){var e=null;return _visitNode(this.documentElement,function(t){if(t.nodeType==ELEMENT_NODE&&t.getAttribute("id")==r)return e=t,!0}),e},getElementsByClassName:function(r){var e=new RegExp("(^|\\s)"+r+"(\\s|$)");return new LiveNodeList(this,function(t){var n=[];return _visitNode(t.documentElement,function(s){s!==t&&s.nodeType==ELEMENT_NODE&&e.test(s.getAttribute("class"))&&n.push(s)}),n})},createElement:function(r){var e=new Element;e.ownerDocument=this,e.nodeName=r,e.tagName=r,e.childNodes=new NodeList;var t=e.attributes=new NamedNodeMap;return t._ownerElement=e,e},createDocumentFragment:function(){var r=new DocumentFragment;return r.ownerDocument=this,r.childNodes=new NodeList,r},createTextNode:function(r){var e=new Text;return e.ownerDocument=this,e.appendData(r),e},createComment:function(r){var e=new Comment;return e.ownerDocument=this,e.appendData(r),e},createCDATASection:function(r){var e=new CDATASection;return e.ownerDocument=this,e.appendData(r),e},createProcessingInstruction:function(r,e){var t=new ProcessingInstruction;return t.ownerDocument=this,t.tagName=t.target=r,t.nodeValue=t.data=e,t},createAttribute:function(r){var e=new Attr;return e.ownerDocument=this,e.name=r,e.nodeName=r,e.localName=r,e.specified=!0,e},createEntityReference:function(r){var e=new EntityReference;return e.ownerDocument=this,e.nodeName=r,e},createElementNS:function(r,e){var t=new Element,n=e.split(":"),s=t.attributes=new NamedNodeMap;return t.childNodes=new NodeList,t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.namespaceURI=r,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,s._ownerElement=t,t},createAttributeNS:function(r,e){var t=new Attr,n=e.split(":");return t.ownerDocument=this,t.nodeName=e,t.name=e,t.namespaceURI=r,t.specified=!0,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,t}},_extends(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(r){return this.getAttributeNode(r)!=null},getAttribute:function(r){var e=this.getAttributeNode(r);return e&&e.value||""},getAttributeNode:function(r){return this.attributes.getNamedItem(r)},setAttribute:function(r,e){var t=this.ownerDocument.createAttribute(r);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(r){var e=this.getAttributeNode(r);e&&this.removeAttributeNode(e)},appendChild:function(r){return r.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(r,null):_appendSingleChild(this,r)},setAttributeNode:function(r){return this.attributes.setNamedItem(r)},setAttributeNodeNS:function(r){return this.attributes.setNamedItemNS(r)},removeAttributeNode:function(r){return this.attributes.removeNamedItem(r.nodeName)},removeAttributeNS:function(r,e){var t=this.getAttributeNodeNS(r,e);t&&this.removeAttributeNode(t)},hasAttributeNS:function(r,e){return this.getAttributeNodeNS(r,e)!=null},getAttributeNS:function(r,e){var t=this.getAttributeNodeNS(r,e);return t&&t.value||""},setAttributeNS:function(r,e,t){var n=this.ownerDocument.createAttributeNS(r,e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},getAttributeNodeNS:function(r,e){return this.attributes.getNamedItemNS(r,e)},getElementsByTagName:function(r){return new LiveNodeList(this,function(e){var t=[];return _visitNode(e,function(n){n!==e&&n.nodeType==ELEMENT_NODE&&(r==="*"||n.tagName==r)&&t.push(n)}),t})},getElementsByTagNameNS:function(r,e){return new LiveNodeList(this,function(t){var n=[];return _visitNode(t,function(s){s!==t&&s.nodeType===ELEMENT_NODE&&(r==="*"||s.namespaceURI===r)&&(e==="*"||s.localName==e)&&n.push(s)}),n})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(r,e){return this.data.substring(r,r+e)},appendData:function(r){r=this.data+r,this.nodeValue=this.data=r,this.length=r.length},insertData:function(r,e){this.replaceData(r,0,e)},appendChild:function(r){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(r,e){this.replaceData(r,e,"")},replaceData:function(r,e,t){var n=this.data.substring(0,r),s=this.data.substring(r+e);t=n+t+s,this.nodeValue=this.data=t,this.length=t.length}},_extends(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(r){var e=this.data,t=e.substring(r);e=e.substring(0,r),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(r,e,t){return nodeSerializeToString.call(r,e,t)},Node.prototype.toString=nodeSerializeToString;function nodeSerializeToString(r,e){var t=[],n=this.nodeType==9&&this.documentElement||this,s=n.prefix,i=n.namespaceURI;if(i&&s==null){var s=n.lookupPrefix(i);if(s==null)var o=[{namespace:i,prefix:null}]}return serializeToString(this,t,r,e,o),t.join("")}function needNamespaceDefine(r,e,t){var n=r.prefix||"",s=r.namespaceURI;if(!n&&!s||n==="xml"&&s==="http://www.w3.org/XML/1998/namespace"||s=="http://www.w3.org/2000/xmlns/")return!1;for(var i=t.length;i--;){var o=t[i];if(o.prefix==n)return o.namespace!=s}return!0}function serializeToString(r,e,t,n,s){if(n)if(r=n(r),r){if(typeof r=="string"){e.push(r);return}}else return;switch(r.nodeType){case ELEMENT_NODE:s||(s=[]),s.length;var i=r.attributes,o=i.length,E=r.firstChild,a=r.tagName;t=htmlns===r.namespaceURI||t,e.push("<",a);for(var u=0;u<o;u++){var h=i.item(u);h.prefix=="xmlns"?s.push({prefix:h.localName,namespace:h.value}):h.nodeName=="xmlns"&&s.push({prefix:"",namespace:h.value})}for(var u=0;u<o;u++){var h=i.item(u);if(needNamespaceDefine(h,t,s)){var p=h.prefix||"",m=h.namespaceURI,v=p?" xmlns:"+p:" xmlns";e.push(v,'="',m,'"'),s.push({prefix:p,namespace:m})}serializeToString(h,e,t,n,s)}if(needNamespaceDefine(r,t,s)){var p=r.prefix||"",m=r.namespaceURI;if(m){var v=p?" xmlns:"+p:" xmlns";e.push(v,'="',m,'"'),s.push({prefix:p,namespace:m})}}if(E||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(a)){if(e.push(">"),t&&/^script$/i.test(a))for(;E;)E.data?e.push(E.data):serializeToString(E,e,t,n,s),E=E.nextSibling;else for(;E;)serializeToString(E,e,t,n,s),E=E.nextSibling;e.push("</",a,">")}else e.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var E=r.firstChild;E;)serializeToString(E,e,t,n,s),E=E.nextSibling;return;case ATTRIBUTE_NODE:return e.push(" ",r.name,'="',r.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return e.push(r.data.replace(/[<&]/g,_xmlEncoder).replace(/]]>/g,"]]&gt;"));case CDATA_SECTION_NODE:return e.push("<![CDATA[",r.data,"]]>");case COMMENT_NODE:return e.push("<!--",r.data,"-->");case DOCUMENT_TYPE_NODE:var x=r.publicId,P=r.systemId;if(e.push("<!DOCTYPE ",r.name),x)e.push(" PUBLIC ",x),P&&P!="."&&e.push(" ",P),e.push(">");else if(P&&P!=".")e.push(" SYSTEM ",P,">");else{var T=r.internalSubset;T&&e.push(" [",T,"]"),e.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return e.push("<?",r.target," ",r.data,"?>");case ENTITY_REFERENCE_NODE:return e.push("&",r.nodeName,";");default:e.push("??",r.nodeName)}}function importNode(r,e,t){var n;switch(e.nodeType){case ELEMENT_NODE:n=e.cloneNode(!1),n.ownerDocument=r;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:t=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=r,n.parentNode=null,t)for(var s=e.firstChild;s;)n.appendChild(importNode(r,s,t)),s=s.nextSibling;return n}function cloneNode(r,e,t){var n=new e.constructor;for(var s in e){var i=e[s];typeof i!="object"&&i!=n[s]&&(n[s]=i)}switch(e.childNodes&&(n.childNodes=new NodeList),n.ownerDocument=r,n.nodeType){case ELEMENT_NODE:var o=e.attributes,a=n.attributes=new NamedNodeMap,u=o.length;a._ownerElement=n;for(var h=0;h<u;h++)n.setAttributeNode(cloneNode(r,o.item(h),!0));break;case ATTRIBUTE_NODE:t=!0}if(t)for(var p=e.firstChild;p;)n.appendChild(cloneNode(r,p,t)),p=p.nextSibling;return n}function __set__(r,e,t){r[e]=t}try{if(Object.defineProperty){let r=function(e){switch(e.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var t=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&t.push(r(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return r(this)},set:function(e){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),__set__=function(e,t,n){e["$$"+t]=n}}}catch(r){}dom.Node=Node,dom.DOMException=DOMException,dom.DOMImplementation=DOMImplementation$1,dom.XMLSerializer=XMLSerializer;function DOMParser(r){this.options=r||{locator:{}}}DOMParser.prototype.parseFromString=function(r,e){var t=this.options,n=new XMLReader,s=t.domBuilder||new DOMHandler,i=t.errorHandler,o=t.locator,a=t.xmlns||{},u=/\/x?html?$/.test(e),h=u?htmlEntity.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return o&&s.setDocumentLocator(o),n.errorHandler=buildErrorHandler(i,s,o),n.domBuilder=t.domBuilder||s,u&&(a[""]="http://www.w3.org/1999/xhtml"),a.xml=a.xml||"http://www.w3.org/XML/1998/namespace",r&&typeof r=="string"?n.parse(r,a,h):n.errorHandler.error("invalid doc source"),s.doc};function buildErrorHandler(r,e,t){if(!r){if(e instanceof DOMHandler)return e;r=e}var n={},s=r instanceof Function;t=t||{};function i(o){var a=r[o];!a&&s&&(a=r.length==2?function(u){r(o,u)}:r),n[o]=a&&function(u){a("[xmldom "+o+"]	"+u+_locator(t))}||function(){}}return i("warning"),i("error"),i("fatalError"),n}function DOMHandler(){this.cdata=!1}function position(r,e){e.lineNumber=r.lineNumber,e.columnNumber=r.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=new DOMImplementation().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(r,e,t,n){var s=this.doc,i=s.createElementNS(r,t||e),o=n.length;appendElement(this,i),this.currentElement=i,this.locator&&position(this.locator,i);for(var a=0;a<o;a++){var r=n.getURI(a),u=n.getValue(a),t=n.getQName(a),h=s.createAttributeNS(r,t);this.locator&&position(n.getLocator(a),h),h.value=h.nodeValue=u,i.setAttributeNode(h)}},endElement:function(r,e,t){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(r,e){},endPrefixMapping:function(r){},processingInstruction:function(r,e){var t=this.doc.createProcessingInstruction(r,e);this.locator&&position(this.locator,t),appendElement(this,t)},ignorableWhitespace:function(r,e,t){},characters:function(r,e,t){if(r=_toString.apply(this,arguments),r){if(this.cdata)var n=this.doc.createCDATASection(r);else var n=this.doc.createTextNode(r);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(r)&&this.doc.appendChild(n),this.locator&&position(this.locator,n)}},skippedEntity:function(r){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(r){(this.locator=r)&&(r.lineNumber=0)},comment:function(r,e,t){r=_toString.apply(this,arguments);var n=this.doc.createComment(r);this.locator&&position(this.locator,n),appendElement(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(r,e,t){var n=this.doc.implementation;if(n&&n.createDocumentType){var s=n.createDocumentType(r,e,t);this.locator&&position(this.locator,s),appendElement(this,s)}},warning:function(r){console.warn("[xmldom warning]	"+r,_locator(this.locator))},error:function(r){console.error("[xmldom error]	"+r,_locator(this.locator))},fatalError:function(r){throw new ParseError(r,this.locator)}};function _locator(r){if(r)return`
@`+(r.systemId||"")+"#[line:"+r.lineNumber+",col:"+r.columnNumber+"]"}function _toString(r,e,t){return typeof r=="string"?r.substr(e,t):r.length>=e+t||e?new java.lang.String(r,e,t)+"":r}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(r){DOMHandler.prototype[r]=function(){return null}});function appendElement(r,e){r.currentElement?r.currentElement.appendChild(e):r.doc.appendChild(e)}var htmlEntity=entities,sax=sax$1,XMLReader=sax.XMLReader,ParseError=sax.ParseError,DOMImplementation=dom.DOMImplementation,DOMParser_1=DOMParser;const fuseIntersectingBlueprints=r=>{const e=new Map,t=[];return r.forEach((n,s)=>{let i={current:n};e.has(s)?i=e.get(s):t.push(i);let o=i.current;r.slice(s+1).forEach((a,u)=>{const h=s+u+1;let p=a,m=!1;e.has(h)&&(p=e.get(h).current,m=!0),!o.boundingBox.isOut(p.boundingBox)&&o.intersects(p)&&(i.current=fuseBlueprints(o,p),m&&(e.get(h).current=!1),e.set(h,i))})}),t.map(({current:n})=>n).filter(n=>n)},COMMAND=0,NUMBER=1,EOD=2,PARAMS={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function tokenize(r){const e=new Array;for(;r!=="";)if(r.match(/^([ \t\r\n,]+)/))r=r.substr(RegExp.$1.length);else if(r.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:COMMAND,text:RegExp.$1},r=r.substr(RegExp.$1.length);else if(r.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))e[e.length]={type:NUMBER,text:`${parseFloat(RegExp.$1)}`},r=r.substr(RegExp.$1.length);else return[];return e[e.length]={type:EOD,text:""},e}function isType(r,e){return r.type===e}function parsePath(r){const e=[],t=tokenize(r);let n="BOD",s=0,i=t[s];for(;!isType(i,EOD);){let o=0;const a=[];if(n==="BOD")if(i.text==="M"||i.text==="m")s++,o=PARAMS[i.text],n=i.text;else return parsePath("M0,0"+r);else isType(i,NUMBER)?o=PARAMS[n]:(s++,o=PARAMS[i.text],n=i.text);if(s+o<t.length){for(let u=s;u<s+o;u++){const h=t[u];if(isType(h,NUMBER))a[a.length]=+h.text;else throw new Error("Param not a number: "+n+","+h.text)}if(typeof PARAMS[n]=="number"){const u={key:n,data:a};e.push(u),s+=o,i=t[s],n==="M"&&(n="L"),n==="m"&&(n="l")}else throw new Error("Bad segment: "+n)}else throw new Error("Path data ended short")}return e}function absolutize(r){let e=0,t=0,n=0,s=0;const i=[];for(const{key:o,data:a}of r)switch(o){case"M":i.push({key:"M",data:[...a]}),[e,t]=a,[n,s]=a;break;case"m":e+=a[0],t+=a[1],i.push({key:"M",data:[e,t]}),n=e,s=t;break;case"L":i.push({key:"L",data:[...a]}),[e,t]=a;break;case"l":e+=a[0],t+=a[1],i.push({key:"L",data:[e,t]});break;case"C":i.push({key:"C",data:[...a]}),e=a[4],t=a[5];break;case"c":{const u=a.map((h,p)=>p%2?h+t:h+e);i.push({key:"C",data:u}),e=u[4],t=u[5];break}case"Q":i.push({key:"Q",data:[...a]}),e=a[2],t=a[3];break;case"q":{const u=a.map((h,p)=>p%2?h+t:h+e);i.push({key:"Q",data:u}),e=u[2],t=u[3];break}case"A":i.push({key:"A",data:[...a]}),e=a[5],t=a[6];break;case"a":e+=a[5],t+=a[6],i.push({key:"A",data:[a[0],a[1],a[2],a[3],a[4],e,t]});break;case"H":i.push({key:"H",data:[...a]}),e=a[0];break;case"h":e+=a[0],i.push({key:"H",data:[e]});break;case"V":i.push({key:"V",data:[...a]}),t=a[0];break;case"v":t+=a[0],i.push({key:"V",data:[t]});break;case"S":i.push({key:"S",data:[...a]}),e=a[2],t=a[3];break;case"s":{const u=a.map((h,p)=>p%2?h+t:h+e);i.push({key:"S",data:u}),e=u[2],t=u[3];break}case"T":i.push({key:"T",data:[...a]}),e=a[0],t=a[1];break;case"t":e+=a[0],t+=a[1],i.push({key:"T",data:[e,t]});break;case"Z":case"z":i.push({key:"Z",data:[]}),e=n,t=s;break}return i}const roundedRectangleBlueprint=({x:r=0,y:e=0,rx:t=0,ry:n=0,width:s,height:i})=>{let o=Math.min(t,s/2),a=Math.min(n,i/2);const u=o&&a;u||(o=0,a=0);const h=new BlueprintSketcher([r+s/2,e]);return o<s/2&&h.hLine(s/2-o),u&&h.ellipse(o,a,o,a,0,!1,!0),a<i/2&&h.vLine(i-2*a),u&&h.ellipse(-o,a,o,a,0,!1,!0),h.hLine(-s/2+o).closeWithMirror()},ellipseBlueprint=({cx:r=0,cy:e=0,rx:t,ry:n})=>{const s=new BlueprintSketcher([r-t,e]);return s.halfEllipse(2*t,0,n,!1,!0),s.halfEllipse(-2*t,0,n,!1,!0),s.close()},parseArgs=(r,e,t)=>{let n,s=null,i=null;if(r.key==="M"){const[o,a]=r.data;return n=[o,a],{p:n}}if(r.key==="H"){const[o]=r.data;return n=[o,(e==null?void 0:e[1])||0],{p:n}}if(r.key==="V"){const[o]=r.data;return n=[(e==null?void 0:e[0])||0,o],{p:n}}if(r.key==="L"){const[o,a]=r.data;return n=[o,a],{p:n}}if(r.key==="C"){const[o,a,u,h,p,m]=r.data;return n=[p,m],s=[o,a],i=[u,h],{p:n,control1:s,control2:i}}if(r.key==="S"){const[o,a,u,h]=r.data;if(n=[u,h],i=[o,a],s=e,t.control2){const p=e;s=[p[0]+(p[0]-t.control2[0]),p[1]+(p[1]-t.control2[1])]}return{p:n,control1:s,control2:i}}if(r.key==="Q"){const[o,a,u,h]=r.data;return n=[u,h],s=[o,a],{p:n,control1:s}}if(r.key==="T"){const[o,a]=r.data;if(n=[o,a],s=e,t.control1&&!t.control2){const u=e;s=[u[0]+(u[0]-t.control1[0]),u[1]+(u[1]-t.control1[1])]}}if(r.key==="A"){const[o,a,u=0,h=0,p=0,m,v]=r.data;n=[m,v];const E=Math.sqrt((e[0]-m)**2+(e[1]-v)**2),x=Math.max(o,a);let P=o,T=a;if(x<E/2){const C=E/2/x;P=o*C,T=a*C}return{p:n,arcConfig:[P,T,u,!!h,!!p]}}},SVGPathBlueprint=function*(r){const e=absolutize(parsePath(r));let t=null,n=null,s={control1:null,control2:null};for(const i of e){if(i.key==="Z"){t&&(yield t.close()),t=null;continue}const{p:o,control1:a,control2:u,arcConfig:h=[]}=parseArgs(i,n,s);if(i.key==="M"){t&&(yield t.done()),t=new BlueprintSketcher(o),n=o;continue}if(n&&Math.abs(o[0]-n[0])<1e-9&&Math.abs(o[1]-n[1])<1e-9){n=o,s={control1:a,control2:u};continue}(i.key==="L"||i.key==="H"||i.key==="V")&&(t==null||t.lineTo(o)),(i.key==="C"||i.key==="S")&&(t==null||t.cubicBezierCurveTo(o,a,u)),(i.key==="Q"||i.key==="T")&&(t==null||t.quadraticBezierCurveTo(o,a)),i.key==="A"&&(t==null||t.ellipseTo(o,...h)),n=o,s={control1:a,control2:u}}t&&(yield t.done())};function drawSVG(r,{width:e}={}){const n=new DOMParser_1().parseFromString(r,"text/html");let s=[];for(let a of Array.from(n.getElementsByTagName("path"))){let u=a.getAttribute("d");const h=Array.from(SVGPathBlueprint(u));s.push(...h)}for(let a of Array.from(n.getElementsByTagName("polygon"))){let u=a.getAttribute("points");s=s.concat(Array.from(SVGPathBlueprint(`M${u}z`)))}for(let a of Array.from(n.getElementsByTagName("rect"))){const u=parseFloat(a.getAttribute("x"))||0,h=parseFloat(a.getAttribute("y"))||0,p=parseFloat(a.getAttribute("width"))||0,m=parseFloat(a.getAttribute("height"))||0;let v=parseFloat(a.getAttribute("rx"))||0,E=parseFloat(a.getAttribute("ry"))||0;s.push(roundedRectangleBlueprint({x:u,y:h,rx:v,ry:E,width:p,height:m}))}for(let a of Array.from(n.getElementsByTagName("circle"))){const u=parseFloat(a.getAttribute("cx"))||0,h=parseFloat(a.getAttribute("cy"))||0,p=parseFloat(a.getAttribute("r"))||0;s.push(ellipseBlueprint({cx:u,cy:h,rx:p,ry:p}))}for(let a of Array.from(n.getElementsByTagName("ellipse"))){const u=parseFloat(a.getAttribute("cx"))||0,h=parseFloat(a.getAttribute("cy"))||0,p=parseFloat(a.getAttribute("rx"))||0,m=parseFloat(a.getAttribute("ry"))||0;s.push(ellipseBlueprint({cx:u,cy:h,rx:p,ry:m}))}const i=fuseIntersectingBlueprints(s);let o=organiseBlueprints(i).mirror([1,0],[0,0],"plane");if(e){const a=e/o.boundingBox.width;o=o.scale(a,o.boundingBox.center)}return new Drawing(o)}const fonts={ANTON:"http://fonts.gstatic.com/s/anton/v7/XIbCenm-W0IRHWYIh7CGUQ.ttf",ROBOTO:"https://fonts.gstatic.com/s/roboto/v15/W5F8_SL0XFawnjxHGsZjJA.ttf",NOTOSANS:"http://fonts.gstatic.com/s/notosansdisplay/v20/RLplK4fy6r6tOBEJg0IAKzqdFZVZxokvfn_BDLxR.ttf",ANONYMOUSPRO:"http://fonts.gstatic.com/s/anonymouspro/v14/rP2Bp2a15UIB7Un-bOeISG3pLlw89CH98Ko.ttf",MONSERRAT:"http://fonts.gstatic.com/s/montserrat/v15/JTURjIg1_i6t8kCHKm45_dJE3gnD-w.ttf",AGUAFINA:"http://fonts.gstatic.com/s/aguafinascript/v5/65g7cgMtMGnNlNyq_Z6CvMxLhO8OSNnfAp53LK1_iRs.ttf",OPEN_SANS:"http://fonts.gstatic.com/s/opensans/v13/IgZJs4-7SA1XX_edsoXWog.ttf",INCONSOLATA:"http://fonts.gstatic.com/s/inconsolata/v15/AIed271kqQlcIRSOnQH0yXe1Pd76Vl7zRpE7NLJQ7XU.ttf"},TOL=Math.pow(10,-9),NFP_KEY_INDICES=new Uint8Array([0,10,19,23,27,32]),UINT16_BIT_COUNT=16,NFP_INFO_START_INDEX=2;function getAngleCache(){const r=new Map,e=16,t=new Float32Array(2);let n=0,s=0,i=0,o=0,a=0,u=0;for(a=1;a<=e;++a)for(n=Math.round(360/a),s=2*Math.PI/a,u=0;u<a;++u)o=n*u,r.has(o)||(i=s*u,t[0]=Math.sin(i),t[1]=Math.cos(i),r.set(o,t.slice()));return r}const ANGLE_CACHE=getAngleCache();function getMask(r,e=0){return(1<<r)-1<<e}function setBits(r,e,t,n){const s=getMask(n,t);return r&~s|e<<t&s}function getBits(r,e,t){return r>>>e&getMask(t)}function getUint16(r,e){return getBits(r,e*UINT16_BIT_COUNT,UINT16_BIT_COUNT)}function almostEqual(r,e=0,t=TOL){return Math.abs(r-e)<t}function midValue(r,e,t){return Math.abs(2*r-e-t)-Math.abs(e-t)}function cycleIndex(r,e,t){return(r+e+t)%e}function toRotationIndex(r,e){return Math.round(r*e/360)}function generateNFPCacheKey(r,e,t,n){const s=toRotationIndex(t.rotation,r),i=toRotationIndex(n.rotation,r),o=new Uint8Array([t.source+1,n.source+1,s,i,e?1:0]),a=o.length;let u=0,h=0;for(h=0;h<a;++h)u=setBits(u,o[h],NFP_KEY_INDICES[h],NFP_KEY_INDICES[h+1]-NFP_KEY_INDICES[h]);return u}function getPolygonNode(r,e){return{source:r,rotation:0,memSeg:e,children:[]}}function calculateTotalSize(r,e){return r.reduce((t,n)=>{const s=(Float64Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT<<1)+n.memSeg.byteLength,i=t+s;return calculateTotalSize(n.children,i)},e)}function serializeNodes(r,e,t,n){return r.reduce((s,i)=>{t.setFloat64(s,i.source+1),s+=Float64Array.BYTES_PER_ELEMENT,t.setFloat64(s,i.rotation),s+=Float64Array.BYTES_PER_ELEMENT;const o=i.memSeg.length;t.setUint32(s,o>>1),s+=Uint32Array.BYTES_PER_ELEMENT;const a=new Uint8Array(i.memSeg.buffer,i.memSeg.byteOffset,i.memSeg.byteLength);new Uint8Array(e,s).set(a),s+=a.byteLength;const u=i.children.length;return t.setUint32(s,u),s+=Uint32Array.BYTES_PER_ELEMENT,serializeNodes(i.children,e,t,s)},n)}function serializePolygonNodes(r,e=0){const t=Uint32Array.BYTES_PER_ELEMENT+e,n=calculateTotalSize(r,t),s=new ArrayBuffer(n),i=new DataView(s);return i.setUint32(e,r.length),serializeNodes(r,s,i,t),s}function serializeConfig(r){let e=0;return e=setBits(e,r.curveTolerance*10,0,4),e=setBits(e,r.spacing,4,5),e=setBits(e,r.rotations,9,5),e=setBits(e,r.populationSize,14,7),e=setBits(e,r.mutationRate,21,7),e=setBits(e,Number(r.useHoles),28,1),e}function serializeMapToBuffer(r){const e=Array.from(r.values()).reduce((o,a)=>o+(Uint32Array.BYTES_PER_ELEMENT<<1)+a.byteLength,0),t=new ArrayBuffer(e),n=new DataView(t),s=Array.from(r.entries());let i=0;return s.reduce((o,[a,u])=>(n.setUint32(o,a),o+=Uint32Array.BYTES_PER_ELEMENT,i=u.byteLength,n.setUint32(o,i),o+=Uint32Array.BYTES_PER_ELEMENT,new Uint8Array(t,o).set(new Uint8Array(u)),o+i),0),t}function clipperRound(r){return r<0?-Math.round(Math.abs(r)):Math.round(r)}function castInt64(r){return r<0?Math.ceil(r):Math.floor(r)}function splitTo16Bits(r){const n=new Uint16Array(4);let s=Math.abs(r<<0),i=0;for(i=0;i<4;++i)n[i]=s&65535,s=s>>>16;return n}function mulInt128(r,e){const t=splitTo16Bits(r),n=splitTo16Bits(e),s=new Uint32Array(5),i=4294967295;let o=0;for(s[0]=0,s[1]=t[0]*n[0]&i,s[2]=t[1]*n[0]+t[0]*n[1]&i,s[3]=t[2]*n[0]+t[0]*n[2]+t[1]*n[1]&i,s[4]=t[3]*n[3]+t[3]*n[0]+t[2]*n[1]&i,o=4;o>0;--o)s[o]+=s[o-1]>>>16;return s[0]=1+Math.sign(r)*Math.sign(e),s}function equalityInt128(r,e){const t=r.length;let n=0;for(n=0;n<t;++n)if(r[n]!==e[n])return!1;return!0}function slopesEqual(r,e,t,n,s){return s?equalityInt128(mulInt128(r,e),mulInt128(t,n)):castInt64(r*e)-castInt64(t*n)===0}var POLY_FILL_TYPE=(r=>(r[r.NON_ZERO=1]="NON_ZERO",r[r.POSITIVE=2]="POSITIVE",r[r.NEGATIVE=3]="NEGATIVE",r))(POLY_FILL_TYPE||{}),POLY_TYPE=(r=>(r[r.SUBJECT=0]="SUBJECT",r[r.CLIP=1]="CLIP",r))(POLY_TYPE||{}),CLIP_TYPE=(r=>(r[r.UNION=1]="UNION",r[r.DIFFERENCE=2]="DIFFERENCE",r))(CLIP_TYPE||{}),DIRECTION=(r=>(r[r.LEFT=0]="LEFT",r[r.RIGHT=1]="RIGHT",r))(DIRECTION||{});const te=class te{constructor(e,t=0){this.memSeg=e,this.offset=t}bind(e,t=0){return this.memSeg=e,this.offset=t,this}fromMemSeg(e,t=0,n=0){return this.x=e[n+(t<<1)],this.y=e[n+(t<<1)+1],this}fill(e,t,n=0){e[n+(t<<1)]=this.x,e[n+(t<<1)+1]=this.y}set(e,t){return this.x=e,this.y=t,this}update(e){return this.set(e.x,e.y)}fromClipper(e){return this.set(e.x,e.y)}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e.x,this.y*=e.y,this}scaleUp(e){return this.x*=e,this.y*=e,this}scaleDown(e){return this.x/=e,this.y/=e,this}max(e){return this.set(Math.max(this.x,e.x),Math.max(this.y,e.y))}min(e){return this.set(Math.min(this.x,e.x),Math.min(this.y,e.y))}rotate(e){const t=ANGLE_CACHE.get(e),n=t[0],s=t[1];return this.set(this.x*s-this.y*n,this.x*n+this.y*s)}cross(e){return this.y*e.x-this.x*e.y}dot(e){return this.x*e.x+this.y*e.y}getBetween(e,t){return e.almostEqual(t)||e.almostEqual(this)||this.almostEqual(t)?!1:e.x!==t.x?this.x>e.x==this.x<t.x:this.y>e.y==this.y<t.y}len2(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}len(e){return Math.sqrt(this.len2(e))}normalize(){const e=this.length;return!almostEqual(e,1)&&!this.isEmpty&&(this.x=this.x/e,this.y=this.y/e),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clipperRound(){return this.x=clipperRound(this.x),this.y=clipperRound(this.y),this}normal(){return this.set(this.y,-this.x)}reverse(){return this.set(-this.x,-this.y)}onSegment(e,t){const n=midValue(this.x,e.x,t.x),s=midValue(this.y,e.y,t.y);if(almostEqual(e.x,t.x)&&almostEqual(this.x,e.x))return!almostEqual(this.y,t.y)&&!almostEqual(this.y,e.y)&&s<0;if(almostEqual(e.y,t.y)&&almostEqual(this.y,e.y))return!almostEqual(this.x,t.x)&&!almostEqual(this.x,e.x)&&n<0;if(n>0||s>0||this.almostEqual(e)||this.almostEqual(t))return!1;const i=te.from(this).sub(e),o=te.from(t).sub(e);if(Math.abs(i.cross(o))>TOL)return!1;const a=i.dot(o);if(a<TOL)return!1;const u=e.len2(t);return!(a>u||almostEqual(a,u))}almostEqual(e,t=TOL){return almostEqual(this.x,e.x,t)&&almostEqual(this.y,e.y,t)}interpolateX(e,t){return(e.x-t.x)*(this.y-t.y)/(e.y-t.y)+t.x}interpolateY(e,t){return(e.y-t.y)*(this.x-t.x)/(e.x-t.x)+t.y}export(){return this.memSeg.slice(this.offset,this.offset+2)}get x(){return this.memSeg[this.offset]}set x(e){this.memSeg[this.offset]=e}get y(){return this.memSeg[this.offset+1]}set y(e){this.memSeg[this.offset+1]=e}get length(){return Math.sqrt(this.length2)}get length2(){return this.x*this.x+this.y*this.y}get isEmpty(){return this.x===0&&this.y===0}static horzSegmentsOverlap(e,t,n,s){return e.x>n.x==e.x<s.x||t.x>n.x==t.x<s.x||n.x>e.x==n.x<t.x||s.x>e.x==s.x<t.x||e.x===n.x&&t.x===s.x||e.x===s.x&&t.x===n.x}static slopesEqual(e,t,n,s){return slopesEqual(e.y-t.y,t.x-n.x,e.x-t.x,t.y-n.y,s)}static create(e,t){const n=new Float64Array(2);return n[0]=e,n[1]=t,new te(n)}static zero(){return te.create(0,0)}static from(e){return te.create(e.x,e.y)}static lineEquation(e,t){return[t.y-e.y,e.x-t.x,t.x*e.y-e.x*t.y]}static rangeTest(e,t){if(t)(Math.abs(e.x)>te.HIGH_RANGE||Math.abs(e.y)>te.HIGH_RANGE)&&console.warn("Coordinate outside allowed range in rangeTest().");else if(Math.abs(e.x)>te.LOW_RANGE||Math.abs(e.y)>te.LOW_RANGE)return te.rangeTest(e,!0);return t}static pointsAreClose(e,t,n){return te.from(e).len2(t)<=n}};te.LOW_RANGE=47453132,te.HIGH_RANGE=0xfffffffffffff;let Point=te;const HORIZONTAL=-9007199254740992;class OutPt{constructor(e=0,t=null,n=null,s=null){this.index=e,this.point=t===null?Point.zero():Point.from(t),this.next=n,this.prev=s}exclude(){const e=this.prev;return e.next=this.next,this.next.prev=e,e.index=0,e}dispose(){let e=this;for(e.prev.next=null;e!==null;)e=e.next}duplicate(e){const t=new OutPt(this.index,this.point);return e?(t.next=this.next,t.prev=this,this.next.prev=t,this.next=t):(t.prev=this.prev,t.next=this,this.prev.next=t,this.prev=t),t}get pointCount(){let e=0,t=this;do++e,t=t.next;while(t!==this);return e}reverse(){let e=this,t=e,n=null;do n=t.next,t.next=t.prev,t.prev=n,t=n;while(t!==e)}pointIn(e){let t=this,n=t,s=0,i=0,o=0,a=0,u=0,h=0;for(;;){if(i=t.point.x,o=t.point.y,a=t.next.point.x,u=t.next.point.y,u===e.y&&(a===e.x||o===e.y&&a>e.x==i<e.x))return-1;if(o<e.y!=u<e.y){if(i>=e.x)if(a>e.x)s=1-s;else{if(h=(i-e.x)*(u-e.y)-(a-e.x)*(o-e.y),h==0)return-1;h>0==u>o&&(s=1-s)}else if(a>e.x){if(h=(i-e.x)*(u-e.y)-(a-e.x)*(o-e.y),h===0)return-1;h>0==u>o&&(s=1-s)}}if(t=t.next,n==t)break}return s}getBottomPt(){let e=this,t=this.next,n=null;for(;t!==e;)t.point.y>e.point.y?(e=t,n=null):t.point.y==e.point.y&&t.point.x<=e.point.x&&(t.point.x<e.point.x?(n=null,e=t):t.next!==e&&t.prev!==e&&(n=t)),t=t.next;if(n!==null)for(;n!==t;)for(OutPt.firstIsBottomPt(t,n)||(e=n),n=n.next;!n.point.almostEqual(e.point);)n=n.next;return e}static firstIsBottomPt(e,t){let n=e.prev;for(;n.point.almostEqual(e.point)&&n!==e;)n=n.prev;const s=OutPt.getDx(e,n);for(n=e.next;n.point.almostEqual(e.point)&&n!==e;)n=n.next;const i=OutPt.getDx(e,n);for(n=t.prev;n.point.almostEqual(t.point)&&n!==t;)n=n.prev;const o=OutPt.getDx(t,n);for(n=t.next;n.point.almostEqual(t.point)&&n!==t;)n=n.next;const a=OutPt.getDx(t,n),u=Math.max(o,a);return s>=u||i>=u}static joinHorz(e,t,n,s,i,o){const a=e.point.x>t.point.x?DIRECTION.LEFT:DIRECTION.RIGHT,u=n.point.x>s.point.x?DIRECTION.LEFT:DIRECTION.RIGHT;if(a===u)return!1;if(a===DIRECTION.RIGHT){for(;e.next.point.x<=i.x&&e.next.point.x>=e.point.x&&e.next.point.y===i.y;)e=e.next;o&&e.point.x!==i.x&&(e=e.next),t=e.duplicate(!o),t.point.almostEqual(i)||(e=t,e.point.update(i),t=e.duplicate(!o))}else{for(;e.next.point.x>=i.x&&e.next.point.x<=e.point.x&&e.next.point.y===i.y;)e=e.next;!o&&e.point.x!==i.x&&(e=e.next),t=e.duplicate(o),t.point.almostEqual(i)||(e=t,e.point.update(i),t=e.duplicate(o))}if(u===DIRECTION.RIGHT){for(;n.next.point.x<=i.x&&n.next.point.x>=n.point.x&&n.next.point.y===i.y;)n=n.next;o&&n.point.x!==i.x&&(n=n.next),s=n.duplicate(!o),s.point.almostEqual(i)||(n=s,n.point.update(i),s=n.duplicate(!o))}else{for(;n.next.point.x>=i.x&&n.next.point.x<=n.point.x&&n.next.point.y===i.y;)n=n.next;!o&&n.point.x!==i.x&&(n=n.next),s=n.duplicate(o),s.point.almostEqual(i)||(n=s,n.point.update(i),s=n.duplicate(o))}return a===DIRECTION.RIGHT===o?(e.prev=n,n.next=e,t.next=s,s.prev=t):(e.next=n,n.prev=e,t.prev=s,s.next=t),!0}static getDx(e,t){const n=t.point.y-e.point.y,s=t.point.x-e.point.x,i=n===0?HORIZONTAL:s/n;return Math.abs(i)}}function getArea(r){const e=r.length;if(e<3)return 0;let t=0,n=0,s=0;for(n=0,s=e-1;n<e;++n)t+=(r[s].x+r[n].x)*(r[s].y-r[n].y),s=n;return-t*.5}function absArea(r){return Math.abs(getArea(r))}function distanceFromLineSqrd(r,e,t){const n=Point.lineEquation(t,e),s=n[0]*r.x+n[1]*r.y-n[2];return s*s/(n[0]*n[0]+n[1]*n[1])}function slopesNearCollinear(r,e,t,n){return distanceFromLineSqrd(e,r,t)<n}function cleanPolygon(r,e){let t=r.length;const n=new Array(t);let s=0;for(s=0;s<t;++s)n[s]=new OutPt(0,r[s]);for(s=0;s<t;++s)n[s].next=n[cycleIndex(s,t,1)],n[s].next.prev=n[s];const i=e*e;let o=n[0];for(;o.index===0&&o.next!=o.prev;)Point.pointsAreClose(o.point,o.prev.point,i)?(o=o.exclude(),--t):Point.pointsAreClose(o.prev.point,o.next.point,i)?(o.next.exclude(),o=o.exclude(),t-=2):slopesNearCollinear(o.prev.point,o.point,o.next.point,i)?(o=o.exclude(),--t):(o.index=1,o=o.next);if(t<3)return[];const a=new Array(t);for(s=0;s<t;++s)a[s]=Point.from(o.point),o=o.next;return a}function cleanPolygons(r,e){const t=r.length,n=new Array(t);let s=0;for(s=0;s<t;++s)n[s]=cleanPolygon(r[s],e);return n}function showError(r){try{throw new Error(r)}catch(e){console.warn(e.message)}}class Scanbeam{constructor(e=0,t=null){this.Y=e,this.Next=t}static insert(e,t){if(t===null)return new Scanbeam(e);if(e>t.Y)return new Scanbeam(e,t);let n=t;for(;n.Next!==null&&e<=n.Next.Y;)n=n.Next;return e!==n.Y&&(n.Next=new Scanbeam(e,n.Next)),t}}class LocalMinima{constructor(e=0,t=null,n=null,s=null){this.y=0,this.y=e,this.leftBound=t,this.rightBound=n,this.next=s}insert(e){if(e===null)return this;if(this.y>=e.y)return this.next=e,this;let t=e;for(;t.next!==null&&this.y<t.next.y;)t=t.next;return this.next=t.next,t.next=this,e}reset(){let e=this;for(;e!=null;)e.leftBound!==null&&e.leftBound.reset(DIRECTION.LEFT),e.rightBound!==null&&e.rightBound.reset(DIRECTION.RIGHT),e=e.next}getScanbeam(){let e=this,t=null;for(;e!==null;)t=Scanbeam.insert(e.y,t),e=e.next;return t}}const de=class de{constructor(){this.Bot=Point.zero(),this.Curr=Point.zero(),this.Top=Point.zero(),this.Delta=Point.zero(),this.Dx=0,this.PolyTyp=POLY_TYPE.SUBJECT,this.Side=DIRECTION.LEFT,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.index=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null}init(e,t,n){this.Next=e,this.Prev=t,this.Curr.update(n),this.unassign()}initFromPolyType(e){this.Curr.y>=this.Next.Curr.y?(this.Bot.update(this.Curr),this.Top.update(this.Next.Curr)):(this.Top.update(this.Curr),this.Bot.update(this.Next.Curr)),this.setDx(),this.PolyTyp=e}remove(){const e=this.Next;return this.Prev.Next=this.Next,this.Next.Prev=this.Prev,this.Prev=null,this.Next=null,e}reverseHorizontal(){const e=this.Top.x;this.Top.x=this.Bot.x,this.Bot.x=e}findNextLocMin(){let e=this,t=null;for(;;){for(;!e.Bot.almostEqual(e.Prev.Bot)||e.Curr.almostEqual(e.Top);)e=e.Next;if(!e.isDxHorizontal&&!e.Prev.isDxHorizontal)break;for(;e.Prev.isDxHorizontal;)e=e.Prev;for(t=e;e.isDxHorizontal;)e=e.Next;if(e.Top.y!==e.Prev.Bot.y){t.Prev.Bot.x<e.Bot.x&&(e=t);break}}return e}setDx(){this.Delta.update(this.Top).sub(this.Bot),this.Dx=this.Delta.y===0?HORIZONTAL:this.Delta.x/this.Delta.y}reset(e){this.Curr.update(this.Bot),this.Side=e,this.unassign()}copyAELToSEL(){return this.PrevInSEL=this.PrevInAEL,this.NextInSEL=this.NextInAEL,this.NextInAEL}topX(e){return e===this.Top.y?this.Top.x:this.Bot.x+clipperRound(this.Dx*(e-this.Bot.y))}deleteFromSEL(e){if(this.PrevInSEL===null&&this.NextInSEL===null&&this!==e)return e;let t=e;return this.PrevInSEL!==null?this.PrevInSEL.NextInSEL=this.NextInSEL:t=this.NextInSEL,this.NextInSEL!==null&&(this.NextInSEL.PrevInSEL=this.PrevInSEL),this.NextInSEL=null,this.PrevInSEL=null,t}deleteFromAEL(e){if(this.PrevInAEL===null&&this.NextInAEL===null&&this!==e)return e;let t=e;return this.PrevInAEL!==null?this.PrevInAEL.NextInAEL=this.NextInAEL:t=this.NextInAEL,this.NextInAEL!==null&&(this.NextInAEL.PrevInAEL=this.PrevInAEL),this.NextInAEL=null,this.PrevInAEL=null,t}getIntermediate(e){return this.Top.y===e&&this.NextInLML!==null}get isFilled(){return this.isAssigned&&!this.isWindDeletaEmpty}get isHorizontal(){return this.Delta.y===0}get isWindDeletaEmpty(){return this.WindDelta===0}get isDxHorizontal(){return this.Dx===HORIZONTAL}get maximaPair(){let e=null;return this.Next!==null&&this.Next.Top.almostEqual(this.Top)&&this.Next.NextInLML===null?e=this.Next:this.Prev!==null&&this.Prev.Top.almostEqual(this.Top)&&this.Prev.NextInLML===null&&(e=this.Prev),e!==null&&e.NextInAEL===e.PrevInAEL&&!e.isHorizontal?null:e}getMaxima(e){return this.Top.y===e&&this.NextInLML===null}getContributing(e,t){const n=e===CLIP_TYPE.DIFFERENCE&&this.PolyTyp===POLY_TYPE.CLIP;switch(t){case POLY_FILL_TYPE.NON_ZERO:return Math.abs(this.WindCnt)===1&&n!==(this.WindCnt2===0);case POLY_FILL_TYPE.POSITIVE:return this.WindCnt===1&&n!==this.WindCnt2<=0;default:return this.WindCnt===-1&&n!==this.WindCnt2>=0}}insertsBefore(e){return this.Curr.x===e.Curr.x?this.Top.y>e.Top.y?this.Top.x<e.topX(this.Top.y):e.Top.x>this.topX(e.Top.y):this.Curr.x<e.Curr.x}addEdgeToSEL(e){return this.PrevInSEL=null,this.NextInSEL=e,e!==null&&(e.PrevInSEL=this),this}insertEdgeIntoAEL(e,t=null){if(e===null)return this.PrevInAEL=null,this.NextInAEL=null,this;if(t===null&&this.insertsBefore(e))return this.PrevInAEL=null,this.NextInAEL=e,e.PrevInAEL=this,this;let n=t===null?e:t;for(;n.NextInAEL!==null&&!this.insertsBefore(n.NextInAEL);)n=n.NextInAEL;return this.NextInAEL=n.NextInAEL,n.NextInAEL!==null&&(n.NextInAEL.PrevInAEL=this),this.PrevInAEL=n,n.NextInAEL=this,e}getNextInAEL(e){return e===DIRECTION.RIGHT?this.NextInAEL:this.PrevInAEL}unassign(){this.index=de.UNASSIGNED}get horzDirection(){return new Float64Array(this.Bot.x<this.Top.x?[DIRECTION.RIGHT,this.Bot.x,this.Top.x]:[DIRECTION.LEFT,this.Top.x,this.Bot.x])}get isAssigned(){return this.index!==de.UNASSIGNED}setWindingCount(e,t){let n=this.PrevInAEL;for(;n!==null&&(n.PolyTyp!==this.PolyTyp||n.isWindDeletaEmpty);)n=n.PrevInAEL;for(n===null?(this.WindCnt=this.isWindDeletaEmpty?1:this.WindDelta,this.WindCnt2=0,n=e):this.isWindDeletaEmpty&&t!==CLIP_TYPE.UNION?(this.WindCnt=1,this.WindCnt2=n.WindCnt2,n=n.NextInAEL):(n.WindCnt*n.WindDelta<0?Math.abs(n.WindCnt)>1?this.WindCnt=n.WindDelta*this.WindDelta<0?n.WindCnt:n.WindCnt+this.WindDelta:this.WindCnt=this.isWindDeletaEmpty?1:this.WindDelta:this.isWindDeletaEmpty?this.WindCnt=n.WindCnt<0?n.WindCnt-1:n.WindCnt+1:this.WindCnt=n.WindDelta*this.WindDelta<0?n.WindCnt:n.WindCnt+this.WindDelta,this.WindCnt2=n.WindCnt2,n=n.NextInAEL);n!==this;)this.WindCnt2+=n.WindDelta,n=n.NextInAEL}static intersectPoint(e,t,n,s){if(de.slopesEqual(e,t,s)||e.Dx===t.Dx){const i=t.Bot.y>e.Bot.y?t.Bot:e.Bot;return n.update(i),!1}if(e.Delta.x===0)n.set(e.Bot.x,t.isHorizontal?t.Bot.y:clipperRound((e.Bot.x-t.Bot.x)/t.Dx+t.Bot.y));else if(t.Delta.x===0)n.set(t.Bot.x,e.isHorizontal?e.Bot.y:clipperRound((t.Bot.x-e.Bot.x)/e.Dx+e.Bot.y));else{const i=e.Bot.x-e.Bot.y*e.Dx,o=t.Bot.x-t.Bot.y*t.Dx,a=(o-i)/(e.Dx-t.Dx);n.set(Math.abs(e.Dx)<Math.abs(t.Dx)?clipperRound(e.Dx*a+i):clipperRound(t.Dx*a+o),clipperRound(a))}if(n.y<e.Top.y||n.y<t.Top.y){if(e.Top.y>t.Top.y)return n.set(t.topX(e.Top.y),e.Top.y),n.x<e.Top.x;n.set(Math.abs(e.Dx)<Math.abs(t.Dx)?e.topX(n.y):t.topX(n.y),t.Top.y)}return!0}static slopesEqual(e,t,n){return slopesEqual(e.Delta.y,t.Delta.x,e.Delta.x,t.Delta.y,n)}static swapPositionsInAEL(e,t){if(e.NextInAEL===e.PrevInAEL||t.NextInAEL===t.PrevInAEL)return!1;let n=null,s=null;return e.NextInAEL===t?(s=t.NextInAEL,s!==null&&(s.PrevInAEL=e),n=e.PrevInAEL,n!==null&&(n.NextInAEL=t),t.PrevInAEL=n,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=s,!0):t.NextInAEL===e?(s=e.NextInAEL,s!==null&&(s.PrevInAEL=t),n=t.PrevInAEL,n!==null&&(n.NextInAEL=e),e.PrevInAEL=n,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=s,!0):(s=e.NextInAEL,n=e.PrevInAEL,e.NextInAEL=t.NextInAEL,e.NextInAEL!==null&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,e.PrevInAEL!==null&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=s,t.NextInAEL!==null&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=n,t.PrevInAEL!==null&&(t.PrevInAEL.NextInAEL=t),!0)}static swapPositionsInSEL(e,t){if(e.NextInSEL===null&&e.PrevInSEL===null||t.NextInSEL===null&&t.PrevInSEL===null)return!1;let n=null,s=null;return e.NextInSEL===t?(s=t.NextInSEL,s!==null&&(s.PrevInSEL=e),n=e.PrevInSEL,n!==null&&(n.NextInSEL=t),t.PrevInSEL=n,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=s,!0):t.NextInSEL===e?(s=e.NextInSEL,s!==null&&(s.PrevInSEL=t),n=t.PrevInSEL,n!==null&&(n.NextInSEL=e),e.PrevInSEL=n,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=s,!0):(s=e.NextInSEL,n=e.PrevInSEL,e.NextInSEL=t.NextInSEL,e.NextInSEL!==null&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,e.PrevInSEL!==null&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=s,t.NextInSEL!==null&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=n,t.PrevInSEL!==null&&(t.PrevInSEL.NextInSEL=t),!0)}static swapSides(e,t){const n=e.Side;e.Side=t.Side,t.Side=n}static swapPolyIndexes(e,t){const n=e.index;e.index=t.index,t.index=n}};de.UNASSIGNED=-1;let TEdge=de;class ClipperBase{constructor(){this.minimaList=null,this.isUseFullRange=!1,this.currentLM=null}addPath(e,t){let n=e.length-1;for(;n>0&&(e[n].almostEqual(e[0])||e[n].almostEqual(e[n-1]));)--n;if(n<2)return!1;const s=[];let i=0;for(i=0;i<=n;++i)s.push(new TEdge);for(s[1].Curr.update(e[1]),this.isUseFullRange=Point.rangeTest(e[0],this.isUseFullRange),this.isUseFullRange=Point.rangeTest(e[n],this.isUseFullRange),s[0].init(s[1],s[n],e[0]),s[n].init(s[0],s[n-1],e[n]),i=n-1;i>=1;--i)this.isUseFullRange=Point.rangeTest(e[i],this.isUseFullRange),s[i].init(s[i+1],s[i-1],e[i]);let o=s[0],a=o,u=o;for(;;){if(a.Curr.almostEqual(a.Next.Curr)){if(a===a.Next)break;a===o&&(o=a.Next),a=a.remove(),u=a;continue}if(a.Prev===a.Next)break;if(Point.slopesEqual(a.Prev.Curr,a.Curr,a.Next.Curr,this.isUseFullRange)){a===o&&(o=a.Next),a=a.remove(),a=a.Prev,u=a;continue}if(a=a.Next,a===u)break}if(a.Prev===a.Next)return!1;a=o;let h=!0;do a.initFromPolyType(t),a=a.Next,h&&a.Curr.y!==o.Curr.y&&(h=!1);while(a!==o);if(h)return!1;let p=!1,m=null;for(;a=a.findNextLocMin(),a!==m;){m===null&&(m=a),p=a.Dx>=a.Prev.Dx;const v=p?new LocalMinima(a.Bot.y,a,a.Prev):new LocalMinima(a.Bot.y,a.Prev,a);v.leftBound.Side=DIRECTION.LEFT,v.rightBound.Side=DIRECTION.RIGHT,v.leftBound.WindDelta=v.leftBound.Next===v.rightBound?-1:1,v.rightBound.WindDelta=-v.leftBound.WindDelta,a=this.ProcessBound(v.leftBound,p);const E=this.ProcessBound(v.rightBound,!p);this.minimaList=v.insert(this.minimaList),p||(a=E)}return!0}addPaths(e,t){const n=e.length;let s=!1,i=0;for(i=0;i<n;++i)this.addPath(e[i],t)&&(s=!0);return s}ProcessBound(e,t){let n=e,s=e,i=null;if(e.isDxHorizontal){const o=t?e.Prev.Bot.x:e.Next.Bot.x;e.Bot.x!==o&&e.reverseHorizontal()}if(t){for(;s.Top.y===s.Next.Bot.y;)s=s.Next;if(s.isDxHorizontal){for(i=s;i.Prev.isDxHorizontal;)i=i.Prev;i.Prev.Top.x===s.Next.Top.x?t||(s=i.Prev):i.Prev.Top.x>s.Next.Top.x&&(s=i.Prev)}for(;e!==s;)e.NextInLML=e.Next,e.isDxHorizontal&&e!==n&&e.Bot.x!==e.Prev.Top.x&&e.reverseHorizontal(),e=e.Next;e.isDxHorizontal&&e!==n&&e.Bot.x!==e.Prev.Top.x&&e.reverseHorizontal(),s=s.Next}else{for(;s.Top.y===s.Prev.Bot.y;)s=s.Prev;if(s.isDxHorizontal){for(i=s;i.Next.isDxHorizontal;)i=i.Next;i.Next.Top.x===s.Prev.Top.x?t||(s=i.Next):i.Next.Top.x>s.Prev.Top.x&&(s=i.Next)}for(;e!==s;)e.NextInLML=e.Prev,e.isDxHorizontal&&e!==n&&e.Bot.x!==e.Next.Top.x&&e.reverseHorizontal(),e=e.Prev;e.isDxHorizontal&&e!==n&&e.Bot.x!==e.Next.Top.x&&e.reverseHorizontal(),s=s.Prev}return s}reset(){this.currentLM=this.minimaList,this.currentLM!==null&&this.minimaList.reset()}}class IntersectNode{constructor(e=null,t=null,n=null){this.Edge1=e,this.Edge2=t,this.Pt=n===null?Point.zero():Point.from(n)}get edgesAdjacent(){return this.Edge1.NextInSEL===this.Edge2||this.Edge1.PrevInSEL===this.Edge2}static sort(e,t){return t.Pt.y-e.Pt.y}}class OutRec{constructor(e=0,t=!1,n=null){this.Idx=e,this.IsHole=!1,this.IsOpen=t,this.FirstLeft=null,this.Pts=n,this.BottomPt=null}fixupOutPolygon(e,t){this.BottomPt=null;let n=null,s=this.Pts;for(;;){if(s!==null&&(s.prev===s||s.prev===s.next)){s.dispose(),this.Pts=null;return}if(s.point.almostEqual(s.next.point)||s.point.almostEqual(s.prev.point)||Point.slopesEqual(s.prev.point,s.point,s.next.point,t)&&(!e||!s.point.getBetween(s.prev.point,s.next.point))){n=null,s.prev.next=s.next,s.next.prev=s.prev,s=s.prev;continue}if(s==n)break;n===null&&(n=s),s=s.next}this.Pts=s}reversePts(){this.Pts!==null&&this.Pts.reverse()}dispose(){this.Pts!==null&&this.Pts.dispose()}export(){const e=this.pointCount;if(e<2)return null;const t=new Array(e);let n=this.Pts.prev,s=0;for(s=0;s<e;++s)t[s]=n.point,n=n.prev;return t}joinCommonEdges(e,t){return e.containsPoly(this)?(this.IsHole=!e.IsHole,this.FirstLeft=e,this.IsHole!==t==this.area>0&&this.Pts.reverse(),!0):!1}updateOutPtIdxs(){let e=this.Pts;do e.index=this.Idx,e=e.prev;while(e!==this.Pts)}containsPoly(e){let t=e.Pts,n=0;do{if(n=this.Pts.pointIn(t.point),n>=0)return n!==0;t=t.next}while(t!==e.Pts);return!0}get pointCount(){return this.Pts!==null&&this.Pts.prev!==null?this.Pts.prev.pointCount:0}get isEmpty(){return this.Pts===null||this.IsOpen}get area(){if(this.Pts==null)return 0;let e=this.Pts,t=0;do t=t+(e.prev.point.x+e.point.x)*(e.prev.point.y-e.point.y),e=e.next;while(e!=this.Pts);return t*.5}setHoleState(e,t){let n=!1,s=e.PrevInAEL;for(;s!==null;)s.isAssigned&&!s.isWindDeletaEmpty&&(n=!n,this.FirstLeft===null&&(this.FirstLeft=t[s.index])),s=s.PrevInAEL;n&&(this.IsHole=!0)}simplify(e,t){let n=null,s=null,i=null,o=null;do{for(s=e.next;s!==this.Pts;)e.point.almostEqual(s.point)&&s.next!=e&&s.prev!=e&&(i=e.prev,o=s.prev,e.prev=o,o.next=e,s.prev=i,i.next=s,this.Pts=e,n=OutRec.create(t),n.Pts=s,n.updateOutPtIdxs(),this.containsPoly(n)?(n.IsHole=!this.IsHole,n.FirstLeft=this):n.containsPoly(this)?(n.IsHole=this.IsHole,this.IsHole=!n.IsHole,n.FirstLeft=this.FirstLeft,this.FirstLeft=n):(n.IsHole=this.IsHole,n.FirstLeft=this.FirstLeft),s=e),s=s.next;e=e.next}while(e!=this.Pts)}static param1RightOfParam2(e,t){do if(e=e.FirstLeft,e==t)return!0;while(e!==null);return!1}static parseFirstLeft(e){for(;e!=null&&e.Pts==null;)e=e.FirstLeft;return e}static getLowermostRec(e,t){e.BottomPt===null&&(e.BottomPt=e.Pts.getBottomPt()),t.BottomPt===null&&(t.BottomPt=t.Pts.getBottomPt());const n=e.BottomPt,s=t.BottomPt;switch(!0){case n.point.y>s.point.y:return e;case n.point.y<s.point.y:return t;case n.point.x<s.point.x:return e;case n.point.x>s.point.x:return t;case n.next===n:return t;case s.next===s:return e;case OutPt.firstIsBottomPt(n,s):return e;default:return t}}static addOutPt(e,t,n){const s=t.Side===DIRECTION.LEFT;let i=null,o=null;if(!t.isAssigned)return o=new OutPt(0,n),i=OutRec.create(e,t.isWindDeletaEmpty,o),o.index=i.Idx,o.next=o,o.prev=o,i.IsOpen||i.setHoleState(t,e),t.index=i.Idx,o;i=e[t.index];const a=i.Pts;return s&&n.almostEqual(a.point)?a:!s&&n.almostEqual(a.prev.point)?a.prev:(o=new OutPt(i.Idx,n,a,a.prev),o.prev.next=o,a.prev=o,s&&(i.Pts=o),o)}static getOutRec(e,t){let n=e[t];for(;n!==e[n.Idx];)n=e[n.Idx];return n}static getHoleStateRec(e,t){switch(!0){case OutRec.param1RightOfParam2(e,t):return t;case OutRec.param1RightOfParam2(t,e):return e;default:return OutRec.getLowermostRec(e,t)}}static addLocalMaxPoly(e,t,n,s,i){if(OutRec.addOutPt(e,t,s),n.isWindDeletaEmpty&&OutRec.addOutPt(e,n,s),t.index===n.index){t.unassign(),n.unassign();return}const o=t.index<n.index?t:n,a=t.index<n.index?n:t,u=e[o.index],h=e[a.index],p=OutRec.getHoleStateRec(u,h),m=u.Pts,v=m.prev,E=h.Pts,x=E.prev;let P;o.Side===DIRECTION.LEFT?(a.Side===DIRECTION.LEFT?(E.reverse(),E.next=m,m.prev=E,v.next=x,x.prev=v,u.Pts=x):(x.next=m,m.prev=x,E.prev=v,v.next=E,u.Pts=E),P=DIRECTION.LEFT):(a.Side===DIRECTION.RIGHT?(E.reverse(),v.next=x,x.prev=v,E.next=m,m.prev=E):(v.next=E,E.prev=v,m.prev=x,x.next=m),P=DIRECTION.RIGHT),u.BottomPt=null,p===h&&(h.FirstLeft!==u&&(u.FirstLeft=h.FirstLeft),u.IsHole=h.IsHole),h.Pts=null,h.BottomPt=null,h.FirstLeft=u;const T=o.index,C=a.index;o.unassign(),a.unassign();let I=i;for(;I!==null;){if(I.index===C){I.index=T,I.Side=P;break}I=I.NextInAEL}h.Idx=u.Idx}static create(e,t=!1,n=null){const s=new OutRec(e.length,t,n);return e.push(s),s}}class Join{constructor(e=null,t=null,n=null){this.OutPt1=e,this.OutPt2=t,this.OffPt=n===null?Point.zero():Point.from(n)}joinPoints(e,t){let n=this.OutPt1,s=this.OutPt2,i=new OutPt,o=new OutPt;const a=this.OutPt1.point.y===this.OffPt.y;if(a&&this.OffPt.almostEqual(this.OutPt1.point)&&this.OffPt.almostEqual(this.OutPt2.point)){for(i=this.OutPt1.next;i!==n&&i.point.almostEqual(this.OffPt);)i=i.next;const u=i.point.y>this.OffPt.y;for(o=this.OutPt2.next;o!==s&&o.point.almostEqual(this.OffPt);)o=o.next;const h=o.point.y>this.OffPt.y;return u===h?!1:(u?(i=n.duplicate(!1),o=s.duplicate(!0),n.prev=s,s.next=n,i.next=o,o.prev=i,this.OutPt1=n,this.OutPt2=i):(i=n.duplicate(!0),o=s.duplicate(!1),n.next=s,s.prev=n,i.prev=o,o.next=i,this.OutPt1=n,this.OutPt2=i),!0)}else if(a){for(i=n;n.prev.point.y===n.point.y&&n.prev!==i&&n.prev!==s;)n=n.prev;for(;i.next.point.y===i.point.y&&i.next!==n&&i.next!==s;)i=i.next;if(i.next===n||i.next===s)return!1;for(o=s;s.prev.point.y===s.point.y&&s.prev!==o&&s.prev!==i;)s=s.prev;for(;o.next.point.y===o.point.y&&o.next!==s&&o.next!==n;)o=o.next;if(o.next===s||o.next===n)return!1;const u=Join.getOverlap(n.point.x,i.point.x,s.point.x,o.point.x);if(!(u.x<u.y))return!1;const p=Point.zero();let m=!1;return n.point.x>=u.x&&n.point.x<=u.y?(p.update(n.point),m=n.point.x>i.point.x):s.point.x>=u.x&&s.point.x<=u.y?(p.update(s.point),m=s.point.x>o.point.x):i.point.x>=u.x&&i.point.x<=u.y?(p.update(i.point),m=i.point.x>n.point.x):(p.update(o.point),m=o.point.x>s.point.x),this.OutPt1=n,this.OutPt2=s,OutPt.joinHorz(n,i,s,o,p,m)}else{for(i=n.next;i.point.almostEqual(n.point)&&i!==n;)i=i.next;const u=i.point.y>n.point.y||!Point.slopesEqual(n.point,i.point,this.OffPt,t);if(u){for(i=n.prev;i.point.almostEqual(n.point)&&i!==n;)i=i.prev;if(i.point.y>n.point.y||!Point.slopesEqual(n.point,i.point,this.OffPt,t))return!1}for(o=s.next;o.point.almostEqual(s.point)&&o!==s;)o=o.next;const h=o.point.y>s.point.y||!Point.slopesEqual(s.point,o.point,this.OffPt,t);if(h){for(o=s.prev;o.point.almostEqual(s.point)&&o!==s;)o=o.prev;if(o.point.y>s.point.y||!Point.slopesEqual(s.point,o.point,this.OffPt,t))return!1}return i===n||o===s||i===o||e&&u===h?!1:(u?(i=n.duplicate(!1),o=s.duplicate(!0),n.prev=s,s.next=n,i.next=o,o.prev=i,this.OutPt1=n,this.OutPt2=i):(i=n.duplicate(!0),o=s.duplicate(!1),n.next=s,s.prev=n,i.prev=o,o.next=i,this.OutPt1=n,this.OutPt2=i),!0)}}joinCommonEdges(e,t,n){let s=OutRec.getOutRec(e,this.OutPt1.index),i=OutRec.getOutRec(e,this.OutPt2.index);if(s.Pts===null||i.Pts===null||!this.joinPoints(s===i,t))return;if(s===i){s.Pts=this.OutPt1,s.BottomPt=null,i=OutRec.create(e),i.Pts=this.OutPt2,i.updateOutPtIdxs(),i.joinCommonEdges(i,n)||(i.IsHole=s.IsHole,i.FirstLeft=s.FirstLeft,s.joinCommonEdges(i,n));return}const o=OutRec.getHoleStateRec(s,i);i.Pts=null,i.BottomPt=null,i.Idx=s.Idx,s.IsHole=o.IsHole,o===i&&(s.FirstLeft=i.FirstLeft),i.FirstLeft=s}static getOverlap(e,t,n,s){return e<t?n<s?Point.create(Math.max(e,n),Math.min(t,s)):Point.create(Math.max(e,s),Math.min(t,n)):n<s?Point.create(Math.max(t,n),Math.min(e,s)):Point.create(Math.max(t,s),Math.min(e,n))}}class Clipper extends ClipperBase{constructor(){super(...arguments),this.clipType=CLIP_TYPE.UNION,this.fillType=POLY_FILL_TYPE.NON_ZERO,this.scanbeam=null,this.activeEdges=null,this.sortedEdges=null,this.intersections=[],this.isExecuteLocked=!1,this.polyOuts=[],this.joins=[],this.ghostJoins=[],this.ReverseSolution=!1,this.StrictlySimple=!1}execute(e,t,n){if(this.isExecuteLocked)return!1;this.isExecuteLocked=!0,this.fillType=n,this.clipType=e,t.length=0;let s=!1;try{s=this.executeInternal(),s&&this.buildResult(t)}finally{this.disposeAllPolyPts(),this.isExecuteLocked=!1}return s}executeInternal(){try{if(this.reset(),this.currentLM===null)return!1;let e=0,t=null,n=0,s=this.popScanbeam(),i=0;do{if(this.insertLocalMinimaIntoAEL(s),this.ghostJoins=[],this.processHorizontals(!1),this.scanbeam===null)break;if(i=this.popScanbeam(),!this.processIntersections(s,i))return!1;this.processEdgesAtTopOfScanbeam(i),s=i}while(this.scanbeam!==null||this.currentLM!==null);for(n=this.polyOuts.length,e=0;e<n;++e)t=this.polyOuts[e],!t.isEmpty&&t.IsHole!==this.ReverseSolution==t.area>0&&t.reversePts();const o=this.joins.length;for(e=0;e<o;++e)this.joins[e].joinCommonEdges(this.polyOuts,this.isUseFullRange,this.ReverseSolution);for(n=this.polyOuts.length,e=0;e<n;++e)t=this.polyOuts[e],t.isEmpty||t.fixupOutPolygon(!1,this.isUseFullRange);return this.StrictlySimple&&this.doSimplePolygons(),!0}finally{this.joins=[],this.ghostJoins=[]}}processEdgesAtTopOfScanbeam(e){let t=this.activeEdges,n=null,s=!1,i=null,o=null;for(;t!==null;)s=t.getMaxima(e),s&&(n=t.maximaPair,s=n===null||!n.isHorizontal),s?(n=t.PrevInAEL,this.DoMaxima(t),t=n===null?this.activeEdges:n.NextInAEL):(t.getIntermediate(e)&&t.NextInLML.isHorizontal?(t=this.updateEdgeIntoAEL(t),t.isAssigned&&OutRec.addOutPt(this.polyOuts,t,t.Bot),this.sortedEdges=t.addEdgeToSEL(this.sortedEdges)):t.Curr.set(t.topX(e),e),this.StrictlySimple&&(n=t.PrevInAEL,t.isFilled&&n!==null&&n.isFilled&&n.Curr.x===t.Curr.x&&(i=OutRec.addOutPt(this.polyOuts,n,t.Curr),o=OutRec.addOutPt(this.polyOuts,t,t.Curr),this.joins.push(new Join(i,o,t.Curr)))),t=t.NextInAEL);for(this.processHorizontals(!0),t=this.activeEdges;t!==null;){if(t.getIntermediate(e)){i=t.isAssigned?OutRec.addOutPt(this.polyOuts,t,t.Top):null,t=this.updateEdgeIntoAEL(t);const a=t.PrevInAEL,u=t.NextInAEL;i!==null&&a!==null&&a.Curr.almostEqual(t.Bot)&&a.isFilled&&a.Curr.y>a.Top.y&&TEdge.slopesEqual(t,a,this.isUseFullRange)&&!t.isWindDeletaEmpty?(o=OutRec.addOutPt(this.polyOuts,a,t.Bot),this.joins.push(new Join(i,o,t.Top))):i!==null&&u!==null&&u.Curr.almostEqual(t.Bot)&&u.isFilled&&u.Curr.y>u.Top.y&&TEdge.slopesEqual(t,u,this.isUseFullRange)&&!t.isWindDeletaEmpty&&(o=OutRec.addOutPt(this.polyOuts,u,t.Bot),this.joins.push(new Join(i,o,t.Top)))}t=t.NextInAEL}}DoMaxima(e){const t=e.maximaPair;if(t===null){e.isAssigned&&OutRec.addOutPt(this.polyOuts,e,e.Top),this.activeEdges=e.deleteFromAEL(this.activeEdges);return}let n=e.NextInAEL;for(;n!==null&&n!==t;)this.intersectEdges(e,n,e.Top,!0),this.SwapPositionsInAEL(e,n),n=e.NextInAEL;!e.isAssigned&&!t.isAssigned?(this.activeEdges=e.deleteFromAEL(this.activeEdges),this.activeEdges=t.deleteFromAEL(this.activeEdges)):e.isAssigned&&t.isAssigned?this.intersectEdges(e,t,e.Top,!1):e.isWindDeletaEmpty?(e.isAssigned&&(OutRec.addOutPt(this.polyOuts,e,e.Top),e.unassign()),this.activeEdges=e.deleteFromAEL(this.activeEdges),t.isAssigned&&(OutRec.addOutPt(this.polyOuts,t,e.Top),t.unassign()),this.activeEdges=t.deleteFromAEL(this.activeEdges)):showError("DoMaxima error")}insertLocalMinimaIntoAEL(e){let t=null,n=null,s=null;for(;this.currentLM!==null&&this.currentLM.y===e;)if(t=this.currentLM.leftBound,n=this.currentLM.rightBound,s=null,this.currentLM!==null&&(this.currentLM=this.currentLM.next),t===null?(this.activeEdges=n.insertEdgeIntoAEL(this.activeEdges),n.setWindingCount(this.activeEdges,this.clipType),n.getContributing(this.clipType,this.fillType)&&(s=OutRec.addOutPt(this.polyOuts,n,n.Bot))):n===null?(this.activeEdges=t.insertEdgeIntoAEL(this.activeEdges),t.setWindingCount(this.activeEdges,this.clipType),t.getContributing(this.clipType,this.fillType)&&(s=OutRec.addOutPt(this.polyOuts,t,t.Bot)),this.scanbeam=Scanbeam.insert(t.Top.y,this.scanbeam)):(this.activeEdges=t.insertEdgeIntoAEL(this.activeEdges),this.activeEdges=n.insertEdgeIntoAEL(this.activeEdges,t),t.setWindingCount(this.activeEdges,this.clipType),n.WindCnt=t.WindCnt,n.WindCnt2=t.WindCnt2,t.getContributing(this.clipType,this.fillType)&&(s=this.AddLocalMinPoly(t,n,t.Bot)),this.scanbeam=Scanbeam.insert(t.Top.y,this.scanbeam)),n!==null&&(n.isHorizontal?this.sortedEdges=n.addEdgeToSEL(this.sortedEdges):this.scanbeam=Scanbeam.insert(n.Top.y,this.scanbeam)),!(t===null||n===null)){if(s!==null&&n.isHorizontal&&this.ghostJoins.length>0&&!n.isWindDeletaEmpty){const i=this.ghostJoins.length;let o=0,a=null;for(o=0;o<i;++o)a=this.ghostJoins[o],Point.horzSegmentsOverlap(a.OutPt1.point,a.OffPt,n.Bot,n.Top)&&this.joins.push(new Join(a.OutPt1,s,a.OffPt))}if(t.isFilled&&t.PrevInAEL!==null&&t.PrevInAEL.Curr.x===t.Bot.x&&t.PrevInAEL.isFilled&&TEdge.slopesEqual(t.PrevInAEL,t,this.isUseFullRange)){const i=OutRec.addOutPt(this.polyOuts,t.PrevInAEL,t.Bot);this.joins.push(new Join(s,i,t.Top))}if(t.NextInAEL!==n){if(n.isFilled&&n.PrevInAEL.isFilled&&TEdge.slopesEqual(n.PrevInAEL,n,this.isUseFullRange)){const o=OutRec.addOutPt(this.polyOuts,n.PrevInAEL,n.Bot);this.joins.push(new Join(s,o,n.Top))}let i=t.NextInAEL;if(i!==null)for(;i!==n;)this.intersectEdges(n,i,t.Curr,!1),i=i.NextInAEL}}}processIntersections(e,t){if(this.activeEdges===null)return!0;try{if(this.buildIntersectList(e,t),this.intersections.length===0)return!0;if(this.intersections.length===1||this.fixupIntersectionOrder())this.processIntersectList();else return!1}catch{this.sortedEdges=null,this.intersections.length=0,showError("ProcessIntersections error")}return this.sortedEdges=null,!0}processIntersectList(){const e=this.intersections.length;let t=0,n=null;for(t=0;t<e;++t)n=this.intersections[t],this.intersectEdges(n.Edge1,n.Edge2,n.Pt,!0),this.SwapPositionsInAEL(n.Edge1,n.Edge2);this.intersections=[]}intersectEdges(e,t,n,s){let i=!s&&e.NextInLML===null&&e.Top.almostEqual(n),o=!s&&t.NextInLML===null&&t.Top.almostEqual(n),a=e.isAssigned,u=t.isAssigned;if(e.isWindDeletaEmpty||t.isWindDeletaEmpty){e.isWindDeletaEmpty&&t.isWindDeletaEmpty?(i||o)&&a&&u&&OutRec.addLocalMaxPoly(this.polyOuts,e,t,n,this.activeEdges):e.PolyTyp===t.PolyTyp&&e.WindDelta!==t.WindDelta&&this.clipType===CLIP_TYPE.UNION?e.isWindDeletaEmpty?u&&(OutRec.addOutPt(this.polyOuts,e,n),a&&e.unassign()):a&&(OutRec.addOutPt(this.polyOuts,t,n),u&&t.unassign()):e.PolyTyp!==t.PolyTyp&&(e.isWindDeletaEmpty&&Math.abs(t.WindCnt)===1&&(this.clipType!==CLIP_TYPE.UNION||t.WindCnt2===0)?(OutRec.addOutPt(this.polyOuts,e,n),a&&e.unassign()):t.isWindDeletaEmpty&&Math.abs(e.WindCnt)===1&&(this.clipType!==CLIP_TYPE.UNION||e.WindCnt2===0)&&(OutRec.addOutPt(this.polyOuts,t,n),u&&t.unassign())),i&&(e.isAssigned?showError("Error intersecting polylines"):this.activeEdges=e.deleteFromAEL(this.activeEdges)),o&&(t.isAssigned?showError("Error intersecting polylines"):this.activeEdges=t.deleteFromAEL(this.activeEdges));return}e.PolyTyp===t.PolyTyp?(e.WindCnt=e.WindCnt===-t.WindDelta?-e.WindCnt:e.WindCnt+t.WindDelta,t.WindCnt=t.WindCnt===e.WindDelta?-t.WindCnt:t.WindCnt-e.WindDelta):(e.WindCnt2+=t.WindDelta,t.WindCnt2-=e.WindDelta);let h=0,p=0;switch(this.fillType){case POLY_FILL_TYPE.POSITIVE:h=e.WindCnt,p=t.WindCnt;break;case POLY_FILL_TYPE.NEGATIVE:h=-e.WindCnt,p=-t.WindCnt;break;default:h=Math.abs(e.WindCnt),p=Math.abs(t.WindCnt);break}if(a&&u)i||o||h!==0&&h!==1||p!==0&&p!==1||e.PolyTyp!==t.PolyTyp?OutRec.addLocalMaxPoly(this.polyOuts,e,t,n,this.activeEdges):(OutRec.addOutPt(this.polyOuts,e,n),OutRec.addOutPt(this.polyOuts,t,n),TEdge.swapSides(e,t),TEdge.swapPolyIndexes(e,t));else if(a)(p===0||p===1)&&(OutRec.addOutPt(this.polyOuts,e,n),TEdge.swapSides(e,t),TEdge.swapPolyIndexes(e,t));else if(u)(h===0||h===1)&&(OutRec.addOutPt(this.polyOuts,t,n),TEdge.swapSides(e,t),TEdge.swapPolyIndexes(e,t));else if((h===0||h===1)&&(p===0||p===1)&&!i&&!o){let m=0,v=0;switch(this.fillType){case POLY_FILL_TYPE.POSITIVE:m=e.WindCnt2,v=t.WindCnt2;break;case POLY_FILL_TYPE.NEGATIVE:m=-e.WindCnt2,v=-t.WindCnt2;break;default:m=Math.abs(e.WindCnt2),v=Math.abs(t.WindCnt2);break}if(e.PolyTyp!==t.PolyTyp)this.AddLocalMinPoly(e,t,n);else if(h===1&&p===1)switch(this.clipType){case CLIP_TYPE.UNION:m<=0&&v<=0&&this.AddLocalMinPoly(e,t,n);break;case CLIP_TYPE.DIFFERENCE:(e.PolyTyp===POLY_TYPE.CLIP&&Math.min(m,v)>0||e.PolyTyp===POLY_TYPE.SUBJECT&&Math.max(m,v)<=0)&&this.AddLocalMinPoly(e,t,n);break}else TEdge.swapSides(e,t)}i!==o&&(i&&e.isAssigned||o&&t.isAssigned)&&(TEdge.swapSides(e,t),TEdge.swapPolyIndexes(e,t)),i&&(this.activeEdges=e.deleteFromAEL(this.activeEdges)),o&&(this.activeEdges=t.deleteFromAEL(this.activeEdges))}AddLocalMinPoly(e,t,n){let s=null,i=null,o;if(t.isHorizontal||e.Dx>t.Dx?(s=OutRec.addOutPt(this.polyOuts,e,n),t.index=e.index,t.Side=DIRECTION.RIGHT,e.Side=DIRECTION.LEFT,i=e,o=i.PrevInAEL===t?t.PrevInAEL:i.PrevInAEL):(s=OutRec.addOutPt(this.polyOuts,t,n),e.index=t.index,e.Side=DIRECTION.RIGHT,t.Side=DIRECTION.LEFT,i=t,o=i.PrevInAEL===e?e.PrevInAEL:i.PrevInAEL),o!==null&&o.isFilled&&o.topX(n.y)===i.topX(n.y)&&TEdge.slopesEqual(i,o,this.isUseFullRange)&&!i.isWindDeletaEmpty){const a=OutRec.addOutPt(this.polyOuts,o,n);this.joins.push(new Join(s,a,i.Top))}return s}buildResult(e){const t=this.polyOuts.length;let n=null,s=null,i=0;for(i=0;i<t;++i)n=this.polyOuts[i],s=n.export(),s!==null&&e.push(s)}reset(){super.reset(),this.scanbeam=this.minimaList!==null?this.minimaList.getScanbeam():null,this.activeEdges=null,this.sortedEdges=null}popScanbeam(){const e=this.scanbeam.Y;return this.scanbeam=this.scanbeam.Next,e}disposeAllPolyPts(){const e=this.polyOuts.length;let t=null,n=0;for(n=0;n<e;++n)t=this.polyOuts[n],t.dispose();this.polyOuts=[]}processHorizontals(e){let t=this.sortedEdges;for(;t!==null;)this.sortedEdges=t.deleteFromSEL(this.sortedEdges),this.processHorizontal(t,e),t=this.sortedEdges}processHorizontal(e,t){let n=e.horzDirection,s=n[0],i=n[1],o=n[2],a=e,u=null;for(;a.NextInLML!==null&&a.NextInLML.isHorizontal;)a=a.NextInLML;for(a.NextInLML===null&&(u=a.maximaPair);;){const h=e===a;let p=e.getNextInAEL(s),m=null;for(;p!==null&&!(p.Curr.x===e.Top.x&&e.NextInLML!==null&&p.Dx<e.NextInLML.Dx);){if(m=p.getNextInAEL(s),s===DIRECTION.RIGHT&&p.Curr.x<=o||s===DIRECTION.LEFT&&p.Curr.x>=i){if(e.isFilled&&this.prepareHorzJoins(e,t),p===u&&h){s===DIRECTION.RIGHT?this.intersectEdges(e,p,p.Top,!1):this.intersectEdges(p,e,p.Top,!1),u.isAssigned&&showError("ProcessHorizontal error");return}const v=Point.create(p.Curr.x,e.Curr.y);s===DIRECTION.RIGHT?this.intersectEdges(e,p,v,!0):this.intersectEdges(p,e,v,!0),this.SwapPositionsInAEL(e,p)}else if(s===DIRECTION.RIGHT&&p.Curr.x>=o||s===DIRECTION.LEFT&&p.Curr.x<=i)break;p=m}if(e.isFilled&&this.prepareHorzJoins(e,t),e.NextInLML!==null&&e.NextInLML.isHorizontal)e=this.updateEdgeIntoAEL(e),e.isAssigned&&OutRec.addOutPt(this.polyOuts,e,e.Bot),n=e.horzDirection,s=n[0],i=n[1],o=n[2];else break}if(e.NextInLML!==null)if(e.isAssigned){const h=OutRec.addOutPt(this.polyOuts,e,e.Top);if(e=this.updateEdgeIntoAEL(e),e.isWindDeletaEmpty)return;let p=e.PrevInAEL,m=e.NextInAEL;if(p!==null&&p.Curr.almostEqual(e.Bot)&&p.isFilled&&p.Curr.y>p.Top.y&&TEdge.slopesEqual(e,p,this.isUseFullRange)){const v=OutRec.addOutPt(this.polyOuts,p,e.Bot);this.joins.push(new Join(h,v,e.Top))}else if(m!==null&&m.Curr.almostEqual(e.Bot)&&m.isFilled&&m.Curr.y>m.Top.y&&TEdge.slopesEqual(e,m,this.isUseFullRange)){const v=OutRec.addOutPt(this.polyOuts,m,e.Bot);this.joins.push(new Join(h,v,e.Top))}}else e=this.updateEdgeIntoAEL(e);else u!==null?u.isAssigned?(s===DIRECTION.RIGHT?this.intersectEdges(e,u,e.Top,!1):this.intersectEdges(u,e,e.Top,!1),u.isAssigned&&showError("ProcessHorizontal error")):(this.activeEdges=e.deleteFromAEL(this.activeEdges),this.activeEdges=u.deleteFromAEL(this.activeEdges)):(e.isAssigned&&OutRec.addOutPt(this.polyOuts,e,e.Top),this.activeEdges=e.deleteFromAEL(this.activeEdges))}prepareHorzJoins(e,t){if(t){let n=this.polyOuts[e.index].Pts;e.Side===DIRECTION.RIGHT&&(n=n.prev);const s=n.point.almostEqual(e.Top)?e.Bot:e.Top;this.ghostJoins.push(new Join(n,null,s))}}updateEdgeIntoAEL(e){e.NextInLML===null&&showError("UpdateEdgeIntoAEL: invalid call");const t=e.PrevInAEL,n=e.NextInAEL;return e.NextInLML.index=e.index,t!==null?t.NextInAEL=e.NextInLML:this.activeEdges=e.NextInLML,n!==null&&(n.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,e=e.NextInLML,e.Curr.update(e.Bot),e.PrevInAEL=t,e.NextInAEL=n,e.isHorizontal||(this.scanbeam=Scanbeam.insert(e.Top.y,this.scanbeam)),e}doSimplePolygons(){let e=0,t=null,n=null;for(;e<this.polyOuts.length;)n=this.polyOuts[e++],t=n.Pts,t!==null&&n.simplify(t,this.polyOuts)}fixupIntersectionOrder(){this.intersections.sort(IntersectNode.sort),this.copyAELToSEL();const e=this.intersections.length;let t=0,n=0,s=null;for(t=0;t<e;++t){if(!this.intersections[t].edgesAdjacent){for(n=t+1;n<e&&!this.intersections[n].edgesAdjacent;)++n;if(n===e)return!1;s=this.intersections[t],this.intersections[t]=this.intersections[n],this.intersections[n]=s}this.SwapPositionsInSEL(this.intersections[t].Edge1,this.intersections[t].Edge2)}return!0}SwapPositionsInAEL(e,t){TEdge.swapPositionsInAEL(e,t)&&(e.PrevInAEL===null?this.activeEdges=e:t.PrevInAEL===null&&(this.activeEdges=t))}SwapPositionsInSEL(e,t){TEdge.swapPositionsInSEL(e,t)&&(e.PrevInSEL===null?this.sortedEdges=e:t.PrevInSEL===null&&(this.sortedEdges=t))}copyAELToSEL(){let e=this.activeEdges;for(this.sortedEdges=e;e!==null;)e=e.copyAELToSEL()}buildIntersectList(e,t){if(this.activeEdges===null)return;let n=this.activeEdges;for(this.sortedEdges=n;n!==null;)n.PrevInSEL=n.PrevInAEL,n.NextInSEL=n.NextInAEL,n.Curr.x=n.topX(t),n=n.NextInAEL;let s=!0,i=null,o=null;for(;s&&this.sortedEdges!==null;){for(s=!1,n=this.sortedEdges;n.NextInSEL!==null;)i=n.NextInSEL,o=Point.zero(),n.Curr.x>i.Curr.x?(!TEdge.intersectPoint(n,i,o,this.isUseFullRange)&&n.Curr.x>i.Curr.x+1&&showError("Intersection error"),o.y>e&&o.set(Math.abs(n.Dx)>Math.abs(i.Dx)?i.topX(e):n.topX(e),e),this.intersections.push(new IntersectNode(n,i,o)),this.SwapPositionsInSEL(n,i),s=!0):n=i;if(n.PrevInSEL!==null)n.PrevInSEL.NextInSEL=null;else break}this.sortedEdges=null}}class ClipperOffset{constructor(){this.srcPolygon=[]}execute(e,t){this.srcPolygon=this.formatPath(e);const n=[],s=this.doOffset(t),i=new Clipper;if(i.addPath(s,POLY_TYPE.SUBJECT),t>0)i.execute(CLIP_TYPE.UNION,n,POLY_FILL_TYPE.POSITIVE);else{const o=ClipperOffset.getOuterBounds(s);i.addPath(o,POLY_TYPE.SUBJECT),i.ReverseSolution=!0,i.execute(CLIP_TYPE.UNION,n,POLY_FILL_TYPE.NEGATIVE),n.length>0&&n.splice(0,1)}return n}formatPath(e){let t=e.length-1,n=0,s=0;for(;t>0&&e[0].almostEqual(e[t]);)--t;const i=[];for(i.push(e[0]),n=1;n<=t;++n)i[s].almostEqual(e[n])||(++s,i.push(e[n]));return s>=2&&getArea(i)<0&&i.reverse(),i}doOffset(e){const t=this.srcPolygon.length,n=[];let s=0;if(t==1){const i=Point.create(-1,-1);for(s=0;s<4;++s)n.push(Point.from(i).scaleUp(e).add(this.srcPolygon[0])),i.x<0?i.x=1:i.y<0?i.y=1:i.x=-1}else{const i=new Array(t);for(s=0;s<t;++s)i[s]=Point.from(this.srcPolygon[cycleIndex(s,this.srcPolygon.length,1)]).sub(this.srcPolygon[s]).normal().normalize();let o=t-1;for(s=0;s<t;++s)o=this.offsetPoint(n,i,e,s,o)}return n}offsetPoint(e,t,n,s,i){let o=t[s].cross(t[i]);if(Math.abs(o)<5e-5)return i;o>1?o=1:o<-1&&(o=-1);const a=this.srcPolygon[s],u=t[s],h=t[i];if(o*n<0)e.push(Point.from(h).scaleUp(n).add(a).clipperRound()),e.push(Point.from(a)),e.push(Point.from(u).scaleUp(n).add(a).clipperRound());else{const p=1+u.dot(h);if(p>=1.8){const m=n/p;e.push(Point.from(h).add(u).scaleUp(m).add(a).clipperRound())}else{const m=Math.tan(Math.atan2(o,h.dot(u))*.25);e.push(Point.from(h).normal().scaleUp(m).reverse().add(h).scaleUp(n).add(a)),e.push(Point.from(u).normal().scaleUp(m).add(u).scaleUp(n).add(a))}}return s}static getOuterBounds(e){const t=e.length;let n=e[0].x,s=e[0].x,i=e[0].y,o=e[0].y,a=null,u=0;for(u=0;u<t;++u)a=e[u],n=Math.min(a.x,n),s=Math.max(a.x,s),i=Math.min(a.y,i),o=Math.max(a.y,o);return[Point.create(n-10,o+10),Point.create(s+10,o+10),Point.create(s+10,i-10),Point.create(n-10,i-10)]}static create(){return new ClipperOffset}}class BoundRect{constructor(e=0,t=0,n=0,s=0){this._memSeg=new Float64Array([e,t,n,s]),this._position=new Point(this._memSeg,0),this._size=new Point(this._memSeg,2)}clone(){return new BoundRect(this._position.x,this._position.y,this._size.x,this._size.y)}update(e,t){this._position.update(e),this._size.update(t)}get position(){return this._position}get size(){return this._size}get x(){return this._position.x}get y(){return this._position.y}get width(){return this._size.x}get height(){return this._size.y}}class Polygon{constructor(){this.point=Point.zero(),this.closed=!1,this.pointCount=0,this.offset=0,this.rectangle=!1,this.bounds=new BoundRect}bind(e,t=0,n=e.length>>1){this.closedDirty=!1,this.rectangle=!1,this.closed=!1,this.pointCount=0,this.offset=0,this.pointCount=n,this.offset=t,this.memSeg=e,this.calculateBounds()}bindNFP(e,t){const n=e[NFP_INFO_START_INDEX+t],s=getUint16(n,1),i=getUint16(n,0)>>>1;this.bind(e,s,i)}clean(){this.closedDirty=!1,this.rectangle=!1,this.closed=!1,this.pointCount=0,this.offset=0,this.memSeg=null,this.point.bind(null)}rotate(e){const t=this.pointCount;let n=0;for(n=0;n<t;++n)this.at(n).rotate(e);this.calculateBounds()}at(e){if(e>=this.length)return null;const t=cycleIndex(e,this.pointCount,0);return this.point.bind(this.memSeg,this.getPointOffset(t))}pointIn(e,t=null){if(this.isBroken)return null;const n=Point.from(e),s=Point.zero(),i=Point.zero(),o=this.pointCount;let a=!1,u=0;for(u=0;u<o;++u){if(s.update(this.at(u)),i.update(this.at(cycleIndex(u,o,-1))),t!==null&&(s.add(t),i.add(t)),s.almostEqual(n)||n.onSegment(s,i))return null;s.almostEqual(i)||s.y>n.y!=i.y>n.y&&n.x<n.interpolateX(i,s)&&(a=!a)}return a}close(){this.isClosed||(this.closedDirty=!0)}reverse(){const e=this.pointCount>>1,t=this.pointCount-1;let n=0,s=0,i=0,o=0,a=0,u=0;for(n=0;n<e;++n)s=t-n,i=this.offset+(n<<1),o=this.offset+(s<<1),a=this.offset+i+1,u=this.offset+o+1,this.memSeg[i]=this.memSeg[i]+this.memSeg[o],this.memSeg[o]=this.memSeg[i]-this.memSeg[o],this.memSeg[i]=this.memSeg[i]-this.memSeg[o],this.memSeg[a]=this.memSeg[a]+this.memSeg[u],this.memSeg[u]=this.memSeg[a]-this.memSeg[u],this.memSeg[a]=this.memSeg[a]-this.memSeg[u]}exportBounds(){return this.bounds.clone()}resetPosition(){const e=Point.from(this.position),t=this.length;let n=0;for(n=0;n<t;++n)this.at(n).sub(e);this.calculateBounds()}normalize(){let e=this.pointCount;const t=Point.from(this.first),n=Point.from(this.last);for(;t.almostEqual(n);)--e,n.update(this.at(e-1));return this.pointCount!==e&&(this.pointCount=e,this.memSeg=this.memSeg.slice(this.offset,this.offset+(e<<1))),this.area>0&&this.reverse(),this.memSeg}getPointOffset(e){return this.offset+(e<<1)}calculateBounds(){if(this.isBroken)return;const e=Point.from(this.first),t=Point.from(this.last);this.closed=e.almostEqual(t);const n=this.pointCount;let s=0,i=null;for(s=0;s<n;++s)i=this.at(s),e.min(i),t.max(i);for(this.rectangle=!0,s=0;s<this.pointCount;++s)if(i=this.at(s),!((almostEqual(i.x,e.x)||almostEqual(i.x,t.x))&&(almostEqual(i.y,e.y)||almostEqual(i.y,t.y)))){this.rectangle=!1;break}t.sub(e),this.bounds.update(e,t)}get length(){const e=this.closedDirty?1:0;return this.pointCount+e}get first(){return this.at(0)}get last(){return this.at(cycleIndex(this.length,this.pointCount,-1))}get isBroken(){return this.length<3}get isClosed(){return this.closed||this.closedDirty}get isRectangle(){return this.rectangle}get area(){const e=this.pointCount,t=Point.zero(),n=Point.zero();let s=0,i=0;for(i=0;i<e;++i)t.update(this.at(cycleIndex(i,e,-1))),n.update(this.at(i)),s+=(t.x+n.x)*(t.y-n.y);return .5*s}get absArea(){return Math.abs(this.area)}get position(){return this.bounds.position}get size(){return this.bounds.size}static create(){return new Polygon}static fromMemSeg(e){const t=new Polygon;return t.bind(e),t}}const K=class K{constructor(e){this.configuration=e,this.polygon=Polygon.create()}generateBounds(e){if(this.polygon.bind(e),this.polygon.isBroken)return null;const t=getPolygonNode(-1,e),n=this.polygon.exportBounds(),s=ClipperOffset.create();this.cleanNode(t),this.offsetNode(s,t,-1),this.polygon.bind(t.memSeg),this.polygon.resetPosition();const i=this.polygon.exportBounds(),o=this.polygon.area;return{binNode:t,bounds:n,resultBounds:i,area:o}}generateTree(e,t){const n=Point.zero(),{curveTolerance:s}=this.configuration,i=s*s,o=[],a=e.length;let u=null,h=null,p=0;for(p=0;p<a;++p){if(u=e[p],h=getPolygonNode(p,u),this.cleanNode(h),this.polygon.bind(h.memSeg),this.polygon.isBroken||this.polygon.absArea<=i){console.warn("Can not parse polygon",p);continue}o.push(h)}t&&this.nestPolygons(n,o);const m=ClipperOffset.create();return this.offsetNodes(m,o,1),o}nestPolygons(e,t){const n=[];let s=0,i=0,o=t.length,a=null,u=null,h=!1;for(s=0;s<o;++s){for(a=t[s],h=!1,e.fromMemSeg(a.memSeg),i=0;i<o;++i)if(u=t[i],this.polygon.bind(u.memSeg),i!==s&&this.polygon.pointIn(e)){u.children.push(a),h=!0;break}h||n.push(a)}for(s=0;s<o;++s)n.indexOf(t[s])<0&&(t.splice(s,1),--o,--s);const p=n.length;let m=null;for(s=0;s<p;++s)m=n[s],m.children&&this.nestPolygons(e,m.children)}offsetNodes(e,t,n){const s=t.length;let i=null,o=0;for(o=0;o<s;++o)i=t[o],this.offsetNode(e,i,n),this.offsetNodes(e,i.children,-n)}offsetNode(e,t,n){if(this.configuration.spacing!==0){const{spacing:s}=this.configuration,i=.5*s*n,o=K.fromMemSeg(t.memSeg),a=e.execute(o,i*K.CLIPPER_SCALE);if(a.length!==1)throw new Error(`Error while offset ${JSON.stringify(t)}`);t.memSeg=K.toMemSeg(a[0]),this.cleanNode(t)}this.polygon.bind(t.memSeg),t.memSeg=this.polygon.normalize()}cleanNode(e){const{curveTolerance:t}=this.configuration,n=K.fromMemSeg(e.memSeg),s=[],i=new Clipper;if(i.StrictlySimple=!0,i.addPath(n,POLY_TYPE.SUBJECT),i.execute(CLIP_TYPE.UNION,s,POLY_FILL_TYPE.NON_ZERO),!s||s.length===0)return;let o=0,a=s[0],u=absArea(a),h=0,p=s.length;for(o=1;o<p;++o)h=absArea(s[o]),h>u&&(a=s[o],u=h);const m=cleanPolygon(a,t*K.CLIPPER_SCALE);p=m&&m.length?m.length:0,p&&(e.memSeg=K.toMemSeg(m))}static fromNfp(e,t,n=null){const s=n===null?-1:K.CLEAN_TRASHOLD,i=n===null,o=e[NFP_INFO_START_INDEX+t],a=getUint16(o,1),u=getUint16(o,0)>>>1;return K.fromMemSeg(e,a,u,1,n,i,s)}static fromMemSeg(e,t=0,n=e.length>>1,s=1,i=null,o=!1,a=-1){const u=s*K.CLIPPER_SCALE,h=[],p=Point.zero();let m=0;for(m=0;m<n;++m)p.fromMemSeg(e,m,t),i!==null&&p.add(i),p.scaleUp(u),o&&p.round(),h.push(Point.from(p));return a!==-1?cleanPolygon(h,a):h}static toMemSeg(e,t=null,n=null){const s=e.length,i=t||new Float64Array(s<<1),o=Point.zero();let a=0;for(a=0;a<s;++a)o.fromClipper(e[a]).scaleDown(K.CLIPPER_SCALE),n!==null&&o.add(n),o.fill(i,a);return i}static applyNfps(e,t,n){const s=new Float64Array(t),i=s[1];let o=null,a=0;for(a=0;a<i;++a)o=K.fromNfp(s,a,n),absArea(o)>K.AREA_TRASHOLD&&e.addPath(o,POLY_TYPE.SUBJECT)}static nfpToClipper(e,t){const n=e.alloc(1),s=t[1];let i=0;const o=[];for(i=0;i<s;++i)o.push(K.fromNfp(t,i));return e.malloc(n),o}static getFinalNfps(e,t,n,s,i,o){const a=e.alloc(1),u=e.get(a,0);let h=new Clipper,p=0,m=0;for(p=0;p<n.length;++p)m=generateNFPCacheKey(t.rotations,!1,n[p],s),t.nfpCache.has(m)&&(u.fromMemSeg(o,p),K.applyNfps(h,t.nfpCache.get(m),u));e.malloc(a);const v=[];if(!h.execute(CLIP_TYPE.UNION,v,POLY_FILL_TYPE.NON_ZERO))return null;let E=[];const x=K.nfpToClipper(e,i);if(h=new Clipper,h.addPaths(v,POLY_TYPE.CLIP),h.addPaths(x,POLY_TYPE.SUBJECT),!h.execute(CLIP_TYPE.DIFFERENCE,E,POLY_FILL_TYPE.NON_ZERO))return null;for(E=cleanPolygons(E,K.CLEAN_TRASHOLD),p=0;p<E.length;++p)absArea(E[p])<K.AREA_TRASHOLD&&(E.splice(p,1),--p);return E.length===0?null:E}};K.CLIPPER_SCALE=1e7,K.AREA_TRASHOLD=.1*K.CLIPPER_SCALE*K.CLIPPER_SCALE,K.CLEAN_TRASHOLD=1e-4*K.CLIPPER_SCALE;let ClipperWrapper=K;const Oe=class Oe{constructor(e){this.items=new Array(Oe.POOL_SIZE),this.used=0,this.memSeg=new Float64Array(e,0,Oe.POOL_SIZE<<1),this.memSeg.fill(0);for(let t=0;t<Oe.POOL_SIZE;++t)this.items[t]=new Point(this.memSeg,t<<1)}alloc(e){let t=0,n=0,s=~this.used,i=0;for(;s!==0;)if(i=1<<Oe.MAX_BITS-Math.clz32(s),t|=i,s&=~i,++n,n===e)return this.used|=t,t;throw Error("Pool is empty")}malloc(e){this.used&=~e}get(e,t){let n=0,s=0,i=0,o=e;for(;o!==0;){if(s=Oe.MAX_BITS-Math.clz32(o),i=1<<s,n===t)return this.items[s];o&=~i,++n}throw Error(`Can't find point with index ${t}`)}get size(){return this.memSeg.byteLength}};Oe.MAX_BITS=31,Oe.POOL_SIZE=32;let PointPool=Oe;const Xt=class Xt{constructor(e,t){Z(this,Ue);Z(this,Ae);Z(this,Tt);U(this,Ae,e),U(this,Ue,t),U(this,Tt,0)}cut(e){return new Xt(k(this,Ae).slice(0,e),k(this,Ue).slice(0,e))}clone(){return new Xt(k(this,Ae).slice(),k(this,Ue).slice())}contains(e){const t=e.source,n=this.size;let s=0;for(s=0;s<n;++s)if(k(this,Ae)[s].source===t)return!0;return!1}mate(e){let t=0,n=e.placement[0],s=e.rotation[0];for(t=0;t<e.size;++t)n=e.placement[t],s=e.rotation[t],this.contains(n)||(k(this,Ae).push(n),k(this,Ue).push(s))}swap(e){const t=e+1;if(t===this.size)return!1;const n=k(this,Ae)[e];return k(this,Ae)[e]=k(this,Ae)[t],k(this,Ae)[t]=n,!0}get placement(){return k(this,Ae)}get rotation(){return k(this,Ue)}get cutPoint(){return Math.round(Math.min(Math.max(Math.random(),.1),.9)*(k(this,Ae).length-1))}get size(){return k(this,Ae).length}get fitness(){return k(this,Tt)}set fitness(e){U(this,Tt,e)}};Ue=new WeakMap,Ae=new WeakMap,Tt=new WeakMap;let Phenotype=Xt;class GeneticAlgorithm{constructor(){Z(this,ut);Z(this,Se,[]);Z(this,_t,!0);Z(this,He,0);Z(this,Ct,0)}init(e,t,n){if(!k(this,_t))return;U(this,He,n.rotations),U(this,Ct,.01*n.mutationRate),U(this,_t,!1),U(this,ut,t);const s=Polygon.create(),i=e.slice();let o=0,a=0;i.sort((m,v)=>(s.bind(m.memSeg),o=s.absArea,s.bind(v.memSeg),a=s.absArea,a-o));const u=[];let h=0,p=null;for(h=0;h<i.length;++h)u.push(this.randomAngle(s,i[h]));for(k(this,Se).push(new Phenotype(i,u));k(this,Se).length<n.populationSize;)p=this.mutate(k(this,Se)[0]),k(this,Se).push(p)}clean(){U(this,_t,!0),U(this,He,0),U(this,Ct,0),U(this,ut,null),k(this,Se).length=0}mutate(e){const t=Polygon.create(),n=e.clone(),s=n.size;let i=0;for(i=0;i<s;++i)this.getMutate()&&n.swap(i),this.getMutate()&&(n.rotation[i]=this.randomAngle(t,n.placement[i]));return n}mate(e,t){const n=e.cutPoint,s=[e.cut(n),t.cut(n)];return s[0].mate(t),s[1].mate(e),s}randomWeightedIndividual(e){const t=e?k(this,Se).indexOf(e):-1,n=k(this,Se).slice();t!==-1&&n.splice(t,1);const s=n.length,i=Math.random(),o=2/s;let a=0,u=o/2,h=0;for(h=0;h<s;++h){if(i>a&&i<u)return n[h];a=u,u=u+o*((s-h)/s)}return n[0]}randomAngle(e,t){const n=k(this,He)-1,s=[],i=360/k(this,He);let o=0,a=0,u=0;for(a=0;a<k(this,He);++a)s.push(Math.round(a*i));for(a=n;a>0;--a)u=Math.floor(Math.random()*(a+1)),o=s[a],s[a]=s[u],s[u]=o;for(a=0;a<k(this,He);++a)if(e.bind(t.memSeg.slice()),e.rotate(s[a]),e.size.x<k(this,ut).width&&e.size.y<k(this,ut).height)return s[a];return 0}get individual(){const e=k(this,Se).length;let t=0;for(t=0;t<e;++t)if(!k(this,Se)[t].fitness)return k(this,Se)[t];k(this,Se).sort((u,h)=>u.fitness-h.fitness);const n=[k(this,Se)[0]],s=k(this,Se).length;let i=null,o=null,a=null;for(;n.length<s;)i=this.randomWeightedIndividual(),o=this.randomWeightedIndividual(i),a=this.mate(i,o),n.push(this.mutate(a[0])),n.length<s&&n.push(this.mutate(a[1]));return U(this,Se,n),k(this,Se)[1]}getMutate(){return Math.random()<k(this,Ct)}}ut=new WeakMap,Se=new WeakMap,_t=new WeakMap,He=new WeakMap,Ct=new WeakMap;class Parallel{constructor(){Z(this,Re);Z(this,Ge);Z(this,Me);Z(this,At);Z(this,ct);Z(this,ze);Z(this,ht);Z(this,ft);Z(this,We);Z(this,$e);Z(this,kt);Z(this,Ot);Z(this,pt);U(this,At,null),U(this,ct,null),U(this,ht,!0),U(this,ft,0),U(this,We,0),U(this,$e,0),U(this,kt,null),U(this,Ot,null),U(this,pt,null),this.onMessage=e=>{const t=this.clean(e.currentTarget),n=k(this,ze)[t];if(k(this,ct)[n]=e.data,k(this,ft)===k(this,$e)){k(this,Ot).call(this,k(this,ct));return}k(this,We)<k(this,$e)&&this.trigger()},this.onError=e=>{this.clean(e.currentTarget),k(this,kt).call(this,e)},U(this,Ge,navigator.hardwareConcurrency||4),U(this,Re,new Array(k(this,Ge))),U(this,Me,new Array(k(this,Ge))),U(this,ze,new Array(k(this,Ge))),k(this,Re).fill(!1),k(this,Me).fill(null),k(this,ze).fill(-1)}start(e,t,n,s=null){if(e.length===0)return this.onError(new ErrorEvent("Empty data")),!1;U(this,kt,n),U(this,Ot,t),U(this,pt,s),U(this,ft,0),U(this,We,0),U(this,At,e),U(this,$e,e.length),U(this,ct,new Array(k(this,$e)));let i=0;if(k(this,Re).fill(!1),k(this,ze).fill(-1),k(this,ht)){for(i=0;i<k(this,Ge);++i)k(this,Me)[i]=new Worker(new URL("/assets/nest.worker-gRLMMyDf.js",self.location.href),{type:"module"});U(this,ht,!1)}for(;k(this,We)<k(this,$e)&&k(this,Re).indexOf(!1)!==-1;)this.trigger();return!0}terminate(){let e=0;for(e=0;e<k(this,Ge);++e)k(this,Me)[e]!==null&&(k(this,Me)[e].terminate(),k(this,Me)[e]=null),k(this,Re)[e]=!1,k(this,ze)[e]=-1;U(this,ht,!0)}trigger(){const e=k(this,Re).indexOf(!1);if(e===-1)return!1;k(this,Re)[e]=!0;const t=k(this,Me)[e],n=k(this,We);++Nr(this,We)._,k(this,ze)[e]=n,k(this,pt)!==null&&k(this,pt).call(this,k(this,We));const s=k(this,At)[n];return t.onmessage=this.onMessage,t.onerror=this.onError,t.postMessage(s,[s]),!0}clean(e){let t=0;for(t=0;t<k(this,Ge)&&k(this,Me)[t]!==e;++t);return k(this,Re)[t]=!1,++Nr(this,ft)._,t}}Re=new WeakMap,Ge=new WeakMap,Me=new WeakMap,At=new WeakMap,ct=new WeakMap,ze=new WeakMap,ht=new WeakMap,ft=new WeakMap,We=new WeakMap,$e=new WeakMap,kt=new WeakMap,Ot=new WeakMap,pt=new WeakMap;var THREAD_TYPE=(r=>(r[r.PLACEMENT=1]="PLACEMENT",r[r.PAIR=0]="PAIR",r))(THREAD_TYPE||{});const tt=class tt{constructor(){Z(this,Ye,new Map);Z(this,dt,[]);Z(this,Ne,null);Z(this,Ft,0);Z(this,It,0)}init(e,t,n){U(this,It,serializeConfig(n)),U(this,Ne,e),U(this,Ft,n.rotations),U(this,dt,[]);const s=Polygon.create(),i=k(this,Ne).placement,o=k(this,Ne).rotation,a=i.length,u=new Map;let h=null,p=0,m=0;for(p=0;p<a;++p)for(h=i[p],h.rotation=o[p],this.updateCache(s,t,h,!0,u),m=0;m<p;++m)this.updateCache(s,i[m],h,!1,u);U(this,Ye,u)}update(e){const t=e.length;if(t!==0){let n=0,s=null;for(n=0;n<t;++n)s=new DataView(e[n]),e[n].byteLength>Float64Array.BYTES_PER_ELEMENT<<1&&k(this,Ye).set(s.getFloat64(0,!0),e[n])}}updateCache(e,t,n,s,i){const o=generateNFPCacheKey(k(this,Ft),s,t,n);if(k(this,Ye).has(o))i.set(o,k(this,Ye).get(o));else{const a=tt.rotateNodes(e,[t,n]),u=serializePolygonNodes(a,Float64Array.BYTES_PER_ELEMENT*3),h=new DataView(u);h.setFloat64(0,THREAD_TYPE.PAIR),h.setFloat64(Float64Array.BYTES_PER_ELEMENT,o),h.setFloat64(Float64Array.BYTES_PER_ELEMENT<<1,k(this,It)),k(this,dt).push(u)}}clean(){k(this,Ye).clear(),U(this,dt,[]),U(this,Ne,null)}getPlacementData(e){const t=Polygon.create(),n=serializeMapToBuffer(k(this,Ye)),s=n.byteLength,i=tt.rotateNodes(t,k(this,Ne).placement),o=serializePolygonNodes(i,Float64Array.BYTES_PER_ELEMENT*4+s),a=new DataView(o);return a.setFloat64(0,THREAD_TYPE.PLACEMENT),a.setFloat64(Float64Array.BYTES_PER_ELEMENT,k(this,It)),a.setFloat64(Float64Array.BYTES_PER_ELEMENT*2,e),a.setFloat64(Float64Array.BYTES_PER_ELEMENT*3,s),new Uint8Array(o,Float64Array.BYTES_PER_ELEMENT*4).set(new Uint8Array(n)),[o]}get nfpPairs(){return k(this,dt)}get placementCount(){return k(this,Ne).placement.length}get fitness(){return k(this,Ne).fitness}set fitness(e){k(this,Ne).fitness=e}static rotateNodes(e,t){const n=tt.cloneNodes(t),s=n.length;let i=0;for(i=0;i<s;++i)tt.rotateNode(e,n[i],n[i].rotation);return n}static rotateNode(e,t,n){e.bind(t.memSeg),e.rotate(n);const s=t.children.length;let i=0;for(i=0;i<s;++i)tt.rotateNode(e,t.children[i],n)}static cloneNodes(e){const t=[],n=e.length;let s=null,i=0;for(i=0;i<n;++i)s=e[i],t.push({...s,memSeg:s.memSeg.slice(),children:tt.cloneNodes(s.children)});return t}};Ye=new WeakMap,dt=new WeakMap,Ne=new WeakMap,Ft=new WeakMap,It=new WeakMap;let NFPStore=tt;class PolygonPacker{constructor(){Z(this,mt);Z(this,vt);Z(this,gt);Z(this,Dt);Z(this,Lt);Z(this,yt);Z(this,rt);Z(this,Rt);Z(this,nt);Z(this,Le);Z(this,Et);Z(this,qe);U(this,mt,new GeneticAlgorithm),U(this,vt,null),U(this,gt,0),U(this,Dt,null),U(this,Lt,null),U(this,yt,!1),U(this,rt,null),U(this,Rt,0),U(this,nt,0),U(this,Le,new NFPStore),U(this,Et,new Parallel),U(this,qe,[]),this.onSpawn=e=>{U(this,Rt,e/k(this,Le).nfpPairs.length)}}start(e,t,n,s,i){const o=new ClipperWrapper(e),a=o.generateBounds(n);U(this,vt,a.binNode),U(this,Dt,a.bounds),U(this,Lt,a.resultBounds),U(this,gt,a.area),U(this,yt,!0),U(this,qe,o.generateTree(t,e.useHoles)),this.launchWorkers(e,i),U(this,nt,setInterval(()=>{s(k(this,Rt))},100))}launchWorkers(e,t){k(this,mt).init(k(this,qe),k(this,Lt),e),k(this,Le).init(k(this,mt).individual,k(this,vt),e),k(this,Et).start(k(this,Le).nfpPairs,n=>this.onPair(e,n,t),this.onError,this.onSpawn)}onError(e){console.log(e.message),console.log(e.error)}onPair(e,t,n){k(this,Le).update(t),k(this,Et).start(k(this,Le).getPlacementData(k(this,gt)),s=>this.onPlacement(e,s,n),this.onError)}onPlacement(e,t,n){if(t.length===0)return;let s=0,i=new Float64Array(t[0]),o=null;for(k(this,Le).fitness=i[0],s=1;s<t.length;++s)o=new Float64Array(t[s]),o[0]<i[0]&&(i=o);let a=null,u=0,h=0,p=0;if(!k(this,rt)||i[0]<k(this,rt)[0]){U(this,rt,i);const m=Math.abs(k(this,gt)),v=Polygon.create(),E=i[1];let x=0,P=0,T=0,C=0,I=0,O=0,G=0,F=0,Y=0;for(F=0;F<E;++F)for(T+=m,I=i[2+F],O=getUint16(I,1),G=getUint16(I,0),x+=G,Y=0;Y<G;++Y)C=getUint16(i[O+Y],1),v.bind(k(this,qe)[C].memSeg),P+=v.absArea;u=k(this,Le).placementCount,h=x,p=P/T,a={placementsData:i,nodes:k(this,qe),bounds:k(this,Dt),angleSplit:e.rotations}}k(this,yt)&&(n(a,p,h,u),this.launchWorkers(e,n))}stop(e){U(this,yt,!1),k(this,nt)&&(clearInterval(k(this,nt)),U(this,nt,0)),k(this,Et).terminate(),e&&(U(this,qe,[]),U(this,rt,null),U(this,vt,null),k(this,mt).clean(),k(this,Le).clean())}}mt=new WeakMap,vt=new WeakMap,gt=new WeakMap,Dt=new WeakMap,Lt=new WeakMap,yt=new WeakMap,rt=new WeakMap,Rt=new WeakMap,nt=new WeakMap,Le=new WeakMap,Et=new WeakMap,qe=new WeakMap;class PlacementWrapper{constructor(e,t){this._angleSplit=t,this._placementCount=e[1],this._memSeg=e,this._placement=0,this._offset=0,this._size=0,this._pointData=0,this._pointOffset=0}bindPlacement(e){this._placement=this._memSeg[2+e],this._offset=this._placement>>>16,this._size=this._placement&65535}bindData(e){this._pointData=this._memSeg[this._offset+e],this._pointOffset=this._offset+this._size+(e<<1)}get placementCount(){return this._placementCount}get offset(){return this._offset}get size(){return this._size}get id(){return this._pointData>>>16}get rotation(){return Math.round((this._pointData&65535)*360/this._angleSplit)}get x(){return this._memSeg[this._pointOffset]}get y(){return this._memSeg[this._pointOffset+1]}}var library={};let defaultColor="#aad7f2",loaded=!1;const init=async()=>{if(loaded)return Promise.resolve(!0);const r=await Module({locateFile:()=>opencascadeWasm});return loaded=!0,setOC(r),console.log(replicad),!0},started=init();function toGeometry(r){return typeof r=="number"?library[r]:r.geometry?r:{geometry:[r],tags:[],color:defaultColor,bom:[]}}function generateUniqueID(){const r=new Date().getTime(),e=Math.floor(Math.random()*1e3);return r+e}function deleteFromLibrary(r){return started.then(()=>{delete library[r]})}function createMesh(r){return started.then(()=>[])}function circle(r,e){return started.then(()=>{const t=new Plane().pivot(0,"Y");return library[r]={geometry:[drawCircle(e/2)],tags:[],plane:t,color:defaultColor,bom:[]},!0})}function rectangle(r,e,t){return started.then(()=>{const n=new Plane().pivot(0,"Y");return library[r]={geometry:[drawRectangle(e,t)],tags:[],plane:n,color:defaultColor,bom:[]},!0})}function regularPolygon(r,e,t){return started.then(()=>{const n=new Plane().pivot(0,"Y");return library[r]={geometry:[drawPolysides(e,t)],tags:[],plane:n,color:defaultColor,bom:[]},!0})}async function text(r,e,t,n){await loadFont(fonts[n]).then(()=>(console.log("Font loaded"),started.then(()=>{const s=new Plane().pivot(0,"Y"),i=drawText(e,{startX:0,startY:0,fontSize:t,font:n});return library[r]={geometry:[i],tags:[],plane:s,color:defaultColor,bom:[]},!0}))).catch(s=>{throw new Error("Error loading font: ",s)})}function loftShapes(r,e){return started.then(()=>{let t=[];e.forEach(i=>{if(is3D(library[i]))throw new Error("Parts to be lofted must be sketches");let a=digFuse(library[i]).sketchOnPlane(library[i].plane);if(!a.sketches)t.push(a);else throw new Error("Sketches to be lofted can't have interior geometries")});let n=t.shift();const s=new Plane().pivot(0,"Y");return library[r]={geometry:[n.loftWith([...t])],tags:[],plane:s,color:defaultColor,bom:[]},!0})}function extrude(r,e,t){return started.then(()=>(library[r]=actOnLeafs(library[e],n=>({geometry:[n.geometry[0].clone().sketchOnPlane(n.plane).extrude(t)],tags:n.tags,plane:n.plane,color:n.color,bom:n.bom})),!0))}function is3D(r){return isAssembly(r)?r.geometry.some(e=>is3D(e)):r.geometry[0].mesh!==void 0}function move(r,e,t,n,s=null){return started.then(()=>{if(is3D(library[r])){let i=actOnLeafs(library[r],o=>({geometry:[o.geometry[0].clone().translate(e,t,n)],plane:o.plane,tags:o.tags,color:o.color,bom:o.bom}),library[r].plane);if(s)library[s]=i;else return i}else{let i=actOnLeafs(library[r],o=>({geometry:[o.geometry[0].clone().translate([e,t])],tags:o.tags,plane:o.plane.translate([0,0,n]),color:o.color,bom:o.bom}),library[r].plane.translate([0,0,n]));if(s)library[s]=i;else return i}return!0})}function rotate(r,e,t,n,s=null){let i=toGeometry(r);return started.then(()=>{if(is3D(i)){let o=actOnLeafs(i,a=>({geometry:[a.geometry[0].clone().rotate(e,[0,0,0],[1,0,0]).rotate(t,[0,0,0],[0,1,0]).rotate(n,[0,0,0],[0,0,1])],tags:a.tags,plane:a.plane,color:a.color,bom:a.bom}));if(s)library[s]=o;else return o}else{let o=actOnLeafs(toGeometry(r),a=>({geometry:[a.geometry[0].clone().rotate(n,[0,0,0],[0,0,1])],tags:a.tags,plane:a.plane.pivot(e,"X").pivot(t,"Y"),color:a.color,bom:a.bom}));if(s)library[s]=o;else return o}})}function difference(r,e,t){return started.then(()=>{let n;if(is3D(library[e])&&is3D(library[t])||!is3D(library[e])&&!is3D(library[t]))n=digFuse(library[t]),library[r]=actOnLeafs(library[e],s=>({geometry:[s.geometry[0].clone().cut(n)],tags:s.tags,color:s.color,plane:s.plane,bom:s.bom}));else throw new Error("Both inputs must be either 3D or 2D");return!0})}function shrinkWrapSketches(r,e){return started.then(()=>{let t=[];if(e.every(n=>!is3D(library[n]))){let n=[];e.forEach(o=>{let a=digFuse(library[o]);if(n.push(a),a.innerShape.blueprints)throw new Error("Sketches to be lofted can't have interior geometries");t.push(library[o].bom)});let s=chainFuse(n);const i=new Plane().pivot(0,"Y");return library[r]={geometry:[shrinkWrap(s,50)],tags:[],color:defaultColor,plane:i,bom:t},!0}else throw new Error("All inputs must be sketches")})}function intersect(r,e,t=null){let n=toGeometry(r),s=toGeometry(e);return started.then(()=>{let i=actOnLeafs(n,o=>{const a=digFuse(s);return{geometry:[o.geometry[0].clone().intersect(a)],tags:o.tags,color:o.color,plane:o.plane,bom:o.bom}});return t!=null?(library[t]=i,!0):i})}function tag(r,e,t){return started.then(()=>(library[r]={geometry:library[e].geometry,bom:library[e].bom,tags:[...t,...library[e].tags],color:library[e].color,plane:library[e].plane},!0))}function extractAllTags(r,e){return started.then(()=>{function t(o){let a=new Set(o.tags||[]);return isAssembly(o)&&o.geometry.forEach(u=>{t(u).forEach(p=>a.add(p))}),a}const n=library[r];if(!n)throw new Error(`Geometry with ID ${r} not found in library`);const s=t(n);let i=Array.from(s);return i=["Select Tag",...new Set(i)],i})}async function Rotate(r,e,t,n){try{return await rotate(r,e,t,n)}catch(s){throw console.error("Error rotating geometry:",s),s}}async function Move(r,e,t,n){try{return await move(r,e,t,n)}catch(s){throw console.error("Error moving geometry:",s),s}}async function Assembly(r){try{return await assembly(r)}catch(e){throw console.error("Error assembling geometry:",e),e}}async function Intersect(r,e){try{return await intersect(r,e)}catch(t){throw console.error("Error intersecting geometry:",t),t}}async function code(targetID,code,argumentsArray){await started;let keys1=["Rotate","Move","Assembly","Intersect"],inputValues=[Rotate,Move,Assembly,Intersect];for(const[r,e]of Object.entries(argumentsArray))keys1.push(`${r}`),inputValues.push(e);var result=await eval("(async ("+keys1.join(",")+") => {"+code+"})("+inputValues.join(",")+")");return library[targetID]=result,typeof result=="number"?result:!0}function color(r,e,t){return started.then(()=>{library[r]=actOnLeafs(library[e],n=>(t=="#D9544D"&&n.tags.push("keepout"),{geometry:n.geometry,tags:[...n.tags],color:t,bom:n.bom,plane:n.plane}))})}function bom(r,e,t){return started.then(()=>(library[e].bom!=[]&&(t=[...library[e].bom,t]),library[r]={geometry:library[e].geometry,tags:[...library[e].tags],bom:t,color:library[e].color},!0))}function extractTag(r,e,t){return started.then(()=>{let n=extractTags(library[e],t);if(n!=!1)library[r]={bom:n.bom,geometry:n.geometry,tags:n.tags,color:n.color};else throw new Error("Tag not found");return!0})}function output(r,e){return started.then(()=>{if(library[e]!=null)library[r]=library[e];else throw new Error("Nothing is connected to the output");return!0})}function molecule(r,e){return started.then(()=>{if(library[e]!=null)library[r]=library[e];else throw new Error("output ID is undefined");return!0})}function extractBomList(r){return library[r].bom!==void 0?library[r].bom:!1}function visExport(r,e,t){return started.then(()=>{let n=extractKeepOut(library[e]),s=digFuse(n),i=t=="STL"?"#91C8D5":t=="STEP"?"#ACAFDD":"#3C3C3C",o;return t=="SVG"?is3D(library[e])?o=[drawProjection(s,"top").visible]:o=[s]:o=[s],library[r]={geometry:o,color:i,plane:library[e].plane},!0})}function downExport(r,e,t,n){return started.then(()=>{let s=n=="Inches"?1:n=="MM"?25.4:1,i=t/s;if(e=="SVG"){let a=library[r].geometry[0].clone().scale(i).toSVG(i);var o=new Blob([a],{type:"image/svg+xml;charset=utf-8"});return o}else return e=="STL"?library[r].geometry[0].clone().blobSTL():library[r].geometry[0].clone().blobSTEP()})}async function importingSTEP(r,e){let t=await importSTEP(e);return library[r]={geometry:[t],tags:[],color:defaultColor,bom:[]},!0}async function importingSTL(r,e){let t=await importSTL(e);return library[r]={geometry:[t],tags:[],color:defaultColor,bom:[]},!0}async function importingSVG(r,e,t){const n=t+t*.05;drawRectangle(n,n).sketchOnPlane().extrude(1);const s=e;try{let i=await drawSVG(s,{width:t}),o=i.boundingBox.center;return library[r]={geometry:[i.clone().translate(-o[0],-o[1])],tags:[],plane:new Plane().pivot(0,"Y"),color:defaultColor,bom:[]},console.log("SVG imported successfully"),!0}catch(i){throw console.error("Error importing SVG:",i),i}}const prettyProjection=r=>{const e=r.boundingBox,t=e.center,n=[e.center[0]+e.width,e.center[1]-e.height,e.center[2]+e.depth],s=new ProjectionCamera(n).lookAt(t),{visible:i,hidden:o}=drawProjection(r,s);return{visible:i,hidden:o}};function generateThumbnail(r){return started.then(()=>{if(library[r]!=null){let e,t,n;return is3D(library[r])?(e=digFuse(library[r]),t=prettyProjection(e),n=t.visible.toSVG()):(e=digFuse(library[r]).sketchOnPlane("XY").extrude(1e-4),t=drawProjection(e,"top").visible,n=t.toSVG()),n}else throw new Error("can't generate thumbnail for undefined geometry")})}function extractTags(r,e){if(r.tags.includes(e))return r;if(isAssembly(r)){let t=[];return r.geometry.forEach(n=>{let s=extractTags(n,e);s!=!1&&t.push(s)}),t.length>0?{geometry:t,tags:r.tags,color:r.color,bom:r.bom}:!1}else return!1}function extractKeepOut(r){if(r.tags.includes("keepout"))return!1;if(isAssembly(r)){let e=[];return r.geometry.forEach(t=>{let n=extractKeepOut(t);n!=!1&&e.push(n)}),e.length>0?{geometry:e,tags:r.tags,color:r.color,bom:r.bom}:!1}else return r}function layout(r,e,t,n,s){return started.then(()=>{let i=generateUniqueID();var o=rotateForLayout(i,e,s);return computePositions(o,t,n,e,r,s).then(u=>{if(applyLayout(r,i,u,s),u.length==0)throw new Error("Failed to place any parts. Are sheet dimensions right?");{let h=o.length-u.flat().length;if(h>0){const p=h+" parts are too big to fit on this sheet size. Failed layout for "+h+" part(s)";throw new Error(p)}}return u})})}function displayLayout(r,e,t,n){let s=generateUniqueID();rotateForLayout(s,e,n),applyLayout(r,s,t,n)}function rotateForLayout(r,e,t){var n=.001;function s(m,v){return Math.abs(m-v)<n}let i=library[e],o=0,a=[];const u={},h=actOnLeafs(i,m=>{const v=[];let E=!1,x=0;if(m.geometry[0].faces.forEach(T=>{if(T.geomType=="PLANE"){E=!0;const C=moveFaceToCuttingPlane(m.geometry[0],T);C.boundingBox.bounds[0][2]>-1*n&&v.push({face:T,geom:C,faceIndex:x,thickness:C.boundingBox.depth})}x++}),v.length==0&&!E)throw new Error("Upstream object uncuttable, has no flat face");u[o]=v;const P={geometry:m.geometry,id:o,tags:m.tags,color:m.color,plane:m.plane,bom:m.bom};return o++,P});let p=-1;if(t.units){const m=t.units=="MM"?25.4:1,v=Object.values(u).map(E=>Math.min(...E.map(x=>x.thickness)));Math.max(...v)<=m+n&&(p=Math.max(...v))}return library[r]=actOnLeafs(h,m=>{let v=u[m.id],E;if(v.length==1)E=v[0];else{const T=v.map((C,I)=>({candidate_index:I,thickness:C.thickness,area:areaApprox(C.face.UVBounds),interiorWires:C.face.clone().innerWires().length}));T.sort((C,I)=>s(C.thickness,I.thickness)?C.interiorWires!=I.interiorWires?C.interiorWires-I.interiorWires:Math.abs(C.area-I.area)>n?I.area-C.area:0:s(C.thickness,p)?-1:s(I.thickness,p)?1:C.thickness-I.thickness),E=v[T[0].candidate_index]}let P={geometry:[E.geom.clone().translate(-1*E.face.center.x,-1*E.face.center.y,0)],id:m.id,referencePoint:E.face.center,tags:m.tags,color:m.color,plane:m.plane,bom:m.bom};return a.push({id:m.id,shape:P.geometry[0].faces[E.faceIndex]}),P}),a}function applyLayout(r,e,t,n){console.log("Applying layout"),console.log(t),library[r]=actOnLeafs(library[e],s=>{let i;for(var o=0;o<t.length;o++){let u=t[o].filter(h=>h.id==s.id);if(u.length==1){i=u[0];break}else u.length>1&&console.warn("Found more than one transformation for same id")}if(i==null){console.log("didn't find transform for id: "+s.id);return}return{geometry:[s.geometry[0].clone().rotate(i.rotate,new Vector([0,0,0]),new Vector([0,0,1])).translate(i.translate.x,i.translate.y+o*n.height,0)],tags:s.tags,color:s.color,plane:s.plane,bom:s.bom,id:s.id}})}function asFloat64(r){const e=new Float64Array(r.length*2+2);let t=0;if(r.forEach(n=>{e[t]=n.x,e[t+1]=n.y,t+=2}),e[t]=r[0].x,e[t+1]=r[0].y,e.filter(n=>!Number.isFinite(n)).length>0)throw new Error("NaN points in Float64Array from: "+JSON.stringify(r));return e}function computePositions(r,e,t,n,s,i){console.log("Starting to compute positions for shapes: "),console.log(r);const o=.1,a=3e4,u={curveTolerance:.3,spacing:i.partPadding+o*2,rotations:12,populationSize:8,mutationRate:50,useHoles:!1},h=r.map(P=>{const C=P.shape.clone().outerWire().meshEdges({tolerance:.5,angularTolerance:5});return asFloat64(preparePoints(C,o))}),p=asFloat64([{x:0,y:0},{x:0,y:i.height},{x:i.width,y:i.height},{x:i.width,y:0}]),m=new PolygonPacker;let v=0;const E=P=>{v++,e(.1+.9*(v*100/a),proxy(()=>{m.stop()}))};return new Promise((P,T)=>{let C=null;const I=(O,G,F,Y)=>{if(F>0){let V=translatePlacements(O,F,Y);t(V),C=V}};try{m.start(u,h,p,E,I),setTimeout(()=>{console.log("Timeout reached. Stopping packer."),C!=null?(m.stop(),P(C)):(m.stop(),T(new Error("Failed to find placements within the time limit.")))},a)}catch(O){console.log("error in nesting engine: "+O),m.stop(),T(O)}})}function translatePlacements(r,e,t){const n=new PlacementWrapper(r.placementsData,r.angleSplit);console.log("new placement received. "+e+" of "+t+" parts placed. score: "+r.placementsData[0]);const s=[];for(let i=0;i<n.placementCount;i++){const o=[];n.bindPlacement(i);for(let a=0;a<n.size;a++)n.bindData(a),o.push({id:n.id,rotate:n.rotation,translate:{x:n.x,y:n.y}});s.push(o)}return s}function preparePoints(r,e){let t=[];r.edgeGroups.forEach(a=>{t.push({startPoint:{x:r.lines[a.start*3],y:r.lines[a.start*3+1]},start:a.start*3,len:a.count,edgeId:a.edgeId});const u=(a.start+a.count-1)*3;t.push({startPoint:{x:r.lines[u],y:r.lines[u+1]},start:u,len:-1*a.count,edgeId:a.edgeId})});const n=(a,u)=>{const h=Math.abs(a.x-u.x)<e,p=Math.abs(a.y-u.y)<e;return h&&p},s=[];let i=t[0];for(;t.length>0;){for(var o=1;o<Math.abs(i.len);o++){let u=o*3;i.len<0&&(u=-1*u);const h=i.start+u;s.push({x:r.lines[h],y:r.lines[h+1]})}t=t.filter(u=>u.edgeId!=i.edgeId);const a=t.filter(u=>n(s[s.length-1],u.startPoint));if(t.length>0&&a.length!=1)throw new Error("Geometry error when preparing for cutlayout. Part perimiter has an edge with: "+a.length+" continuations");i=a[0]}return s}function moveFaceToCuttingPlane(r,e){let t=e.pointOnSurface(0,0),n=e.normalAt(),s=new Vector([0,0,-1]),i=n.cross(s);if(i.Length==0)return n.dot(s)<0&&(r=r.clone().rotate(180,t,new Vector([1,0,0]))),r.clone().translate(0,0,-1*t.z);let o=Math.acos(n.dot(s)/(s.Length*n.Length))*360/(2*Math.PI);return r.clone().rotate(o,t,i).translate(0,0,-1*t.z)}function areaApprox(r){return(r.uMax-r.uMin)*(r.vMax-r.vMin)}function isAssembly(r){return r.geometry.length>0?!!r.geometry[0].geometry:!1}function cutAssembly(r,e,t){try{if(isAssembly(r)){let s=r.geometry,i=[];s.forEach(a=>{i.push(cutAssembly(a,e,t))});let o=generateUniqueID();return library[o]={geometry:i,tags:r.tags,bom:r.bom},library[o]}else{let s=function(o){return Array.from(iterTopo(o.wrapped,"solid"),a=>new Solid(a))};var n=r.geometry[0];if(e.forEach(o=>{n=recursiveCut(n,toGeometry(o))}),n.wrapped){let o=s(n);if(o.length>1){let a=[];o.forEach(h=>{a.push({geometry:[h],tags:r.tags,color:r.color,bom:r.bom,plane:r.plane})});let u=generateUniqueID();return library[u]={geometry:a,tags:r.tags,color:r.color,bom:r.bom,plane:r.plane},library[u]}}let i=generateUniqueID();return library[i]={geometry:[n],tags:r.tags,color:r.color,bom:r.bom,plane:r.plane},library[i]}}catch{throw new Error("Cut Assembly failed")}}function recursiveCut(r,e){try{let t=r;if(isAssembly(e)){for(let n=0;n<e.geometry.length;n++)t=recursiveCut(t,e.geometry[n]);return t}else{let n;return n=r.cut(e.geometry[0]),n}}catch{throw new Error("Recursive Cut failed")}}async function assembly(r,e=null){if(!Array.isArray(r)||r.length===0)throw new Error("inputIDs must be a non-empty array");await started;let t=[],n=[];if(r.length>1){const o=r.every(u=>is3D(toGeometry(u))),a=r.every(u=>!is3D(toGeometry(u)));if(o||a)for(let u=0;u<r.length;u++){const h=toGeometry(r[u]);t.push(cutAssembly(h,r.slice(u+1),e)),h.bom.length>0&&n.push(...h.bom)}else throw new Error("Assemblies must be composed from only sketches OR only solids")}else{const o=toGeometry(r[0]);t.push(o),o.bom.length>0&&n.push(...o.bom)}const s=new Plane().pivot(0,"Y");let i={geometry:t,plane:s,tags:[],bom:n};if(e!=null)library[e]=i;else return i;return!0}function fusion(r,e){return started.then(()=>{let t=[],n=[];e.forEach(i=>{if(e.every(o=>is3D(library[o])))t.push(digFuse(library[i]));else if(e.every(o=>!is3D(library[o])))t.push(digFuse(library[i]));else throw new Error("Fusion must be composed from only sketches OR only solids");library[i].bom.length>0&&n.push(...library[i].bom)});const s=new Plane().pivot(0,"Y");return library[r]={geometry:[chainFuse(t)],tags:[],bom:n,plane:s,color:defaultColor},!0})}function actOnLeafs(r,e,t){if(t=t||r.plane,r.geometry.length==1&&r.geometry[0].geometry==null)return e(r);{let n=[];return r.geometry.forEach(s=>{const i=actOnLeafs(s,e);i!=null&&n.push(i)}),{geometry:n,tags:r.tags,bom:r.bom,plane:t}}}function flattenAssembly(r){var e=[];return r.geometry.length==1&&r.geometry[0].geometry==null?(e.push({geometry:r.geometry[0],color:r.color}),e):(r.geometry.forEach(t=>{e.push(...flattenAssembly(t))}),e)}function chainFuse(r){try{let e=r[0].clone();for(let t=1;t<r.length;t++)e=e.fuse(r[t]);return e}catch{throw new Error("Fusion failed")}}function digFuse(r){var e=[];return isAssembly(r)?(r.geometry.forEach(t=>{isAssembly(t)?e.push(digFuse(t)):e.push(t.geometry[0])}),chainFuse(e)):r.geometry[0]}async function generateDefaultMesh(r){return await text(r,"No output to display",28,"ROBOTO")}function resetView(){return started.then(()=>[])}function getLargestBoundingBox(r){let e=[1/0,1/0,1/0],t=[-1/0,-1/0,-1/0];if(!Array.isArray(r))throw new Error("meshArray is not defined or not an array");r.forEach(o=>{if(!o.geometry||!o.geometry.boundingBox||!Array.isArray(o.geometry.boundingBox.bounds))throw new Error("Invalid mesh geometry or boundingBox structure");let a=o.geometry.boundingBox.bounds;if(a.length<2||!Array.isArray(a[0])||!Array.isArray(a[1]))throw new Error("boundingBox bounds are not properly defined");let u=a[0],h=a[1];e[0]=Math.min(e[0],u[0]),e[1]=Math.min(e[1],u[1]),e[2]=Math.min(e[2],u[2]),t[0]=Math.max(t[0],h[0]),t[1]=Math.max(t[1],h[1]),t[2]=Math.max(t[2],h[2])});let n=t[0]-e[0],s=t[1]-e[1],i=t[2]-e[2];return{width:n,height:s,depth:i}}function calculateZoom(r){try{const e={width:312.0005000624958,height:312.00074999364347,depth:432.0009977339615},t=.5,n=Math.sqrt(Math.pow(e.width,2)+Math.pow(e.height,2)+Math.pow(e.depth,2)),s=Math.sqrt(Math.pow(r.width,2)+Math.pow(r.height,2)+Math.pow(r.depth,2));return t*n/s}catch{throw new Error("Error calculating zoom level")}}function generateCameraPosition(r){try{let e=getLargestBoundingBox(r);return calculateZoom(e)}catch(e){throw new Error(e)}}function generateDisplayMesh(r){return started.then(()=>{console.log("Generating display mesh for "+r),(library[r]==null||r==null)&&(console.log("ID undefined or not found in library"),generateDefaultMesh(r).then(i=>{console.log(i)}));let e=[];flattenAssembly(library[r]).forEach(i=>{var o=[];if(i.geometry.mesh==null){let a=library[r].plane;o=i.geometry.clone().sketchOnPlane(a).extrude(1e-4)}else o=i.geometry;e.push({color:i.color,geometry:o})});let n;try{n=generateCameraPosition(e)}catch{console.log("Error generating camera position"),n=1}let s=[];return e.forEach(i=>{try{if(i.geometry.mesh==null){const o=i.sketchOnPlane(sketchPlane).clone().extrude(1e-4);return{faces:o.mesh({tolerance:.1,angularTolerance:.5}),edges:o.meshEdges({tolerance:.1,angularTolerance:.5})}}else s.push({cameraZoom:n,faces:i.geometry.mesh({tolerance:.1,angularTolerance:.5}),edges:i.geometry.meshEdges({tolerance:.1,angularTolerance:.5}),color:i.color})}catch(o){throw new Error("Error generating display mesh"+o)}}),s})}expose({deleteFromLibrary,importingSTEP,importingSTL,importingSVG,createMesh,circle,color,code,regularPolygon,rectangle,generateDisplayMesh,extrude,fusion,extractBomList,generateThumbnail,visExport,downExport,shrinkWrapSketches,move,rotate,difference,tag,extractAllTags,layout,displayLayout,output,molecule,bom,extractTag,intersect,assembly,loftShapes,text,resetView})})();
